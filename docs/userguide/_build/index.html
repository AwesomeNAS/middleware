<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Section 1: Introduction and Installation &mdash; freenas 9.2.2 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '9.2.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="freenas 9.2.2 documentation" href="#" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="test.html">freenas 9.2.2 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <p><a class="reference internal" href="_images/100000000000026400000318EBB4C7DF.jpg"><img alt="100000000000026400000318EBB4C7DF_jpg" src="_images/100000000000026400000318EBB4C7DF.jpg" style="width: 6.9173in; height: 9.4484in;" /></a></p>
<p><em>FreeNAS® is © 2011-</em>
<em>2</em>
<a href="#id1"><span class="problematic" id="id2">*</span></a>014 iXsystems *</p>
<p><a href="#id3"><span class="problematic" id="id4">*</span></a>FreeNAS® and the FreeNAS® logo are registered trademarks of iXsystems. *</p>
<p><em>FreeBSD is a registered trademark of the FreeBSD Foundation</em></p>
<p><em>Cover art by Jenny Rosenberg</em></p>
<div class="section" id="section-1-introduction-and-installation">
<h1>Section 1: Introduction and Installation<a class="headerlink" href="#section-1-introduction-and-installation" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="preface">
<h1>Preface<a class="headerlink" href="#preface" title="Permalink to this headline">¶</a></h1>
<p>Written by users of the FreeNAS® network-attached storage operating system.</p>
<p>Version 9.2.2</p>
<p>Published
February 7, 2014</p>
<p>Copyright © 2011-2014
<a class="reference external" href="http://www.ixsystems.com/">iXsystems</a>
.</p>
<p>This Guide covers the installation and use of FreeNAS® 9.2.2.
If you are running a version of FreeNAS® that is earlier than FreeNAS® 9.2.2, it is recommended that you upgrade to or install FreeNAS® 9.2.2.
This version fixes many bugs from previous versions and several features mentioned in this Guide were not available in earlier versions of FreeNAS®.</p>
<p>The FreeNAS® Users Guide is a work in progress and relies on the contributions of many individuals. If you are interested in helping us to improve the Guide, visit
<a class="reference external" href="http://doc.freenas.org/">doc.freenas.org</a>
and create a wiki login account. If you use IRC Freenode, you are welcome to join the #freenas channel where you will find other FreeNAS® users.</p>
<p>The FreeNAS® Users Guide is freely available for sharing and redistribution under the terms of the
<a class="reference external" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution License</a>
. This means that you have permission to copy, distribute, translate, and adapt the work as long as you attribute iXsystems as the original source of the Guide.</p>
<p>FreeNAS® and the FreeNAS® logo are registered trademarks of iXsystems.</p>
<p>3ware® and LSI® are trademarks or registered trademarks of LSI Corporation.</p>
<p>Active Directory® is a registered trademark or trademark of Microsoft Corporation in the United States and/or other countries.</p>
<p>Apple, Mac and Mac OS are trademarks of Apple Inc., registered in the U.S. and other countries.</p>
<p>Chelsio® is a registered trademark of Chelsio Communications.</p>
<p>Cisco® is a registered trademark or trademark of Cisco Systems, Inc. and/or its affiliates in the United States and certain other countries.</p>
<p>Django® is a registered trademark of Django Software Foundation.</p>
<p>Facebook® is a registered trademark of Facebook Inc.</p>
<p>FreeBSD and the FreeBSD logo are registered trademarks of the FreeBSD Foundation.</p>
<p>Fusion-io is a trademark or registered trademark of Fusion-io, Inc.</p>
<p>Intel, the Intel logo, Pentium Inside, and Pentium are trademarks of Intel Corporation in the U.S. and/or other countries.</p>
<p>LinkedIn® is a registered trademark of LinkedIn Corporation.</p>
<p>Linux® is a registered trademark of Linus Torvalds.</p>
<p>Marvell® is a registered trademark of Marvell or its affiliates.</p>
<p>Twitter is a trademark of Twitter, Inc. in the United States and other countries.</p>
<p>UNIX® is a registered trademark of The Open Group.</p>
<p>VirtualBox® is a registered trademark of Oracle.</p>
<p>VMware® is a registered trademark of VMware, Inc.</p>
<p>Wikipedia® is a registered trademark of the Wikimedia Foundation, Inc., a non-profit organization.</p>
<p>Windows® is a registered trademark of Microsoft Corporation in the United States and other countries.</p>
<p><strong>Typographic Conventions</strong></p>
<p>The
FreeNAS®</p>
<p>9.2.2 Users
Guide
uses the following typographic conventions:</p>
<p><strong>bold text:</strong>
represents a command written at the command line. In usage examples, the font is changed to
Courier 10
with any command output displayed in unbolded text.</p>
<p><em>italic text:</em>
used to represent device names, file name paths, or text that is input into a GUI field.</p>
<p><strong>bold italic text:</strong>
** **
used to emphasize an important point.</p>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>FreeNAS® is an embedded open source network-attached storage (NAS) system based on FreeBSD and released under a BSD license. A NAS provides an operating system that has been optimized for file storage and sharing.</p>
<p>Notable features in FreeNAS® include:</p>
<ul class="simple">
<li>supports AFP, CIFS, FTP, NFS, SSH (including SFTP), and TFTP as file sharing mechanisms</li>
<li>supports exporting file or device extents via iSCSI</li>
<li>supports Active Directory or LDAP for user authentication as well as manual user and group creation</li>
<li>supports the creation and import of UFS2 based volumes, including gmirror, gstripe, and graid3</li>
<li>supports the creation and import of
<a class="reference external" href="http://en.wikipedia.org/wiki/ZFS">ZFS</a>
pools, enabling many features not available in UFS2 such as quotas, snapshots, compression, replication, and datasets for sharing subsets of volumes</li>
<li>upgrade procedure saves the current operating system to an inactive partition, allowing for an easy reversal of an undesirable upgrade</li>
<li>system notifications are automatically mailed to the root user account</li>
<li><a class="reference external" href="http://en.wikipedia.org/wiki/Django_%28Web_framework%29">Django</a>
driven graphical user interface available through a web browser</li>
<li>secure replication, automatic ZFS snapshots, scheduling of ZFS scrubs, and cron management are all configurable through the graphical interface</li>
<li>support for menu localization and keyboard layouts</li>
<li>SMART monitoring and UPS management in GUI</li>
<li>support for Windows ACLs and UNIX filesystem permissions</li>
<li>periodic ZFS snapshots are visible in Windows as shadow copies</li>
<li>includes
<a class="reference external" href="http://sourceforge.net/projects/tmux/">tmux</a>
, a BSD-licensed utility similar to GNU screen</li>
</ul>
<div class="section" id="what-s-new-in-9-2-2">
<h3>What&#8217;s New in 9.2.2<a class="headerlink" href="#what-s-new-in-9-2-2" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="known-issues">
<h3>Known Issues<a class="headerlink" href="#known-issues" title="Permalink to this headline">¶</a></h3>
<p>Before installing FreeNAS® you should be aware of the following known issues:</p>
<ul class="simple">
<li><strong>UPGRADES FROM FreeNAS® 0.7x ARE UNSUPPORTED.</strong>
The system has no way to import configuration settings from 0.7x versions of FreeNAS®, meaning that you will have to manually recreate your configuration. However, you should be able to
<a class="reference external" href="#1.6.3.2.ImportingVolumes|outline">import</a>
supported FreeNAS® 0.7x
volumes.</li>
<li><strong>The ZFS upgrade procedure is non-reversible.</strong>
Do not upgrade your ZFS version unless you are absolutely sure that you will never want to go back to the previous version. There is no reversing a ZFS pool upgrade, and there is no way for a system with an older version of ZFS to access pools that have been upgraded.</li>
<li>The available space reported in the parent zpool may not reflect reality and can be confusing because the available space represented by datasets or zvols can exceed that of the parent zpool.</li>
<li>Disks with certain configurations can get probed by GEOM and become essentially unwritable without manual intervention. For instance, if you use disks that previously had a gmirror on them, the system may pick that up and the disks will be unavailable until the existing gmirror is stopped and destroyed.</li>
<li>The mps driver for 6G LSI SAS HBAs is version 16, which requires phase 16 firmware on the controller. Running older firmware can cause many woes, including the failure to probe all of the attached disks, which can lead to degraded or unavailable arrays.</li>
</ul>
</div>
<div class="section" id="hardware-recommendations">
<h3>Hardware Recommendations<a class="headerlink" href="#hardware-recommendations" title="Permalink to this headline">¶</a></h3>
<p>Since FreeNAS® 9.2.2 is based on FreeBSD 9.2, it supports the same hardware found in
the
amd64
and i386 sections</p>
<p>of
the
<a class="reference external" href="http://www.freebsd.org/releases/9.2R/hardware.html">FreeBSD</a>
<a class="reference external" href="http://www.freebsd.org/releases/9.2R/hardware.html">9.2</a>
` Hardware Compatibility List &lt;<a class="reference external" href="http://www.freebsd.org/releases/9.2R/hardware.html">http://www.freebsd.org/releases/9.2R/hardware.html</a>&gt;`_
.</p>
<p>Actual hardware requirements will vary depending upon what you are using your FreeNAS® system for. This section provides some guidelines to get you started. You can also skim through the
<a class="reference external" href="http://forums.freenas.org/forumdisplay.php?18-Hardware">FreeNAS® Hardware Forum</a>
for performance tips from other FreeNAS® users or to post questions regarding the hardware best suited to meet your requirements. This
<a class="reference external" href="http://forums.freenas.org/threads/so-you-want-some-hardware-suggestions.12276/">forum post</a>
provides some specific recommendations if you are planning on purchasing hardware.</p>
<div class="section" id="architecture">
<h4>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h4>
<p>While FreeNAS® is available for both 32-bit and 64-bit architectures, 64-bit hardware is recommended for speed and performance. A 32-bit system can only address up to 4 GB of RAM, making it poorly suited to the RAM requirements of ZFS. If you only have access to a 32-bit system, consider using UFS instead of ZFS.</p>
</div>
<div class="section" id="ram">
<h4>RAM<a class="headerlink" href="#ram" title="Permalink to this headline">¶</a></h4>
<p>The best way to get the most out of your FreeNAS® system is to install as much RAM as possible. If your RAM is limited, consider using UFS until you can afford better hardware. FreeNAS® with ZFS typically requires a minimum of 8 GB of RAM in order to provide good performance and stability. The more RAM, the better the performance, and the
<a class="reference external" href="http://forums.freenas.org/">FreeNAS® Forums</a>
provide anecdotal evidence from users on how much performance is gained by adding more RAM. For systems with large disk capacity (greater than 8 TB), a general rule of thumb is 1 GB of RAM for every 1 TB of storage. This
<a class="reference external" href="http://hardforum.com/showpost.php?s=8d31305e57c1dd2853eb817124ff18d9&amp;p=1036865233&amp;postcount=3">post</a>
describes how RAM is used by ZFS.</p>
<p>If you plan to use your server for home use, you can often soften the rule of thumb of 1 GB of RAM for every 1 TB of storage, though 8 GB of RAM is still the recommended minimum. If performance is inadequate you should consider adding more RAM as a first remedy. The sweet spot for most users in home/small business is 16GB of RAM.</p>
<p>It is possible to use ZFS on systems with less than 8 GB of RAM. However, FreeNAS® as distributed is configured to be suitable for systems meeting the sizing recommendations above. If you wish to use ZFS on a smaller memory system, some tuning will be necessary, and performance will be (likely substantially) reduced. ZFS will automatically disable pre-fetching (caching) on systems where it is not able to use at least 4 GB of memory just for ZFS cache and data structures. This
<a class="reference external" href="http://forums.freenas.org/showthread.php?3606-How-I-did-ZFS-through-FreeNAS-on-a-32bit-proc-with-low-memory">post</a>
describes many of the relevant tunables.</p>
<p>If your
system
supports it
and your
budget allows for it
,
install ECC RAM
.</p>
<p>If you plan to use ZFS deduplication, a general rule of thumb is 5 GB RAM per TB of storage to be deduplicated.</p>
<p>If you use Active Directory with FreeNAS®, add an additional 2 GB of RAM for winbind&#8217;s internal cache.</p>
<p>If you are installing FreeNAS® on a headless system, disable the shared memory settings for the video card in the BIOS.</p>
<p>If you only plan to use UFS, you may be able to get by with as little as 2GB of RAM.</p>
<p>If you don&#8217;t have at least 8GB of RAM with ZFS or 2GB of RAM with UFS, you should consider getting more powerful hardware before using FreeNAS® to store your data. Otherwise, data loss may result.</p>
<p><strong>WARNING:</strong>
to ensure consistency for the checksumming and parity calculations performed by ZFS, ECC RAM is highly recommended. Using non-ECC RAM can cause unrecoverable damage to a zpool resulting in a loss of all data in the pool.</p>
</div>
<div class="section" id="compact-or-usb-flash">
<h4>Compact or USB Flash<a class="headerlink" href="#compact-or-usb-flash" title="Permalink to this headline">¶</a></h4>
<p>The FreeNAS® operating system is a running image. This means that it should not be installed onto a
hard drive, but rather to a USB or compact flash device that is at least 2 GB in size. If you don&#8217;t have compact flash, you can instead use a USB thumb drive that is dedicated to the running image and which stays inserted in the USB slot. While technically you can install FreeNAS® onto a hard drive, this is discouraged as you will lose the storage capacity of the drive. In other words, the operating system will take over the drive and will not allow you to store data on it, regardless of the size of the drive.</p>
<p>The FreeNAS® installation will partition the operating system drive into two partitions. One partition holds the current operating system and the other partition is used when you upgrade. This allows you to safely upgrade to a new image or to revert to an older image should you encounter problems.</p>
<p>USB 3.0 support is disabled by default as it currently is not compatible with some hardware, including Haswell (Lynx point) chipsets. If you receive a &#8220;failed with error 19&#8221; message when trying to boot FreeNAS®, make sure that xHCI/USB3 is disabled in the system BIOS. While this will downclock the USB ports to 2.0, the bootup and shutdown times will not be significantly different. To see if USB 3.0 support works with your hardware, create a
<a class="reference external" href="#1.4.9.Tunables|outline">Tunable</a>
named
<em>xhci_load</em>
, set its value to
<em>YES</em>
, and reboot the system.</p>
<p>It is highly recommended that when using a USB stick, that only name brand USB sticks are used as off-brand sticks may not be fully compatible with FreeNAS®.</p>
<p><strong>NOTE:</strong>
SD cards to USB converters are not recommended as these have caused problems for many users. When using a CF adapter, avoid the no-name brands to ensure compatibility, reliability, and performance.</p>
</div>
<div class="section" id="storage-disks-and-controllers">
<h4>Storage Disks and Controllers<a class="headerlink" href="#storage-disks-and-controllers" title="Permalink to this headline">¶</a></h4>
<p>The
<a class="reference external" href="http://www.freebsd.org/releases/9.2R/hardware.html#DISK">Disk section</a>
of the FreeBSD Hardware List lists the supported disk controllers. In addition, support for 3ware 6gbps RAID controllers has been added along with the CLI utility
<a class="reference external" href="#1.11.6.tw_cli|outline">tw_cli</a>
for managing 3ware RAID controllers.</p>
<p>FreeNAS®
supports hot pluggable drives. Make sure that AHCI is enabled in the BIOS.
Note that hot plugging is
<strong>not the same</strong>
** **
as a hot spare, which is not supported at this time.</p>
<p>If you need reliable disk alerting, immediate reporting of a failed drive, and or swapping, use a fully manageable hardware RAID controller such as a LSI MegaRAID controller or a 3Ware twa-compatible controller. The current FreeBSD ZFS implementation will not notice that a drive is gone until you reboot or put the volume on high load. More information about LSI cards and FreeNAS® can be found in this
<a class="reference external" href="http://forums.freenas.org/showthread.php?11901-Confused-about-that-LSI-card-Join-the-crowd">forum post</a>
.</p>
<p>Suggestions for testing disks before adding them to a RAID array can be found in this
<a class="reference external" href="http://forums.freenas.org/showthread.php?12082-Checking-new-HDD-s-in-RAID">forum post</a>
.</p>
<p><a class="reference external" href="http://technutz.com/purpose-built-nas-hard-drives/">This article</a>
provides a good overview of hard drives which are well suited for a NAS.</p>
<p>If you have some money to spend and wish to optimize your disk subsystem, consider your read/write needs, your budget, and your RAID requirements.</p>
<p>If you have steady, non-contiguous writes, use disks with low seek times. Examples are 10K or 15K SAS drives which cost about $1/GB. An example configuration would be six 600 GB 15K SAS drives in a RAID 10 which would yield 1.8 TB of usable space or eight 600 GB 15K SAS drives in a RAID 10 which would yield 2.4 TB of usable space.</p>
<p>7200 RPM SATA disks are designed for single-user sequential I/O and are not a good choice for multi-
user writes.</p>
<p>If you have the budget and high performance is a key requirement, consider a
<a class="reference external" href="http://www.fusionio.com/products/">Fusion-I/O card</a>
which is optimized for massive random access. These cards are expensive and are suited for high end systems that demand performance. A Fusion-I/O can be formatted with a filesystem and used as direct storage; when used this way, it does not have the write issues typically associated with a flash device. A Fusion-I/O can also be used as a cache device when your ZFS dataset size is bigger than your RAM. Due to the increased throughput, systems running these cards typically use multiple 10 GigE network interfaces.</p>
<p>If you will be using ZFS,
<a class="reference external" href="http://download.oracle.com/docs/cd/E19253-01/819-5461/6n7ht6r12/index.html">Disk Space Requirements for ZFS Storage Pools</a>
recommends a minimum of 16 GB of disk space. Due to the way that ZFS creates swap,
<strong>you can not format less than 3 GB of **
**space with ZFS</strong>
. However, on a drive that is below the minimum recommended size you lose a fair amount of storage space to swap: for example, on a 4 GB drive, 2 GB will be reserved for swap.</p>
<p>If you are new to ZFS and are purchasing hardware, read through
<a class="reference external" href="http://www.open-tech.com/2011/10/zfs-best-practices-guide-from-solaris-internals/">ZFS Storage Pools</a>
<a class="reference external" href="http://www.solarisinternals.com/wiki/index.php/ZFS_Best_Practices_Guide#ZFS_Storage_Pools_Recommendations">Recommendations</a>
first.</p>
<p>ZFS uses dynamic block sizing, meaning that it is capable of striping different sized disks. However, if you care about performance, use disks of the same size. Further, when creating a RAIDZ, only the size of the smallest disk will be used on each disk.</p>
</div>
<div class="section" id="network-interfaces">
<h4>Network Interfaces<a class="headerlink" href="#network-interfaces" title="Permalink to this headline">¶</a></h4>
<p>The
<a class="reference external" href="http://www.freebsd.org/releases/9.2R/hardware.html#ETHERNET">Ethernet section</a>
of the FreeBSD Hardware Notes indicates which interfaces are supported by each driver. While many interfaces are supported, FreeNAS® users have seen the best performance from Intel and Chelsio interfaces, so consider these brands if you are purchasing a new interface. Realteks will perform poorly under CPU load as interfaces with these chipsets do not provide their own processors.</p>
<p>At a minimum you will want to use a GigE interface. While GigE interfaces and switches are affordable for home use, it should be noted that modern disks can easily saturate 110 MB/s. If you require a higher network throughput, you can bond multiple GigE cards together using the LACP type of
<a class="reference external" href="#1.5.3.LinkAggregations|outline">Link Aggregation</a>
. However, any switches will need to support LACP which means you will need a more expensive managed switch rather than a home user grade switch.</p>
<p>If network performance is a requirement and you have some money to spend, use 10 GigE interfaces and a managed switch. If you are purchasing a managed switch, consider one that supports LACP and jumbo frames as both can be used to increase network throughput.</p>
<p><strong>NOTE:</strong>
at this time the following are
<strong>not</strong>
supported: InfiniBand, FibreChannel over Ethernet, or wireless interfaces.</p>
<p>If network speed is a requirement, consider both your hardware and the type of shares that you create. On the same hardware, CIFS will be slower than FTP or NFS as Samba is
<a class="reference external" href="http://www.samba.org/samba/docs/man/Samba-Developers-Guide/architecture.html">single-threaded</a>
. If you will be using CIFS, use a fast CPU.</p>
<p>Wake on LAN (WOL) support is dependent upon the FreeBSD driver for the interface. If the driver supports WOL, it can be enabled using
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=ifconfig">ifconfig(8)</a>
. To determine if WOL is supported on a particular interface, specify the interface name to the following command. In this example, the capabilities line indicates that WOL is supported for the
<em>re0</em>
interface:</p>
<p><strong>ifconfig -m em0</strong></p>
<p>re0: flags=8943&lt;UP,BROADCAST,RUNNING,PROMISC,SIMPLEX,MULTICAST&gt; metric 0 mtu 1500</p>
<p>options=42098&lt;VLAN_MTU,VLAN_HWTAGGING,VLAN_HWCSUM,WOL_MAGIC,VLAN_HWTSO&gt;</p>
<p>capabilities=5399b&lt;RXCSUM,TXCSUM,VLAN_MTU,VLAN_HWTAGGING,VLAN_HWCSUM,TSO4,WOL_UCAST,WOL_MCAST,</p>
<p>WOL_MAGIC,VLAN_HWFILTER,VLAN_H WTSO&gt;</p>
<p>If you find that WOL support is indicated but not working for a particular interface,
<a class="reference external" href="#1.12.3.SupportDatabase|outline">submit a bug</a>
<a class="reference external" href="#1.13.2.SubmitBugReports|outline">report</a>
.</p>
</div>
<div class="section" id="raid-overview">
<h4>RAID Overview<a class="headerlink" href="#raid-overview" title="Permalink to this headline">¶</a></h4>
<p>Data redundancy and speed are important considerations for any network attached storage system. Most NAS systems use multiple disks to store data, meaning you should decide which type of
<a class="reference external" href="http://en.wikipedia.org/wiki/RAID">RAID</a>
to use
<em>before</em>
installing FreeNAS®. This section provides an overview of RAID types to assist you in deciding which type best suits your requirements.</p>
<p><strong>RAID 0:</strong>
provides optimal performance and allows you to add disks as needed.
<strong>Provides zero redundancy, meaning if one disk fails, all of the data on all of the disks is lost.</strong>
The more disks in the RAID 0, the more likely the chance of a failure.</p>
<p><strong>RAID 1:</strong>
provides redundancy as data is copied (mirrored) to two or more drives. Provides good read performance but may have slower write performance, depending upon how the mirrors are setup and the number of ZILs and L2ARCs.</p>
<p><strong>RAID 5:</strong>
requires a minimum of three disks and can tolerate the loss of one disk without losing data. Disk reads are fast but write speed can be reduced by as much as 50%. If a disk fails, it is marked as degraded but the system will continue to operate until the drive is replaced and the RAID is rebuilt. However, should another disk fail before the RAID is rebuilt, all data will be lost.</p>
<p><strong>RAID 6:</strong>
requires a minimum of four disks and can tolerate the loss of two disks without losing data. Benefits from having many disks as performance, fault tolerance, and cost efficiency are all improved relatively with more disks. The larger the failed drive, the longer it takes to rebuild the array. Reads are very fast but writes are slower than a RAID 5.</p>
<p><strong>RAID 10:</strong>
requires a minimum of four disks and number of disks is always even as this type of RAID mirrors striped sets. This type of RAID can survive the failure of any one drive. If you lose a second drive from the
<strong>same</strong>
** **
mirrored set, you will lose the array. However, if you lose a second drive from a different mirrored set, the array will continue to operate in a degraded state. RAID 10 significantly outperforms RAIDZ2, especially on writes.</p>
<p><strong>RAID 60:</strong>
requires a minimum of eight disks. Combines RAID 0 striping with the distributed double parity of RAID 6 by striping 2 4-disk RAID 6 arrays. RAID 60 rebuild times are half that of RAID 6.</p>
<p><a href="#id9"><span class="problematic" id="id10">**</span></a>RAIDZ1: **
ZFS software solution that is equivalent to RAID5. Its advantage over RAID 5 is that it
avoids the
<a class="reference external" href="http://blogs.oracle.com/bonwick/entry/raid_z">write-hole</a>
and does not require any special hardware, meaning it can be used on commodity
disks. If your FreeNAS® system will be used for steady writes, RAIDZ is a poor choice due to the
slow write speed.</p>
<p><strong>RAIDZ2:</strong>
double-parity ZFS software solution that is similar to RAID-6. Its advantage over RAID 5 is that it also avoids the write-hole and does not require any special hardware, meaning it can be used on commodity disks. RAIDZ2 allows you to lose one drive without any degradation as it basically becomes a RAIDZ1 until you replace the failed drive and resilver. At this time, RAIDZ2 on FreeBSD is slower than RAIDZ1.</p>
<p><strong>RAIDZ3:</strong>
triple-parity ZFS software solution. RAIDZ3 offers three parity drives and can operate in degraded mode if up to three drives fail with no restrictions on which drives can fail.</p>
<p><strong>NOTE:</strong>
instead of mixing ZFS RAID with hardware RAID, it is recommended that you place your hardware RAID controller in JBOD mode and let ZFS handle the RAID. According to
<a class="reference external" href="http://en.wikipedia.org/wiki/ZFS#Data_Integrity">Wikipedia</a>
: “
ZFS can not fully protect the user&#8217;s data when using a hardware RAID controller, as it is not able to perform the automatic self-healing unless it controls the redundancy of the disks and data. ZFS prefers
direct, exclusive access to the disks, with nothing in between that interferes. If the user insists on using
hardware-level RAID, the controller should be configured as JBOD mode (i.e. turn off RAID-functionality) for ZFS to be able to guarantee data integrity. Note that hardware RAID configured as
JBOD may still detach disks that do not respond in time; and as such may require TLER/CCTL/ERC-
enabled disks to prevent drive dropouts. These limitations do not apply when using a non-RAID
controller, which is the preferred method of supplying disks to ZFS.
”</p>
<p>When determining the type of RAIDZ to use, consider whether your goal is to maximum disk space or maximum performance:</p>
<ul class="simple">
<li>RAIDZ1 maximizes disk space and generally performs well when data is written and read in large chunks (128K or more).</li>
<li>RAIDZ2 offers better data availability and significantly better mean time to data loss (MTTDL) than RAIDZ1.</li>
<li>A mirror consumes more disk space but generally performs better with small random reads.</li>
</ul>
<p>For better performance, a mirror is strongly favored over any RAIDZ, particularly for large, uncacheable, random read loads.</p>
<p>When determining how many disks to use in a RAIDZ, the following configurations provide optimal performance. Array sizes beyond 12 disks are not recommended.</p>
<ul class="simple">
<li>Start a RAIDZ1 at at 3, 5, or 9 disks.</li>
<li>Start a RAIDZ2 at 4, 6, or 10 disks.</li>
<li>Start a RAIDZ3 at 5, 7, or 11 disks.</li>
</ul>
<p>The recommended number of disks per group is between 3 and 9. If you have more disks, use multiple groups.</p>
<p>The following resources can also help you determine the RAID configuration best suited to your storage needs:</p>
<ul class="simple">
<li><a class="reference external" href="http://forums.freenas.org/showthread.php?312-what-is-the-best-raidz-configuration-and-how-to-set-it-up">What is the Best RAIDZ Configuration</a></li>
<li><a class="reference external" href="http://forums.freenas.org/showthread.php?16-Getting-the-most-out-of-ZFS-pools%21">Getting the Most out of ZFS Pools</a></li>
<li><a class="reference external" href="http://constantin.glez.de/blog/2010/06/closer-look-zfs-vdevs-and-performance">A Closer Look at ZFS, Vdevs and Performance</a></li>
</ul>
<p><strong>NOTE: **
**NO RAID SOLUTION PROVIDES A REPLACEMENT FOR A RELIABLE BACKUP STRATEGY. BAD STUFF CAN STILL HAPPEN AND YOU WILL BE GLAD THAT YOU BACKED UP YOUR DATA WHEN IT DOES.</strong>
See
<a class="reference external" href="#1.6.1.PeriodicSnapshotTasks|outline">Periodic Snapshot Tasks</a>
and
<a class="reference external" href="#1.6.2.ReplicationTasks|outline">Replication Tasks</a>
if you would like to use ZFS snapshots and rsync as part of your backup strategy.</p>
</div>
<div class="section" id="zfs-overview">
<h4>ZFS Overview<a class="headerlink" href="#zfs-overview" title="Permalink to this headline">¶</a></h4>
<p>While ZFS isn&#8217;t hardware, an overview is included in this section as the decision to use ZFS may impact on your hardware choices and whether or not to use hardware RAID.</p>
<p>If you are new to ZFS, the
<a class="reference external" href="http://en.wikipedia.org/wiki/Zfs">Wikipedia entry on ZFS</a>
provides an excellent starting point to learn about its features. These resources are also useful to bookmark and refer to as needed:</p>
<ul class="simple">
<li><a class="reference external" href="http://wiki.freebsd.org/ZFSTuningGuide">FreeBSD ZFS Tuning Guide</a></li>
<li><a class="reference external" href="http://download.oracle.com/docs/cd/E19253-01/819-5461/index.html">ZFS Administration Guide</a></li>
<li><a class="reference external" href="http://blogs.oracle.com/video/entry/becoming_a_zfs_ninja">Becoming a ZFS Ninja (video)</a></li>
<li><a class="reference external" href="http://forums.freenas.org/threads/slideshow-explaining-vdev-zpool-zil-and-l2arc-for-noobs.7775/">Slideshow explaining VDev, zpool, ZIL and L2ARC and other newbie mistakes!</a></li>
<li><a class="reference external" href="http://www.bsdnow.tv/tutorials/zfs">A Crash Course on ZFS</a></li>
</ul>
<p>The following is a glossary of terms used by ZFS:</p>
<p><strong>Pool:</strong>
a collection of devices that provides physical storage and data replication managed by ZFS. This pooled storage model eliminates the concept of volumes and the associated problems of partitions, provisioning, wasted bandwidth and stranded storage. In FreeNAS®,
<a class="reference external" href="#1.6.3.4.ZFSVolumeManager|outline">ZFS Volume Manager</a>
is used to create ZFS pools.</p>
<p><strong>Dataset:</strong>
once a pool is created, it can be
<a class="reference external" href="#1.6.3.6.CreatingZFSDatasets|outline">divided into datasets</a>
. A dataset is similar to a folder in that it supports permissions. A dataset is also similar to a filesystem in that you can set properties such as quotas and compression.</p>
<p><strong>Zvol:</strong>
ZFS storage pools can provide volumes for applications that need raw-device semantics such as swap devices or iSCSI device extents. In other words, a zvol is a virtual block device in a ZFS storage pool.</p>
<p><strong>Snapshot:</strong>
a read-only point-in-time copy of a filesystem. Snapshots can be created quickly and, if little data changes, new snapshots take up very little space. For example, a snapshot where no files have changed takes 0 MB of storage, but if you change a 10 GB file it will keep a copy of both the old and the new 10 GB version. Snapshots provide a clever way of keeping a history of files, should you need to recover an older copy or even a deleted file. For this reason, many administrators take snapshots often (e.g. every 15 minutes), store them for a period of time (e.g. for a month), and store them on another system. Such a strategy allows the administrator to roll the system back to a specific time or, if there is a catastrophic loss, an off-site snapshot can restore the system up to the last snapshot interval (e.g. within 15 minutes of the data loss). Snapshots can be cloned or rolled back, but the files on the snapshot cannot be accessed independently.</p>
<p><strong>Clone:</strong>
a writable copy of a snapshot which can only be created on the same ZFS volume. Clones provide an extremely space-efficient way to store many copies of mostly-shared data such as workspaces, software installations, and diskless clients. Clones do not inherit the properties of the parent dataset, but rather inherit the properties based on where the clone is created in the ZFS pool. Because a clone initially shares all its disk space with the original snapshot, its used property is initially zero. As changes are made to the clone, it uses more space.</p>
<p><strong>Deduplication: **
the process of eliminating duplicate copies of data in order to save space. Once
deduplicaton occurs, it can improve ZFS performance as less data is written and stored. However, the
process of deduplicating the data is RAM intensive and a general rule of thumb is 5 GB RAM per TB
of storage to be deduplicated.
**In most cases, enabling compression will provide comparable performance.</strong>
** **
In FreeNAS®, deduplication can be enabled at the dataset level and there is no way to
undedup data once it is deduplicated: switching deduplication off has
<strong>NO AFFECT</strong>
** **
on existing data. The more data you write to a deduplicated dataset, the more RAM it requires, and there is no upper
bound on this. When the system starts storing the DDTs (dedup tables) on disk because they no longer fit into RAM, performance craters. Furthermore, importing an unclean pool can require between 3-5
GB of RAM per TB of deduped data, and if the system doesn&#8217;t have the needed RAM it will panic, with
the only solution being to add more RAM or to recreate the pool.
<strong>Think carefully before enabling **
**dedup!</strong>
** **</p>
<p><strong>ZIL:</strong>
(
<a class="reference external" href="http://blogs.oracle.com/realneel/entry/the_zfs_intent_log">ZFS Intent Log</a>
) is effectively a filesystem journal that manages writes. The ZIL is a temporary
storage area for sync writes until they are written asynchronously to the ZFS pool. If the system has
many sync writes, such as from a database server, performance can be increased by adding a dedicated log device (slog) using
<a class="reference external" href="#1.6.3.4.ZFSVolumeManager|outline">ZFS Volume Manager</a>
. If the system has few sync writes, a slog will not speed up writes to the pool. A more detailed explanation can be found in this
<a class="reference external" href="http://forums.freenas.org/threads/some-insights-into-slog-zil-with-zfs-on-freenas.13633/">forum post</a>
.</p>
<p>A dedicated log device will have no affect on CIFS, AFP, or iSCSI as these protocols rarely use sync writes. A dedicated log device can increase write performance over NFS, especially for ESXi. When creating a dedicated log device, it is recommended to use a fast SSD with a supercapacitor or a bank of capacitors that can handle writing the contents of the SSD&#8217;s RAM to the SSD. If you don&#8217;t have access to such an SSD, try disabling sync writes on the NFS dataset using
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=zfs">zfs(8)</a>
instead.</p>
<p>The
<strong>zilstat</strong>
utility can be run from
<a class="reference external" href="#1.11.2.Shell|outline">Shell</a>
to help determine if the system would benefit from a dedicated ZIL device. See
<a class="reference external" href="http://www.richardelling.com/Home/scripts-and-programs-1/zilstat">this website</a>
for usage information.</p>
<p>If you decide to create a dedicated log device to speed up NFS writes, the SSD can be half the size of system RAM as anything larger than that is unused capacity. The log device
<strong>should be mirrored on a ZFSv15 pool because if one of the log devices fails, the pool is unrecoverable</strong>
** **
and the pool must be recreated and the data restored from a backup. The log device does not need to be mirrored on a ZFSv28 pool as the system will revert to using the ZIL if the log device fails and only the data in the device which had not been written to the pool will be lost (typically the last few seconds of writes). You can replace the lost log device in the
<a class="reference external" href="#1.6.3.9.ViewingVolumes|outline">View Volumes</a>
→ Volume Status screen. Note that a dedicated log device can not be shared between ZFS pools and that the same device cannot hold both a log and a cache device.</p>
<p><a class="reference external" href="https://blogs.oracle.com/brendan/entry/test">L2ARC</a>
<strong>:</strong>
ZFS uses a RAM cache to reduce read latency. If an SSD is dedicated as a cache device, it is known as an L2ARC and ZFS uses it to store more reads which can increase random read performance. However, adding a cache device will not improve a system with too little RAM and will actually decrease performance as ZFS uses RAM to track the contents of L2ARC. RAM is always faster than disks, so always add as much RAM as possible before determining if the system would benefit from a L2ARC device.</p>
<p>If you have a lot of applications that do large amounts of random reads, on a dataset small enough to fit into the L2ARC, read performance may be increased by adding a dedicated cache device using
<a class="reference external" href="#1.6.3.4.ZFSVolumeManager|outline">ZFS</a>
<a class="reference external" href="#1.6.3.4.ZFSVolumeManager|outline">Volume Manager</a>
. SSD cache devices only help if your working set is larger than system RAM, but small enough that a significant percentage of it will fit on the SSD.
After adding an L2ARC, monitor its effectiveness using tools such as
<a class="reference external" href="#1.12.4.arcstat|outline">arcstat</a>
. If you need to increase the size of an existing L2ARC, you can stripe another cache device by
<a class="reference external" href="#1.6.3.5.ExtendingaZFSVolume|outline">adding another device</a>
. The GUI will always stripe L2ARC, not mirror it, as the contents of L2ARC are recreated at boot.</p>
<p>Losing an L2ARC device will not affect the integrity of the pool, but may have an impact on read
performance, depending upon the workload and the ratio of dataset size to cache size. Note that a dedicated L2ARC device can not be shared between ZFS pools.</p>
<p><strong>Scrub:</strong>
similar to ECC memory scrubbing, all data is read to detect latent errors while they&#8217;re still correctable. A scrub traverses the entire storage pool to read every data block, validates it against its 256-bit checksum, and repairs it if necessary.</p>
</div>
</div>
</div>
<div class="section" id="installing-and-upgrading-freenas">
<h2>Installing and Upgrading FreeNAS®<a class="headerlink" href="#installing-and-upgrading-freenas" title="Permalink to this headline">¶</a></h2>
<p>Before installing, it is important to remember that the FreeNAS® operating system must be installed on a separate device from the drive(s) that will hold the storage data. In other words, if you only have one disk drive you will be able to use the FreeNAS® graphical interface but won&#8217;t be able to store any data, which after all, is the whole point of a NAS system. If you are a home user who is experimenting with FreeNAS®, you can install FreeNAS® on an inexpensive USB thumb drive and use the computer&#8217;s disk(s) for storage.</p>
<p>This section describes the following:</p>
<ul class="simple">
<li><a class="reference external" href="#1.2.1.GettingFreeNAS™|outline">Getting FreeNAS®</a></li>
<li><a class="reference external" href="#1.2.2.FreeNAS®inaVirtualEnvironment|outline">FreeNAS® in a Virtual Environment</a></li>
<li><a class="reference external" href="#1.2.3.InstallingfromCDROM|outline">Installing from CDROM</a></li>
<li><a class="reference external" href="#1.2.4.BurninganIMGFile|outline">Burning an IMG File</a></li>
<li><a class="reference external" href="#1.2.5.InitialSetup|outline">Initial Setup</a></li>
<li><a class="reference external" href="#1.2.6.UpgradingFreeNAS™|outline">Upgrading F</a>
<a class="reference external" href="#1.2.6.UpgradingFreeNAS™|outline">reeNAS®</a></li>
</ul>
<div class="section" id="id14">
<h3>Getting FreeNAS®<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p>FreeNAS® 9.2.2 can be downloaded from
<a class="reference external" href="http://download.freenas.org/">http://download.freenas.org/</a>
.</p>
<p>The download page contains the following types of files. Download one file that meets your needs:</p>
<ul class="simple">
<li><a href="#id15"><span class="problematic" id="id16">**</span></a>CD Installer: **
this is a bootable installer that can be written to CDROM. This is described in more detail in
<a class="reference external" href="#1.2.3.InstallingfromCDROM|outline">Installing from CDROM</a>
.</li>
<li><strong>Disk Image:</strong>
this is a compressed image of the operating system that needs to be written to a USB or compact flash device.
<a class="reference external" href="#1.2.4.BurninganIMGFile|outline">Burning an IMG File</a>
describes how to write the image.</li>
<li><a href="#id19"><span class="problematic" id="id20">**</span></a>GUI Upgrade or Legacy Upgrade: **
this is a compressed firmware upgrade image. If your intent is to upgrade FreeNAS®, download the correct file for your architecture and version and see the section on
<a class="reference external" href="#1.2.6.UpgradingFreeNAS®|outline">Upgrading FreeNAS®</a>
. Download the GUI Upgrade if you are upgrading from version 8.2.0-BETA3 through 9.1.0. Download the legacy upgrade if you are upgrading from version 8.0.1BETA3 through 8.2.0-BETA2.</li>
</ul>
<p>Each file has an associated SHA256 hash which should be used to verify the integrity of the downloaded file before writing it to the installation media. The command you use to verify the checksum varies by operating system:</p>
<ul class="simple">
<li>on a BSD system use the command
<strong>sha256 name_of_file</strong></li>
<li>on a Linux system use the command
<strong>sha256sum name_of_file</strong></li>
<li>on a Mac system use the command
<strong>shasum -a 256 name_of_file</strong></li>
<li>on a Windows system or Mac system, you can install a utility such as
<a class="reference external" href="http://www.slavasoft.com/hashcalc/">HashCalc</a>
or
<a class="reference external" href="http://implbits.com/HashTab.aspx">HashTab</a></li>
</ul>
</div>
<div class="section" id="id21">
<h3>FreeNAS® in a Virtual Environment<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<p>FreeNAS can be run inside a virtual environment for development, experimentation, and educational
purposes. Please note that running FreeNAS in production as a virtual machine is
<a class="reference external" href="http://forums.freenas.org/showthread.php?12484-Please-do-not-run-FreeNAS-in-production-as-a-Virtual-Machine%21">not recommended</a>
.
If you decide to use FreeNAS® within a virtual environment,
<a class="reference external" href="http://forums.freenas.org/showthread.php?12714-quot-Absolutely-must-virtualize-FreeNAS%21-quot-a-guide-to-not-completely-losing-your-data">read this post first</a>
as it contains useful guidelines for minimizing the risk of losing your data.</p>
<p>In order to install or run FreeNAS® within a virtual environment, you will need to create a virtual machine that meets the following minimum requirements:</p>
<ul class="simple">
<li><strong>at least</strong>
204
8 MB base memory size (UFS)
or 4096 MB (ZFS)</li>
<li>a virtual disk
<strong>at least 2 GB in size</strong>
** **
to hold the operating system and swap</li>
<li>at least one more virtual disk
<strong>at least 4 GB in size</strong>
** **
to be used as data storage</li>
<li>a bridged adapter</li>
</ul>
<p>This section demonstrates how to create and access a virtual machine within the VirtualBox and VMware ESXi environments.</p>
<div class="section" id="virtualbox">
<h4>VirtualBox<a class="headerlink" href="#virtualbox" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://www.virtualbox.org/">VirtualBox</a>
is an open source virtualization program originally created by Sun Microsystems. VirtualBox runs on Windows, BSD, Linux, Macintosh, and OpenSolaris. It can be configured to use a downloaded FreeNAS®
<em>.iso</em>
or
<em>.img.xz</em>
file, and makes a good testing environment for practicing configurations or learning how to use the features provided by FreeNAS®.</p>
<div class="section" id="creating-the-virtual-machine">
<h5>Creating the Virtual Machine<a class="headerlink" href="#creating-the-virtual-machine" title="Permalink to this headline">¶</a></h5>
<p>To create the virtual machine, start VirtualBox and click the “New” button, seen in Figure 2.2a, to start the new virtual machine wizard.</p>
<p><strong>Figure 2.2a: Initial VirtualBox Screen</strong></p>
<p><a class="reference internal" href="_images/100000000000030200000194DB5CCF9B.png"><img alt="100000000000030200000194DB5CCF9B_png" src="_images/100000000000030200000194DB5CCF9B.png" style="width: 6.9252in; height: 3.6335in;" /></a></p>
<p>Click the “Next” button to see the screen in Figure 2.2b.
Enter a name for the virtual machine, click the “Operating System” drop-down menu and select BSD, and select “FreeBSD (64-bit)” from the “Version” dropdown.</p>
<p><strong>Figure 2.2b: Type in a Name and Select the Operating System for the New Virtual Machine</strong></p>
<p><a class="reference internal" href="_images/100002010000028A000001B8AD594B93.png"><img alt="100002010000028A000001B8AD594B93_png" src="_images/100002010000028A000001B8AD594B93.png" style="width: 5.4626in; height: 3.6665in;" /></a></p>
<p>Click “Next” to see the screen in Figure 2.2c. The base memory size must be changed to
<em>at least 2048</em>
* *
<em>MB</em>
.
<em>If *
*your system has enough memory, select at least 4096 MB so that you can use ZFS</em>
. When finished, click “Next” to see the screen in Figure 2.2d.</p>
<p><strong>Figure 2.2c: Select the Amount of Memory Reserved for the Virtual Machine</strong></p>
<p><a class="reference internal" href="_images/100002010000028A000001B83E678583.png"><img alt="100002010000028A000001B83E678583_png" src="_images/100002010000028A000001B83E678583.png" style="width: 5.4626in; height: 3.6665in;" /></a></p>
<p><strong>Figure 2.2d: Select Whether to Use an Existing or Create a New Virtual Hard Drive</strong></p>
<p><a class="reference internal" href="_images/100002010000028A000001B82CB5EA35.png"><img alt="100002010000028A000001B82CB5EA35_png" src="_images/100002010000028A000001B82CB5EA35.png" style="width: 5.4626in; height: 3.6665in;" /></a></p>
<p>Click “Create” to launch the
“Create Virtual Hard Drive Wizard” shown in Figure 2.2e.</p>
<p><strong>Figure 2.2e: Create New Virtual Hard Drive Wizard</strong></p>
<p><a class="reference internal" href="_images/10000201000002F5000001F1967BE2E6.png"><img alt="10000201000002F5000001F1967BE2E6_png" src="_images/10000201000002F5000001F1967BE2E6.png" style="width: 6.361in; height: 4.1417in;" /></a></p>
<p>Select one of the following types:</p>
<ul class="simple">
<li><strong>VDI:</strong>
select this option if you downloaded the ISO.</li>
<li><strong>VMDK:</strong>
select this option if you converted the
<em>.img</em>
file to VMDK format using the instructions in
<a class="reference external" href="#1.2.2.1.4.RunningFreeNAS™fromaUSBImage|outline">Running FreeNAS® from a USB Image</a>
.</li>
</ul>
<p>Once you make a selection, click the “Next” button to see the screen in Figure 2.2f.</p>
<p><strong>Figure 2.2f: Select the Storage Type for the Virtual Disk</strong></p>
<p><a class="reference internal" href="_images/10000201000002F5000001F1A595AB8F.png"><img alt="10000201000002F5000001F1A595AB8F_png" src="_images/10000201000002F5000001F1A595AB8F.png" style="width: 6.361in; height: 4.1417in;" /></a></p>
<p>You can now choose whether you want “Dynamically allocated” or “Fixed-size” storage. The first option uses disk space as needed until it reaches the maximum size that you will set in the next screen. The second option creates a disk the same size as that specified amount of disk space, whether it is used or not. Choose the first option if you are worried about disk space; otherwise, choose the second option as it allows VirtualBox to run slightly faster. Once you select “Next”, you will see the screen in Figure 2.2g.</p>
<p><strong>Figure 2.2g: Select the File Name and Size of the Virtual Disk</strong></p>
<p><a class="reference internal" href="_images/100002010000023E000001BAFB464DC1.png"><img alt="100002010000023E000001BAFB464DC1_png" src="_images/100002010000023E000001BAFB464DC1.png" style="width: 5.9783in; height: 4.6035in;" /></a></p>
<p>This screen is used to set the size (or upper limit) of the virtual machine.
<strong>In</strong>
<strong>crease the default size to 2 or 4 GB</strong>
. Use the folder icon to browse to a directory on disk with sufficient space to hold the virtual machine.</p>
<p>Once you make your selection and press “Next”, you will see a summary of your choices. Use the “Back” button to return to a previous screen if you need to change any values. Otherwise, click “Finish” to finish using the wizard. The virtual machine will be listed in the left frame, as seen in the example in Figure 2.2h.</p>
<p><strong>Figure 2.2h: The New Virtual Machine</strong></p>
<p><a class="reference internal" href="_images/10000201000002F500000241B6F0F7D2.png"><img alt="10000201000002F500000241B6F0F7D2_png" src="_images/10000201000002F500000241B6F0F7D2.png" style="width: 6.361in; height: 4.8083in;" /></a></p>
</div>
<div class="section" id="creating-devices-for-storage-and-installation-media">
<h5>Creating Devices for Storage and Installation Media<a class="headerlink" href="#creating-devices-for-storage-and-installation-media" title="Permalink to this headline">¶</a></h5>
<p>Next, create the virtual disk(s) to be used for storage. Click the “Storage” hyperlink in the right frame to access the storage screen seen in Figure 2.2i.</p>
<p><strong>Figure 2.2i: The Storage Settings of the Virtual Machine</strong></p>
<p><a class="reference internal" href="_images/10000000000002B200000238AA2AAEAB.png"><img alt="10000000000002B200000238AA2AAEAB_png" src="_images/10000000000002B200000238AA2AAEAB.png" style="width: 6.9252in; height: 4.3807in;" /></a></p>
<p>Click the “Add Attachment” button, select “Add Hard Disk” from the pop-up menu, then click the “Create New Disk” button. This will launch the Create New Virtual Hard Drive Wizard (seen in Figures 2.2e and 2.2f). Since this disk will be used for storage, create a size appropriate to your needs, making sure that it is
<strong>at</strong></p>
<p><strong>least 4 GB</strong>
in size.
If you wish to practice RAID configurations, create as many virtual disks as you need. You will be able to create 2 disks on the IDE controller. If you need additional disks, click the “Add Controller” button to create another controller to attach disks to.</p>
<p>Next, create the device for the installation media.</p>
<p>If you will be installing from an ISO, highlight
the word “Empty”, then click the CD icon as seen in Figure 2.2j.</p>
<p><strong>Figure 2.2j: Configuring the ISO Installation Media</strong></p>
<p><a class="reference internal" href="_images/100000000000033400000234CCE0A6DA.png"><img alt="100000000000033400000234CCE0A6DA_png" src="_images/100000000000033400000234CCE0A6DA.png" style="width: 6.9252in; height: 3.6602in;" /></a></p>
<p>Click “Choose a virtual CD/DVD disk file...” to browse to the location of the
<em>.iso</em>
file. Alternately, if you have burned the
<em>.iso</em>
to disk, select the detected “Host Drive”.</p>
<p>D
epending upon the extensions available in your CPU, you may or may not be able to use the ISO. If you receive the error “your CPU does not support long mode” when you try to boot the ISO, your CPU either does not have the required extension or AMD-V/VT-x is disabled in the system BIOS.</p>
<p><strong>NOTE:</strong>
if you receive a kernel panic when booting into the ISO, stop the virtual machine. Then, go to System and check the box “Enable IO APIC”.</p>
</div>
<div class="section" id="configuring-the-bridged-adapter">
<h5>Configuring the Bridged Adapter<a class="headerlink" href="#configuring-the-bridged-adapter" title="Permalink to this headline">¶</a></h5>
<p>To configure the network adapter, go to Settings → Network. In the “Attached to” drop-down menu select “Bridged Adapter”, then select the name of the physical interface from the “Name” drop-down menu. In the example shown in Figure 2.2k, the Intel Pro/1000 Ethernet card is attached to the network and has a device name of
<em>re0</em>
.</p>
<p>Once your configuration is complete, click the “Start” arrow. If you configured the ISO, install FreeNAS® as described in
<a class="reference external" href="#1.2.3.InstallingfromCDROM|outline">Installing from CDROM</a>
. Once FreeNAS® is installed, press F12 to access the boot menu in order to select the primary hard disk as the boot option. You can permanently boot from disk by removing the CD/DVD device in “Storage” or by unchecking CD/DVD-ROM in the “Boot Order” section of “System”.</p>
<p>If you configured the VMDK, the virtual machine will boot directly into FreeNAS®.</p>
<p><strong>Figure 2.2k: Configuring a Bridged Adapter in VirtualBox</strong></p>
<p><a class="reference internal" href="_images/1000000000000293000001EB2237CFE9.png"><img alt="1000000000000293000001EB2237CFE9_png" src="_images/1000000000000293000001EB2237CFE9.png" style="width: 6.8634in; height: 5.1138in;" /></a></p>
</div>
<div class="section" id="id24">
<h5>Running FreeNAS® from a USB Image<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h5>
<p>If you will be running FreeNAS® from an
<em>.img.xz</em>
file instead of installing it from the ISO, you must first download and install the
<a class="reference external" href="https://www.virtualbox.org/wiki/Downloads">Oracle VM VirtualBox Extension Pack</a>
that matches your version of
VirtualBox. The extension pack enables USB support.</p>
<p>Next, uncompress and burn the FreeNAS®
<em>.img.xz</em>
file using the instructions at
<a class="reference external" href="#1.2.4.BurninganIMGFile|outline">Burning an Image File</a>
. Once the image is burned to the USB device, leave the device inserted.</p>
<p>The VirtualBox GUI does not automatically provide a way to select a USB device to boot from. However, you can use a command line utility to link the USB device to a
<em>.vmdk</em>
file so that it can be
selected as a boot device. To do this on a Windows system, open a command prompt in administrative
mode (right-click
<strong>cmd</strong>
from the Run menu and select Run as administrator), and run the commands shown in Figure 2.2l. Before running these commands, verify the physical drive number from
Start menu → right-click Computer → Manage → Storage → Disk Management
. If the USB drive is different than Disk 1, change the number in
<em>\.PhysicalDrive1</em>
to match the disk number. You can also specify where to save the .
<em>vmdk</em>
file. Make sure that the security tab of the saved file gives “Full control” permissions to Users so that the file can be accessed by VirtualBox.</p>
<p><strong>Figure 2.2l: Creating the vmdk File in Windows</strong></p>
<p><a class="reference internal" href="_images/10000201000002A500000156B453E8F1.png"><img alt="10000201000002A500000156B453E8F1_png" src="_images/10000201000002A500000156B453E8F1.png" style="width: 6.9252in; height: 3.4984in;" /></a></p>
<p>Once you have a .
<em>vmdk</em>
file, create a new virtual machine while the USB stick is inserted. When you get to Figure 2.2e, select “Use existing hard disk” and browse to your
<em>.vmdk</em>
file. Click “Next”, then “Create”. This will create the virtual machine and bring you to Figure 2.2h. You can then create your storage disks and bridged adapter as usual. When finished, start the virtual machine and it will boot directly into FreeNAS®.</p>
</div>
</div>
<div class="section" id="vmware-esxi">
<h4>VMware ESXi<a class="headerlink" href="#vmware-esxi" title="Permalink to this headline">¶</a></h4>
<p>If you are considering using ESXi, read
<a class="reference external" href="http://forums.freenas.org/threads/sync-writes-or-why-is-my-esxi-nfs-so-slow-and-why-is-iscsi-faster.12506/">this post</a>
for an explanation of why iSCSI will be faster than NFS.</p>
<p>ESXi is is a bare-metal hypervisor architecture created by VMware Inc. Commercial and free versions of the VMware vSphere Hypervisor operating system (ESXi) are available from the
<a class="reference external" href="http://www.vmware.com/products/vsphere/esxi-and-esx/">VMware website</a>
. Once the operating system is installed on supported hardware, use a web browser to connect to its IP address. The welcome screen will provide a link to download the VMware vSphere client which is used to create and manage virtual machines.</p>
<p>Once the VMware vSphere client is installed, use it to connect to the ESXi server. To create a new virtual machine, click File → New → Virtual Machine. The New Virtual Machine Wizard will launch as seen in Figure 2.2m.</p>
<p>Click “Next”
** **
and input a name for the virtual machine. Click “Next” and highlight a datastore. An example is shown in Figure 2.2n.
** **
Click “Next”. In the screen shown in Figure 2.2o, click “Other” then select a FreeBSD architecture that matches the FreeNAS® architecture.</p>
<p><strong>Figure 2.2m: New Virtual Machine Wizard</strong></p>
<p><a class="reference internal" href="_images/10000201000003950000021F0BA6E10F.png"><img alt="10000201000003950000021F0BA6E10F_png" src="_images/10000201000003950000021F0BA6E10F.png" style="width: 6.9252in; height: 4.1in;" /></a></p>
<p><strong>Figure 2.2n: Select a Datastore</strong></p>
<p><a class="reference internal" href="_images/10000201000003950000021F7988BEDD.png"><img alt="10000201000003950000021F7988BEDD_png" src="_images/10000201000003950000021F7988BEDD.png" style="width: 6.9252in; height: 4.1in;" /></a></p>
<p><strong>Figure 2.2o: Select the Operating System</strong></p>
<p><a class="reference internal" href="_images/10000201000003950000021FFB8F2015.png"><img alt="10000201000003950000021FFB8F2015_png" src="_images/10000201000003950000021FFB8F2015.png" style="width: 6.9252in; height: 4.1in;" /></a></p>
<p>Click “Next” and create a virtual disk file of 2
** GB**
to hold the FreeNAS®
operating system, as shown in Figure 2.2p.</p>
<p>Click “Next” then “Finish”. Your virtual machine will be listed in the left frame. Right-click the virtual machine and select “Edit Settings” to access the screen shown in Figure 2.2q.</p>
<p>Increase the “Memory Configuration” to
<em>at least 2048 MB</em>
.
** **</p>
<p>Under “CPUs”, make sure that only 1 virtual processor is listed, otherwise you will be unable to start any FreeNAS® services.</p>
<p>To create a storage disk, click Hard disk 1 → Add. In the “Device Type” menu, highlight “Hard Disk” and click” Next”. Select “Create a new virtual disk” and click “Next”. In the screen shown in Figure 2.2r, select the size of the disk. If you would like the size to be dynamically allocated as needed, check the box “Allocate and commit space on demand (Thin Provisioning)”. Click “Next”, then “Next”, then “Finish” to create the disk. Repeat to create the amount of storage disks needed to meet your requirements.</p>
<p><strong>Figure 2.2p: Create a Disk for the Operating System</strong></p>
<p><a class="reference internal" href="_images/10000201000003950000021F038D89C4.png"><img alt="10000201000003950000021F038D89C4_png" src="_images/10000201000003950000021F038D89C4.png" style="width: 6.7957in; height: 3.8472in;" /></a></p>
<p><strong>Figure 2.2q: Virtual Machine&#8217;s Settings</strong></p>
<p><a class="reference internal" href="_images/10000201000002C400000270A063501A.png"><img alt="10000201000002C400000270A063501A_png" src="_images/10000201000002C400000270A063501A.png" style="width: 6.7346in; height: 4.3146in;" /></a></p>
<p><strong>Figure 2.2r: Creating a Storage Disk</strong></p>
<p><a class="reference internal" href="_images/100002010000028C00000200588B16CC.png"><img alt="100002010000028C00000200588B16CC_png" src="_images/100002010000028C00000200588B16CC.png" style="width: 6.7925in; height: 5.3339in;" /></a></p>
</div>
</div>
<div class="section" id="id25">
<h3>Installing from CDROM<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<p>If you prefer to install FreeNAS® using a menu-driven installer, download the
ISO
image
that matches the architecture of the system you will install onto (32- or 64-bit)
and burn it to a CDROM.</p>
<p><strong>NOTE:</strong>
the installer on the CDROM will recognize if a previous version of FreeNAS® is already installed, meaning the CDROM can also be used to upgrade FreeNAS®. However, the installer can not perform an upgrade from a FreeNAS® .7 system.</p>
<p>Insert the CDROM into the system and boot from it. Once the media has finished booting, you will be presented with the console setup menu seen in Figure 2.3a.</p>
<p><strong>NOTE:</strong>
if the installer does not boot, check that the CD drive is listed first in the boot order in the BIOS. Some motherboards may require you to connect the CDROM to SATA0 (the first connector) in order to boot from CDROM. If it stalls during boot, check the SHA256 hash of your ISO against that listed in the Release Notes; if the hash does not match, re-download the file. If the hash is correct, try burning the CD again at a lower speed.</p>
<p>Figure 2.3a: FreeNAS® Console Setup</p>
<p>Press enter to select the default option of “1 Install/Upgrade to hard drive/flash device, etc.”. The next menu, seen in Figure 2.3b, will list all available drives, including any inserted USB thumb drives which will begin with
<em>da</em>
. In this example, the user is installing into VirtualBox and has created a 4 GB virtual disk to hold the operating system.</p>
<p><strong>NOTE:</strong>
at this time, the installer does not check the size of the install media before attempting an installation. A 2 GB device is required, but the install will appear to complete successfully on smaller devices, only to fail at boot. If using a USB thumb drive, an 4 GB drive is recommended as many 2 GB thumb drives have a smaller capacity which will result in a seemingly successful installation that fails to boot.</p>
<p>Use your arrow keys to highlight the USB, compact flash device, or virtual disk to install into, then tab to OK and press enter. FreeNAS® will issue the warning seen in Figure 2.3c, reminding you not to install onto a storage drive.</p>
<p>Press enter and FreeNAS® will extract the image from the ISO and transfer it to the device. Once the installation is complete, you should see a message similar to Figure 2.3d.</p>
<p>Press enter to return to the first menu, seen in Figure 2.3a. Highlight “3 Reboot System” and press enter. Remove the CDROM. If you installed onto a USB thumb drive, leave the thumb drive inserted. Make sure that the device you installed to is listed as the first boot entry in the BIOS so that the system will boot from it. FreeNAS® should now be able to boot into the Console setup menu described in
<a class="reference external" href="#1.2.5.InitialSetup|outline">Initial Setup</a>
.</p>
<p>Figure 2.3b: Selecting Which Drive to Install Into</p>
<p><a class="reference internal" href="_images/10000000000002B50000016CE687B64A.png"><img alt="10000000000002B50000016CE687B64A_png" src="_images/10000000000002B50000016CE687B64A.png" style="width: 5.8228in; height: 3.0335in;" /></a></p>
<p>Figure 2.3c: FreeNAS® Installation Warning</p>
<p><a class="reference internal" href="_images/10000000000002CA000001595A6F0226.png"><img alt="10000000000002CA000001595A6F0226_png" src="_images/10000000000002CA000001595A6F0226.png" style="width: 6.9252in; height: 2.5709in;" /></a></p>
<p>Figure 2.3d: FreeNAS® Installation Complete</p>
<p><a class="reference internal" href="_images/10000000000002BF000000E0D845E216.png"><img alt="10000000000002BF000000E0D845E216_png" src="_images/10000000000002BF000000E0D845E216.png" style="width: 6.911in; height: 1.9783in;" /></a></p>
</div>
<div class="section" id="id27">
<h3>Burning an IMG File<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<p>If your system does not have a CDROM drive to install from, you can instead write the operating system directly to a compact flash card or USB thumbdrive. Download the
<em>img.xz</em>
file, uncompress the file, and write it to a compact flash card or USB thumbdrive that is 2 GB or larger. You then boot into that device to load the FreeNAS® operating system. This section demonstrates how to write the image using several different operating systems. The Unetbootin tool is not supported at this time.</p>
<p><strong>DANGER!</strong>
The
<strong>dd</strong>
command demonstrated in this section is very powerful and can destroy any existing data on the specified device. Be
<strong>very sure</strong>
that you know the device name to write to and that you do not typo the device name when using
<strong>dd</strong>
!
If you are uncomfortable writing the image yourself, download the
<em>.iso</em>
file instead and use the instructions in
<a class="reference external" href="#1.2.3.InstallingfromCDROM|outline">Installing from CDROM</a>
.</p>
<p>Once you have written the image to the device, make sure the boot order in the BIOS is set to boot from that device and boot the system. It should boot into the Console setup menu described in
<a class="reference external" href="#1.2.5.InitialSetup|outline">Initial Setup</a>
. If it does not, try the suggestions in the
<a class="reference external" href="#1.2.4.4.Troubleshooting|outline">Troubleshooting</a>
section.</p>
<div class="section" id="using-xzcat-and-dd-on-a-freebsd-or-linux-system">
<h4>Using xzcat and dd on a FreeBSD or Linux System<a class="headerlink" href="#using-xzcat-and-dd-on-a-freebsd-or-linux-system" title="Permalink to this headline">¶</a></h4>
<p>On a FreeBSD or Linux system, the
<strong>xzcat</strong>
and
<strong>dd</strong>
commands can be used to uncompress and write the
<em>.xz</em>
image to an inserted USB thumb drive or compact flash device. Example 2.4a demonstrates writing the image to the first USB device (
<em>/dev/da0</em>
) on a FreeBSD system. Substitute the filename of your
<em>.xz</em>
file and the device name representing the device to write to on your system.</p>
<p><a href="#id30"><span class="problematic" id="id31">**</span></a>Example 2.4a: Writing the Image to a USB Thumb Drive **</p>
<p><strong>xzcat FreeNAS-9.2.2-RELEASE-x64.img.xz | dd of=/dev/da0 bs=64k</strong></p>
<p>0+244141 records in</p>
<p>0+244141 records out</p>
<p>2000000000 bytes transferred in 596.039857 secs (3355480 bytes/sec)</p>
<p>When using the
<strong>dd</strong>
command:</p>
<ul class="simple">
<li><strong>of=</strong>
refers to the output file; in our case, the device name of the flash card or removable USB drive. You may have to increment the number in the name if it is not the first USB device. On Linux, use
<em>/dev/sdX,</em>
where
<em>X</em>
refers to the letter of the USB device.</li>
<li><strong>bs=</strong>
refers to the block size</li>
</ul>
</div>
<div class="section" id="using-keka-and-dd-on-an-os-x-system">
<h4>Using Keka and dd on an OS X System<a class="headerlink" href="#using-keka-and-dd-on-an-os-x-system" title="Permalink to this headline">¶</a></h4>
<p>On an OS X system, you can download and install
<a class="reference external" href="http://www.kekaosx.com/en/">Keka</a>
to uncompress the image. In FINDER, navigate to the location where you saved the downloaded
<em>.xz</em>
file. Right-click the
<em>.xz</em>
file and select “Open With Keka”. After a few minutes you will have a large file with the same name, but
no
<em>.xz</em>
extension
.</p>
<p>Insert the USB thumb drive and go to Launchpad → Utilities → Disk Utility. Unmount any mounted partitions on the USB thumb drive. Check that the USB thumb drive has only one partition, otherwise you will get partition table errors on boot. If needed, use Disk Utility to setup one partition on the USB drive; selecting &#8220;free space&#8221; when creating the partition works fine.</p>
<p>Next, determine the device name of the inserted USB thumb drive. From TERMINAL, navigate to your Desktop then type this command:</p>
<p><strong>diskutil list</strong></p>
<p>/dev/disk0</p>
<p>#:
TYPE NAME
SIZE
IDENTIFIER</p>
<p>0:
GUID_partition_scheme
<a href="#id32"><span class="problematic" id="id33">*</span></a>500.1 GB
disk0</p>
<p>1:
EFI
209.7 MB
disk0s1</p>
<p>2:
Apple_HFS Macintosh HD
499.2 GB
disk0s2</p>
<p>3:
Apple_Boot Recovery HD
650.0 MB
disk0s3</p>
<p>/dev/disk1</p>
<p>#:
TYPE NAME
SIZE
IDENTIFIER</p>
<p>0:
FDisk_partition_scheme
<a href="#id34"><span class="problematic" id="id35">*</span></a>8.0 GB
disk1</p>
<p>1:
DOS_FAT_32 UNTITLED
8.0 GB
disk1s1</p>
<p>This will show you which devices are available to the system. Locate your USB stick and record the path. If you are not sure which path is the correct one for the USB stick, remove the device, run the command again, and compare the difference. Once you are sure of the device name, navigate to the Desktop from TERMINAL, unmount the USB stick, and use the
<strong>dd</strong>
command to write the image to the USB stick. In Example 2.4b, the USB thumb drive is
<em>/dev/disk1</em>
. Substitute the name of your uncompressed file and the correct path to your USB thumb drive.</p>
<p><strong>Example 2.4b: Using dd on an OS X System</strong></p>
<p><strong>diskutil unmountDisk /dev/disk1</strong></p>
<p>Unmount of all volumes on disk1 was successful</p>
<p><strong>dd if=FreeNAS-9.2.2-RELEASE-x64.img of=/dev/disk1 bs=64k</strong></p>
<p><strong>NOTE:</strong>
if you get the error “Resource busy” when you run the
<strong>dd</strong>
command, go to Applications → Utilities → Disk Utility, find your USB thumb drive, and click on its partitions to make sure all of them are unmounted.
If you get the error “dd: /dev/disk1: Permission denied”, run the
<strong>dd</strong>
command by typing
<strong>sudo dd if=FreeNAS-9.2.2-RELEASE-x64.img of=/dev/disk1 bs=64k</strong>
, which will prompt for your password.</p>
<p>The
<strong>dd</strong>
command will take some minutes to complete. Wait until you get a prompt back and a message that displays how long it took to write the image to the USB drive.</p>
</div>
<div class="section" id="using-7-zip-and-win32diskimager-on-windows">
<h4>Using 7-Zip and Win32DiskImager on Windows<a class="headerlink" href="#using-7-zip-and-win32diskimager-on-windows" title="Permalink to this headline">¶</a></h4>
<p>Windows users will need to download a utility that can uncompress
<em>.xz</em>
files and a utility that can create a USB bootable image from the uncompressed
<em>.img</em>
file.</p>
<p>This section will demonstrate how to use
<a class="reference external" href="http://www.7-zip.org/">7-Zip</a>
and
<a class="reference external" href="https://launchpad.net/win32-image-writer">Win32DiskImager</a>
to burn the image file. When downloading Win32DiskImager, download the latest version that ends in
<em>-binary.zip</em>
and use 7-Zip to unzip its executable.</p>
<p>Once both utilities are installed, launch the 7-Zip File Manager and browse to the location containing your downloaded
<em>.img.xz</em>
file, as seen in Figure 2.4a.</p>
<p><strong>Figure 2.4a: Using 7-Zip to Extract Image File</strong></p>
<p>Click the Extract button, browse to the path to extract to, and click OK. The extracted image will end in
<em>.img</em>
and is now ready to be written to a USB device using Win32DiskImager.</p>
<p>Next, launch Win32DiskImager, shown in Figure 2.4b. Use the browse button to browse to the location of the
<em>.img</em>
file. Insert a USB thumb drive and select its drive letter from the Device drop-down menu. Click the Write button and the image will be written to the USB thumb drive.</p>
<p><strong>Figure 2.4b: Using Win32DiskImager to Write the Image</strong></p>
</div>
<div class="section" id="id36">
<h4>Troubleshooting<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h4>
<p>If the system does not boot into FreeNAS®, there are several things that you can check to resolve the situation.</p>
<p>First, check the system BIOS and see if there is an option to change the USB emulation from CD/DVD/floppy to hard drive. If it still will not boot, check to see if the card/drive is UDMA compliant.</p>
<p>Some users have found that some brands of 2 GB USB sticks do not work as they are not really 2 GB in size, but changing to a 4 GB stick fixes the problem.</p>
<p>If you are writing the image to a compact flash card, make sure that it is MSDOS formatted.</p>
<p>If the system starts to boot but hangs with this repeated error message:</p>
<p>run_interrupt_driven_hooks: still waiting after 60 seconds for xpt_config</p>
<p>go into the system BIOS and see if there is an onboard device configuration for a 1394 Controller. If so, disable the device and try booting again.</p>
<p>If the burned image fails to boot and the image was burned using a Windows system, wipe the USB stick before trying a second burn using a utility such as
<a class="reference external" href="http://how-to-erase-hard-drive.com/">Active&#64; KillDisk</a>
. Otherwise, the second burn attempt will fail as Windows does not understand the partition which was written from the image file. Be very careful that you specify the USB stick when using a wipe utility!</p>
</div>
</div>
<div class="section" id="id37">
<h3>Initial Setup<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h3>
<p>When you boot into FreeNAS®, the Console Setup, shown in Figure 2.5a, will appear at the end of the boot process. If you have access to the the FreeNAS® system&#8217;s keyboard and monitor, this Console Setup menu can be used to administer the system should the administrative GUI become inaccessible.</p>
<p><strong>NOTE:</strong>
you can access the Console Setup menu from within the FreeNAS® GUI by typing
<strong>/etc/netcli</strong>
from
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
. You can disable the Console Setup menu by unchecking the &#8220;Enable Console Menu&#8221; in System → Settings →
<a class="reference external" href="#1.4.6.2.AdvancedTab|outline">Advanced</a>
.</p>
<p><strong>Figure 2.5a: FreeNAS® Console Setup Menu</strong></p>
<p><a class="reference internal" href="_images/10000000000001EB0000014DF2519984.png"><img alt="10000000000001EB0000014DF2519984_png" src="_images/10000000000001EB0000014DF2519984.png" style="width: 5.9154in; height: 3.0835in;" /></a></p>
<p>This menu provides the following options:</p>
<p><strong>1) Configure Network Interfaces:</strong>
provides a configuration wizard to configure the system&#8217;s network interfaces.</p>
<p><strong>2) Configure Link Aggregation:</strong>
allows you to either create a new
<a class="reference external" href="#1.5.3.LinkAggregations|outline">link aggregation</a>
or to delete an existing link aggregation.</p>
<p><strong>3) Configure VLAN Interface:</strong>
used to create or delete a
<a class="reference external" href="#1.5.6.VLANs|outline">VLAN</a>
interface.</p>
<p><strong>4) Configure Default Route:</strong>
used to set the IPv4 or IPv6 default gateway. When prompted, input the IP address of the default gateway.</p>
<p><strong>5) Configure Static Routes:</strong>
will prompt for the destination network and the gateway IP address. Re-enter this option for each route you need to add.</p>
<p><strong>6) Configure DNS:</strong>
will prompt for the name of the DNS domain then the IP address of the first DNS server. To input multiple DNS servers, press enter to input the next one. When finished, press enter twice to leave this option.</p>
<p><strong>7) Reset WebGUI login credentials:</strong>
if you are unable to login to the graphical administrative interface, select this option. The next time the graphical interface is accessed, it will prompt to set the
<em>root</em>
password.</p>
<p><strong>8) Reset to factory defaults:</strong>
if you wish to delete
<strong>all</strong>
of the configuration changes made in the administrative GUI, select this option. Once the configuration is reset, the system will reboot. You will need to go to Storage → Volumes → Auto Import Volume to re-import your volume.</p>
<p><strong>9) Shell:</strong>
enters a shell in order to run FreeBSD commands. To leave the shell, type
<strong>exit.</strong></p>
<p><strong>10) Reboot:</strong>
reboots the system.</p>
<p><strong>11) Shutdown:</strong>
halts the system.</p>
<p>During boot, FreeNAS® will automatically try to connect to a
DHCP
server from all live interfaces. If it successfully receives an IP address, it will display the IP address which can be used to access the
graphical console. In the example seen in Figure 2.5a, the FreeNAS® system is accessible from
<em>http://</em>
<em>192.168.1.70</em>
.</p>
<p>If your FreeNAS® server is not connected to a network with a DHCP server, you can use the network configuration wizard to manually configure the interface as seen in Example 2.5a. In this example, the FreeNAS® system has one network interface (
<em>em0</em>
).</p>
<p><strong>Example 2.5a: Manually Setting an IP Address from the Console Menu</strong></p>
<p>Enter an option from 1-11:
<strong>1</strong></p>
<ol class="arabic simple">
<li>em0</li>
</ol>
<p>Select an interface (q to quit):
<strong>1</strong></p>
<p>Delete existing config? (y/n)
<strong>n</strong></p>
<p>Configure interface for DHCP? (y/n)
<strong>n</strong></p>
<p>Configure IPv4? (y/n)
<strong>y</strong></p>
<p>Interface name: (press enter as can be blank)</p>
<p>Several input formats are supported</p>
<p>Example 1 CIDR Notation:</p>
<p>192.168.1.1/24</p>
<p>Example 2 IP and Netmask separate:</p>
<p>IP: 192.168.1.1</p>
<p>Netmask: 255.255.255.0, or /24 or 24</p>
<p>IPv4 Address:
192.168.1.108/24</p>
<p>Saving interface configuration: Ok</p>
<p>Configure IPv6? (y/n)
n</p>
<p>Restarting network: ok</p>
<p>You may try the following URLs to access the web user interface:</p>
<p><a class="reference external" href="http://192.168.1.108/">http://192.168.1.108</a></p>
<p>Once the system has an IP address, input that address into a graphical web browser from a computer capable of accessing the network containing the FreeNAS® system. You should be prompted to create a password for the
<em>root</em>
user, as seen in Figure 2.5b.</p>
<p><strong>Figure 2.5b: Set the Root Password</strong></p>
<p>Setting a password is mandatory and the password can not be blank. Since this password provides access to the administrative GUI, it should be a hard-to-guess password. Once the password has been input and confirmed, you should see the administrative GUI as shown in the example in Figure 2.5c.</p>
<p><strong>Figure 2.5c: FreeNAS® Graphical Configuration Menu</strong></p>
<p>If you are unable to access the IP address from a browser, check the following:</p>
<ul class="simple">
<li>Are proxy settings enabled in the browser configuration? If so, disable the settings and try connecting again.</li>
<li>If the page does not load, make sure that you can
<strong>ping</strong>
the FreeNAS® system&#8217;s IP address. If the address is in a private IP address range, you will only be able to access the system from within the private network.</li>
<li>If the user interface loads but is unresponsive or seems to be missing menu items, try using a different web browser. IE9 has known issues and will not display the graphical administrative interface correctly if compatibility mode is turned on. If you can&#8217;t access the GUI using Internet Explorer, use
<a class="reference external" href="http://www.mozilla.com/en-US/firefox/all.html">Firefox</a>
instead.</li>
<li>If you receive “An error occurred!” messages when attempting to configure an item in the GUI, make sure that the browser is set to allow cookies from the FreeNAS® system.</li>
</ul>
<p>This
<a class="reference external" href="http://fortysomethinggeek.blogspot.com/2012/10/ipad-iphone-connect-with-freenas-or-any.html">blog post</a>
describes some applications which can be used to access the FreeNAS® system from an iPad or iPhone.</p>
</div>
<div class="section" id="id40">
<h3>Upgrading FreeNAS®<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h3>
<p>FreeNAS® provides two methods for performing an upgrade: an ISO upgrade or an upgrade using the graphical administrative interface. Unless the Release Notes indicate that your current version requires an ISO upgrade, you can use either upgrade method. Both methods are described in this section.</p>
<p><strong>Before performing an upgrade, always backup your configuration file and your data.</strong></p>
<p>When upgrading,
<strong>be aware of the following caveats:</strong></p>
<ul class="simple">
<li>Neither upgrade method can be used to migrate from FreeNAS 0.7x. Instead, install FreeNAS®
and either
<a class="reference external" href="#1.6.3.1.AutoImportingVolumes|outline">auto-import</a>
supported software RAID or
<a class="reference external" href="#1.6.3.2.ImportingVolumes|outline">import</a>
supported filesystems. You will need to recreate your configuration as the installation process will not import 0.7 configuration settings.</li>
</ul>
<div class="section" id="preparing-for-the-upgrade">
<h4>Preparing for the Upgrade<a class="headerlink" href="#preparing-for-the-upgrade" title="Permalink to this headline">¶</a></h4>
<p>Before upgrading the system to 9.2.2, perform the following steps:</p>
<ol class="arabic simple">
<li><a class="reference external" href="http://www.freenas.org/download-releases.html">Download</a>
the
<em>.iso</em>
or .
<em>txz</em>
file that matches the system&#8217;s architecture to the computer that you use to access the FreeNAS® system.</li>
<li>Locate and confirm the SHA256 hash for the file that you downloaded in the Release Notes for the version that you are upgrading to.</li>
<li><strong>Backup the FreeNAS® configuration</strong>
** **
in System → Settings → General → Save Config.</li>
<li>If any volumes are encrypted, make sure that you have
<a class="reference external" href="#1.6.3.4.2.CreatinganEncryptedVolume|outline">set the passphrase and have copies of the encryption key and the latest recovery key</a>
.</li>
<li>Warn users that the FreeNAS® shares will be unavailable during the upgrade; you should schedule the upgrade for a time that will least impact users.</li>
<li>Stop all services in Services → Control Services.</li>
</ol>
</div>
<div class="section" id="using-the-iso-to-upgrade">
<h4>Using the ISO to Upgrade<a class="headerlink" href="#using-the-iso-to-upgrade" title="Permalink to this headline">¶</a></h4>
<p>Burn the downloaded
<em>.iso</em>
file to a CDROM.</p>
<p>Insert the CDROM into the system and boot from it. Once the media has finished booting into the installation menu, press enter to select the default option of “1 Install/Upgrade to hard drive/flash device, etc.” As with a fresh install, the installer will present a screen showing all available drives; select the device FreeNAS® is installed into and press enter.</p>
<p>The installer will recognize that an earlier version of FreeNAS® is installed on the device and will present the message shown in Figure 2.6a.</p>
<p><strong>NOTE:</strong>
if you select to perform a
<em>Fresh Install</em>
, you will have to restore the backup of your configuration.</p>
<p>To perform an upgrade, press enter to accept the default of
<em>Upgrade Install</em>
. Again, the installer will remind you that the operating system should be installed on a thumb drive. Press enter to start the upgrade. Once the installer has finished unpacking the new image, you will see the menu shown in Figure 2.6b. The database file that is preserved and migrated contains your FreeNAS® configuration settings.</p>
<p>Press enter and FreeNAS® will indicate that the upgrade is complete and that you should reboot, as seen in Figure 2.6c.</p>
<p><strong>Figure 2.6a: Upgrading a FreeNAS® Installation</strong></p>
<p><a class="reference internal" href="_images/10000000000002C20000017F0B9104CB.png"><img alt="10000000000002C20000017F0B9104CB_png" src="_images/10000000000002C20000017F0B9104CB.png" style="width: 5.9327in; height: 3.1917in;" /></a></p>
<p><strong>Figure 2.6b: FreeNAS® will Preserve and Migrate Settings</strong></p>
<p><a class="reference internal" href="_images/10000000000002CF0000018CA87134B3.png"><img alt="10000000000002CF0000018CA87134B3_png" src="_images/10000000000002CF0000018CA87134B3.png" style="width: 6.9252in; height: 3.8134in;" /></a></p>
<p>During the reboot there may be a conversion of the previous configuration database to the new version of the database. This happens during the “Applying database schema changes” line in the reboot cycle. This conversion can take a long time to finish so be patient and the boot should complete normally. If for some reason you end up with database errors but the graphical administrative interface is accessible,
go to Settings → General and use the Upload Config button to upload the configuration that you saved before you started the upgrade.</p>
<p><strong>Figure 2.6c: Upgrade is Complete</strong>
** **</p>
<p><a class="reference internal" href="_images/10000000000002C300000141704D5CD2.png"><img alt="10000000000002C300000141704D5CD2_png" src="_images/10000000000002C300000141704D5CD2.png" style="width: 6.9252in; height: 2.4161in;" /></a></p>
</div>
<div class="section" id="using-the-gui-to-upgrade">
<h4>Using the GUI to Upgrade<a class="headerlink" href="#using-the-gui-to-upgrade" title="Permalink to this headline">¶</a></h4>
<p>To perform an upgrade using this method,
<a class="reference external" href="http://www.freenas.org/download-releases.html">download</a>
the latest version of the
<em>.txz</em>
file
that matches the
architecture of the system (32- or 64-bit)
. Then, go to System → Settings → Advanced → Firmware Update as shown in Figure 2.6d.</p>
<p>Use the drop-down menu to select an existing volume to temporarily place the firmware file during the upgrade. Alternately, select “Memory device” to allow the system to create a temporary RAM disk to be used during the upgrade.
After making your selection, click the Apply Update button to see the screen shown in Figure 2.6e.</p>
<p>This screen again reminds you to backup your configuration before proceeding. If you have not yet, click the “click here” link.</p>
<p>Browse to the location of the downloaded
<em>.txz</em>
file, then paste its SHA256 sum.</p>
<p>When finished, click the Apply Update button to begin the upgrade progress. Behind the scenes, the following steps are occurring:</p>
<ul class="simple">
<li>the SHA256 hash is confirmed and an error will display if it does not match; if you get this error, double-check that you pasted the correct checksum and try pasting again</li>
<li>the new image is uncompressed and written to the USB compact or flash drive; this can take a few minutes so be patient</li>
<li>once the new image is written, you will momentarily lose your connection as the FreeNAS® system will automatically reboot into the new version of the operating system</li>
<li>FreeNAS® will actually reboot twice: once the new operating system loads, the upgrade process applies the new database schema and reboots again</li>
<li>assuming all went well, the FreeNAS® system will receive the same IP from the DHCP server; refresh your browser after a moment to see if you can access the system</li>
</ul>
<p>Figure 2.
6
d: Upgrading
FreeNAS®
From the
GUI</p>
<p><a class="reference internal" href="_images/10000000000002D1000001F0BFB72532.png"><img alt="10000000000002D1000001F0BFB72532_png" src="_images/10000000000002D1000001F0BFB72532.png" style="width: 6.7528in; height: 4.4299in;" /></a></p>
<p><strong>Figure 2.6e: Step 2 of 2</strong></p>
<p><a class="reference internal" href="_images/10000000000002FA000001E9AA5ABD0D.png"><img alt="10000000000002FA000001E9AA5ABD0D_png" src="_images/10000000000002FA000001E9AA5ABD0D.png" style="width: 6.6508in; height: 3.7728in;" /></a></p>
</div>
<div class="section" id="unlocking-an-encrypted-volume">
<h4>Unlocking an Encrypted Volume<a class="headerlink" href="#unlocking-an-encrypted-volume" title="Permalink to this headline">¶</a></h4>
<p>If your disks are encrypted and you have created a passphrase and saved the recovery key, the volume will automatically be locked during an upgrade. This is to prevent an unauthorized user from using an upgrade procedure to gain access to the data on the encrypted disks. After the upgrade, the locked volumes will be unavailable until they are unlocked with the passphrase and recovery key.</p>
<p>To unlock the volume, go to Storage → Volumes → View Volumes and highlight the locked volume. As seen in Figure 2.6f, clicking the “Unlock” icon will prompt for the passphrase or recovery key. You can also select which services to start when the volume is unlocked.</p>
<p><strong>Figure 2.6f: Unlocking an Encrypted Volume</strong></p>
<p><a class="reference internal" href="_images/10000000000002EE00000236CD5A0F75.png"><img alt="10000000000002EE00000236CD5A0F75_png" src="_images/10000000000002EE00000236CD5A0F75.png" style="width: 6.9252in; height: 5.2256in;" /></a></p>
</div>
<div class="section" id="if-something-goes-wrong">
<h4>If Something Goes Wrong<a class="headerlink" href="#if-something-goes-wrong" title="Permalink to this headline">¶</a></h4>
<p>If the FreeNAS® system does not become available after the upgrade, you will need physical access to the system to find out what went wrong. From the console menu you can determine if it received an IP address and use option “1) Configure Network Interfaces” if it did not.</p>
<p>If this does not fix the problem, go into option “9) Shell” and read the system log with this command:</p>
<p><strong>more /var/log/messages</strong></p>
<p>If the database upgrade failed, a file called
<em>/data/upgrade-failed</em>
should be created with the details.</p>
<p>If the problem is not obvious or you are unsure how to fix it, see
<a class="reference external" href="#1.12.FreeNAS®SupportResources|outline">FreeNAS® Support Resources</a>
.</p>
<p>FreeNAS® supports two operating systems on the operating system device: the current operating system and, if you have performed an upgrade, the previously installed version of the operating system. This allows you to reboot into the previous version should you experience a problem with the upgraded version.</p>
<p>The upgrade process automatically configures the system to boot from the new operating system. If the system remains inaccessible and you wish to revert back to the previous installation, type
<strong>reboot</strong>
from the shell or select “10) Reboot” from the console menu. Watch the boot screens and press the other boot option (typically
<em>F2</em>
) from the FreeNAS® console when you see the following options at the very beginning of the boot process. In this example,
<em>Boot: F1</em>
refers to the default option (the newly upgraded version), so pressing
<em>F2</em>
will boot into the previous version.</p>
<p>F1 FreeBSD</p>
<p>F2 FreeBSD</p>
<p>Boot: F1</p>
<p><strong>NOTE:</strong>
if a previously working FreeNAS® system hangs after a FreeNAS® upgrade, check to see if there is a BIOS/BMC firmware upgrade available as that may fix the issue.</p>
<p>If the upgrade completely fails, don&#8217;t panic. The data is still on your disks and you still have a copy of your saved configuration. You can always:</p>
<ol class="arabic simple">
<li>Perform a fresh installation.</li>
<li>Import your volumes in Storage →
<a class="reference external" href="#1.6.3.1.AutoImportingVolumes|outline">Auto Import Volume</a>
.</li>
<li>Restore the configuration in System → Settings →
<a class="reference external" href="#1.4.6.1.GeneralTab|outline">Upload Config</a>
.</li>
</ol>
</div>
<div class="section" id="upgrading-a-zfs-pool">
<h4>Upgrading a ZFS Pool<a class="headerlink" href="#upgrading-a-zfs-pool" title="Permalink to this headline">¶</a></h4>
<p>ZFS pools that are created using
<a class="reference external" href="#1.6.3.4.ZFSVolumeManager|outline">ZFS Volume Manager</a></p>
<p>on FreeNAS® 9.x
have
<a class="reference external" href="http://blog.vx.sk/archives/35-New-features-in-open-source-ZFS.html">ZFS feature flags</a>
enabled. Feature flags are sometimes referred to as ZFS version 5000. ZFS pools that were created in FreeNAS® 8.3.x use ZFSv28. Any ZFS pools that were created in any previous 8.x versions of FreeNAS® use ZFSv15. If you
<a class="reference external" href="#1.6.3.1.AutoImportingVolumes|outline">auto-import</a>
a ZFS pool from any 8.x version, it will remain at its original ZFS version unless you upgrade the pool. This means that the pool will not understand any feature flags, such as LZ4 compression, until the pool is upgraded.</p>
<p>If you wish to upgrade an existing ZFSv15 or ZFSv28 pool, be aware of the following caveats first:</p>
<ul class="simple">
<li>the ZFS version upgrade must be performed from the command line, it can not be performed using the GUI.</li>
<li>the pool upgrade is a one-way street meaning that
<strong>if you change your mind you can not go back to an earlier ZFS version</strong>
or downgrade to an earlier version of FreeNAS® that does not support feature flags.</li>
<li>before performing any operation that may affect the data on a storage disk,
<strong>always backup your **
**data first and verify the integrity of the backup.</strong>
** **
While it is unlikely that the pool upgrade will affect the data, it is always better to be safe than sorry.</li>
</ul>
<p>To perform the ZFS version upgrade, open
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
.
The following commands will determine the pool state and version. In this example, the pool name is
<em>volume1</em>
and the ZFS version is 28.</p>
<p><strong>zpool status</strong></p>
<p>pool: volume1</p>
<p>state: ONLINE</p>
<p>status: The pool is formatted using a legacy on-disk format.
The pool can</p>
<p>still be used, but some features are unavailable.</p>
<p>action: Upgrade the pool using &#8216;zpool upgrade&#8217;.
Once this is done, the</p>
<p>pool will no longer be accessible on software that does not support feature</p>
<p>flags.</p>
<p>scan: none requested</p>
<p>config:</p>
<p>NAME
STATE
READ WRITE CKSUM</p>
<p>volume1
ONLINE
0
0
0</p>
<p>gptid/ea16925b-e96e-11e2-9ed5-e06995777a82
ONLINE
0
0
0</p>
<p>gptid/ea8f3a7b-e96e-11e2-9ed5-e06995777a82
ONLINE
0
0
0</p>
<p>gptid/eb064d06-e96e-11e2-9ed5-e06995777a82
ONLINE
0
0
0</p>
<p>gptid/eb7ba402-e96e-11e2-9ed5-e06995777a82
ONLINE
0
0
0</p>
<p>errors: No known data errors</p>
<p><strong>zpool get version volume1</strong></p>
<p>NAME
PROPERTY
VALUE
SOURCE</p>
<p>volume1
version
28
local</p>
<p>Next, verify that the status of the pool is healthy:</p>
<p><strong>zpool status -x</strong></p>
<p>all pools are healthy</p>
<p><strong>NOTE:</strong>
do not upgrade the pool if its status does not show as healthy.</p>
<p>To upgrade a pool named
<em>volume1</em>
:</p>
<p><strong>zpool upgrade volume1</strong></p>
<p>This system supports ZFS pool feature flags.</p>
<p>Successfully upgraded &#8216;volume1&#8217; from version 28 to feature flags.</p>
<p>Enabled the following features on &#8216;volume1&#8217;:</p>
<p>async_destroy</p>
<p>empty_bpobj</p>
<p>lz4_compress</p>
<p>The upgrade itself should only take a seconds and is non-disruptive. This means that you do not need to stop any sharing services in order to upgrade the pool. However, you should choose to upgrade when the pool is not being heavily used. The upgrade process will suspend I/O for a short period, but should be nearly instantaneous on a quiet pool.</p>
</div>
</div>
</div>
</div>
<div class="section" id="section-2-using-the-graphical-interface">
<h1>Section 2: Using the Graphical Interface<a class="headerlink" href="#section-2-using-the-graphical-interface" title="Permalink to this headline">¶</a></h1>
<p>This section of the Guide describes all of the configuration screens available within the FreeNAS® graphical administrative interface. It begins with a Quick Start Guide that provides an overview of the FreeNAS® configuration workflow.</p>
<p>The configuration screens are listed in the order that they appear within the FreeNAS® configuration tree found in the left frame of the graphical administrative interface.</p>
<p><strong>NOTE:</strong>
it is important to use the GUI (or the console) for
all configuration changes.
FreeNAS® uses a configuration database to store its settings. While you can use the command line to modify your configuration, changes made at the command line are not written to the configuration database. This means that any changes made at the command line will not persist after a reboot and will be overwritten by the values in the configuration database during an upgrade.</p>
<div class="section" id="quick-start-guide-and-account-configuration">
<h2>Quick Start Guide and Account Configuration<a class="headerlink" href="#quick-start-guide-and-account-configuration" title="Permalink to this headline">¶</a></h2>
<p>This section contains a Quick Start Guide to get you started with your FreeNAS® configuration. It is followed by the account section of the GUI which allows you to change the administrative password and manage users and groups.</p>
<div class="section" id="quick-start-guide">
<h3>Quick Start Guide<a class="headerlink" href="#quick-start-guide" title="Permalink to this headline">¶</a></h3>
<p>This section demonstrates the initial preparation that should be performed before you start to configure the FreeNAS® system. It then provides an overview of the configuration workflow along with pointers to the section in the 9.2.2 Users Guide that contains the details and configuration examples for each step in the configuration workflow.</p>
<div class="section" id="set-the-root-password">
<h4>Set the Root Password<a class="headerlink" href="#set-the-root-password" title="Permalink to this headline">¶</a></h4>
<p>The first time you access the FreeNAS® administrative interface, a pop-up window will prompt you to set the
<em>root</em>
password. You should set a hard to guess password as anyone who knows this password can gain access to the FreeNAS® administrative GUI.</p>
<p><a href="#id46"><span class="problematic" id="id47">**</span></a>NOTE: **
for security reasons, the SSH service and
<em>root</em>
SSH logins are disabled by default. Unless these are set, the only way to access a shell as
<em>root</em>
is to gain physical access to the console menu or to access the web shell within the administrative GUI. This means that the FreeNAS® system should be kept physically secure and that the administrative GUI should be behind a properly configured firewall and protected by a secure password.</p>
</div>
<div class="section" id="set-the-administrative-email-address">
<h4>Set the Administrative Email Address<a class="headerlink" href="#set-the-administrative-email-address" title="Permalink to this headline">¶</a></h4>
<p>FreeNAS® provides an Alert icon in the upper right corner to provide a visual indication of events that warrant administrative attention. The alert system automatically emails the
<em>root</em>
user account whenever an alert is issued. FreeNAS® also sends a daily email to the
<a href="#id48"><span class="problematic" id="id49">*</span></a>root *
user which should be read in order to determine the overall health of the system.</p>
<p>To set the email address for the
<em>root</em>
account, go to Account →
<a class="reference external" href="#1.3.2.3.Users|outline">Users</a>
→ View Users. Click the Change E-mail button associated with the
<em>root</em>
user account and input the email address of the person to receive
the administrative emails.</p>
</div>
<div class="section" id="enable-console-logging">
<h4>Enable Console Logging<a class="headerlink" href="#enable-console-logging" title="Permalink to this headline">¶</a></h4>
<p>To view system messages within the graphical administrative interface, go to System → Settings →
<a class="reference external" href="#1.4.6.2.AdvancedTab|outline">Advanced</a>
. Check the box “Show console messages in the footer” and click Save. The output of
<strong>tail **
**-f /var/log/messages</strong>
will now be displayed at the bottom of the screen. If you click the console messages area, it will pop-up as a window, allowing you to scroll through the output and to copy its contents.</p>
<p>You are now ready to start configuring the FreeNAS® system. Typically, the configuration workflow will use the following steps in their listed order.</p>
</div>
<div class="section" id="configure-storage">
<h4>Configure Storage<a class="headerlink" href="#configure-storage" title="Permalink to this headline">¶</a></h4>
<p>FreeNAS® supports the creation of both UFS and ZFS volumes; however, ZFS volumes are recommended to get the most out of your FreeNAS® system.</p>
<p>When creating a volume, you have several choices depending upon your storage requirements and whether or not data already exists on the disk(s). T
he following options are available:
** **</p>
<ol class="arabic simple">
<li>Auto-import an existing UFS disk, gstripe (RAID0), gmirror (RAID1), or graid3 (RAID3) in Storage → Volumes → Auto Import Volume.</li>
<li>Auto-import an existing ZFS disk, stripe, mirror, RAIDZ1, RAIDZ2, or RAIDZ3 in Storage → Volumes → Auto
Import Volume. Auto-importing is described in more detail in
<a class="reference external" href="#1.6.3.1.AutoImportingVolumes|outline">Auto Importing</a>
<a class="reference external" href="#1.6.3.1.AutoImportingVolumes|outline">Volumes</a>
.</li>
<li>Import a disk that is formatted with UFS, NTFS, MSDOS, or EXT2 in Storage → Volumes → Import Volume. This is described in more detail in
<a class="reference external" href="#1.6.3.2.ImportingVolumes|outline">Importing Volumes</a>
.</li>
<li>Format disk(s) with UFS and optionally create a gstripe (RAID0), gmirror (RAID1), or graid3 (RAID3) in Storage → Volumes →
<a class="reference external" href="#1.6.3.3.UFSVolumeManager|outline">UFS Volume Manager</a>
.</li>
<li>Format disk(s) with ZFS and optionally create a stripe, mirror, RAIDZ1, RAIDZ2, or RAIDZ3 in Storage → Volumes →
<a class="reference external" href="#1.6.3.4.ZFSVolumeManager|outline">ZFS Volume Manager</a>
.</li>
</ol>
<p>If you format your disk(s) with ZFS, additional options are available:</p>
<ol class="arabic simple">
<li>Divide the ZFS pool into datasets to provide more flexibility when configuring user access to data. Dataset creation is described in
<a class="reference external" href="#1.6.3.5.CreatingZFSDatasets|outline">Creating ZFS Datasets</a>
.</li>
<li>Create a Zvol to be used when configuring an iSCSI device extent. Zvol creation is described in
<a class="reference external" href="#1.6.3.6.Creatingazvol|outline">Creating a zvol</a>
.</li>
</ol>
</div>
<div class="section" id="create-users-groups-or-integrate-with-ad-ldap">
<h4>Create Users/Groups or Integrate with AD/LDAP<a class="headerlink" href="#create-users-groups-or-integrate-with-ad-ldap" title="Permalink to this headline">¶</a></h4>
<p>FreeNAS® supports a variety of user access scenarios:</p>
<ul class="simple">
<li>the use of an anonymous or guest account that everyone in the network uses to access the stored data</li>
<li>the creation of individual user accounts where each user has access to their own ZFS dataset</li>
<li>the addition of individual user accounts to groups where each group has access to their own
volume or ZFS dataset</li>
<li>the import of existing accounts from an OpenLDAP or Active Directory server</li>
</ul>
<p>When configuring your FreeNAS® system,
<strong>select one of the following,</strong>
** **
depending upon whether or not the network has an existing OpenLDAP or Active Directory domain. OpenLDAP and Active Directory are mutually exclusive, meaning that you can not use both but must choose one or the other.</p>
<ol class="arabic simple">
<li>Manually create users and groups. User management is described in
<a class="reference external" href="#1.3.2.3.Users|outline">Users</a>
and group management is described in
<a class="reference external" href="#1.3.2.2.Groups|outline">Groups</a>
.</li>
<li>Import existing Active Directory account information using the instructions in
<a class="reference external" href="#1.8.2.ActiveDirectory|outline">Active Directory</a>
.</li>
<li>Import existing OpenLDAP account information using the instructions in
<a class="reference external" href="#1.8.8.LDAP|outline">LDAP</a>
.</li>
</ol>
</div>
<div class="section" id="configure-permissions">
<h4>Configure Permissions<a class="headerlink" href="#configure-permissions" title="Permalink to this headline">¶</a></h4>
<p>Setting permissions is an important aspect of configuring access to storage data. The graphical administrative interface is meant to set the
<strong>initial</strong>
** **
permissions in order to make a volume or dataset accessible as a share. Once a share is available, the client operating system should be used to fine-tune the permissions of the files and directories that are created by the client.</p>
<p>Configured volumes and datasets will appear in Storage → Volumes. Each volume and dataset will have its own Change Permissions option, allowing for greater flexibility when providing access to data.</p>
<p>Before creating your shares, determine which users should have access to which data. This will help you to determine if multiple volumes, datasets, and/or shares should be created to meet the permissions needs of your environment.</p>
</div>
<div class="section" id="configure-sharing">
<h4>Configure Sharing<a class="headerlink" href="#configure-sharing" title="Permalink to this headline">¶</a></h4>
<p>Once your volumes have been configured with permissions, you are ready to configure the type of share or service that you determine is suitable for your network.</p>
<p>FreeNAS® supports several types of shares and sharing services for providing storage data to the clients in a network. It is recommended that you
<strong>select only one type of share per volume or dataset</strong>
** **
in order to prevent possible conflicts between different types of shares. The type of share you create depends upon the operating system(s) running in your network, your security requirements, and expectations for network transfer speeds. The following types of shares and services are available:</p>
<ul class="simple">
<li><strong>Apple (AFP):</strong>
FreeNAS® uses Netatalk to provide sharing services to Apple clients. This type of share is a good choice if all of your computers run Mac OS X. Configuration examples can be found in
<a class="reference external" href="#1.7.1.Apple(AFP)Shares|outline">section 7.1</a>
.</li>
<li><strong>Unix (NFS):</strong>
this type of share is accessible by Mac OS X, Linux, BSD, and professional/enterprise versions of Windows. It is a good choice if there are many different operating systems in your network. Configuration examples can be found in
<a class="reference external" href="#1.7.2.Unix(NFS)Shares|outline">section 7.2</a>
.</li>
<li><strong>Windows (CIFS):</strong>
FreeNAS® uses Samba to provide the SMB/CIFS sharing service. This type of share is accessible by Windows, Mac OS X, Linux, and BSD computers, but it is slower than an NFS share. If your network contains only Windows systems, this is a good choice. Configuration examples can be found in
<a class="reference external" href="#1.7.3.Windows(CIFS)Shares|outline">section 7.3</a>
.</li>
<li><strong>FTP:</strong>
this service provides fast access from any operating system, using a cross-platform FTP and file manager client application such as Filezilla. FreeNAS® supports encryption and chroot for FTP. Configuration examples can be found in
<a class="reference external" href="#1.8.6.FTP|outline">section 8.6</a>
.</li>
<li><strong>SSH:</strong>
this service provides encrypted connections from any operating system using SSH command line utilities or the graphical WinSCP application for Windows clients. Configuration examples can be found in
<a class="reference external" href="#1.8.12.SSH|outline">section 8.12</a>
.</li>
<li><strong>iSCSI:</strong>
FreeNAS® uses istgt to export virtual disk drives that are accessible to clients running iSCSI initiator software. Configuration examples can be found in
<a class="reference external" href="#1.8.7.iSCSI|outline">section 8.7</a>
.</li>
</ul>
</div>
<div class="section" id="start-applicable-service-s">
<h4>Start Applicable Service(s)<a class="headerlink" href="#start-applicable-service-s" title="Permalink to this headline">¶</a></h4>
<p>Once you have configured your share or service, you will need to start its associated service(s) in order to implement the configuration. By default, all services are off until you start them. The status of services is managed using Services →
<a class="reference external" href="#1.8.1.ControlServices|outline">Control Services</a>
. To start a service, click its red OFF button. After a second or so, it will change to a blue ON, indicating that the service has been enabled. Watch the console messages as the service starts to determine if there are any error messages.</p>
</div>
<div class="section" id="test-configuration-from-client">
<h4>Test Configuration from Client<a class="headerlink" href="#test-configuration-from-client" title="Permalink to this headline">¶</a></h4>
<p>If the service successfully starts, try to make a connection to the service from a client system. For example, use Windows Explorer to try to connect to a CIFS share, use an FTP client such as Filezilla to try to connect to an FTP share, or use Finder on a Mac OS X system to try to connect to an AFP share.</p>
<p>If the service starts correctly and you can make a connection but receive permissions errors, check that the user has permissions to the volume/dataset being accessed.</p>
</div>
<div class="section" id="backup-the-configuration">
<h4>Backup the Configuration<a class="headerlink" href="#backup-the-configuration" title="Permalink to this headline">¶</a></h4>
<p>Once you have tested your configuration, be sure to back it up. Go to System →
<a class="reference external" href="#1.4.6.1.GeneralTab|outline">Settings</a>
and click the Save Config button. Your browser will provide an option to save a copy of the configuration database.</p>
<p>You should
<strong>backup your configuration whenever you make configuration changes and always before upgrading FreeNAS®</strong>
.</p>
</div>
</div>
<div class="section" id="account-configuration">
<h3>Account Configuration<a class="headerlink" href="#account-configuration" title="Permalink to this headline">¶</a></h3>
<p>The Account Configuration section of the administrative GUI describes how to manually create and manage users and groups. This section contains the following entries:</p>
<ul class="simple">
<li><a class="reference external" href="#1.3.2.1.Groups|outline">Groups</a>
: used to manage UNIX-style groups on the FreeNAS® system.</li>
<li><a class="reference external" href="#1.3.2.2.Users|outline">Users</a>
: used to manage UNIX-style accounts on the FreeNAS® system.</li>
</ul>
<p>Each of these entries are described in more detail in this section.</p>
<div class="section" id="id55">
<h4>Groups<a class="headerlink" href="#id55" title="Permalink to this headline">¶</a></h4>
<p>The Groups interface allows you to manage UNIX-style groups on the FreeNAS® system.</p>
<p><strong>NOTE:</strong>
if Active Directory or OpenLDAP is running on your network, you do not need to recreate the
network&#8217;s users or groups. Instead, import the existing account information into FreeNAS® using Services →
Directory Services →
<a class="reference external" href="#1.8.2.ActiveDirectory|outline">Active Directory</a>
or Services → Directory Services →
<a class="reference external" href="#1.8.8.LDAP|outline">LDAP</a>
.</p>
<p>This section describes how to create a group and assign it user accounts. The next section will describe how to create user accounts.</p>
<p>If you click Groups → View Groups, you will see a screen similar to Figure 3.2a.</p>
<p><strong>Figure 3.2a: FreeNAS® Groups Management</strong></p>
<p><a class="reference internal" href="_images/10000000000002B1000001EDAEAA5CF9.png"><img alt="10000000000002B1000001EDAEAA5CF9_png" src="_images/10000000000002B1000001EDAEAA5CF9.png" style="width: 6.9252in; height: 4.9547in;" /></a></p>
<p>All groups that came with the operating system will be listed. Each group has an entry indicating the group ID, group name, whether or not it is a built-in group which was installed with FreeNAS®, and whether or not the group&#8217;s members are allowed to use
<strong>sudo</strong>
. If you click a group entry,
a Members button will appear. Click this button to view and modify that group&#8217;s membership.</p>
<p>f you click the
Add Group
button, you will see the screen shown in Figure 3.2b. Table 3.2a summarizes the available options when creating a group.</p>
<p><strong>Figure 3.2b: Creating a New Group</strong></p>
<p><a class="reference internal" href="_images/10000000000002400000014CFA486E78.png"><img alt="10000000000002400000014CFA486E78_png" src="_images/10000000000002400000014CFA486E78.png" style="width: 5.9992in; height: 3.4575in;" /></a></p>
<p><strong>Table 3.2a: Options When Creating a Group</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="4%" />
<col width="89%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Group ID</td>
<td>string</td>
<td>the next available group ID will be suggested for you; by convention, UNIX groups containing user accounts have an ID greater than 1000 and groups required by a service have an ID equal to the default port number used by the service (e.g. the sshd group has an ID of 22)</td>
</tr>
<tr class="row-odd"><td>Group Name</td>
<td>string</td>
<td>mandatory</td>
</tr>
<tr class="row-even"><td>Permit Sudo</td>
<td>checkbox</td>
<td>if checked, members of the group have permission to use
<strong>sudo</strong></td>
</tr>
<tr class="row-odd"><td>Allow repeated GIDs</td>
<td>checkbox</td>
<td>allows multiple groups to share the same group id; this is useful when a GID is already associated with the UNIX permissions for existing data</td>
</tr>
</tbody>
</table>
<p>Once the group and users are created, you can assign users as members of a group. Click on View Groups then the Members button for the group you wish to assign users to. Highlight the user in the Member users list (which shows all user accounts on the system) and click the &gt;&gt; to move that user to the right frame. The user accounts which appear in the right frame will be added as members of that group.</p>
<p>In the example shown in Figure 3.2c, the
<em>data1</em>
group has been created and the
<em>user1</em>
user account has been created with a primary group of
<em>user1</em>
. The Members button for the
<em>data1</em>
group has been selected and
<em>user1</em>
has been added as a member of that group.</p>
<p>To delete a group, click its Delete Group button. The pop-up message will ask whether or not you would also like to delete all members of that group. Note that the built-in groups do not provide a Delete Group button.</p>
<p><strong>Figure 3.2c: Assigning a User as a Member of a Group</strong></p>
<p><a class="reference internal" href="_images/100000000000037A000001F472E304C4.png"><img alt="100000000000037A000001F472E304C4_png" src="_images/100000000000037A000001F472E304C4.png" style="width: 6.9252in; height: 3.8902in;" /></a></p>
</div>
<div class="section" id="id58">
<h4>Users<a class="headerlink" href="#id58" title="Permalink to this headline">¶</a></h4>
<p>FreeNAS® supports users, groups, and permissions, allowing great flexibility in configuring which users have access to the data stored on FreeNAS®. In order to assign permissions which will be used by shares, you will need to do
<strong>one of the following</strong>
:</p>
<ol class="arabic simple">
<li>Create a guest account that all users will use.</li>
<li>Create a user account for every user in the network where the name of each account is the same as a logon name used on a computer. For example, if a Windows system has a login name of
<em>bobsmith</em>
, you should create a user account with the name
<em>bobsmith</em>
on FreeNAS®. If your intent is to assign groups of users different permissions to shares, you will need to also create groups and assign users to the groups.</li>
<li>If your network uses Active Directory to manage user accounts and permissions, enable the
<a class="reference external" href="#1.8.4.1.ActiveDirectory|outline">Active Directory</a>
service.</li>
<li>If your network uses an OpenLDAP server to manage user accounts and permissions, enable the
<a class="reference external" href="#1.8.4.2.LDAP|outline">LDAP</a>
service.</li>
</ol>
<p>User accounts can be given
<a class="reference external" href="#1.6.3.9.SettingPermissions|outline">permissions</a>
to volumes or datasets. If you wish to use groups to manage permissions, you should create the user accounts first, then assign the accounts as members of the groups. This section demonstrates how to create a user account.</p>
<p><strong>NOTE:</strong>
if Active Directory or OpenLDAP is running on your network, you do not need to recreate the network&#8217;s users or groups. Instead, import the existing account information into FreeNAS® using Services → Active Directory or Services → LDAP.</p>
<p>Account → Users → View Users provides a listing of all of the system accounts that were installed with the FreeNAS® operating system, as shown in Figure 3.2d.</p>
<p><strong>Figure 3.</strong>
<strong>2d</strong>
<strong>: Managing User Accounts</strong></p>
<p><a class="reference internal" href="_images/10000000000004BC000001E97FA3DC88.png"><img alt="10000000000004BC000001E97FA3DC88_png" src="_images/10000000000004BC000001E97FA3DC88.png" style="width: 6.9252in; height: 2.7937in;" /></a></p>
<p>Each account entry indicates the user ID, username, primary group ID, home directory, default shell, full name, whether or not it is a built-in user that came with the FreeNAS® installation, the email address, whether or not logins are disabled, whether or not the user account is locked, and whether or not the user is allowed to use
<strong>sudo</strong>
.
To reorder the list, click the desired column.</p>
<p>If you click a user account, the following buttons will appear for that account:</p>
<ul class="simple">
<li><strong>Change Password:</strong>
provides fields to enter and confirm the new password.</li>
<li><strong>Modify User:</strong>
used to modify the account&#8217;s settings, as listed in Table 3.2b.</li>
<li><strong>Auxiliary Groups:</strong>
used to make the account a member of additional groups.</li>
<li><strong>Change E-mail:</strong>
used to change the email address associated with the account.</li>
</ul>
<p><strong>NOTE:</strong>
it is important to set the email address for the built-in
<em>root</em>
user account as important system messages are sent to the
<em>root</em>
user. For security reasons, password logins are disabled for the
<em>root</em>
account and changing this setting is highly discouraged.</p>
<p>Every account that came with the FreeNAS® operating system, except for the
<em>root</em>
user, is a system account. Each system account is used by a service and should not be available for use as a login account.
For this reason, the default shell is
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=nologin">nologin(8)</a>
. For security reasons, and to prevent breakage of system services, you should not modify the system accounts.</p>
<p>To create a user account, click the Add New User button to open the screen shown in Figure 3.2e.
Some
settings are only available in Advanced Mode. To see these settings, either click the Advanced Mode
button or configure the system to always display these settings by checking the box “Show advanced fields by default” in System → Settings → Advanced.
Table 3.2b summarizes the options which are available when you create or modify a user account.</p>
<p><strong>Figure 3.2e: Adding or Editing a User Account</strong></p>
<p><a class="reference internal" href="_images/100000000000026B000001AA72839EBC.jpg"><img alt="100000000000026B000001AA72839EBC_jpg" src="_images/100000000000026B000001AA72839EBC.jpg" style="width: 6.9252in; height: 3.6626in;" /></a></p>
<p><strong>Table 3.2b: User Account Configuration</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="6%" />
<col width="84%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>User ID</td>
<td>integer</td>
<td>greyed out if user already created; when creating an account, the next numeric ID will be suggested; by convention, user accounts have an ID greater than 1000 and system accounts have an ID equal to the default port number used by the service</td>
</tr>
<tr class="row-odd"><td>Username</td>
<td>string</td>
<td>greyed out if user already created; maximum 32 characters to allow for longer AD names though a maximum of 8 is recommended for interoperability; can include numerals but can not include a space</td>
</tr>
<tr class="row-even"><td>Create a new primary group</td>
<td>checkbox</td>
<td>by default, a primary group with the same name as the user will be created; uncheck this box to select a different primary group name (
<strong>NOTE</strong>
: in Unix,
<a class="reference external" href="http://linuxers.org/article/difference-between-primary-and-secondary-groups-linux">a primary group is not the same as a secondary/auxiliary group</a>
)</td>
</tr>
<tr class="row-odd"><td>Primary Group</td>
<td>drop-down menu</td>
<td>must uncheck
<em>Create a new primary group</em>
in order to access this menu; for security reasons, FreeBSD will not give a user
<strong>su</strong>
permissions if
<em>wheel</em>
is their primary group&#8211;if your intent is to give a user
<strong>su</strong>
access, add them to the
<em>wheel</em>
group in the Auxiliary groups section</td>
</tr>
<tr class="row-even"><td>Home Directory</td>
<td>browse button</td>
<td>leave as
<em>/nonexistent</em>
for system accounts, otherwise browse to the name of an
<strong>existing</strong>
volume or dataset that the user will be assigned permission to access</td>
</tr>
<tr class="row-odd"><td>Home Directory Mode</td>
<td>checkboxes</td>
<td>only available in Advanced Mode and will be read-only for built-in users; sets default permissions of user&#8217;s home directory</td>
</tr>
<tr class="row-even"><td>Shell</td>
<td>drop-down menu</td>
<td>if creating a system account, choose
<em>nologin</em>
; if creating a user account, select shell of choice</td>
</tr>
<tr class="row-odd"><td>Full Name</td>
<td>string</td>
<td>mandatory, may contain spaces</td>
</tr>
<tr class="row-even"><td>E-mail</td>
<td>string</td>
<td>email address associated with the account</td>
</tr>
<tr class="row-odd"><td>Password</td>
<td>string</td>
<td>mandatory unless check box to disable password logins</td>
</tr>
<tr class="row-even"><td>Password confirmation</td>
<td>string</td>
<td>must match
<em>Password</em></td>
</tr>
<tr class="row-odd"><td>Disable password login</td>
<td>checkbox</td>
<td>when checked, the user can not log into the FreeNAS® system or authenticate to a CIFS share; to undo this setting, set a password for the user using the &#8220;Change Password&#8221; button for the user in &#8220;View Users&#8221;; checking this box will grey out
<em>Lock user</em>
which is mutually exclusive</td>
</tr>
<tr class="row-even"><td>Lock user</td>
<td>checkbox</td>
<td>a checked box prevents user from logging in until the account is unlocked (box is unchecked)
; checking this box will grey out
<em>Disable password login</em>
which is mutually exclusive</td>
</tr>
<tr class="row-odd"><td>Permit Sudo</td>
<td>checkbox</td>
<td>if checked, members of the group have permission to use
<strong>sudo</strong></td>
</tr>
<tr class="row-even"><td>SSH
Public K
ey</td>
<td>string</td>
<td>paste the user&#8217;s
<strong>public</strong>
key to be used for SSH key authentication (
<strong>do not paste the private key!</strong>
)</td>
</tr>
<tr class="row-odd"><td>Auxiliary groups</td>
<td>mouse selection</td>
<td>highlight the group(s) you wish to add the user to and use the &gt;&gt; button to add the user to the highlighted groups</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section" id="system-configuration">
<h2>System Configuration<a class="headerlink" href="#system-configuration" title="Permalink to this headline">¶</a></h2>
<p>The System section of the administrative GUI contains the following entries:</p>
<ul>
<li><p class="first"><a class="reference external" href="#1.4.1.CronJobs|outline">Cron Jobs</a>
<a href="#id61"><span class="problematic" id="id62">**</span></a>: **
provides a graphical front-end to
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=crontab&amp;sektion=5">crontab(5)</a></p>
</li>
<li><p class="first"><a class="reference external" href="#1.4.2.Init/ShutdownScripts|outline">Init/Shutdown Scripts</a>
<strong>:</strong></p>
<p>used to configure a command or script to automatically execute during system startup or shutdown</p>
</li>
<li><p class="first"><a class="reference external" href="#1.4.2.NTPServers|outline">NTP Servers</a>
<a href="#id63"><span class="problematic" id="id64">**</span></a>: **
used to configure NTP server settings</p>
</li>
<li><p class="first"><a class="reference external" href="#1.4.4.RsyncTasks|outline">Rsync Tasks</a>
<a href="#id65"><span class="problematic" id="id66">**</span></a>: **
allows you to schedule rsync tasks</p>
</li>
<li><p class="first"><a class="reference external" href="#1.4.5.S.M.A.R.T.Tests|outline">S.M.A.R.T. Tests</a>
<a href="#id67"><span class="problematic" id="id68">**</span></a>: **
allows you to schedule which S.M.A.R.T. tests to run on a per-disk basis</p>
</li>
<li><p class="first"><a class="reference external" href="#1.4.7.Settings|outline">Settings</a>
<strong>:</strong>
used to configure system wide settings such as timezone, email setup, HTTPS access, and firmware upgrades</p>
</li>
<li><p class="first"><a class="reference external" href="#1.4.7.Sysctls|outline">Sysctls</a>
<a href="#id70"><span class="problematic" id="id71">**</span></a>: **
provides a front-end for tuning the FreeNAS® system by interacting with the underlying FreeBSD kernel</p>
</li>
<li><p class="first"><a class="reference external" href="#1.4.8.SystemInformation|outline">System Information</a>
<strong>:</strong>
provides general FreeNAS® system information such as hostname, operating system version, platform, and uptime</p>
</li>
<li><p class="first"><a class="reference external" href="#1.4.9.Tunables|outline">Tunables</a>
<a href="#id72"><span class="problematic" id="id73">**</span></a>: **
provides a front-end to load additional kernel modules at boot time</p>
</li>
</ul>
<p>Each of these is described in more detail in this section.</p>
<div class="section" id="id74">
<h3>Cron Jobs<a class="headerlink" href="#id74" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=cron">cron(8)</a>
is a daemon that runs a command or script on a regular schedule as a specified user. Typically, the user who wishes to schedule a task manually creates a
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=crontab&amp;sektion=5">crontab(5)</a>
using syntax that can be perplexing to new Unix users. The FreeNAS® GUI makes it easy to schedule when you would like the task to occur.</p>
<p><strong>NOTE:</strong>
due to a limitation in FreeBSD, users with account names that contain spaces or exceed 17 characters are unable to create cron jobs.</p>
<p>Figure 4.1a shows the screen that opens when you click System → Cron Jobs → Add Cron Job.</p>
<p><strong>Figure 4.1a: Creating a Cron Job</strong></p>
<p><a class="reference internal" href="_images/10000000000002B1000001DFB89D50FB.png"><img alt="10000000000002B1000001DFB89D50FB_png" src="_images/10000000000002B1000001DFB89D50FB.png" style="width: 6.9252in; height: 4.8146in;" /></a></p>
<p>Table 4.1a summarizes the configurable options when creating a cron job.</p>
<p><strong>Table 4.1a: Cron Job Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="16%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>User</td>
<td>drop-down menu</td>
<td>make sure the selected user has permission to run the specified command or script</td>
</tr>
<tr class="row-odd"><td>Command</td>
<td>string</td>
<td>the
<strong>full path</strong>
to the command or script to be run; if it is a script, test it at the command line first to make sure that it works as expected</td>
</tr>
<tr class="row-even"><td>Short description</td>
<td>string</td>
<td>optional</td>
</tr>
<tr class="row-odd"><td>Minute</td>
<td>slider or minute selections</td>
<td>if use the slider, cron job occurs every N minutes; if use minute selections, cron job occurs at the highlighted minutes</td>
</tr>
<tr class="row-even"><td>Hour</td>
<td>slider or hour selections</td>
<td>if use the slider, cron job occurs every N hours; if use hour selections, cron job occurs at the highlighted hours</td>
</tr>
<tr class="row-odd"><td>Day of month</td>
<td>slider or month selections</td>
<td>if use the slider, cron job occurs every N days; if use day selections, cron job occurs on the highlighted days each month</td>
</tr>
<tr class="row-even"><td>Month</td>
<td>checkboxes</td>
<td>cron job occurs on the selected months</td>
</tr>
<tr class="row-odd"><td>Day of week</td>
<td>checkboxes</td>
<td>cron job occurs on the selected days</td>
</tr>
<tr class="row-even"><td>Redirect Stdout</td>
<td>checkbox</td>
<td>disables emailing standard output to the
<em>root</em>
user account</td>
</tr>
<tr class="row-odd"><td>Redirect Stderr</td>
<td>checkbox</td>
<td>disables emailing errors to the
<em>root</em>
user account</td>
</tr>
<tr class="row-even"><td>Enabled</td>
<td>checkbox</td>
<td>uncheck if you would like to disable the cron job without deleting it</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id76">
<h3>Init/Shutdown Scripts<a class="headerlink" href="#id76" title="Permalink to this headline">¶</a></h3>
<p>FreeNAS® provides the ability to schedule commands or scripts to run at system startup or shutdown.</p>
<p>Figure 4.2a shows the screen that opens when you click System → Init/Shutdown Scripts → Add Init/Shutdown Script. Table 4.2a summarizes the available options.</p>
<p>When scheduling a command, make sure that the command is in your path or give the full path to the command. One way to test the path is to type
<strong>which command_name.</strong>
If the command is not found, it is not in your path.</p>
<p>When scheduling a script, make sure that the script is executable and has been fully tested to ensure that it achieves the desired results.</p>
<p><strong>Figure 4.2a: Add an Init/Shutdown Script</strong></p>
<p><a class="reference internal" href="_images/10000000000001F40000013D5D55C1C6.png"><img alt="10000000000001F40000013D5D55C1C6_png" src="_images/10000000000001F40000013D5D55C1C6.png" style="width: 6.0228in; height: 2.9346in;" /></a></p>
<p><strong>Table 4.2a: Options When Adding an Init/Shutdown Script</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="17%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Setting</strong></td>
<td><strong>Value</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td>Type</td>
<td>drop-down menu</td>
<td>select from
<em>Command</em>
(for an executable) or
<em>Script</em>
(for an executable script)</td>
</tr>
<tr class="row-odd"><td>Command</td>
<td>string</td>
<td>if
<em>Command</em>
is selected, input the command plus any desired options; if
<em>Script</em>
is selected, browse to the location of the script</td>
</tr>
<tr class="row-even"><td>Type</td>
<td>drop-down menu</td>
<td>select when the command/script will run; choices are
<em>Pre Init *
(very early in boot process before filesystems are mounted)
,
*Post Init *
(towards end of boot process before FreeNAS services are started)
, or
*Shutdown</em></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id77">
<h3>NTP Servers<a class="headerlink" href="#id77" title="Permalink to this headline">¶</a></h3>
<p>The network time protocol (NTP) is used to synchronize the time on the computers in a network. Accurate time is necessary for the successful operation of time sensitive applications such as Active Directory.</p>
<p>By default, FreeNAS® is pre-configured to use three public NTP servers. If your network is using Active Directory, ensure that the FreeNAS® system and the Active Directory Domain Controller have been configured to use the same NTP servers.</p>
<p>Figure 4.3a shows the default NTP configuration for FreeNAS®.
If you wish to change a default server to match the settings used by your network&#8217;s domain controller, click an entry to access its “Edit” button. Alternately, you can delete the default NTP servers and click “Add NTP Server” to create your own. Figure 4.3b shows the “Add NTP Server” screen and Table 4.3a summarizes the options when adding or editing an NTP server.
** **
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=ntp.conf">ntp.conf(5)</a>
explains these options in more detail.</p>
<p><strong>Figure 4.3a: Default NTP Configuration</strong></p>
<p><a class="reference internal" href="_images/10000000000002E3000001E636F5AB70.png"><img alt="10000000000002E3000001E636F5AB70_png" src="_images/10000000000002E3000001E636F5AB70.png" style="width: 6.9252in; height: 4.5543in;" /></a></p>
<p><strong>Figure 4.3b: Add or Edit a NTP Server</strong></p>
<p><a class="reference internal" href="_images/100000000000011C0000016E12EDFEE5.jpg"><img alt="100000000000011C0000016E12EDFEE5_jpg" src="_images/100000000000011C0000016E12EDFEE5.jpg" style="width: 3.4217in; height: 3.389in;" /></a></p>
<p><strong>Table 4.3a: NTP Server Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="8%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Address</td>
<td>string</td>
<td>name of NTP server</td>
</tr>
<tr class="row-odd"><td>Burst</td>
<td>checkbox</td>
<td>recommended when
<em>Max. Poll</em>
is greater than
<em>10</em>
; only use on your own servers i.e.
<strong>do not</strong>
** **
use with a public NTP server</td>
</tr>
<tr class="row-even"><td>IBurst</td>
<td>checkbox</td>
<td>speeds the initial synchronization (seconds instead of minutes)</td>
</tr>
<tr class="row-odd"><td>Prefer</td>
<td>checkbox</td>
<td>should only be used for NTP servers that are known to be highly accurate, such as those with time monitoring hardware</td>
</tr>
<tr class="row-even"><td>Min. Poll</td>
<td>integer</td>
<td>power of 2 in seconds; can not be lower than
<em>4</em>
or higher than
<em>Max. Poll</em></td>
</tr>
<tr class="row-odd"><td>Max. Poll</td>
<td>integer</td>
<td>power of 2 in seconds; can not be higher than
<em>17</em>
or lower than
<em>Min. Poll</em></td>
</tr>
<tr class="row-even"><td>Force</td>
<td>checkbox</td>
<td>forces the addition of the NTP server, even if it is currently unreachable</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id78">
<h3>Rsync Tasks<a class="headerlink" href="#id78" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.samba.org/ftp/rsync/rsync.html">Rsync</a>
is a utility that automatically copies specified data from one system to another over a network. Once the initial data is copied, rsync reduces the amount of data sent over the network by sending only the differences between the source and destination files. Rsync can be used for backups, mirroring data on multiple systems, or for copying files between systems.</p>
<p>To configure rsync, you need to configure both ends of the connection:</p>
<ul class="simple">
<li><strong>the rsync server:</strong>
this system pulls (receives) the data. This system is referred to as
<em>PULL</em>
in the configuration examples.</li>
<li><strong>the rsync client:</strong>
this system pushes (sends) the data. This system is referred to as
<em>PUSH</em>
in the configuration examples.</li>
</ul>
<p>FreeNAS® can be configured as either an rsync client or an rsync server. The opposite end of the connection can be another FreeNAS® system or any other system running rsync. In FreeNAS® terminology, an rysnc task defines which data is synchronized between the two systems. If you are synchronizing data between two FreeNAS® systems, create the rsync task on the rsync client.</p>
<p>FreeNAS® supports two modes of rsync operation:</p>
<ul class="simple">
<li><strong>rsync module mode:</strong>
exports a directory tree, and its configured settings, as a symbolic name over an unencrypted connection. This mode requires that at least one module be defined on the rsync server. It can be defined in the FreeNAS® GUI under Services → Rsync →
<a class="reference external" href="#1.8.12.1.RsyncModules|outline">Rsync Modules</a>
. In other operating systems, the module is defined in
<a class="reference external" href="http://www.samba.org/ftp/rsync/rsyncd.conf.html">rsyncd.conf(5)</a>
.</li>
<li><strong>rsync over SSH:</strong>
synchronizes over an encrypted connection. Requires the configuration of SSH user and host public keys.</li>
</ul>
<p>This section summarizes the options when creating an Rsync Task. It then provides a configuration example between two FreeNAS® systems for each mode of rsync operation.</p>
<p><strong>NOTE:</strong>
if there is a firewall between the two systems or if the other system has a built-in firewall, make sure that TCP port 873 is allowed.</p>
<div class="section" id="creating-an-rsync-task">
<h4>Creating an Rsync Task<a class="headerlink" href="#creating-an-rsync-task" title="Permalink to this headline">¶</a></h4>
<p>Figure 4.4a shows the screen that appears when you click System → Rsync Tasks → Add Rsync Task. Table 4.4a summarizes the options that can be configured when creating an rsync task.</p>
<p><strong>Figure 4.4a: Adding an Rsync Task</strong></p>
<p><a class="reference internal" href="_images/1000000000000231000001C0FC056B3B.png"><img alt="1000000000000231000001C0FC056B3B_png" src="_images/1000000000000231000001C0FC056B3B.png" style="width: 6.7583in; height: 4.148in;" /></a></p>
<p><strong>Table 4.4a: Rsync Configuration Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="11%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Path</td>
<td>browse button</td>
<td>browse to the volume/dataset/directory that you wish to copy;
note that a path length greater than 255 characters will fail</td>
</tr>
<tr class="row-odd"><td>Remote Host</td>
<td>string</td>
<td>IP address or hostname of the remote system that will store the copy</td>
</tr>
<tr class="row-even"><td>Remote SSH Port</td>
<td>integer</td>
<td>only available in
<em>Rsync over SSH *
mode
; allows you to specify an alternate SSH port other than the default of
*22</em></td>
</tr>
<tr class="row-odd"><td>Rsync mode</td>
<td>drop-down menu</td>
<td>choices are
<em>Rsync module</em>
or
<em>Rsync over SSH</em></td>
</tr>
<tr class="row-even"><td>Remote Module Name / Remote Path</td>
<td>string</td>
<td>when using
<em>Rsync module *
mode
, at least one module must be defined
in
`rsyncd.conf(5) &lt;http://www.samba.org/ftp/rsync/rsyncd.conf.html&gt;`_
of rsync server or in Services → Rsync → Rsync Modules of another FreeNAS® system; when using
*Rsync over SSH *
mode
,
input the path on the remote host to push or pull (e.g.
*/mnt/volume</em>
)</td>
</tr>
<tr class="row-odd"><td>Direction</td>
<td>drop-down menu</td>
<td>choices are
<em>Push</em>
or
<em>Pull</em>
; default is to push from the FreeNAS®
system to a remote host</td>
</tr>
<tr class="row-even"><td>Short Description</td>
<td>string</td>
<td>optional</td>
</tr>
<tr class="row-odd"><td>Minute</td>
<td>slider or minute selections</td>
<td>if use the slider, sync occurs every N minutes; if use minute selections, sync occurs at the highlighted minutes</td>
</tr>
<tr class="row-even"><td>Hour</td>
<td>slider or hour selections</td>
<td>if use the slider, sync occurs every N hours; if use hour selections, sync occurs at the highlighted hours</td>
</tr>
<tr class="row-odd"><td>Day of month</td>
<td>slider or day selections</td>
<td>if use the slider, sync occurs every N days; if use day selections, sync occurs on the highlighted days</td>
</tr>
<tr class="row-even"><td>Month</td>
<td>checkboxes</td>
<td>task occurs on the selected months</td>
</tr>
<tr class="row-odd"><td>Day of week</td>
<td>checkboxes</td>
<td>task occurs on the selected days of the week</td>
</tr>
<tr class="row-even"><td>User</td>
<td>drop-down menu</td>
<td>specified user must have permission to write to the specified directory on the remote system; due to a limitation in FreeBSD, the user name can not contain spaces or exceed 17 characters</td>
</tr>
<tr class="row-odd"><td>Recursive</td>
<td>checkbox</td>
<td>if checked, copy will include all subdirectories of the specified volume</td>
</tr>
<tr class="row-even"><td>Times</td>
<td>checkbox</td>
<td>preserve modification times of files</td>
</tr>
<tr class="row-odd"><td>Compress</td>
<td>checkbox</td>
<td>recommended on slow connections as reduces size of data to be transmitted</td>
</tr>
<tr class="row-even"><td>Archive</td>
<td>checkbox</td>
<td>equivalent to
<strong>-rlptgoD</strong>
(recursive, copy symlinks as symlinks, preserve permissions, preserve modification times, preserve group, preserve owner (super-user only), and preserve device files (super-user only) and special files)</td>
</tr>
<tr class="row-odd"><td>Delete</td>
<td>checkbox</td>
<td>delete files in destination directory that don&#8217;t exist in sending directory</td>
</tr>
<tr class="row-even"><td>Quiet</td>
<td>checkbox</td>
<td>suppresses informational messages from the remote server</td>
</tr>
<tr class="row-odd"><td>Preserve permissions</td>
<td>checkbox</td>
<td>preserves original file permissions; useful if User is set to
<em>root</em></td>
</tr>
<tr class="row-even"><td>Preserve extended attributes</td>
<td>checkbox</td>
<td>both systems must support
<a class="reference external" href="http://en.wikipedia.org/wiki/Xattr">extended attributes</a></td>
</tr>
<tr class="row-odd"><td>Extra options</td>
<td>string</td>
<td><a class="reference external" href="http://rsync.samba.org/ftp/rsync/rsync.html">rsync(1)</a>
options not covered by the GUI</td>
</tr>
<tr class="row-even"><td>Enabled</td>
<td>checkbox</td>
<td>uncheck if you would like to disable the rsync task without deleting it</td>
</tr>
</tbody>
</table>
<p>If the rysnc server requires password authentication, input
<em>&#8211;password-file=/PATHTO/FILENAME</em>
in the “Extra options” box, replacing
<em>/PATHTO/FILENAME</em>
with the appropriate path to the file containing the value of the password.</p>
</div>
<div class="section" id="configuring-rsync-module-mode-between-two-freenas-systems">
<h4>Configuring Rsync Module Mode Between Two FreeNAS® Systems<a class="headerlink" href="#configuring-rsync-module-mode-between-two-freenas-systems" title="Permalink to this headline">¶</a></h4>
<p>This configuration example will configure rsync module mode between the two following FreeNAS® systems:</p>
<ul class="simple">
<li><em>192.168.2.2</em>
has existing data in
<em>/mnt/local/images</em>
. It will be the rsync client, meaning that an rsync task needs to be defined.
It will be referred to as
<em>PUSH.</em></li>
<li><em>192.168.2.6</em>
has an existing volume named
<em>/mnt/remote</em>
. It will be the rsync server, meaning that it will receive the contents of
<em>/mnt/local/images</em>
. An rsync module needs to be defined on this system and the rsyncd service needs to be started. It will be referred to as
<em>PULL.</em></li>
</ul>
<p>On
<em>PUSH</em>
, an rsync task is defined in System → Rsync Tasks → Add Rsync Task as shown in Figure 4.5b. In this example:</p>
<ul class="simple">
<li>the Path points to
<em>/usr/local/images</em>
, the directory to be copied</li>
<li>the Remote Host points to
<em>192.168.2.6</em>
, the IP address of the rsync server</li>
<li>the Rsync Mode is
<em>Rsync module</em></li>
<li>the Remote Module Name is
<em>backups</em>
; this will need to be defined on the rsync server</li>
<li>the Direction is
<em>Push</em></li>
<li>the rsync is scheduled to occur every 15 minutes</li>
<li>the User is set to
<em>root</em>
so it has permission to write anywhere</li>
<li>the Preserve Permissions checkbox is checked so that the original permissions are not overwritten by the
<em>root</em>
user</li>
</ul>
<p>On
<em>PULL</em>
, an rsync module is defined in Services → Rsync Modules → Add Rsync Module, shown in Figure 4.4c. In this example:</p>
<ul class="simple">
<li>the Module Name is
<em>backups</em>
; this needs to match the setting on the rsync client</li>
<li>the Path is
<em>/mnt/remote</em>
; a directory called
<em>images</em>
will be created to hold the contents of
<em>/usr/local/images</em></li>
<li>the User is set to
<em>root</em>
so it has permission to write anywhere</li>
<li>Hosts allow is set to
<em>192.168.2.2</em>
, the IP address of the rsync client</li>
</ul>
<p>Descriptions of the configurable options can be found in
<a class="reference external" href="#1.8.11.1.RsyncModules|outline">Rsync Modules</a>
.</p>
<p>To finish the configuration, start the rsync service on
<em>PULL</em>
in Services → Control Services. If the rsync is successful, the contents of
<em>/mnt/local/images/</em>
will be mirrored to
<em>/mnt/remote/images/</em>
.</p>
<p><strong>Figure 4.4b: Configuring the Rsync Client</strong></p>
<p><a class="reference internal" href="_images/1000000000000230000001BF3B7F7314.png"><img alt="1000000000000230000001BF3B7F7314_png" src="_images/1000000000000230000001BF3B7F7314.png" style="width: 6.7457in; height: 4.139in;" /></a></p>
<p><strong>Figure 4.4c: Configuring the Rsync Server</strong></p>
<p><a class="reference internal" href="_images/10000000000002FC000001F4677F2595.png"><img alt="10000000000002FC000001F4677F2595_png" src="_images/10000000000002FC000001F4677F2595.png" style="width: 6.9252in; height: 3.4835in;" /></a></p>
</div>
<div class="section" id="configuring-rsync-over-ssh-mode-between-two-freenas-systems">
<h4>Configuring Rsync over SSH Mode Between Two FreeNAS® Systems<a class="headerlink" href="#configuring-rsync-over-ssh-mode-between-two-freenas-systems" title="Permalink to this headline">¶</a></h4>
<p>SSH replication mode does not require the creation of an rsync module or for the rsync service to be running on the rsync server. It does require SSH to be configured before creating the rsync task:</p>
<ul class="simple">
<li>a public/private key pair for the rsync user account (typically
<em>root</em>
) must be generated on
<em>PUSH</em>
and the public key copied to the same user account on
<em>PULL</em></li>
<li>to mitigate the risk of man-in-the-middle attacks, the public host key of
<em>PULL</em>
must be copied to
<em>PUSH</em></li>
<li>the SSH service must be running on
<em>PULL</em></li>
</ul>
<p>To create the public/private key pair for the rsync user account,
* *
open</p>
<p><a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
on
<em>PUSH</em>
. The / filesystem must first be mounted as read-write. The following example generates an R
SA
type public/private key pair for the
<em>root</em>
user. When creating the key pair, do not enter the passphrase as the key is meant to be used for an automated task.</p>
<p><strong>mount -o rw /</strong></p>
<p><a href="#id81"><span class="problematic" id="id82">**</span></a>ssh-keygen -t rsa **</p>
<p>Generating public/private rsa key pair.</p>
<p>Enter file in which to save the key (/root/.ssh/id_rsa):</p>
<p>Created directory &#8216;/root/.ssh&#8217;.</p>
<p>Enter passphrase (empty for no passphrase):</p>
<p>Enter same passphrase again:</p>
<p>Your identification has been saved in /root/.ssh/id_rsa.</p>
<p>Your public key has been saved in /root/.ssh/id_rsa.pub.</p>
<p>The key fingerprint is:</p>
<p>f5:b0:06:d1:33:e4:95:cf:04:aa:bb:6e:a4:b7:2b:df root&#64;freenas.local</p>
<p>The key&#8217;s randomart image is:</p>
<p>+&#8211;[ RSA 2048]&#8212;-+</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>.o. oo
|</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>o+o. .
|</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>. =o +
|</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<ul class="simple">
<li><ul class="first">
<li></li>
</ul>
</li>
</ul>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>S o .
|</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>.o
|</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>o.
|</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>o oo
|</p>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p><a href="#id83"><span class="problematic" id="id84">**</span></a>oE
|</p>
<p>+&#8211;+
|  |
+==+</p>
<p>FreeNAS® supports the following types of SSH keys: DSA, and RSA. When creating the key, specify the type you wish to use or, if you are generating the key on another operating system, select a type of key the key generation software supports.</p>
<p><a href="#id85"><span class="problematic" id="id86">**</span></a>NOTE: **
if a different user account is used for the rsync task, use the su - command after mounting the filesystem but before generating the key. For example, if the rsync task is configured to use the
<em>user1</em>
user account, use this command to become that user:
** **</p>
<p><strong>su - user1</strong></p>
<p>Next, view and copy the contents of the generated public key:</p>
<p><strong>more .ssh/id_rsa.pub</strong></p>
<p>ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC1lBEXRgw1W8y8k+lXPlVR3xsmVSjtsoyIzV/PlQPo</p>
<p>SrWotUQzqILq0SmUpViAAv4Ik3T8NtxXyohKmFNbBczU6tEsVGHo/2BLjvKiSHRPHc/1DX9hofcFti4h</p>
<p>dcD7Y5mvU3MAEeDClt02/xoi5xS/RLxgP0R5dNrakw958Yn001sJS9VMf528fknUmasti00qmDDcp/kO</p>
<p>xT+S6DFNDBy6IYQN4heqmhTPRXqPhXqcD1G+rWr/nZK4H8Ckzy+l9RaEXMRuTyQgqJB/rsRcmJX5fApd</p>
<p>DmNfwrRSxLjDvUzfywnjFHlKk/+TQIT1gg1QQaj21PJD9pnDVF0AiJrWyWnR <a class="reference external" href="mailto:root&#37;&#52;&#48;freenas&#46;local">root<span>&#64;</span>freenas<span>&#46;</span>local</a></p>
<p>Go to
<em>PULL</em>
and paste (or append) the copied key into the SSH Public Key field of Account → Users → View Users → root (or the specified rsync user account) → Modify User. The paste for the above example is shown in Figure 4.4d. When pasting the key, ensure that it is pasted as one long line and, if necessary, remove any extra spaces representing line breaks.</p>
<p><strong>Figure 4.4d: Pasting the User&#8217;s SSH Public Key</strong></p>
<p><a class="reference internal" href="_images/10000000000003BD000001E785E8303B.png"><img alt="10000000000003BD000001E785E8303B_png" src="_images/10000000000003BD000001E785E8303B.png" style="width: 6.9252in; height: 3.5236in;" /></a></p>
<p>While on
<em>PULL</em>
, verify that the SSH service is running in Services → Control Services and start it if it is not.</p>
<p>Next, copy the host key of
<em>PULL</em>
using Shell on
<em>PUSH</em>
. The following command copies the R
SA
host key of the
<em>PULL</em>
server used in our previous example. Be sure to include the double bracket
<em>&gt;&gt;</em>
to prevent overwriting any existing entries in the
<em>known_hosts</em>
file.</p>
<p><strong>ssh-keyscan -t rsa 192.168.2.6 &gt;&gt; /root/.ssh/known_hosts</strong></p>
<p><strong>NOTE:</strong>
If
<em>PUSH</em>
is a Linux system, use the following command to copy the RSA key to the Linux system:</p>
<p><strong>cat ~/.ssh/id_rsa.pub | ssh user&#64;192.168.2.6 &#8216;cat &gt;&gt; .ssh/authorized_keys&#8217;</strong>
** **</p>
<p>You are now ready to create the rsync task on
<em>PULL</em>
. To configure rsync SSH mode using the systems in our previous example, the configuration would be as follows:</p>
<ul class="simple">
<li>the Path points to
<em>/mnt/local/images</em>
, the directory to be copied</li>
<li>the Remote Host points to
<em>192.168.2.6</em>
, the IP address of the rsync server</li>
<li>the Rsync Mode is
<em>Rsync over SSH</em></li>
<li>the rsync is scheduled to occur every 15 minutes</li>
<li>the User is set to
<em>root</em>
so it has permission to write anywhere; the public key for this user must be generated on
<em>PUSH</em>
and copied to
<em>PULL</em></li>
<li>the
<em>Preserve Permissions</em>
checkbox is checked so that the original permissions are not overwritten by the
<em>root</em>
user</li>
</ul>
<p>Once you save the rsync task, the rsync will automatically occur according to your schedule. In this example, the contents of
<em>/mnt/local/images/</em>
will automatically appear in
<em>/mnt/remote/images/</em>
after 15 minutes. If the content does not appear, use Shell on
<em>PULL</em>
to read
<em>/var/log/messages</em>
. If the message indicates a
<em>n</em>
(newline character) in the key, remove the space in your pasted key&#8211;it will be after the character that appears just before the
<em>n</em>
in the error message.</p>
</div>
</div>
<div class="section" id="id87">
<h3>S.M.A.R.T. Tests<a class="headerlink" href="#id87" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/S.M.A.R.T.">S.M.A.R.T.</a>
(Self-Monitoring, Analysis and Reporting Technology) is a monitoring system for computer hard disk drives to detect and report on various indicators of reliability. When a failure is anticipated by S.M.A.R.T., the drive should be replaced. Most modern ATA, IDE and SCSI-3 hard drives support S.M.A.R.T.&#8211;refer to your drive&#8217;s documentation if you are unsure.</p>
<p>Figure 4.5a shows the configuration screen that appears when you click System → S.M.A.R.T. Tests → Add S.M.A.R.T. Test. The tests that you create will be listed under View S.M.A.R.T. Tests. After creating your tests, check the configuration in Services → S.M.A.R.T., then click the slider to ON for the S.M.A.R.T. service in Services → Control Services.
T
he S.M.A.R.T. service will not start if you have not created any volumes.</p>
<p><strong>NOTE:</strong>
to prevent problems, do not enable the S.M.A.R.T. service if your disks are controlled by a RAID controller as it is the job of the controller to monitor S.M.A.R.T. and mark drives as Predictive Failure when they trip.</p>
<p><strong>Figure 4.5a: Adding a S.M.A.R.T. Test</strong></p>
<p><a class="reference internal" href="_images/10000000000001DA0000021AE2615C27.png"><img alt="10000000000001DA0000021AE2615C27_png" src="_images/10000000000001DA0000021AE2615C27.png" style="width: 3.9835in; height: 4.4835in;" /></a></p>
<p>Table 4.5a summarizes the configurable options when creating a S.M.A.R.T. test.</p>
<p><a href="#id88"><span class="problematic" id="id89">**</span></a>Table 4.5a: S.M.A.R.T. Test Options **</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="17%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Disk</td>
<td>list</td>
<td>highlight disk(s) to monitor</td>
</tr>
<tr class="row-odd"><td>Type</td>
<td>drop-down menu</td>
<td>select type of test to run; see
<a class="reference external" href="http://smartmontools.sourceforge.net/man/smartctl.8.html">smartctl(8)</a>
for a description of each type of test (note that some test types will degrade performance or take disk(s) offline)</td>
</tr>
<tr class="row-even"><td>Short description</td>
<td>string</td>
<td>optional</td>
</tr>
<tr class="row-odd"><td>Hour</td>
<td>slider or hour selections</td>
<td>if use the slider, test occurs every N hours; if use hour selections, test occurs at the highlighted hours</td>
</tr>
<tr class="row-even"><td>Day of month</td>
<td>slider or day selections</td>
<td>if use the slider, test occurs every N days; if use day selections, test occurs on the highlighted days</td>
</tr>
<tr class="row-odd"><td>Month</td>
<td>checkboxes</td>
<td>select the months when you wish the test to occur</td>
</tr>
<tr class="row-even"><td>Day of week</td>
<td>checkboxes</td>
<td>select the days of the week when you wish the test to occur</td>
</tr>
</tbody>
</table>
<p>You can verify which tests will run and when by typing
<strong>smartd -q showtests</strong>
within
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
.</p>
</div>
<div class="section" id="id91">
<h3>Settings<a class="headerlink" href="#id91" title="Permalink to this headline">¶</a></h3>
<p>The Settings tab, shown in Figure 4.6a, contains 4 tabs: General, Advanced, Email, and SSL.</p>
<p>Figure
4.6
a: General Tab of Settings</p>
<p><a class="reference internal" href="_images/1000000000000299000001F1EE4FB0C6.png"><img alt="1000000000000299000001F1EE4FB0C6_png" src="_images/1000000000000299000001F1EE4FB0C6.png" style="width: 6.9252in; height: 5.1756in;" /></a></p>
<div class="section" id="general-tab">
<h4>General Tab<a class="headerlink" href="#general-tab" title="Permalink to this headline">¶</a></h4>
<p>Table 4.6a summarizes the settings that can be configured using the General tab:</p>
<p><strong>Table 4.6a: General Tab&#8217;s Configuration Settings</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="7%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Protocol</td>
<td>drop-down menu</td>
<td>protocol to use when connecting to the administrative
GUI
from a browser; if you change the default of
<em>HTTP</em>
to
<em>HTTPS</em>
, an unsigned certificate and RSA key will be generated and you will be logged out in order to accept the certificate</td>
</tr>
<tr class="row-odd"><td>WebGUI IPv4 Address</td>
<td>drop-down menu</td>
<td>choose from a list of recent IP addresses to limit the one to use when accessing the administrative GUI; the built-in HTTP server will automatically bind to the wildcard address of
<em>0.0.0.0</em>
(any address) and will issue an alert if
the specified address becomes unavailable</td>
</tr>
<tr class="row-even"><td>WebGUI IPv6 Address</td>
<td>drop-down menu</td>
<td>choose from a list of recent IPv6 addresses to limit the one to use when accessing the administrative GUI; the built-in HTTP server will automatically bind to the wildcard address of
<em>::</em>
(any address) and will issue an alert if the specified address becomes unavailable</td>
</tr>
<tr class="row-odd"><td>WebGUI HTTP Port</td>
<td>integer</td>
<td>allows you to configure a non-standard port for accessing the administrative GUI over HTTP; changing this setting may require you to
<a class="reference external" href="http://www.redbrick.dcu.ie/%7Ed_fens/articles/Firefox:_This_Address_is_Restricted">change a firefox configuration setting</a></td>
</tr>
<tr class="row-even"><td>WebGUI HTTPS Port</td>
<td>integer</td>
<td>allows you to configure a non-standard port for accessing the administrative GUI over HTTPS</td>
</tr>
<tr class="row-odd"><td>Language</td>
<td>drop-down menu</td>
<td>select the localization from the drop-down menu and reload the browser; you can view the status of localization at
<a class="reference external" href="http://pootle.freenas.org/">pootle.freenas.org</a></td>
</tr>
<tr class="row-even"><td>Console Keyboard Map</td>
<td>drop-down menu</td>
<td>select the keyboard layout</td>
</tr>
<tr class="row-odd"><td>Timezone</td>
<td>drop-down menu</td>
<td>select the timezone from the drop-down menu</td>
</tr>
<tr class="row-even"><td>Syslog server</td>
<td>string</td>
<td>IP address or hostname of remote syslog server to send FreeNAS® logs to;
once set, log entries will be written to both the FreeNAS® console and the remote server</td>
</tr>
<tr class="row-odd"><td>Directory Service</td>
<td>drop-down menu</td>
<td>can select one of
<a class="reference external" href="#1.8.4.1.ActiveDirectory|outline">Active Directory</a>
<em>, *
`Domain Controller &lt;#1.8.4.2.Domain Controller |outline&gt;`_
*, *
`LDAP &lt;#1.8.4.2.LDAP|outline&gt;`_
*, *
`NIS &lt;#1.8.4.3.NIS|outline&gt;`_
, or
* *
`NT4 &lt;#1.8.4.4.NT4|outline&gt;`_
; if a service is selected, an entry named
*Directory Services</em>
will be added to Services → Control Services for managing that selected service</td>
</tr>
</tbody>
</table>
<p><strong>NOTE:</strong>
by default, logs are stored in RAM as there is no space on the embedded device to store logs. This means that logs are deleted whenever the system reboots. If you wish to save the system logs, either:</p>
<ul class="simple">
<li>configure a remote syslog server on another Unix-like operating system, or</li>
<li>create a ZFS dataset called
<em>syslog</em>
and reboot the system; FreeNAS® will automatically create a
<em>log/</em>
directory in this dataset which contains the logs</li>
</ul>
<p>If you make any changes, click the Save button.</p>
<p>This tab also contains the following buttons:</p>
<p><strong>Factory Restore:</strong>
resets the configuration database to the default base version. However, it does not delete user SSH keys or any other data stored in a user&#8217;s home directory. Since any configuration changes stored in the configuration database will be erased, this option is handy if you mess up your system or wish to return a test system to the original configuration.</p>
<p><strong>Save Config:</strong>
used to create a backup copy of the current configuration database in the
format
<em>hostname-version-architecture</em>
.
<a href="#id93"><span class="problematic" id="id94">**</span></a>Always save the configuration after making changes and verify that you have a saved configuration before performing an upgrade. **
This
<a class="reference external" href="http://forums.freenas.org/showthread.php?10735-How-to-automate-FreeNAS-configuration-database-backup">forum post</a>
contains a script to
backup the configuration which could be customized and added as a
<a class="reference external" href="#1.4.1.CronJobs|outline">cron job</a>
. This
<a class="reference external" href="http://forums.freenas.org/showthread.php?12333-Backup-config-only-if-changed">forum post</a>
contains an alternate script which only saves a copy of the configuration when it changes. And this
<a class="reference external" href="http://forums.freenas.org/threads/backup-config-file-every-night-automatically.8237">forum post</a>
contains a script for backing up the configuration from another system.</p>
<p><strong>Upload Config:</strong>
allows you to browse to location of saved configuration file in order to restore that configuration.</p>
</div>
<div class="section" id="advanced-tab">
<h4>Advanced Tab<a class="headerlink" href="#advanced-tab" title="Permalink to this headline">¶</a></h4>
<p>The Advanced tab, shown in Figure 4.6b, allows you to set some miscellaneous settings on the FreeNAS® system. The configurable settings are summarized in Table 4.6b.</p>
<p><strong>Figure **
**4.6</strong>
<strong>b: Advanced Tab</strong></p>
<p><strong>Table 4.6b: Advanced Tab&#8217;s Configuration Settings</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="10%" />
<col width="77%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Enable Console Menu</td>
<td>checkbox</td>
<td>unchecking this box removes the console menu shown in Figure 2.5a</td>
</tr>
<tr class="row-odd"><td>Use Serial Console</td>
<td>checkbox</td>
<td>do
<strong>not</strong>
** **
check this box if your serial port is disabled</td>
</tr>
<tr class="row-even"><td>Serial Port Address</td>
<td>string</td>
<td>serial port address written in hex</td>
</tr>
<tr class="row-odd"><td>Serial Port Speed</td>
<td>drop-down menu</td>
<td>select the speed used by the serial port</td>
</tr>
<tr class="row-even"><td>Enable screen saver</td>
<td>checkbox</td>
<td>enables/disables the console screen saver</td>
</tr>
<tr class="row-odd"><td>Enable powerd (Power Saving Daemon)</td>
<td>checkbox</td>
<td><a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=powerd">powerd(8)</a>
monitors the system state and sets the CPU frequency accordingly</td>
</tr>
<tr class="row-even"><td>Swap size</td>
<td>non-zero integer representing GB</td>
<td>by default, all data disks are created with this amount of swap; this setting does not affect log or cache devices as they are created without swap</td>
</tr>
<tr class="row-odd"><td>Show console messages in the footer</td>
<td>checkbox</td>
<td>will display console messages in real time at bottom of browser; click the console to bring up a scrollable screen; check the “Stop refresh” box in the scrollable screen to pause updating and uncheck the box to continue to watch the messages as they occur</td>
</tr>
<tr class="row-even"><td>Show tracebacks in case of fatal errors</td>
<td>checkbox</td>
<td>provides a pop-up of diagnostic information when a fatal error occurs</td>
</tr>
<tr class="row-odd"><td>Show advanced fields by default</td>
<td>checkbox</td>
<td>several GUI menus provide an Advanced Mode button to access additional features; enabling this shows these features by default</td>
</tr>
<tr class="row-even"><td>Enable autotune</td>
<td>checkbox</td>
<td>enables the
<a class="reference external" href="#1.4.7.2.1.Autotune|outline">autotune</a>
script which attempts to optimize the system depending upon the hardware which is installed</td>
</tr>
<tr class="row-odd"><td>Enable debug kernel</td>
<td>checkbox</td>
<td>if checked, next boot will boot into a debug version of the kernel</td>
</tr>
<tr class="row-even"><td>Enable automatic upload of
kernel crash dumps</td>
<td>checkbox</td>
<td>if checked, kernel crash dumps are automatically sent
to the FreeNAS® development team for diagnosis</td>
</tr>
<tr class="row-odd"><td>MOTD banner</td>
<td>string</td>
<td>input the message to be seen when a user logs in via
SSH</td>
</tr>
<tr class="row-even"><td>System dataset pool</td>
<td>drop-down menu</td>
<td>by default, the
<em>.system</em>
dataset is automatically created in the first ZFS volume in order to store persistent Samba permissions, collecting core files, and storing system log files; the drop-down menu can be used to select a different ZFS volume</td>
</tr>
<tr class="row-odd"><td>Use system dataset for syslog</td>
<td>checkbox</td>
<td>uncheck this box if you don&#8217;t want logging to spin up the disks and it will write to
<em>/var/log/</em>
instead of the
<em>.system</em>
dataset</td>
</tr>
</tbody>
</table>
<p>If you make any changes, click the Save button.</p>
<p>This tab also contains the following buttons:</p>
<p><strong>Rebuild LDAP/AD Cache:</strong>
click if you add a user to Active Directory who needs immediate access to FreeNAS®; otherwise this occurs automatically once a day as a cron job.</p>
<p><strong>Save Debug:</strong>
used to generate a text file of diagnostic information. t will prompt for the location to save the ASCII text file.</p>
<p><strong>Firmware Update:</strong>
used to
<a class="reference external" href="#1.2.6.3.UsingtheGUItoUpgradea9.xSystemtoaLater9.xVersion|outline">Upgrade FreeNAS®</a>
.</p>
<div class="section" id="id98">
<h5>Autotune<a class="headerlink" href="#id98" title="Permalink to this headline">¶</a></h5>
<p>FreeNAS® provides an autotune script which attempts to optimize the system depending upon the hardware which is installed. For example, if a ZFS volume exists on a system with limited RAM, the autotune script will automatically adjust some ZFS sysctl values in an attempt to minimize ZFS memory starvation issues. It should only be used as a temporary measure on a system that hangs until the underlying hardware issue is addressed by adding more RAM. Autotune will always slow the system down as it caps the ARC.</p>
<p>The “Enable autotune” checkbox in System → Settings → Advanced
is unchecked by default; check it if you would like the autotuner to run at boot time. If you would like the script to run immediately, reboot the system.</p>
<p>If autotuner finds any settings that need adjusting, the changed values will appear in System →
<a class="reference external" href="#1.4.8.Sysctls|outline">Sysctls</a>
(for
<em>sysctl.conf</em>
values) and in System →
<a class="reference external" href="#1.4.10.Tunables|outline">Tunables</a>
(for
<em>loader.conf</em>
values). If you do not like the changes, you can modify the values that are displayed in the GUI and your changes will override the values that were created by the autotune script. However, if you delete a sysctl or tunable that was created by autotune, it will be recreated at next boot. This is because autotune only creates values that do not already exist.</p>
<p>If you are trying to increase the performance of your FreeNAS® system and suspect that the current hardware may be limiting performance, try enabling autotune.</p>
<p>If you wish to read the script to see which checks are performed, the script is located in
<em>/usr/local/bin/autotune</em>
.</p>
</div>
</div>
<div class="section" id="email-tab">
<h4>Email Tab<a class="headerlink" href="#email-tab" title="Permalink to this headline">¶</a></h4>
<p>The Email tab, shown in Figure 4.6c, is used to configure the email settings on the FreeNAS® system. Table 4.6c summarizes the settings that can be configured using the Email tab.</p>
<p><strong>NOTE:</strong>
it is important to configure the system so that it can successfully send emails. An automatic script send a nightly email to the
<em>root</em>
user account containing important information such as the health of the disks. Alert events are also emailed to the
<em>root</em>
user account.</p>
<p><strong>Figure **
**4.6c</strong>
<strong>: Email Tab</strong></p>
<p><a class="reference internal" href="_images/10000000000002C1000001F84303F765.png"><img alt="10000000000002C1000001F84303F765_png" src="_images/10000000000002C1000001F84303F765.png" style="width: 6.9252in; height: 4.9508in;" /></a></p>
<p><strong>Table 4.6c: Email Tab&#8217;s Configuration Settings</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="16%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>From email</td>
<td>string</td>
<td>the
<strong>From</strong>
email address to be used when sending email notifications</td>
</tr>
<tr class="row-odd"><td>Outgoing mail server</td>
<td>string or IP address</td>
<td>hostname or IP address of SMTP server</td>
</tr>
<tr class="row-even"><td>Port to connect to</td>
<td>integer</td>
<td>SMTP
port number, typically 25, 465 (secure
SMTP
), or 587 (submission)</td>
</tr>
<tr class="row-odd"><td>TLS/
SSL</td>
<td>drop-down menu</td>
<td>encryption type; choices are
<em>Plain</em>
,
<em>SSL</em>
, or
<em>TLS</em></td>
</tr>
<tr class="row-even"><td>Use
SMTP
Authentication</td>
<td>checkbox</td>
<td>enables/disables
<a class="reference external" href="http://en.wikipedia.org/wiki/SMTP_Authentication">SMTP AUTH</a>
using PLAIN SASL</td>
</tr>
<tr class="row-odd"><td>Username</td>
<td>string</td>
<td>used to authenticate with SMTP server</td>
</tr>
<tr class="row-even"><td>Password</td>
<td>string</td>
<td>used to authenticate with SMTP server</td>
</tr>
<tr class="row-odd"><td>Send Test Mail</td>
<td>button</td>
<td>click to check that configured email settings are working; this will fail if you do not set the
<strong>To</strong>
email address
by clicking the Change E-mail button for the
<em>root</em>
account in Accounts → Users → View Users</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="ssl-tab">
<h4>SSL Tab<a class="headerlink" href="#ssl-tab" title="Permalink to this headline">¶</a></h4>
<p>When you change the Protocol value to HTTPS in System → Settings → General, an unsigned RSA certificate and key are auto-generated. Once generated, the certificate and key will be displayed in the SSL Certificate field in System → Settings → SSL, shown in Figure 4.6d.
If you already have your own signed certificate that you wish to use for SSL/TLS connections, replace the values in the SSL certificate field with a copy/paste of your own key and certificate. The certificate can be used to secure the HTTP connection (enabled in the Settings → General Tab) to the FreeNAS® system.</p>
<p>Table 4.6d summarizes the settings that can be configured using the SSL tab. This
<a class="reference external" href="http://www.akadia.com/services/ssh_test_certificate.html">howto</a>
shows how to manually generate your own certificate using OpenSSL and provides some examples for the values shown in Table 4.6d.</p>
<p><strong>Figure **
**4.6d</strong>
<strong>: SSL Tab</strong></p>
<p><a class="reference internal" href="_images/100000000000025A00000201DD9E6537.png"><img alt="100000000000025A00000201DD9E6537_png" src="_images/100000000000025A00000201DD9E6537.png" style="width: 6.2693in; height: 5.3429in;" /></a></p>
<p><strong>Table 4.6d: **
SSL
** Tab&#8217;s Configuration Settings</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="6%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Organization</td>
<td>string</td>
<td>optional</td>
</tr>
<tr class="row-odd"><td>Organizational Unit</td>
<td>string</td>
<td>optional</td>
</tr>
<tr class="row-even"><td>Email Address</td>
<td>string</td>
<td>optional</td>
</tr>
<tr class="row-odd"><td>Locality</td>
<td>string</td>
<td>optional</td>
</tr>
<tr class="row-even"><td>State</td>
<td>string</td>
<td>optional</td>
</tr>
<tr class="row-odd"><td>Country</td>
<td>string</td>
<td>optional</td>
</tr>
<tr class="row-even"><td>Common Name</td>
<td>string</td>
<td>optional</td>
</tr>
<tr class="row-odd"><td>Passphrase</td>
<td>string</td>
<td>if the certificate was created with a passphrase, input and confirm it; the value will appear as dots in the GUI</td>
</tr>
<tr class="row-even"><td>SSL
Certificate</td>
<td>string</td>
<td>paste the
private
key and certificate
into the box</td>
</tr>
</tbody>
</table>
<p><strong>NOTE:</strong>
FreeNAS® will check the validity of the certificate and key and will fallback to HTTP if they
appear to be invalid.</p>
</div>
</div>
<div class="section" id="id101">
<h3>Sysctls<a class="headerlink" href="#id101" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=sysctl">sysctl(8)</a>
is an interface that is used to make changes to the FreeBSD kernel running on a FreeNAS® system. It can be used to tune the system in order to meet the specific needs of a network. Over five hundred system variables can be set using sysctl(8). Each variable is known as a MIB as it is comprised of a dotted set of components. Since these MIBs are specific to the kernel feature that is being tuned, descriptions can be found in many FreeBSD man pages (e.g.
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=sysctl&amp;sektion=3">sysctl(3)</a>
,
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=tcp">tcp(4)</a>
and
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=tuning">tuning(7)</a>
) and in many sections of the
<a class="reference external" href="http://www.freebsd.org/handbook">FreeBSD Handbook</a>
.</p>
<p><strong>DANGER!</strong>
changing the value of a sysctl MIB is an advanced feature that immediately affects the kernel of the FreeNAS® system.
<strong>Do not change a MIB on a production system unless you understand the ramifications of that change.</strong>
A badly configured MIB could cause the system to become unbootable, unreachable via the network, or can cause the system to panic under load. Certain changes may break assumptions made by the FreeNAS® software. This means that you should always test the impact of any changes on a test system first.</p>
<p>FreeNAS® provides a graphical interface for managing sysctl MIBs. To add a sysctl, go to System → Sysctls → Add Sysctl, shown in Figure 4.7a.</p>
<p><strong>Figure 4.7a: Adding a Sysctl</strong></p>
<p><a class="reference internal" href="_images/1000000000000126000000FBE02571B5.png"><img alt="1000000000000126000000FBE02571B5_png" src="_images/1000000000000126000000FBE02571B5.png" style="width: 3.5417in; height: 2.3244in;" /></a></p>
<p>Table 4.7a summarizes the options when adding a sysctl.</p>
<p><strong>Table 4.7a: Adding a Sysctl</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="17%" />
<col width="72%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Setting</strong></td>
<td><strong>Value</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td>Variable</td>
<td>string</td>
<td>must be in dotted format e.g.
<em>kern.ipc.shmmax</em></td>
</tr>
<tr class="row-odd"><td>Value</td>
<td>integer or string</td>
<td>value to associate with the MIB;
<strong>do not make this up</strong>
, refer to the suggested values in a man page, FreeBSD Handbook page, or tutorial</td>
</tr>
<tr class="row-even"><td>Comment</td>
<td>string</td>
<td>optional, but a useful reminder for the reason behind using this MIB/value</td>
</tr>
<tr class="row-odd"><td>Enabled</td>
<td>checkbox</td>
<td>uncheck if you would like to disable the sysctl without deleting it</td>
</tr>
</tbody>
</table>
<p>As soon as you add or edit a sysctl, the running kernel will change that variable to the value you specify. As long as the sysctl exists, that value will persist across reboots and upgrades.</p>
<p>Note that any sysctl that is read-only will require a reboot to enable the setting change. You can verify if a sysctl is read-only by attempting to change it from
<a class="reference external" href="#1.11.2.Shell|outline">Shell</a>
. For example, to change the value of
<em>net.inet.tcp.delay_ack</em>
to
<em>1</em>
, use the command
<strong>sysctl net.inet.tcp.delay_ack=1</strong>
. If the sysctl value is read-only, an error message will indicate that the setting is read-only. If you do not get an error, the setting is now applied. However, for the setting to be persistent across reboots, the sysctl must be added in System → Sysctls.</p>
<p>Any MIBs that you add will be listed in System → Sysctls → View Sysctls. To change the value of a MIB, click its Edit button. To remove a MIB, click its Delete button.</p>
<p>At this time, the GUI does not display the sysctl MIBs that are pre-set in the installation image.
9.2.2 ships with the following MIBs set:</p>
<p>kern.metadelay=3</p>
<p>kern.dirdelay=4</p>
<p>kern.filedelay=5</p>
<p>kern.coredump=0</p>
<p>net.inet.tcp.delayed_ack=0</p>
<p><strong>Do not add or edit the default MIBS as sysctls</strong>
** **
as doing so will overwrite the default values which may render the system unusable
.</p>
</div>
<div class="section" id="id103">
<h3>System Information<a class="headerlink" href="#id103" title="Permalink to this headline">¶</a></h3>
<p>System → System Information displays general information about the FreeNAS® system. An example is seen in Figure 4.8a.</p>
<p>The information includes the hostname, the build version, type of CPU (platform), the amount of memory, the current system time, the system&#8217;s uptime, and the current load average.</p>
<p>To change the system&#8217;s hostname, click its “Edit” button, type in the new hostname, and click “OK”. The hostname must include the domain name. If the network does not use a domain name add
<em>.local</em>
to the end of the hostname.</p>
<p><strong>Figure 4.</strong>
<strong>8</strong>
<strong>a: System Information Tab</strong></p>
</div>
<div class="section" id="id104">
<h3>Tunables<a class="headerlink" href="#id104" title="Permalink to this headline">¶</a></h3>
<p>When a FreeBSD-based system boots,
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=loader.conf">loader.conf(5)</a>
is read to determine if any parameters should be passed to the kernel or if any additional kernel modules (such as drivers) should be loaded. Since loader values are specific to the kernel parameter or driver to be loaded, descriptions can be found in the man page for the specified driver and in many sections of the
<a class="reference external" href="http://www.freebsd.org/handbook">FreeBSD Handbook</a>
.</p>
<p>FreeNAS® provides a graphical interface for managing loader values. This advanced functionality is intended to make it easier to load additional kernel modules at boot time. A typical usage would be to load a FreeBSD hardware driver that does not automatically load after a FreeNAS® installation. The default FreeNAS® image does not load every possible hardware driver. This is a necessary evil as some drivers conflict with one another or cause stability issues, some are rarely used, and some drivers
just don&#8217;t belong on a standard NAS system. If you need a driver that is not automatically loaded, you need to add a tunable.</p>
<p><strong>DANGER!</strong>
adding a tunable is an advanced feature that could adversely effect the ability of the FreeNAS® system to successfully boot. It is
<strong>very important</strong>
** **
that you do not have a typo when adding a tunable as this could halt the boot process. Fixing this problem requires physical access to the FreeNAS® system and knowledge of how to use the boot loader prompt as described in
<a class="reference external" href="#1.4.10.1.RecoveringFromIncorrectTunables|outline">Recovering</a>
<a class="reference external" href="#1.4.9.1.RecoveringFromIncorrectTunables|outline">From Incorrect Tunables</a>
. This means that you should always test the impact of any changes on a test system first.</p>
<p>To add a tunable, go to System → Tunables → Add Tunable, as seen in Figure 4.9a.</p>
<p><strong>Figure 4.9a: Adding a Tunable</strong></p>
<p><a class="reference internal" href="_images/1000000000000127000001015F4550E1.png"><img alt="1000000000000127000001015F4550E1_png" src="_images/1000000000000127000001015F4550E1.png" style="width: 3.5535in; height: 2.3799in;" /></a></p>
<p>Table 4.9a summarizes the options when adding a tunable. The changes you make will not take effect until the system is rebooted as loader settings are only read when the kernel is loaded at boot time. As long as the tunable exists, your changes will persist at each boot and across upgrades. Any tunables that you add will be listed alphabetically in System → Tunables → View Tunables. To change the value of a tunable, click its Edit button. To remove a tunable, click its Delete button.</p>
<p><strong>Table 4.9a: Adding a Tunable</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="18%" />
<col width="70%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Setting</strong></td>
<td><strong>Value</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td>Variable</td>
<td>string</td>
<td>typically the name of the driver to load, as indicated by its man page</td>
</tr>
<tr class="row-odd"><td>Value</td>
<td>integer or string</td>
<td>value to associate with variable; typically this is set to
<em>YES</em>
to enable the driver specified by the variable</td>
</tr>
<tr class="row-even"><td>Comment</td>
<td>string</td>
<td>optional, but a useful reminder for the reason behind adding this tunable</td>
</tr>
<tr class="row-odd"><td>Enabled</td>
<td>checkbox</td>
<td>uncheck if you would like to disable the tunable without deleting it</td>
</tr>
</tbody>
</table>
<p>At this time, the GUI does not display the tunables that are pre-set in the installation image.
9.2.2 ships with the following tunables set:</p>
<p>autoboot_delay=&#8221;2&#8221;</p>
<p>loader_logo=&#8221;freenas-logo&#8221;</p>
<p>loader_menu_title=&#8221;Welcome to FreeNAS&#8221;</p>
<p>loader_brand=&#8221;freenas-brand&#8221;</p>
<p>loader_version=&#8221; &#8220;</p>
<p>debug.debugger_on_panic=1</p>
<p>debug.ddb.textdump.pending=1</p>
<p>hw.hptrr.attach_generic=0</p>
<p>kern.ipc.nmbclusters=&#8221;262144&#8221;</p>
<p>vfs.mountroot.timeout=&#8221;30&#8221;</p>
<p>hint.isp.0.role=2</p>
<p>hint.isp.1.role=2</p>
<p>hint.isp.2.role=2</p>
<p>hint.isp.3.role=2</p>
<p>module_path=&#8221;/boot/modules;/usr/local/modules&#8221;</p>
<p>net.inet6.ip6.auto_linklocal=&#8221;0&#8221;</p>
<p><strong>Do not add or edit the default tunables</strong>
** **
as doing so will overwrite the default values which may render the system unusable.</p>
<p>The ZFS version used in 9.2.2 deprecates the following tunables:</p>
<p>vfs.zfs.write_limit_override</p>
<p>vfs.zfs.write_limit_inflated</p>
<p>vfs.zfs.write_limit_max</p>
<p>vfs.zfs.write_limit_min</p>
<p>vfs.zfs.write_limit_shift</p>
<p>vfs.zfs.no_write_throttle</p>
<p>If you upgrade from an earlier version of FreeNAS® where these tunables are set, they will automatically be deleted for you. You should not try to add these tunables back.</p>
<div class="section" id="recovering-from-incorrect-tunables">
<h4>Recovering From Incorrect Tunables<a class="headerlink" href="#recovering-from-incorrect-tunables" title="Permalink to this headline">¶</a></h4>
<p>If a tunable is preventing the system from booting, you will need physical access to the FreeNAS® system. Watch the boot messages and press the number 3 key or the Esc key to select “3.
<strong>Esc</strong>
ape to loader prompt” when you see the FreeNAS® boot menu shown in Figure 4.9b.</p>
<p><strong>Figure 4.9b: FreeNAS® Boot Menu</strong></p>
<p><a class="reference internal" href="_images/10000000000002D10000018F743DB34E.png"><img alt="10000000000002D10000018F743DB34E_png" src="_images/10000000000002D10000018F743DB34E.png" style="width: 6.0583in; height: 3.3252in;" /></a></p>
<p>The boot loader prompt provides a minimal set of commands described in
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=loader">loader(8)</a>
. Once at the prompt, use the
<strong>unset</strong>
command to disable a problematic value, the
<strong>set</strong>
command to modify the problematic value, or the
<strong>unload</strong>
command to prevent the problematic driver from loading.</p>
<p>Example 4.9a demonstrates several examples using these commands at the boot loader prompt. The first command disables the current value associated with the
<em>kern.ipc.nmbclusters</em>
MIB and will fail with a “no such file or directory” error message if a current tunable does not exist to set this value. The second command disables ACPI. The third command instructs the system not to load the fuse driver. When finished, type
<strong>boot</strong>
to continue the boot process.</p>
<p><strong>Example 4.9a: Sample Commands at the Boot Loader Prompt</strong></p>
<p>Type &#8216;?&#8217; for a list of commands, &#8216;help&#8217; for more detailed help.</p>
<p>OK
<strong>unset kern.ipc.nmbclusters</strong></p>
<p>OK
<strong>set hint.acpi.0.disabled=1</strong></p>
<p>OK
<strong>unload fuse</strong></p>
<p>OK
<strong>boot</strong></p>
<p>Any changes made at the boot loader prompt only effect the current boot. This means that you need to edit or remove the problematic tunable in System → Tunables → View Tunables to make your change permanent and to prevent future boot errors.</p>
</div>
</div>
</div>
<div class="section" id="network-configuration">
<h2>Network Configuration<a class="headerlink" href="#network-configuration" title="Permalink to this headline">¶</a></h2>
<p>The Network section of the administrative GUI contains the following components for viewing and configuring the FreeNAS® system&#8217;s network settings:</p>
<ul class="simple">
<li><a class="reference external" href="#1.5.1.GlobalConfiguration|outline">Global Configuration</a>
: used to to set non-interface specific network settings.</li>
<li><a class="reference external" href="#1.5.2.Interfaces|outline">Interfaces</a>
: used to configure a specified interface&#8217;s network settings.</li>
<li><a class="reference external" href="#1.5.3.IPMI|outline">IPMI</a>
:
** **
provides side-band management should the appliance become unavailable through the graphical administrative interface.</li>
<li><a class="reference external" href="#1.5.3.LinkAggregations|outline">Link Aggregations</a>
: used to configure link aggregation and link failover.</li>
<li><a class="reference external" href="#1.5.4.NetworkSummary|outline">Network Summary</a>
: provides an overview of the current network settings.</li>
<li><a class="reference external" href="#1.5.5.StaticRoutes|outline">Static Routes</a>
: used to add static routes.</li>
<li><a class="reference external" href="#1.5.6.VLANs|outline">VLANs</a>
: used to configure IEEE 802.1q tagging.</li>
</ul>
<p>Each of these is described in more detail in this section.</p>
<div class="section" id="id106">
<h3>Global Configuration<a class="headerlink" href="#id106" title="Permalink to this headline">¶</a></h3>
<p>Network → Global Configuration, shown in Figure 5.1a, allows you to set non-interface specific network settings.</p>
<p>Table 5.1a summarizes the settings that can be configured using the Global Configuration tab. The hostname and domain will be pre-filled for you, as seen in Figure 5.1a, but can be changed to meet the local network&#8217;s requirements.</p>
<p>If you will be using
<a class="reference external" href="#1.8.4.1.ActiveDirectory|outline">Active Directory</a>
, set the IP address of the DNS server used in the realm.</p>
<p>If your network does not have a DNS server or NFS, SSH, or FTP users are receiving “reverse DNS” or timeout errors, add an entry for the IP address of the FreeNAS® system in the “Host name database” field.</p>
<p><strong>NOTE:</strong>
if you add a gateway to the Internet, make sure that the FreeNAS® system is protected by a properly configured firewall.</p>
<p><strong>Figure 5.1a: Global Configuration</strong></p>
<p><strong>Screen</strong></p>
<p><a class="reference internal" href="_images/10000000000002E8000001F895B2C752.png"><img alt="10000000000002E8000001F895B2C752_png" src="_images/10000000000002E8000001F895B2C752.png" style="width: 6.9252in; height: 4.6909in;" /></a></p>
<p><strong>Table 5.1a: Global Configuration Settings</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="8%" />
<col width="77%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Hostname</td>
<td>string</td>
<td>system host name</td>
</tr>
<tr class="row-odd"><td>Domain</td>
<td>string</td>
<td>system domain name</td>
</tr>
<tr class="row-even"><td>IPv4 Default Gateway</td>
<td>IP address</td>
<td>typically not set (see NOTE below)</td>
</tr>
<tr class="row-odd"><td>IPv6 Default Gateway</td>
<td>IP address</td>
<td>typically not set (see NOTE below)</td>
</tr>
<tr class="row-even"><td>Nameserver 1</td>
<td>IP address</td>
<td>primary DNS server (typically in Windows domain)</td>
</tr>
<tr class="row-odd"><td>Nameserver 2</td>
<td>IP address</td>
<td>secondary DNS server</td>
</tr>
<tr class="row-even"><td>Nameserver 3</td>
<td>IP address</td>
<td>tertiary DNS server</td>
</tr>
<tr class="row-odd"><td>Enable netwait feature</td>
<td>checkbox</td>
<td>if enabled, network services will not be started at boot time until the interface is able to ping the addresses listed in
<em>Netwait IP list</em></td>
</tr>
<tr class="row-even"><td>Netwait IP list</td>
<td>string</td>
<td>if
<em>Enable netwait feature</em>
is checked, list of IP addresses to ping; otherwise, ping the default gateway</td>
</tr>
<tr class="row-odd"><td>Host name database</td>
<td>string</td>
<td>used to add one entry per line which will be appended to
<em>/etc/hosts</em>
; use the format
<em>IP_address space hostname</em>
where multiple hostnames can be used if separated by a space</td>
</tr>
</tbody>
</table>
<p><strong>NOTE:</strong>
In many cases, a FreeNAS® configuration will deliberately exclude default gateway information as a way to make it more difficult for a remote attacker to communicate with the server. While this is a reasonable precaution, such a configuration does
<strong>not</strong>
** **
restrict inbound traffic from sources within the local network. However, omitting a default gateway will prevent the FreeNAS® system from communicating with DNS servers, time servers, and mail servers that are located outside of the local network. In this case, it is recommended that
<a class="reference external" href="#1.5.5.StaticRoutes|outline">Static Routes</a>
be added in order to reach external DNS, NTP, and mail servers which are configured with static IP addresses.</p>
</div>
<div class="section" id="id109">
<h3>Interfaces<a class="headerlink" href="#id109" title="Permalink to this headline">¶</a></h3>
<p>Network → Interfaces is used to view which interfaces have been manually configured, to add a manually configured interface, and to edit an interface&#8217;s manual configuration.</p>
<p><strong>NOTE:</strong>
typically the interface used to access the FreeNAS® administrative GUI is configured by DHCP. This interface will not appear in this screen, even though it is already dynamically configured and in use.</p>
<p>Figure 5.2a shows the screen that opens when you click Interfaces → Add Interface. Table 5.2a summarizes the configuration options when you Add an interface or Edit an already configured interface.</p>
<p>Figure 5.2a: Adding or Editing an Interface</p>
<p><a class="reference internal" href="_images/1000000000000182000001C49B157EE6.png"><img alt="1000000000000182000001C49B157EE6_png" src="_images/1000000000000182000001C49B157EE6.png" style="width: 4.65in; height: 4.1846in;" /></a></p>
<p><strong>Table 5.2a: Interface Configuration Settings</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="10%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>NIC</td>
<td>drop-down menu</td>
<td>select the FreeBSD device name; will be a read-only field when editing an interface</td>
</tr>
<tr class="row-odd"><td>Interface Name</td>
<td>string</td>
<td>description of interface</td>
</tr>
<tr class="row-even"><td>DHCP</td>
<td>checkbox</td>
<td>requires static IPv4 or IPv6 configuration if unchecked; note that only one interface can be configured for DHCP</td>
</tr>
<tr class="row-odd"><td>IPv4 Address</td>
<td>IP address</td>
<td>set if
DHCP
unchecked</td>
</tr>
<tr class="row-even"><td>IPv4 Netmask</td>
<td>drop-down menu</td>
<td>set if
DHCP
unchecked</td>
</tr>
<tr class="row-odd"><td>Auto configure IPv6</td>
<td>checkbox</td>
<td>only one interface can be configured for this option; requires manual configuration if unchecked and wish to use IPv6</td>
</tr>
<tr class="row-even"><td>IPv6 Address</td>
<td>IPv6 address</td>
<td>must be unique on network</td>
</tr>
<tr class="row-odd"><td>IPv6 Prefix Length</td>
<td>drop-down menu</td>
<td>match the prefix used on network</td>
</tr>
<tr class="row-even"><td>Options</td>
<td>string</td>
<td>additional parameters from
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=ifconfig">ifconfig(8)</a>
, separate multiple parameters with a space; for example:
<em>mtu 9000</em>
will increase the MTU for interfaces that support jumbo frames</td>
</tr>
</tbody>
</table>
<p>This screen also allows you to configure an alias for the interface. If you wish to set multiple aliases, click the “Add extra alias” link for each alias you wish to configure. To delete an alias, highlight the interface in the tree to access its &#8220;Edit&#8221; screen. Be sure to check the &#8220;Delete&#8221; checkbox associated with the alias. If you instead click the &#8220;Delete&#8221; button at the bottom of this screen, you will delete the whole interface, not just the alias.</p>
<p>When configuring multiple interfaces, they can not be members of the same subnet. Check the subnet mask if you receive an error when setting the IP addresses on multiple interfaces.</p>
<p>When configuring an interface for both IPv4 and IPv6, this screen will not let you set both addresses as primary. In other words, you will get an error if you fill in both the
<em>IPv4 address</em>
and
<em>IPv6 address</em>
fields. Instead, set one of these address fields and create an alias for the other address.</p>
</div>
<div class="section" id="id111">
<h3>IPMI<a class="headerlink" href="#id111" title="Permalink to this headline">¶</a></h3>
<p>Beginning with version 9.2.1, FreeNAS® provides a graphical screen for configuring an IPMI interface. This screen will only appear if the system hardware includes a Baseboard Management Controller (BMC) and the IPMI kernel module is loaded.</p>
<p>IPMI provides side-band management should the system become unavailable through the graphical administrative interface. This allows for a few vital functions, such as checking the log, accessing the BIOS setup, and powering on the system without requiring physical access to the system. IPMI can also be used to allow another person remote access to the system in order to assist with a configuration or troubleshooting issue. Before configuring IPMI, ensure that the management interface is physically connected to the network. Depending upon the hardware, the IPMI device may share the primary Ethernet interface or it may be a dedicated IPMI interface.</p>
<p>Before configuring IPMI, add a
<a class="reference external" href="#1.4.9.Tunables|outline">tunable</a>
with a &#8220;Variable&#8221; of
<em>ipmi_load</em>
and a &#8220;Value&#8221; of
<em>YES</em>
. This will configure the system to load the driver at bootup. Then, to load the
<em>ipmi</em>
kernel module now, without
rebooting, type this from
<a class="reference external" href="#1.12.2.Shell|outline">Shell</a>
:</p>
<p><strong>kldload ipmi</strong></p>
<p>Once the module is loaded, IPMI should be configured from Network → IPMI. Figure 5.3a shows the configuration screen and Table 5.3a summarizes the options when configuring IPMI.</p>
<p><strong>Figure 5.3a: IPMI Configuration</strong></p>
<p><strong>Table 5.3a: IPMI Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="14%" />
<col width="67%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Password</td>
<td>string</td>
<td>input the password used to connect to the IPMI interface from a web browser</td>
</tr>
<tr class="row-odd"><td>DHCP</td>
<td>checkbox</td>
<td>if left unchecked, the following three fields must be set</td>
</tr>
<tr class="row-even"><td>IPv4 Address</td>
<td>string</td>
<td>IP address used to connect to the IPMI web GUI</td>
</tr>
<tr class="row-odd"><td>IPv4 Netmask</td>
<td>drop-down menu</td>
<td>subnet mask associated with the IP address</td>
</tr>
<tr class="row-even"><td>IPv4 Default Gateway</td>
<td>string</td>
<td>default gateway associated with the IP address</td>
</tr>
</tbody>
</table>
<p>Once configured, you can access the IPMI interface using a web browser and the IP address you specified in the configuration. The management interface will prompt for a username and the password that you configured. Refer to the documentation for the IPMI device to determine the default administrative username.</p>
<p>The default username is
<em>ADMIN</em>
(in all caps). Once you have logged into the management interface, you can change the administrative username as well as create additional users. The appearance of the utility and the functions that are available within the IPMI management utility will vary depending upon the hardware.</p>
</div>
<div class="section" id="id114">
<h3>Link Aggregations<a class="headerlink" href="#id114" title="Permalink to this headline">¶</a></h3>
<p>FreeNAS® uses FreeBSD&#8217;s
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=lagg">lagg(4)</a>
interface to provide link aggregation and link failover. The lagg interface allows aggregation of multiple network interfaces
into a single
virtual lagg interface
,
providing fault-tolerance and high-speed
multi-link throughput
.
The aggregation protocols supported by lagg determine which ports are used for outgoing
traffic and
whether a specific port accepts
incoming traffic
. The
link state of the lagg interface is used to validate if the port is
active
or not
.</p>
<p>Aggregation works best on switches supporting LACP, which distributes traffic bi-directionally while
responding to failure of individual links. FreeNAS® also supports active/passive failover between pairs of links.
T
he LACP, FEC and load-balance modes select the output interface using a hash that includes the Ethernet source and destination address, VLAN tag (if available), IP source and destination address, and flow label (IPv6 only). The benefit can only be observed when multiple clients are transfer
r
ing files
<strong>from</strong>
** **
your NAS. The flow entering
<strong>into</strong>
* *
your NAS depends on the Ethernet switch load-balance algorithm.</p>
<p>The lagg driver currently supports the following aggregation protocols
:</p>
<p><strong>Failover:</strong>
the default protocol. Sends traffic only through the active port. If the master port becomes unavailable, the next active port is used. The first interface added is the master port; any interfaces added after that are used as failover devices. By default, received traffic is only accepted when received through the active port. This constraint can be relaxed, which is useful for certain bridged network setups, by setting
<em>net.link.lagg.failover_rx_all</em>
to a non-zero value in System →
<a class="reference external" href="#1.4.8.Sysctls|outline">Sysctls</a>
→ Add Sysctl.</p>
<p><strong>FEC:</strong>
supports Cisco EtherChannel on older Cisco switches. This is a static setup and does not negotiate aggregation with the peer or exchange frames to monitor the link.</p>
<p><strong>LACP:</strong>
supports the IEEE 802.3ad Link Aggregation Control Protocol (LACP) and the Marker Protocol. LACP will negotiate a set of aggregable links with the peer into one or more link aggregated groups (LAGs). Each LAG is composed of ports of the same speed, set to full-duplex operation. The traffic will be balanced across the ports in the LAG with the greatest total speed; in most cases there will only be one LAG which contains all ports. In the event of changes in physical connectivity, link aggregation will quickly converge to a new configuration. LACP must be configured on the switch as well.</p>
<p><strong>Load Balance:</strong>
balances outgoing traffic across the active ports based on hashed protocol header information and accepts incoming traffic from any active port. This is a static setup and does not negotiate aggregation with the peer or exchange frames to monitor the link. The hash includes the Ethernet source and destination address, VLAN tag (if available), and IP source and destination address. Requires a switch which supports IEEE 802.3ad static link aggregation.</p>
<p><strong>Round Robin:</strong>
distributes outgoing traffic using a round-robin scheduler through all active ports and accepts incoming traffic from any active port. This mode can cause unordered packet arrival at the client. This has a side effect of limiting throughput as reordering packets can be CPU intensive on the client. Requires a switch which supports IEEE 802.3ad static link aggregation.</p>
<p><strong>None:</strong>
this protocol disables any traffic without disabling the lagg interface itself.</p>
<p><strong>NOTE:</strong>
the FreeNAS® system must be rebooted after configuring the lagg device and
TCP access will be lost during reboot.</p>
<p><strong>Do not</strong>
configure t
he interfaces used in the lagg device before creating the lagg
device.</p>
<div class="section" id="considerations-when-using-lacp-mpio-nfs-or-esxi">
<h4>Considerations When Using LACP, MPIO, NFS, or ESXi<a class="headerlink" href="#considerations-when-using-lacp-mpio-nfs-or-esxi" title="Permalink to this headline">¶</a></h4>
<p>LACP bonds Ethernet connections in order to improve bandwidth. For example, four physical interfaces can be used to create one mega interface. However, it cannot increase the bandwidth for a single conversation. It is designed to increase bandwidth when multiple clients are simultaneously accessing the same system. It also assumes that quality Ethernet hardware is used and it will not make much difference when using inferior Ethernet chipsets such as a Realtek.</p>
<p>LACP reads the sender and receiver IP addresses and, if they are deemed to belong to the same TCP connection, always sends the packet over the same interface to ensure that TCP does not need to reorder packets. This makes LACP ideal for load balancing many simultaneous TCP connections, but does nothing for increasing the speed over one TCP connection.</p>
<p>MPIO operates at the iSCSI protocol level. For example, if you create four IP addresses and there are
four simultaneous TCP connections, MPIO will send the data over all available links. When configuring MPIO, make sure that the IP addresses on the interfaces are configured to be on separate subnets with non-overlapping netmasks or configure static routes to do point-to-point communication. Otherwise, all packets will pass through one interface.</p>
<p>LACP and other forms of link aggregation generally do not work well with virtualization solutions. In a virtualized environment, consider the use of iSCSI MPIO through the creation of an
<a class="reference external" href="#1.8.7.4.Portals|outline">iSCSI Portal</a>
. This allows an iSCSI initiator to recognize multiple links to a target, utilizing them for increased bandwidth or redundancy. This
<a class="reference external" href="http://fojta.wordpress.com/2010/04/13/iscsi-and-esxi-multipathing-and-jumbo-frames/">how-to</a>
contains instructions for configuring MPIO on ESXi.</p>
<p>NFS does not understand MPIO. Therefore, you will need one fast interface since creating an iSCSI portal will not improve bandwidth when using NFS. LACP does not work well to increase the bandwidth for point-to-point NFS (one server and one client). LACP is a good solution for link redundancy or for one server and many clients.</p>
</div>
<div class="section" id="creating-a-link-aggregation">
<h4>Creating a Link Aggregation<a class="headerlink" href="#creating-a-link-aggregation" title="Permalink to this headline">¶</a></h4>
<p>Before creating a link aggregation, double-check that no interfaces have been manually configured in Network → Interfaces → View Interfaces. If any configured interfaces exist, delete them as lagg creation will fail if any interfaces are manually configured.</p>
<p>Figure 5.4a shows the configuration options when adding a lagg interface using Network → Link Aggregations → Create Link Aggregation.</p>
<p>Figure 5.4a: Creating a lagg Interface</p>
<p><a class="reference internal" href="_images/100000000000021700000197330084C6.png"><img alt="100000000000021700000197330084C6_png" src="_images/100000000000021700000197330084C6.png" style="width: 6.4453in; height: 3.7681in;" /></a></p>
<p><strong>NOTE:</strong>
if interfaces are installed but do not appear in the Physical NICs in the LAGG list, check that a FreeBSD driver for the interface exists
<a class="reference external" href="http://www.freebsd.org/releases/9.2R/hardware.html#ETHERNET">here</a>
.</p>
<p>Select the desired aggregation protocol, highlight the interface(s) to associate with the lagg device, and click the OK button.</p>
<p>Once the lagg device has been created, it will be listed in the tree under an entry which indicates the type of protocol. As seen in Figure 5.4b, it will also appear in View Link Aggregations.</p>
<p><strong>Figure 5.4b: Viewing Link Aggregations</strong></p>
<p><a class="reference internal" href="_images/100000000000020D000001F8277BDF48.png"><img alt="100000000000020D000001F8277BDF48_png" src="_images/100000000000020D000001F8277BDF48.png" style="width: 5.4681in; height: 5.2492in;" /></a></p>
<p>Click a link aggregation entry to see the buttons to edit that lagg interface, delete the link aggregation, or edit the lagg&#8217;s member interfaces.</p>
<p>If you click the Edit button for a lagg, you will see the configuration screen shown in Figure 5.4c. Table 5.4a describes the options in this screen.</p>
<p>After creating the lagg interface, set the IP address manually or with DHCP and save. The connection to the web interface may be lost at this point, and if so, the system must be rebooted from the console setup menu. You may also have to change your switch settings to communicate through the new lagg interface. After reboot, if the IP address was set manually, you may also have to manually enter a default gateway from the console setup menu option in order to get access into the GUI through the new lagg interface.</p>
<p><strong>Figure 5.4c: Editing a lagg</strong></p>
<p><a class="reference internal" href="_images/10000000000002AF000001F1B648933C.png"><img alt="10000000000002AF000001F1B648933C_png" src="_images/10000000000002AF000001F1B648933C.png" style="width: 6.9252in; height: 3.85in;" /></a></p>
<p><strong>Table 5.4a: Configurable Options for a lagg</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="13%" />
<col width="69%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>NIC</td>
<td>string</td>
<td>read-only as automatically assigned next available numeric ID</td>
</tr>
<tr class="row-odd"><td>Interface Name</td>
<td>string</td>
<td>by default same as device (NIC) name, can be changed to a more descriptive value</td>
</tr>
<tr class="row-even"><td>DHCP</td>
<td>checkbox</td>
<td>check if the lagg device gets its IP address info from DHCP server</td>
</tr>
<tr class="row-odd"><td>IPv4 Address</td>
<td>string</td>
<td>mandatory if DHCP is left unchecked</td>
</tr>
<tr class="row-even"><td>IPv4 Netmask</td>
<td>drop-down menu</td>
<td>mandatory if DHCP is left unchecked</td>
</tr>
<tr class="row-odd"><td>Auto configure IPv6</td>
<td>checkbox</td>
<td>check only if DHCP server available to provide IPv6 address info</td>
</tr>
<tr class="row-even"><td>IPv6 Address</td>
<td>string</td>
<td>optional</td>
</tr>
<tr class="row-odd"><td>IPv6 Prefix Length</td>
<td>drop-down menu</td>
<td>required if input IPv6 address</td>
</tr>
<tr class="row-even"><td>Options</td>
<td>string</td>
<td>additional
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=ifconfig">ifconfig(8)</a>
options</td>
</tr>
</tbody>
</table>
<p>This screen also allows you to configure an alias for the lagg interface. If you wish to set multiple aliases, click the “Add extra Alias” link for each alias you wish to configure.</p>
<p>If you click the Edit Members button, click the entry for a member, then click its Edit button, you will
see the configuration screen shown in Figure 5.4d. The configurable options are summarized in Table 5.4b.</p>
<p><strong>Figure 5.4d: Editing a **
**Member Interface</strong></p>
<p><a class="reference internal" href="_images/100000000000038A000001F41B7DFD86.png"><img alt="100000000000038A000001F41B7DFD86_png" src="_images/100000000000038A000001F41B7DFD86.png" style="width: 6.9252in; height: 3.8217in;" /></a></p>
<p><strong>Table 5.4b: Configuring a Member Interface</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="12%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>LAGG Interface group</td>
<td>drop-down menu</td>
<td>select the member interface to configure</td>
</tr>
<tr class="row-odd"><td>LAGG Priority Number</td>
<td>integer</td>
<td>order of selected interface within the lagg
; configure a failover to set the master interface to 0 and the other interfaces to 1, 2, etc.</td>
</tr>
<tr class="row-even"><td>LAGG Physical NIC</td>
<td>drop-down menu</td>
<td>physical interface of the selected member</td>
</tr>
<tr class="row-odd"><td>Options</td>
<td>string</td>
<td>additional parameters from
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=ifconfig">ifconfig(8)</a></td>
</tr>
</tbody>
</table>
<p><strong>NOTE:</strong>
options can be set at either the lagg level (using the Edit button) or the individual parent interface level (using the Edit Members button). Typically, changes are made at the lagg level (Figure 5.4c) as each interface member will inherit from the lagg. If you instead configure the interface level (Figure 5.4d), you will have to repeat the configuration for each interface within the lagg. However, some lagg options can only be set by editing the interface. For instance, the MTU of a lagg is inherited from the interface. To set an MTU on a lagg, set all the interfaces to the same MTU.</p>
<p>To see if the link aggregation is load balancing properly, run the following command from
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
:</p>
<p><strong>systat -ifstat</strong></p>
<p>More information about this command can be found at
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=systat">systat(1)</a>
.</p>
</div>
</div>
<div class="section" id="id119">
<h3>Network Summary<a class="headerlink" href="#id119" title="Permalink to this headline">¶</a></h3>
<p>Network → Network Summary allows you to quickly view the addressing information of every configured interface. For each interface name, the configured IP address(es),
DNS
server(s), and default gateway will be displayed.</p>
</div>
<div class="section" id="id120">
<h3>Static Routes<a class="headerlink" href="#id120" title="Permalink to this headline">¶</a></h3>
<p>By default, no static routes are defined on the FreeNAS® system. Should you need a static route to reach portions of your network, add the route using Network → Static Routes → Add Static Route, shown in Figure 5.6a.</p>
<p><strong>Figure 5.6a: Adding a Static Route</strong></p>
<p><a class="reference internal" href="_images/1000000000000150000000D15F029EC2.png"><img alt="1000000000000150000000D15F029EC2_png" src="_images/1000000000000150000000D15F029EC2.png" style="width: 3.4992in; height: 2.1772in;" /></a></p>
<p>The available options are summarized in Table 5.6a.</p>
<p><strong>Table 5.6a: Static Route Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="16%" />
<col width="54%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Destination network</td>
<td>integer</td>
<td>use the format
<em>A.B.C.D/E</em>
where
<em>E</em>
is the CIDR mask</td>
</tr>
<tr class="row-odd"><td>Gateway</td>
<td>integer</td>
<td>input the IP address of the gateway</td>
</tr>
<tr class="row-even"><td>Description</td>
<td>string</td>
<td>optional</td>
</tr>
</tbody>
</table>
<p>If you add any static routes, they will show in “View Static Routes”. Click a route&#8217;s entry to access its Edit and Delete buttons.</p>
</div>
<div class="section" id="id121">
<h3>VLANs<a class="headerlink" href="#id121" title="Permalink to this headline">¶</a></h3>
<p>FreeNAS® uses FreeBSD&#8217;s
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=vlan">vlan(4)</a>
interface to demultiplex frames with IEEE 802.1q tags. This allows nodes on different VLANs to communicate through a layer 3 switch or router. A vlan interface must be assigned a parent interface and a numeric VLAN tag. A single parent can be assigned to multiple vlan interfaces provided they have different tags. If you click Network → VLANs → Add VLAN, you will see the screen shown in Figure 5.7a.</p>
<p><a href="#id122"><span class="problematic" id="id123">**</span></a>NOTE: **
VLAN tagging is the only 802.1q feature that is implemented. Additionally, not all Ethernet interfaces support full VLAN processing–see the HARDWARE section of
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=vlan">vlan(4)</a>
for details.</p>
<p>Figure 5.7a: Adding a VLAN</p>
<p><a class="reference internal" href="_images/100000000000013A000000F8F965FD90.png"><img alt="100000000000013A000000F8F965FD90_png" src="_images/100000000000013A000000F8F965FD90.png" style="width: 3.2701in; height: 2.5827in;" /></a></p>
<p>Table 5.7a summarizes the configurable fields.</p>
<p><strong>Table 5.7a: Adding a VLAN</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="12%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Virtual Interface</td>
<td>string</td>
<td>use the format
<em>vlanX</em>
where
<em>X</em>
is a number representing the vlan interface</td>
</tr>
<tr class="row-odd"><td>Parent Interface</td>
<td>drop-down menu</td>
<td>usually an Ethernet card connected to a properly configured switch port; if using a newly created
<a class="reference external" href="#1.5.3.LinkAggregations|outline">lagg device</a>
, it will not appear in the drop-down until the FreeNAS® system is rebooted</td>
</tr>
<tr class="row-even"><td>VLAN Tag</td>
<td>integer</td>
<td>should match a numeric tag set up in the switched network</td>
</tr>
<tr class="row-odd"><td>Description</td>
<td>string</td>
<td>optional</td>
</tr>
</tbody>
</table>
<p>The parent interface of a vlan has to be up, but it can have an IP address or it can be unconfigured, depending upon the requirements of the VLAN configuration. This makes it difficult for the GUI to do the right thing without trampling the configuration. To remedy this, after adding the VLAN, go to Network →
<a class="reference external" href="#1.5.2.Interfaces|outline">Interfaces</a>
→ Add Interface. Select the parent interface from the NIC drop-down menu and in the Options field, type
<em>up</em>
. This will bring up the parent interface. If an IP address is required, it can be configured using the rest of the options in the Add Interface screen.</p>
</div>
</div>
<div class="section" id="storage-configuration">
<h2>Storage Configuration<a class="headerlink" href="#storage-configuration" title="Permalink to this headline">¶</a></h2>
<p>The Storage section of the graphical interface allows you to configure the following:</p>
<ul class="simple">
<li><a class="reference external" href="#1.6.1.PeriodicSnapshotTasks|outline">Periodic Snapshot Tasks</a>
: used to schedule the automatic creation of ZFS snapshots.</li>
<li><a class="reference external" href="#1.6.2.ReplicationTasks|outline">Replication Tasks</a>
: used to schedule the replication of snapshots over an encrypted connection.</li>
<li><a class="reference external" href="#1.6.3.Volumes|outline">Volumes</a>
: used to create and manage storage volumes.</li>
<li><a class="reference external" href="#1.6.4.ZFSScrubs|outline">ZFS Scrubs</a>
: used to schedule ZFS scrubs as part of ongoing disk maintenance.</li>
</ul>
<p>These configurations are described in more detail in this section.</p>
<div class="section" id="id129">
<h3>Periodic Snapshot Tasks<a class="headerlink" href="#id129" title="Permalink to this headline">¶</a></h3>
<p>A periodic snapshot task allows you to schedule the creation of read-only versions of ZFS volumes and datasets at a given point in time. Snapshots can be created quickly and, if little data changes, new snapshots take up very little space. For example, a snapshot where no files have changed takes 0 MB of storage, but as you make changes to files, the snapshot size changes to reflect the size of the changes.</p>
<p>Snapshots provide a clever way of keeping a history of files, should you need to recover an older copy or even a deleted file. For this reason, many administrators take snapshots often (e.g. every 15 minutes), store them for a period of time (e.g. for a month), and store them on another system (e.g. using
<a class="reference external" href="#1.6.2.ReplicationTasks|outline">Replication Tasks</a>
). Such a strategy allows the administrator to roll the system back to a specific time or, if there is a catastrophic loss, an off-site snapshot can restore the system up to the last snapshot interval.</p>
<p>Before you can create a snapshot, you need to have an existing ZFS volume. How to create a volume is described in
<a class="reference external" href="#1.6.3.4.ZFSVolumeManager|outline">ZFS Volume Manager</a>
.</p>
<div class="section" id="creating-a-periodic-snapshot-task">
<h4>Creating a Periodic Snapshot Task<a class="headerlink" href="#creating-a-periodic-snapshot-task" title="Permalink to this headline">¶</a></h4>
<p>To create a periodic snapshot task, click Storage → Periodic Snapshot Tasks → Add Periodic Snapshot which will open the screen shown in Figure 6.1a. Table 6.1a summarizes the fields in this screen.</p>
<p><strong>NOTE:</strong>
if you just need a one-time snapshot, instead use Storage → Volumes → View Volumes and click the Create Snapshot button for the volume or dataset that you wish to snapshot.</p>
<p>Figure 6.1a: Creating a ZFS Periodic Snapshot</p>
<p><a class="reference internal" href="_images/1000000000000267000001E2C69857F7.png"><img alt="1000000000000267000001E2C69857F7_png" src="_images/1000000000000267000001E2C69857F7.png" style="width: 6.4047in; height: 5.0201in;" /></a></p>
<p><strong>Table 6.1a: Options When Creating a Periodic Snapshot</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="7%" />
<col width="13%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Enabled</td>
<td>checkbox</td>
<td>uncheck to disable the scheduled replication task without deleting it</td>
</tr>
<tr class="row-odd"><td>Volume/Dataset</td>
<td>drop-down menu</td>
<td>select an existing ZFS volume, dataset, or zvol; if you select a volume, separate snapshots will also be created for each of its datasets</td>
</tr>
<tr class="row-even"><td>Recursive</td>
<td>checkbox</td>
<td>select this box to take separate snapshots of the volume/dataset and each of its child datasets; if unchecked, only one snapshot is taken of the volume/dataset specified in
<em>Filesystem / Volume</em></td>
</tr>
<tr class="row-odd"><td>Lifetime</td>
<td>integer and drop-down menu</td>
<td>how long to keep the snapshot on this system; if the snapshot is replicated, it is not removed from the receiving system when the lifetime expires</td>
</tr>
<tr class="row-even"><td>Begin</td>
<td>drop-down menu</td>
<td>do not create snapshots before this time of day</td>
</tr>
<tr class="row-odd"><td>End</td>
<td>drop-down menu</td>
<td>do not create snapshots after this time of day</td>
</tr>
<tr class="row-even"><td>Interval</td>
<td>drop-down menu</td>
<td>how often to take snapshot between
<em>Begin</em>
and
<em>End</em>
times</td>
</tr>
<tr class="row-odd"><td>Weekday</td>
<td>checkboxes</td>
<td>which days of the week to take snapshots</td>
</tr>
</tbody>
</table>
<p>If the Recursive box is checked, you do not need to create snapshots for every dataset individually as they are included in the snapshot. The downside is that there is no way to exclude certain datasets from being included in a recursive snapshot.</p>
<p>Once you click the OK button, a snapshot will be taken and this task will be repeated according to your settings.</p>
</div>
<div class="section" id="managing-periodic-snapshot-tasks">
<h4>Managing Periodic Snapshot Tasks<a class="headerlink" href="#managing-periodic-snapshot-tasks" title="Permalink to this headline">¶</a></h4>
<p>After creating a periodic snapshot task, an entry for the snapshot task will be added to View Periodic Snapshot Tasks, as seen in the example in Figure 6.1b. Click an entry to access its Modify and Delete buttons.</p>
<p><strong>Figure 6.1b: View Periodic Snapshot Tasks</strong></p>
<p><a class="reference internal" href="_images/10000000000003AE000001EC7F2141B9.png"><img alt="10000000000003AE000001EC7F2141B9_png" src="_images/10000000000003AE000001EC7F2141B9.png" style="width: 6.9252in; height: 3.6165in;" /></a></p>
<p>If you click the ZFS Snapshots tab (above the Add Periodic Snapshot button), you can review the listing of available snapshots. An example is shown in Figure 6.1c.</p>
<p><strong>NOTE:</strong>
if snapshots do not appear, check that the current time does not conflict with the begin, end, and interval settings. If the snapshot was attempted but failed, an entry will be added to
<em>/var/log/messages</em>
. This log file can be viewed in
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
.</p>
<p>Figure 6.1c: Viewing Available Snapshots</p>
<p><a class="reference internal" href="_images/100000000000054E000001EE38B1A8BB.png"><img alt="100000000000054E000001EE38B1A8BB_png" src="_images/100000000000054E000001EE38B1A8BB.png" style="width: 6.9252in; height: 2.5189in;" /></a></p>
<p>The most recent snapshot for a volume or dataset will be listed last and will have 3 icons. The icons associated with a snapshot allow you to:</p>
<p><strong>Clone Snapshot:</strong>
will prompt for the name of the clone to create. The clone will be a writable copy of the snapshot. Since a clone is really a dataset which can be mounted, the clone will appear in the Active Volumes tab, instead of the Periodic Snapshots tab, and will have the word
<em>clone</em>
in its name.</p>
<p><strong>Destroy Snapshot:</strong>
a pop-up message will ask you to confirm this action. Child clones must be destroyed before their parent snapshot can be destroyed. While creating a snapshot is instantaneous, deleting a snapshot can be I/O intensive and can take a long time, especially when deduplication is enabled.
In order to delete a block in a snapshot, ZFS has to walk all the allocated blocks to see if that block is used anywhere else; if it is not, it can be freed.</p>
<p><strong>Rollback Snapshot:</strong>
a pop-up message will ask if you are sure that you want to rollback to this snapshot state. If you click Yes, any files that have changed since the snapshot was taken will be reverted back to their state at the time of the snapshot.</p>
<p><strong>NOTE:</strong>
rollback is a potentially dangerous operation and will cause any configured replication tasks to fail as the replication system uses the existing snapshot when doing an incremental backup. If you do need to restore the data within a snapshot, the recommended steps are:</p>
<ol class="arabic simple">
<li>Clone the desired snapshot.</li>
<li>Share the clone with the share type or service running on the FreeNAS® system.</li>
<li>Once users have recovered the needed data, destroy the clone in the Active Volumes tab.</li>
</ol>
<p>This approach will never destroy any on-disk data and has no impact on replication.</p>
<p>Periodic snapshots can be configured to appear as
<a class="reference external" href="#1.7.3.4.ConfiguringShadowCopies|outline">shadow copies</a>
in newer versions of Windows Explorer. Users can access the files in the shadow copy using Explorer without requiring any interaction with the FreeNAS® graphical administrative interface.</p>
<p>The ZFS Snapshots screen allows you to create filters to view snapshots by selected criteria. To create a filter, click the Define filter icon (near the text “No filter applied”). When creating a filter:</p>
<ul class="simple">
<li>select the column or leave the default of Any Column.</li>
<li>select the condition. Possible conditions are:
<em>contains</em>
(default),
<em>is, starts with, ends with, does *
*not contain, is not, does not start with, does not end with</em>
, and
<em>is empty</em>
.</li>
<li>input a value that meets your view criteria.</li>
<li>click the Filter button to save your filter and exit the define filter screen. Alternately, click the + button to add another filter.</li>
</ul>
<p>If you create multiple filters, select the filter you wish to use before leaving the define filter screen. Once a filter is selected, the “No filter applied” text will change to “Clear filter”. If you click “Clear filter”, a pop-up message will indicate that this will remove the filter and all available snapshots will be listed.</p>
</div>
</div>
<div class="section" id="id133">
<h3>Replication Tasks<a class="headerlink" href="#id133" title="Permalink to this headline">¶</a></h3>
<p>A replication task allows you to automate the copy of ZFS snapshots to another system over an encrypted connection. This allows you to create an off-site backup of a ZFS dataset or pool.</p>
<p>This section will refer to the system generating the ZFS snapshots as
<em>PUSH</em>
and the system to receive a copy of the ZFS snapshots as
<em>PULL</em>
.</p>
<p>Before you can configure a replication task, the following pre-requisites must be met:</p>
<ul class="simple">
<li>a ZFS volume must exist on both
<em>PUSH</em>
and
<em>PULL</em>
.</li>
<li>a periodic snapshot task must be created on
<em>PUSH</em>
. You will not be able to create a replication task before the first snapshot exists.</li>
<li>the SSH service must be enabled on
<em>PULL</em>
. The first time the service is enabled, it will generate the required SSH keys.</li>
</ul>
<p>A replication task uses the following keys:</p>
<ul class="simple">
<li><strong>/data/ssh/replication.pub:</strong>
the RSA public key used for authenticating the
<em>PUSH</em>
replication user. This key needs to be copied to the
replication
* *
user account on
<em>PULL</em>
.</li>
<li><strong>/etc/ssh/ssh_host_rsa_key.pub:</strong>
the RSA host public key of
<em>PULL</em>
used to authenticate the receiving side in order to prevent a man-in-the-middle attack. This key needs to be copied to the replication task on
<em>PUSH</em>
.</li>
</ul>
<p>This section will demonstrate how to configure a replication task between the following two FreeNAS® systems:</p>
<ul class="simple">
<li><em>192.168.2.2</em>
will be referred to as
<em>PUSH</em>
. This system has a periodic snapshot task for the ZFS dataset
<em>/mnt/local/data</em>
.</li>
<li><em>192.168.2.6</em>
will be referred to as
<em>PULL</em>
. This system has an existing ZFS volume named
<em>/mnt/remote</em>
which will store the pushed snapshots.</li>
</ul>
<div class="section" id="configure-pull">
<h4>Configure PULL<a class="headerlink" href="#configure-pull" title="Permalink to this headline">¶</a></h4>
<p>A copy of the public key for the replication user on
<em>PUSH</em>
needs to be pasted to the public key of the replication user on the
<em>PULL</em>
system.
* *</p>
<p>To obtain a copy of the replication key: on
<em>PUSH</em>
go to Storage → View Replication Tasks. Click the View Public Key button and copy its contents. An example is shown in Figure 6.2a.</p>
<p><strong>Figure 6.2a: Copy the Replication Key</strong></p>
<p><a class="reference internal" href="_images/100000000000033D000001B86EE0E351.png"><img alt="100000000000033D000001B86EE0E351_png" src="_images/100000000000033D000001B86EE0E351.png" style="width: 6.9252in; height: 3.6752in;" /></a></p>
<p>Go to
<em>PULL</em>
and click Account → Users → View Users. Click the Modify User button for the user account you will be using for replication (by default this is the
<em>root</em>
user).
Paste the copied key into the “SSH Public Key” field and click OK. If a key already exists, append the new text after the existing key.</p>
<p>On
<em>PULL</em>
, ensure that the SSH service is enabled in Services → Control Services. Start it if it is not
already running.</p>
</div>
<div class="section" id="configure-push">
<h4>Configure PUSH<a class="headerlink" href="#configure-push" title="Permalink to this headline">¶</a></h4>
<p>On
<em>PUSH</em>
, verify that a periodic snapshot task has been created and that at least one snapshot is listed in Storage → Periodic Snapshot Tasks → View Periodic Snapshot Tasks → ZFS Snapshots.</p>
<p>To create the replication task, click Storage → Replication Tasks → Add Replication Task. Figure 6.2b shows the required configuration for our example:</p>
<ul class="simple">
<li>the Volume/Dataset is
<em>local/data</em></li>
<li>the Remote ZFS Volume/Dataset is
<em>remote</em></li>
<li>the Remote hostname is
<em>192.168.2.6</em></li>
<li>the Begin and End times are at their default values, meaning that replication will occur whenever a snapshot is created</li>
<li>once the Remote hostname is input, click the SSH Key Scan button; assuming the address is
reachable and the SSH service is running on
<em>PULL</em>
, its key will automatically be populated to the Remote hostkey box</li>
</ul>
<p>Table 6.2a summarizes the available options in the Add Replication Task screen.</p>
<p><strong>Figure 6.2b: Adding a Replication Task</strong></p>
<p><a class="reference internal" href="_images/1000000000000405000001A6B477C9AE.png"><img alt="1000000000000405000001A6B477C9AE_png" src="_images/1000000000000405000001A6B477C9AE.png" style="width: 6.9252in; height: 2.8398in;" /></a></p>
<p><strong>Table 6.2a: Adding a Replication Task</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="17%" />
<col width="10%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Enabled</td>
<td>checkbox</td>
<td>uncheck to disable the scheduled replication task without deleting it</td>
</tr>
<tr class="row-odd"><td>Volume/Dataset</td>
<td>drop-down menu</td>
<td>the ZFS volume or dataset on
<em>PUSH</em>
containing the snapshots to be replicated; the drop-down menu will be empty if a snapshot does not already exist</td>
</tr>
<tr class="row-even"><td>Remote ZFS Volume/Dataset</td>
<td>string</td>
<td>the ZFS volume on
<em>PULL</em>
that will store the snapshots;
<em>/mnt/</em>
is assumed and should not be included in the path</td>
</tr>
<tr class="row-odd"><td>Recursively replicate</td>
<td>checkbox</td>
<td>if checked will replicate child datasets and replace previous snapshot stored on
<em>PULL</em></td>
</tr>
<tr class="row-even"><td>Initialize remote side</td>
<td>checkbox</td>
<td>does a reset once operation which destroys the replication data on
<em>PULL</em>
before reverting to normal operation; use this option if replication gets stuck</td>
</tr>
<tr class="row-odd"><td>Limit (kB/s)</td>
<td>integer</td>
<td>limits replication speed to specified value in kilobytes/second; default of
<em>0</em>
is unlimited</td>
</tr>
<tr class="row-even"><td>Begin</td>
<td>drop-down menu</td>
<td>the replication can not start before this time; the times selected in the
<em>Begin</em>
and
<em>End</em>
fields set the replication window for when replication can occur</td>
</tr>
<tr class="row-odd"><td>End</td>
<td>drop-down menu</td>
<td>the replication must start by this time; once started, replication will occur until it is finished (see NOTE below)</td>
</tr>
<tr class="row-even"><td>Remote hostname</td>
<td>string</td>
<td>IP address or DNS name of
<em>PULL</em></td>
</tr>
<tr class="row-odd"><td>Remote port</td>
<td>string</td>
<td>must match port being used by SSH service on
<em>PULL</em></td>
</tr>
<tr class="row-even"><td>Dedicated User Enabled</td>
<td>checkbox</td>
<td>allows a user account other than root to be used for replication</td>
</tr>
<tr class="row-odd"><td>Dedicated User</td>
<td>drop-down menu</td>
<td>only available if
<em>Dedicated User Enabled</em>
is checked; select the user account to be used for replication</td>
</tr>
<tr class="row-even"><td>Enable High Speed Ciphers</td>
<td>checkbox</td>
<td>note that the cipher is quicker because it has a lower strength</td>
</tr>
<tr class="row-odd"><td>Remote hostkey</td>
<td>string</td>
<td>use the SSH Key Scan button to retrieve the public key of
<em>PULL</em></td>
</tr>
</tbody>
</table>
<p>By default, replication occurs when snapshots occur. For example, if snapshots are scheduled for every 2 hours, replication occurs every 2 hours. The Begin and End times can be used to create a window of time where replication occurs. Change the default times (which allow replication to occur at any time of the day a snapshot occurs) if snapshot tasks are scheduled during office hours but the replication itself should occur after office hours. For the End time, consider how long replication will take so that it finishes before the next day&#8217;s office hours begin.</p>
<p>Once the replication task is created, it will appear in the View Replication Tasks of
<em>PUSH.</em></p>
<p><em>PUSH</em>
will immediately attempt to replicate its latest snapshot to
<em>PULL</em>
. If the replication is successful, the snapshot will appear in the Storage → Periodic Snapshot Tasks → View Periodic Snapshot Tasks → ZFS Snapshots tab of
<em>PULL</em>
, as seen in Figure 6.2c.
If the snapshot is not replicated, see the next section for troubleshooting tips.</p>
<p><strong>Figure 6.2c: Verifying the Snapshot was Replicated</strong></p>
</div>
<div class="section" id="troubleshooting-replication">
<h4>Troubleshooting Replication<a class="headerlink" href="#troubleshooting-replication" title="Permalink to this headline">¶</a></h4>
<p>If you have followed all of the steps above and have
<em>PUSH</em>
snapshots that are not replicating to
<em>PULL</em>
, check to see if SSH is working properly. On
<em>PUSH</em>
, open
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
and try to
<strong>ssh</strong>
into
<em>PULL</em>
. Replace
<em>hostname_or_ip</em>
with the value for
<em>PULL</em>
:</p>
<p><strong>ssh -vv -i /data/ssh/replication hostname_or_ip</strong></p>
<p>This command should not ask for a password. If it asks for a password, SSH authentication is not working. Go to Storage → Replication Tasks → View Replication Tasks and click the “View Public Key” button.
Make sure that it matches one of the values in
<em>/~/.ssh/authorized_keys</em>
on
<a href="#id135"><span class="problematic" id="id136">*</span></a>PULL, *
where ~
represents the home directory of the replication user
.</p>
<p>Also check
<em>/var/log/auth.log</em>
on
<em>PULL</em>
and
<em>/var/log/messages</em>
on
<em>PUSH</em>
to see if either log gives an indication of the error.</p>
<p>If the key is correct and replication is still not working, try deleting all snapshots on
<em>PULL</em>
except for the most recent one. In Storage → Periodic Snapshot Tasks → View Periodic Snapshot Tasks → ZFS Snapshots check the box next to every snapshot except for the last one (the one with 3 icons instead of 2), then click the global Destroy button at the bottom of the screen.</p>
<p>Once you have only one snapshot, open Shell on
<em>PUSH</em>
and use the
<strong>zfs send</strong>
command. To continue our example, the ZFS snapshot on the
<em>local/data</em>
dataset of
<em>PUSH</em>
is named
<em>auto-20110922.1753-2h</em>
, the IP address of
<em>PULL</em>
is
<em>192.168.2.6</em>
, and the ZFS volume on
<em>PULL</em>
is
<em>remote</em>
. Note that the
<strong>&#64;</strong>
is used to separate the volume/dataset name from the snapshot name.</p>
<p><strong>zfs send local/data&#64;auto-20110922.1753-2h | ssh -i /data/ssh/replication 192.168.2.6 zfs receive local/data&#64;auto-20110922.1753-2h</strong></p>
<p><strong>NOTE:</strong>
if this command fails with the error “cannot receive new filesystem stream: destination has snapshots”, check the box “initialize remote side for once” in the replication task and try again. If the
<strong>zfs send</strong>
command still fails, you will need to open Shell on
<em>PULL</em>
and use the
<strong>zfs destroy -R volume_name&#64;snapshot_name</strong>
command to delete the stuck snapshot. You can then use the
<strong>zfs list -t snapshot</strong>
on
<em>PULL</em>
to confirm if the snapshot successfully replicated.</p>
<p>After successfully transmitting the snapshot, recheck again after the time period between snapshots lapses to see if the next snapshot successfully transmitted. If it is still not working, you can manually send an incremental backup of the last snapshot that is on both systems to the current one with this command:</p>
<p><strong>zfs send local/data&#64;auto-20110922.1753-2h | ssh -i /data/ssh/replication 192.168.2.6 zfs receive local/data&#64;auto-20110922.1753-2h</strong></p>
</div>
</div>
<div class="section" id="id137">
<h3>Volumes<a class="headerlink" href="#id137" title="Permalink to this headline">¶</a></h3>
<p>Since the storage disks are separate from the FreeNAS® operating system, you do not actually have a NAS (network-attached storage) system until you configure your disks into at least one volume. The FreeNAS® graphical interface supports the creation of both
<a class="reference external" href="http://en.wikipedia.org/wiki/Unix_File_System">UFS</a>
and
<a class="reference external" href="http://en.wikipedia.org/wiki/Zfs">ZFS</a>
volumes. ZFS volumes are recommended to get the most out of your FreeNAS® system.</p>
<p><strong>NOTE:</strong>
in ZFS terminology, the storage that is managed by ZFS is referred to as a pool. When configuring the ZFS pool using the FreeNAS® graphical interface, the term volume is used to refer to either a UFS volume or a ZFS pool.</p>
<p>Proper storage design is important for any NAS.
<strong>It is recommended that you read through this entire chapter first, before configuring your storage disks, so that you are aware of all of the possible features, know which ones will benefit your setup most, and are aware of any caveats or hardware **
**restrictions.</strong></p>
<div class="section" id="auto-importing-volumes">
<h4>Auto Importing Volumes<a class="headerlink" href="#auto-importing-volumes" title="Permalink to this headline">¶</a></h4>
<p>If you click Storage → Volumes → Auto Import Volume, you can configure FreeNAS® to use an
<strong>existing</strong>
software UFS or ZFS RAID volume. This action is typically performed when an existing
FreeNAS® system is re-installed (rather than upgraded). Since the operating system is separate from
the disks, a new installation does not affect the data on the disks; however, the new operating system
needs to be configured to use the existing volume.</p>
<p>Supported volumes are UFS GEOM stripes (RAID0), UFS GEOM mirrors (RAID1), UFS GEOM
RAID3, as well as existing ZFS pools.
UFS RAID5 is not supported as it is an unmaintained summer of code project which was never integrated into FreeBSD.</p>
<p>Beginning with version 8.3.1, the import of existing GELI-encrypted ZFS pools is also supported.
However, the pool must be decrypted before it can be imported.</p>
<p>Figure 6.3a shows the initial pop-up window that appears when you select to auto import a volume.</p>
<p>If you are importing a UFS RAID or an existing, unencrypted ZFS pool, select “No: Skip to import” to access the screen shown in Figure 6.3b.</p>
<p><strong>Figure 6.3a: Initial Auto Import Volume Screen</strong></p>
<p><a class="reference internal" href="_images/100000000000027600000153F572D1A1.png"><img alt="100000000000027600000153F572D1A1_png" src="_images/100000000000027600000153F572D1A1.png" style="width: 6.561in; height: 3.5307in;" /></a></p>
<p><strong>Figure 6.3b: Auto Importing a Non-Encrypted Volume</strong></p>
<p><a class="reference internal" href="_images/100000000000026600000151FC5B0A5B.png"><img alt="100000000000026600000151FC5B0A5B_png" src="_images/100000000000026600000151FC5B0A5B.png" style="width: 6.3953in; height: 3.5098in;" /></a></p>
<p>Existing software RAID volumes should be available for selection from the drop-down menu. In the example shown in Figure 6.3b, the FreeNAS® system has an existing, unencrypted ZFS pool. Once the volume is selected, click the “OK” button to import the volume.</p>
<p>FreeNAS® will not import a dirty volume. If an existing UFS RAID does not show in the drop-down menu, you will need to
<strong>fsck</strong>
the volume.</p>
<p>If an existing ZFS pool does not show in the drop-down menu, run
<strong>zpool import</strong>
from
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
to import the pool.</p>
<p>If you plan to physically install ZFS formatted disks from another system, be sure to export the drives on that system to prevent an “in use by another machine” error during the import.</p>
<p>If you suspect that your hardware is not being detected, run
<strong>camcontrol devlist</strong>
from Shell. If the disk does not appear in the output, check to see if the controller driver is supported or if it needs to be loaded by creating a
<a class="reference external" href="#1.4.9.Tunables|outline">tunable</a>
.</p>
<div class="section" id="auto-importing-a-geli-encrypted-zfs-pool">
<h5>Auto Importing a GELI-Encrypted ZFS Pool<a class="headerlink" href="#auto-importing-a-geli-encrypted-zfs-pool" title="Permalink to this headline">¶</a></h5>
<p>If you are importing an existing GELI-encrypted ZFS pool, you must decrypt the disks before importing the pool. In Figure 6.3a, select “Yes: Decrypt disks” to access the screen shown in Figure 6.3c.</p>
<p><strong>Figure 6.3c: Decrypting the Disks Before Importing the ZFS Pool</strong></p>
<p><a class="reference internal" href="_images/10000000000002990000017C9E48C038.png"><img alt="10000000000002990000017C9E48C038_png" src="_images/10000000000002990000017C9E48C038.png" style="width: 6.9252in; height: 3.9571in;" /></a></p>
<p>Select the disks in the encrypted pool, browse to the location of the saved encryption key, input the passphrase associated with the key, then click OK to decrypt the disks.</p>
<p><strong>NOTE:</strong>
the encryption key is required to decrypt the pool. If the pool can not be decrypted, it can not be re-imported after a failed upgrade or lost configuration. This means that it is
<strong>very important</strong>
** **
to save a copy of the key and to remember the passphrase that was configured for the key. The
<a class="reference external" href="#1.6.3.7.1.KeyManagementforEncryptedVolumes|outline">View Volumes</a>
screen is used to manage the keys for encrypted volumes.</p>
<p>Once the pool is decrypted, it should appear in the drop-down menu of Figure 6.3b. Click the OK button to finish the volume import.</p>
</div>
</div>
<div class="section" id="id142">
<h4>Importing Volumes<a class="headerlink" href="#id142" title="Permalink to this headline">¶</a></h4>
<p>The Volume → Import Volume screen, shown in Figure 6.3d, is used to import a single disk or partition that has been formatted with a supported filesystem. FreeNAS® supports the import of disks that have been formatted with UFS, NTFS, MSDOS, or EXT2. The import is meant to be a temporary measure in order to copy the data from a disk to a volume. Only one disk can be imported at a time.</p>
<p>Figure 6.3d: Importing a Volume</p>
<p><a class="reference internal" href="_images/10000000000002160000016D814978F6.png"><img alt="10000000000002160000016D814978F6_png" src="_images/10000000000002160000016D814978F6.png" style="width: 6.4335in; height: 3.3799in;" /></a></p>
<p>Input a name for the volume, use the drop-down menu to select the disk or partition that you wish to import, and select the type of filesystem on the disk.</p>
<p>Before importing a disk, be aware of the following caveats:</p>
<ul>
<li><p class="first">FreeNAS®
will not import a dirty filesystem. If a supported filesystem does not show in the drop-down menu, you will need to
<strong>fsck</strong></p>
<p>or run a disk check on
the filesystem.</p>
</li>
<li><p class="first">FreeNAS®
can not import dynamic NTFS volumes at this time. A future version of FreeBSD may address this issue.</p>
</li>
<li><p class="first">if an NTFS volume will not import, try ejecting the volume safely from a Windows system. This will fix some journal files that are required to mount the drive.</p>
</li>
</ul>
</div>
<div class="section" id="id143">
<h4>UFS Volume Manager<a class="headerlink" href="#id143" title="Permalink to this headline">¶</a></h4>
<p>While the UFS filesystem is supported, it is not recommended as it does not provide any ZFS features such as compression, encryption, deduplication, copy-on-write, lightweight snapshots, or the ability to provide early detection and correction of corrupt data. If you are using UFS as a temporary solution until you can afford better hardware, note that you will have to destroy your existing UFS volume in order to create a ZFS pool, then restore your data from backup.</p>
<p><strong>NOTE:</strong>
it is not recommended to create a UFS volume larger than 5TB as it will be inefficient to
<strong>fsck</strong>
, causing long delays at system boot if the system was not shutdown cleanly.</p>
<p>To format your disks with UFS, go to Storage → Volumes → UFS Volume Manager (legacy) which will open the screen shown in Figure 6.3e.</p>
<p><strong>Figure 6.3e: Creating a UFS Volume</strong></p>
<p><a class="reference internal" href="_images/100000000000024B0000015CFFDFDC80.png"><img alt="100000000000024B0000015CFFDFDC80_png" src="_images/100000000000024B0000015CFFDFDC80.png" style="width: 6.1138in; height: 3.6244in;" /></a></p>
<p>Table 6.3a summarizes the available options.</p>
<p><strong>Table 6.3a: Options When Creating a UFS Volume</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="6%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Volume name</td>
<td>string</td>
<td>mandatory; it is recommended to choose a name that will stick out in the logs (e.g. not
<em>data</em>
or
<em>freenas</em>
)</td>
</tr>
<tr class="row-odd"><td>Member disks</td>
<td>selection</td>
<td>use the mouse to select the disk(s) to be used; to select multiple disks, highlight the first disk, then hold the shift key as you highlight the last disk.</td>
</tr>
<tr class="row-even"><td>Specify custom path</td>
<td>checkbox</td>
<td>optional; useful for creating a
<em>/var</em>
for persistent log storage</td>
</tr>
<tr class="row-odd"><td>Path</td>
<td>string</td>
<td>only available when
<em>Specify custom path</em>
is checked; must be full name of volume (e.g.
<em>/mnt/var</em>
) and if no path is provided, it will append the
<em>Volume *
*name</em>
to
<em>/mnt</em></td>
</tr>
</tbody>
</table>
<p>The Add Volume button warns that
<strong>creating a volume destroys all existing data on selected disk(s).</strong>
** **
In other words, creating storage using UFS Volume Manager is a destructive action that reformats the selected disks. If your intent is to not overwrite the data on an existing volume, see if the volume format is supported by the
<a class="reference external" href="#1.6.3.1.AutoImportingVolumes|outline">auto-import</a>
or
<a class="reference external" href="#1.6.3.2.ImportingVolumes|outline">import</a>
actions. If so, perform the supported action instead. If the current storage format is not supported, you will need to backup the data to an external media, format the disks, then restore the data to the new volume.</p>
</div>
<div class="section" id="id146">
<h4>ZFS Volume Manager<a class="headerlink" href="#id146" title="Permalink to this headline">¶</a></h4>
<p>If you have unformatted disks or wish to overwrite the filesystem (and data) on your disks, use the ZFS Volume Manager to format the desired disks into a ZFS pool.</p>
<p>If you are new to RAID concepts or would like an overview of the differences between hardware RAID and ZFS RAIDZ*, skim through the section on
<a class="reference external" href="#1.1.4.HardwareRecommendations|outline">Hardware Recommendations</a>
before using ZFS Volume Manager.</p>
<p>If you click on Storage → Volumes → ZFS Volume Manager, you will see a screen similar to the example shown in Figure 6.3f.</p>
<p>Figure 6.3f: Creating a ZFS Pool Using Volume Manager</p>
<p><a class="reference internal" href="_images/10000000000003A1000001F0749B2C74.png"><img alt="10000000000003A1000001F0749B2C74_png" src="_images/10000000000003A1000001F0749B2C74.png" style="width: 6.9252in; height: 3.6972in;" /></a></p>
<p>Table 6.3b summarizes the configuration options of this screen.</p>
<p>Table 6.3b: Options When Creating a ZFS Volume</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="13%" />
<col width="72%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Volume name</td>
<td>string</td>
<td>ZFS volumes must conform to these
<a class="reference external" href="http://docs.oracle.com/cd/E23824_01/html/821-1448/gbcpt.html">naming conventions</a>
; it is
recommended to choose a name that will stick out in the logs (e.g.
<strong>not</strong>
** **
<em>data</em>
or
<em>freenas</em>
)</td>
</tr>
<tr class="row-odd"><td>Volume to extend</td>
<td>drop-down menu</td>
<td>requires an existing ZFS pool to extend; see
<a class="reference external" href="#1.6.3.5.ExtendingaZFSVolume|outline">Extending a ZFS Volume</a>
for instructions</td>
</tr>
<tr class="row-even"><td>Encryption</td>
<td>checkbox</td>
<td>read the section on
<a class="reference external" href="#1.6.3.4.1.Encryption|outline">Encryption</a>
before choosing to use encryption</td>
</tr>
<tr class="row-odd"><td>Available disks</td>
<td>display</td>
<td>displays the size of available disks; hover over
<em>show</em>
to list the available device names</td>
</tr>
<tr class="row-even"><td>Volume layout</td>
<td>drag and drop</td>
<td>click and drag the icon to select the desired number of disks</td>
</tr>
<tr class="row-odd"><td>Add Extra Device</td>
<td>button</td>
<td>select to configure multiple pools or to add log or cache devices during pool creation</td>
</tr>
</tbody>
</table>
<p>To configure the pool, drag the slider to select the desired number of disks. The ZFS Volume Manager will automatically select the optimal configuration and the resulting storage capacity, which takes swap into account, will be displayed. If you wish to change the layout or the number of disks, use the mouse to drag the slider to the desired volume layout.
The drop-down menu showing the optimal configuration can also be clicked to change the configuration, though the GUI will turn red if the selected configuration is not recommended.</p>
<p><strong>NOTE:</strong>
for performance and capacity reasons, this screen will not allow you to create a volume from disks of differing sizes. While it is not recommended, it is possible to create a volume in this situation by using the “Manual setup” button and following the instructions in
<a class="reference external" href="#1.6.3.4.2.ManualVolumeCreation|outline">Manual Volume Creation</a>
.</p>
<p>ZFS Volume Manager will allow you to save save a non-optimal configuration. It will still work, but will perform less efficiently than an optimal configuration. However, the GUI will not allow you to select a configuration if the number of disks selected is not enough to create that configuration. Click the tool tip icon to access a link to this documentation.</p>
<p>The Add Volume button warns that
<strong>creating a volume will destroys any existing data on the selected **
**disk(s)</strong>
. In other words, creating a new volume reformats the selected disks. If your intent is to not overwrite the data on an existing volume, see if the volume format is supported by the
<a class="reference external" href="#1.6.3.1.AutoImportingVolumes|outline">auto-import</a>
or
<a class="reference external" href="#1.6.3.2.ImportingVolumes|outline">import</a>
actions. If so, perform the supported action
instead
. If the current storage format is not supported, you will need to backup the data to an external media, format the disks, then restore the data to the new volume.</p>
<p>The ZFS Volume Manager will automatically select the optimal layout for the new pool, depending upon the number of disks selected. The following formats are supported:</p>
<ul class="simple">
<li><strong>Stripe:</strong>
requires at least one disk</li>
<li><strong>Mirror:</strong>
requires at least two disks</li>
<li><strong>RAIDZ1:</strong>
requires at least three disks</li>
<li><strong>RAIDZ2:</strong>
requires at least four disks</li>
<li><strong>RAIDZ3:</strong>
requires at least five disks</li>
<li><strong>log device:</strong>
add a dedicated log device (slog)</li>
<li><strong>cache device:</strong>
add a dedicated cache device</li>
</ul>
<p>If you have more than five disks and are using ZFS, consider the number of disks to use for best performance and scalability. An overview of the various RAID levels and recommended disk group sizes can be found in the
<a class="reference external" href="#1.1.4.6.RAIDOverview|outline">RAID Overview</a>
section. More information about log and cache devices can be found in the
<a class="reference external" href="#1.1.4.7.ZFSOverview|outline">ZFS Overview</a>
section.</p>
<p>Depending upon the size and number of disks, the type of controller, and whether or not encryption is selected, creating the volume may take some time. Once the volume is created, the screen will refresh and the new volume will be listed under Storage → Volumes.</p>
<div class="section" id="id152">
<h5>Encryption<a class="headerlink" href="#id152" title="Permalink to this headline">¶</a></h5>
<p>Beginning with 8.3.1, FreeNAS® supports
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=geli">GELI</a>
full disk encryption when creating ZFS volumes. It is important to understand the following when considering whether or not encryption is right for your FreeNAS® system:</p>
<ul class="simple">
<li>This is
<strong>not</strong>
the encryption method used by Oracle ZFSv30. That version of ZFS has not been open sourced and is the property of Oracle.</li>
<li>This is full disk encryption and
<strong>not</strong>
** **
per-filesystem encryption. The underlying drives are first encrypted, then the pool is created on top of the encrypted devices.</li>
<li>This type of encryption is primarily targeted at users who store sensitive data and want to retain the ability to remove disks from the pool without having to first wipe the disk&#8217;s contents.</li>
<li>This design is only suitable for safe disposal of disks independent of the encryption key. As long as the key and the disks are intact, the system is vulnerable to being decrypted. The key should be protected by a strong passphrase and any backups of the key should be securely stored.</li>
<li>On the other hand, if the key is lost, the data on the disks is inaccessible. Always backup the key!</li>
</ul>
<p><strong>IMPORTANT NOTE:</strong>
the per-drive GELI master keys are not backed up along with with the user keys. If a bit error occurs in the last sector of an encrypted disk, this may mean the data on that disk is completely lost. Until this issue is resolved, it is important to read
<a class="reference external" href="http://forums.freenas.org/threads/please-validate-my-backup-plan-rotating-offsite-backup-disks-from-single-freenas-primary-storage.17316/#post-93073">this forum post</a>
which explains how to back up your master keys manually.
<a class="reference external" href="http://forums.freenas.org/threads/recover-encryption-key.16593/#post-85497">this forum post</a>
gives an in-depth explanation of how the various key types are used by GELI. To track future progress on this issue, refer to
<a class="reference external" href="https://bugs.freenas.org/issues/2375">this bug report</a>
.</p>
<ul class="simple">
<li>The encryption key is per ZFS volume (pool). If you create multiple pools, each pool has its own encryption key.</li>
<li>If the system has a lot of disks, there will be a performance hit if the CPU does not support
<a class="reference external" href="http://en.wikipedia.org/wiki/AES-NI#Supporting_CPUs">AES-NI</a>
or if no crypto hardware is installed. Without hardware acceleration, there will be about a 20% performance hit for a single disk. Performance degradation will continue to increase with more disks. As data is written, it is automatically encrypted and as data is read, it is decrypted on the fly. If the processor does support the AES-NI instruction set, there should be very little, if any, degradation in performance when using encryption. This
<a class="reference external" href="http://forums.freenas.org/showthread.php?12157-Encryption-performance-benchmarks">forum post</a>
compares the performance of various CPUs.</li>
<li>Data in the ARC cache and the contents of RAM are unencrypted.</li>
<li>Swap is always encrypted, even on unencrypted volumes.</li>
<li>There is no way to convert an existing, unencrypted volume. Instead, the data must be backed up, the existing pool must be destroyed, a new encrypted volume must be created, and the backup restored to the new volume.</li>
<li>Hybrid pools are not supported. In other words, newly created vdevs must match the existing encryption scheme. When
<a class="reference external" href="#1.6.3.5.ExtendingaZFSVolume|outline">extending a volume</a>
, Volume Manager will automatically encrypt the new vdev being added to the existing encrypted pool.</li>
</ul>
<p><strong>NOTE:</strong>
the encryption facility used by FreeNAS® is designed to protect against physical theft of the disks. It is not designed to protect against unauthorized software access. Ensure that only authorized users have access to the administrative GUI and that proper permissions are set on shares if sensitive data stored on the system.</p>
<div class="section" id="creating-an-encrypted-volume">
<h6>Creating an Encrypted Volume<a class="headerlink" href="#creating-an-encrypted-volume" title="Permalink to this headline">¶</a></h6>
<p>To create an encrypted volume, check the “Encryption” box shown in Figure 6.3f. Input the volume
name, select the disks to add to the volume, and click the Add Volume button to make the encrypted volume.</p>
<p>Once the volume is created,
<strong>it is extremely important</strong>
** **
to set a passphrase on the key, make a backup of the key, and create a recovery key. Without these, it is impossible to re-import the disks at a later time.</p>
<p>To perform these tasks, go to Storage → Volumes -&gt; View Volumes. This screen is shown in Figure 6.3o.</p>
<p>To set a passphrase on the key, click the volume name and then the &#8220;Create Passphrase&#8221; button (the key shaped icon in Figure 6.3o). You will be prompted to input the password used to access the FreeNAS® administrative GUI, and then to input and repeat the desired passphrase. Unlike a password, a passphrase can contain spaces and is typically a series of words. A good passphrase is easy to remember (like the line to a song or piece of literature) but hard to guess (people who know you should not be able to guess the passphrase).</p>
<p>When you set the passphrase, a warning message will remind you to create a new recovery key as a new passphrase needs a new recovery key. This way, if the passphrase is forgotten, the associated recovery key can be used instead. To create the recovery key, click the &#8220;Add recovery key&#8221; button (second last key icon in Figure 6.3o). This screen will prompt you to input the password used to access the FreeNAS® administrative GUI and then to select the directory in which to save the key. Note that the recovery key is saved to the client system, not on the FreeNAS® system.</p>
<p>Finally, download a copy of the encryption key, using the &#8220;Download key&#8221; button (the key icon with a down arrow in Figure 6.3o). Again, the encryption key is saved to the client system, not on the FreeNAS® system. You will be prompted to input the password used to access the FreeNAS® administrative GUI before the selecting the directory in which to store the key.</p>
<p>The passphrase, recovery key, and encryption key need to be protected. Do not reveal the passphrase to others. On the system containing the downloaded keys, take care that that system and its backups are protected. Anyone who has the keys has the ability to re-import the disks should they be discarded or stolen.</p>
</div>
</div>
<div class="section" id="id155">
<h5>Manual Volume Creation<a class="headerlink" href="#id155" title="Permalink to this headline">¶</a></h5>
<p>The &#8220;Manual Setup&#8221; button shown in Figure 6.3f can be used to create a non-optimal ZFS volume. While this is
<strong>not</strong>
** **
recommended, it can, for example, be used to create a volume containing disks of different sizes or to put more than the recommended number of disks into a vdev.</p>
<p><strong>NOTE:</strong>
when using disks of differing sizes, the volume is limited by the size of the smallest disk. When using more disks than are recommended for a vdev, you increase resilvering time and the risk that more than the allowable number of disks will fail before a resilver completes. For these reasons, it is recommended to instead let the ZFS Volume Manager create an optimal pool for you, as described in
<a class="reference external" href="#1.6.3.4.ZFSVolumeManager|outline">ZFS Volume Manager</a>
, using same-size disks.</p>
<p>Figure 6.3g shows the &#8220;Manual Setup&#8221; screen and Table 6.3c summarizes the available options.</p>
<p><strong>Figure 6.3g: Creating a Non-Optimal ZFS Volume</strong></p>
<p><a class="reference internal" href="_images/10000000000002FB000001C024B7C06D.png"><img alt="10000000000002FB000001C024B7C06D_png" src="_images/10000000000002FB000001C024B7C06D.png" style="width: 6.9252in; height: 4.0661in;" /></a></p>
<p><strong>Table 6.3c: Manual Setup Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="14%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Volume name</td>
<td>string</td>
<td>ZFS volumes must conform to these
<a class="reference external" href="http://docs.oracle.com/cd/E19082-01/817-2271/gbcpt/index.html">naming conventions</a>
; it is recommended to choose a name that will stick out in the logs (e.g.
<strong>not</strong>
** **
<em>data</em>
or
<em>freenas</em>
)</td>
</tr>
<tr class="row-odd"><td>Encryption</td>
<td>checkbox</td>
<td>read the section on
<a class="reference external" href="#1.6.3.4.1.1.CreatinganEncryptedVolume|outline">Encryption</a>
before choosing to use encryption</td>
</tr>
<tr class="row-even"><td>Member disks</td>
<td>list</td>
<td>highlight desired number of disks from list of available disks</td>
</tr>
<tr class="row-odd"><td>Deduplication</td>
<td>drop-down menu</td>
<td>choices are
<em>Off</em>
,
<em>Verify</em>
, and
<em>On</em>
; carefully consider the section on
<a class="reference external" href="#1.6.3.6.1.Deduplication|outline">Deduplication</a>
before changing this setting</td>
</tr>
<tr class="row-even"><td>ZFS Extra</td>
<td>bullet selection</td>
<td>used to specify if disk is used for storage (&#8220;None&#8221;), a log device, a cache device, or a spare</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id159">
<h4>Extending a ZFS Volume<a class="headerlink" href="#id159" title="Permalink to this headline">¶</a></h4>
<p>The “Volume to extend” drop-down menu in Storage → Volumes → ZFS Volume Manager, shown in Figure 6.3h, can be used to add additional disks to an existing ZFS volume. This drop-down empty will be empty if an existing ZFS volume does not exist.</p>
<p><strong>Figure 6.3h: Volume to Extend Field</strong></p>
<p><a class="reference internal" href="_images/10000000000002F5000001C1A3854FFC.png"><img alt="10000000000002F5000001C1A3854FFC_png" src="_images/10000000000002F5000001C1A3854FFC.png" style="width: 6.9252in; height: 4.1071in;" /></a></p>
<p><a href="#id160"><span class="problematic" id="id161">**</span></a>NOTE: **
if the existing volume is encrypted, a warning message will remind you that the operation of
extending a volume will reset the passphrase and recovery key. After extending the volume, you should
immediately
<a class="reference external" href="#1.6.3.4.2.CreatinganEncryptedVolume|outline">recreate both</a>
.</p>
<p>Once an existing volume has been selected from the drop-down menu, drag and drop the desired disk(s) and select the desired volume layout. For example you can:</p>
<ul class="simple">
<li>select an SSD or disk with a volume layout of
<em>Log (ZIL)</em>
to add a log device to the ZFS pool. Selecting 2 SSDs or disks will mirror the log device.</li>
<li>select an SSD or disk with a volume layout of
<em>Cache (L2ARC)</em>
to add a cache device to the ZFS pool.</li>
<li>add additional disks to increase the capacity of the ZFS pool. The caveats to doing this are described below.</li>
</ul>
<p>When adding disks to increase the capacity of a volume, ZFS supports the addition of virtual devices, known as vdevs, to an existing ZFS pool. A vdev can be a single disk, a stripe, a mirror, a RAIDZ1, RAIDZ2, or a RAIDZ3.
<strong>Once a vdev is created, you can not add more drives to that vdev</strong>
** **
; however, you can stripe a new vdev (and its disks) with the
<strong>same type of existing vdev</strong>
** **
in order to increase the overall size of ZFS the pool. In other words, when you extend a ZFS volume, you are really striping similar vdevs. Here are some examples:</p>
<ul class="simple">
<li>to extend a ZFS stripe, add one or more disks. Since there is no redundancy, you do not have to add the same amount of disks as the existing stripe.</li>
<li>to extend a ZFS mirror, add the same number of drives. The resulting striped mirror is a RAID
10. For example, if you have 10 drives, you could start by creating a mirror of two drives, extending this mirror by creating another mirror of two drives, and repeating three more times until all 10 drives have been added.</li>
<li>to extend a three drive RAIDZ1, add three additional drives. The result is a RAIDZ+0, similar to RAID 50 on a hardware controller.</li>
<li>to extend a RAIDZ2 requires a minimum of four additional drives. The result is a RAIDZ2+0, similar to RAID 60 on a hardware controller.</li>
</ul>
<p>If you try to add an incorrect number of disks to the existing vdev, an error message will appear, indicating the number of disks that are needed. You will need to select the correct number of disks in order to continue.</p>
</div>
<div class="section" id="id162">
<h4>Creating ZFS Datasets<a class="headerlink" href="#id162" title="Permalink to this headline">¶</a></h4>
<p>An existing ZFS volume can be divided into datasets. Permissions, compression, deduplication, and quotas can be set on a per dataset basis, allowing more granular control over access to storage data. A dataset is similar to a folder in that you can set permissions; it is also similar to a filesystem in that you can set properties such as quotas and compression as well as create snapshots.</p>
<p><strong>NOTE:</strong>
ZFS provides thick provisioning using quotas and thin provisioning using reserved space.</p>
<p>If you select an existing ZFS volume → Create ZFS Dataset, you will see the screen shown in Figure 6.3i.</p>
<p>Once a dataset is created, you can click on that dataset and select Create ZFS Dataset, thus creating a nested dataset, or a dataset within a dataset. You can also create a zvol within a dataset. When creating datasets, double-check that you are using the Create ZFS Dataset option for the intended volume or dataset. If you get confused when creating a dataset on a volume, click all existing datasets to close them&#8211;the remaining Create ZFS Dataset will be for the volume.</p>
<p>Figure 6.3i: Creating a ZFS Dataset</p>
<p>Table 6.3d summarizes the options available when creating a ZFS dataset. Some settings are only available in Advanced Mode. To see these settings, either click the Advanced Mode button or configure the system to always display these settings by checking the box “Show advanced fields by default” in System → Settings → Advanced. These attributes can also be changed after dataset creation in Storage → Volumes →
<a class="reference external" href="#1.6.3.9.ViewingVolumes|outline">View Volumes</a>
.</p>
<p>Table 6.3d: ZFS Dataset Options</p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="10%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Dataset Name</td>
<td>string</td>
<td>mandatory</td>
</tr>
<tr class="row-odd"><td>Compression Level</td>
<td>drop-down menu</td>
<td>see
<a class="reference external" href="#1.6.3.6.2.Compression|outline">Compression</a>
for a comparison of the available algorithms</td>
</tr>
<tr class="row-even"><td>Share type</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>Enable atime</td>
<td>Inherit, On, or Off</td>
<td>controls whether the access time for files is updated when they are read; setting this property to
<em>Off</em>
avoids producing log traffic when
reading files and can result in significant performance gains</td>
</tr>
<tr class="row-even"><td>Quota for
this
dataset</td>
<td>integer</td>
<td>only available in Advanced Mode; default of 0 is off; can specify M (megabyte), G (gigabyte), or T (terabyte) as in
<em>20G</em>
for 20 GB
, can also include a decimal point (e.g.
<em>2.8G</em>
)</td>
</tr>
<tr class="row-odd"><td>Quota for
this
dataset and all children</td>
<td>integer</td>
<td>only available in Advanced Mode; default of
<em>0</em>
is off; can specify M (megabyte), G (gigabyte), or T (terabyte) as in
<em>20G</em>
for 20 GB</td>
</tr>
<tr class="row-even"><td>Reserved space for
this
dataset</td>
<td>integer</td>
<td>only available in Advanced Mode; default of
<em>0</em>
is unlimited (besides hardware); can specify M (megabyte), G (gigabyte), or T (terabyte) as in
<em>20G</em>
for 20 GB</td>
</tr>
<tr class="row-odd"><td>Reserved space for
this
dataset and all children</td>
<td>integer</td>
<td>only available in Advanced Mode; default of
<em>0</em>
is unlimited (besides hardware); can specify M (megabyte), G (gigabyte), or T (terabyte) as in
<em>20G</em>
for 20 GB</td>
</tr>
<tr class="row-even"><td>ZFS Deduplication</td>
<td>drop-down menu</td>
<td>read the section on
<a class="reference external" href="#1.6.3.6.1.Deduplication|outline">deduplication</a>
before making a change to this
setting</td>
</tr>
<tr class="row-odd"><td>Record
Size</td>
<td>drop-down menu</td>
<td>only available in Advanced Mode; while ZFS automatically adapts the record size dynamically to adapt to data, if the data has a fixed size (e.g. a database), setting the
<em>Record Size</em>
may result in better performance</td>
</tr>
</tbody>
</table>
<div class="section" id="id165">
<h5>Deduplication<a class="headerlink" href="#id165" title="Permalink to this headline">¶</a></h5>
<p>The
<em>ZFS Deduplication</em>
option warns that enabling dedup may have drastic performance implications and that compression should be used instead.
Before checking the deduplication box, read the section on deduplication in the
<a class="reference external" href="#1.1.4.7.ZFSOverview|outline">ZFS Overview</a>
first. This
<a class="reference external" href="http://constantin.glez.de/blog/2011/07/zfs-dedupe-or-not-dedupe">article</a>
provides a good description of the value v.s. cost considerations for deduplication.</p>
<p><strong>Unless you have a lot of RAM and a lot of duplicate data, do not change the default deduplication setting of “Off”.</strong>
** **
The dedup tables used during deduplication need ~8 GB of RAM per 1TB of data to be deduplicated. For performance reasons, consider using compression rather than turning this option on.</p>
<p>I
f deduplication is changed to
<em>On</em>
, duplicate data blocks are removed synchronously. The result is that only unique data is stored and common components are shared among files. If deduplication is changed to
<em>Verify</em>
, ZFS will do a byte-to-byte comparison when two blocks have the same signature to make sure that the block contents are identical. Since hash collisions are extremely rare, verify is usually not worth the performance hit.</p>
<p><strong>NOTE:</strong>
once deduplication is enabled, the only way to disable it is to use the
<strong>zfs set dedup=off dataset_name</strong>
command from
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
. However, any data that is already stored as deduplicated will not be un-deduplicated as only newly stored data after the property change will not be deduplicated. The only way to remove existing deduplicated data is to copy all of the data off of the dataset, set the property to off, then copy the data back in again. Alternately, create a new dataset with the
<em>ZFS Deduplication</em>
left as disabled, copy the data to the new dataset, and destroy the original dataset.</p>
</div>
<div class="section" id="id168">
<h5>Compression<a class="headerlink" href="#id168" title="Permalink to this headline">¶</a></h5>
<p>M
ost media (e.g.
<em>.mp3</em>
,
<em>.mp4</em>
,
<em>.avi</em>
) is already compressed, meaning that you will increase CPU utilization for no gain if you store these files on a compressed dataset. However, if you have raw
<em>.wav</em>
rips of CDs or
<em>.vob</em>
rips of DVDs, you will see a performance gain using a compressed dataset. When selecting a compression type, you need to balance performance with the amount of compression. The following compression algorithms are supported:</p>
<ul class="simple">
<li><a href="#id169"><span class="problematic" id="id170">**</span></a>lz4: **
recommended compression method as it allows compressed datasets to operate at near real-time speed.</li>
<li><a href="#id171"><span class="problematic" id="id172">**</span></a>gzip: **
varies from levels 1 to 9 where
<em>gzip fastest</em>
(level 1) gives the least compression and
<em>gzip *
*maximum</em>
(level 9) provides the best compression but is discouraged due to its performance
impact.</li>
<li><a href="#id173"><span class="problematic" id="id174">**</span></a>zle: **
fast and simple algorithm to eliminate runs of zeroes.
* *</li>
<li><a href="#id175"><span class="problematic" id="id176">**</span></a>lzjb: **
provides decent data compression, but is considered deprecated as lz4 provides much better performance.</li>
</ul>
<p>If you leave the default of
<em>Inherit</em>
or select
<em>Off</em>
, compression will not be used on the dataset.</p>
</div>
</div>
<div class="section" id="id177">
<h4>Creating a zvol<a class="headerlink" href="#id177" title="Permalink to this headline">¶</a></h4>
<p>A zvol is a feature of ZFS that creates a block device over ZFS. This allows you to use a zvol as an
<a class="reference external" href="#1.8.7.2.Extents|outline">iSCSI device extent</a>
.</p>
<p>To create a zvol,
select an existing ZFS volume or dataset
→
Create zvol which will open the screen
shown in Figure 6.3j.</p>
<p>The configuration options are described in Table 6.3e. Some settings are only available in Advanced Mode. To see these settings, either click the Advanced Mode button or configure the system to always display these settings by checking the box “Show advanced fields by default” in System → Settings → Advanced.</p>
<p><strong>Figure 6.3j: Creating a zvol</strong></p>
<p><a class="reference internal" href="_images/100000000000023B00000194713ECE99.png"><img alt="100000000000023B00000194713ECE99_png" src="_images/100000000000023B00000194713ECE99.png" style="width: 6.8783in; height: 3.7402in;" /></a></p>
<p><strong>Table 6.3e: zvol Configuration Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="7%" />
<col width="85%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>zvol Name</td>
<td>string</td>
<td>input a name for the zvol</td>
</tr>
<tr class="row-odd"><td>Size for this zvol</td>
<td>integer</td>
<td>specify size and value such as
<em>10G</em></td>
</tr>
<tr class="row-even"><td>Compression level</td>
<td>drop-down menu</td>
<td>default of
<em>Inherit</em>
means it will use the same compression level as the existing zpool used to create the zvol</td>
</tr>
<tr class="row-odd"><td>Sparse volume</td>
<td>checkbox</td>
<td>used to provide thin provisioning; if this option is selected, writes will fail when the pool is low on space</td>
</tr>
<tr class="row-even"><td>Block size</td>
<td>integer</td>
<td>only available in Advanced Mode; valid size is any power of 2 from 512b to 128kb with a default size of 8kb; can be set to match the block size of the filesystem which will be formatted onto the iSCSI target</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="viewing-disks">
<h4>Viewing Disks<a class="headerlink" href="#viewing-disks" title="Permalink to this headline">¶</a></h4>
<p>Storage → Volumes → View Disks allows you to view all of the disks recognized by the FreeNAS® system. An example is shown in Figure 6.3k.</p>
<p><strong>Figure 6.3k: Viewing Disks</strong></p>
<p><a class="reference internal" href="_images/10000000000004E8000001EACF908077.png"><img alt="10000000000004E8000001EACF908077_png" src="_images/10000000000004E8000001EACF908077.png" style="width: 6.9252in; height: 2.7016in;" /></a></p>
<p>For each device, the current configuration of the options described in Table 6.3e is displayed. Click a disk&#8217;s entry and then its Edit button to change its configuration.</p>
<p>Clicking a disk&#8217;s entry will also display its Wipe button which can be used to blank a disk while providing a progress bar of the wipe&#8217;s status. Use this option before discarding a disk.</p>
<p><strong>NOTE:</strong>
should a disk&#8217;s serial number not be displayed in this screen, use the
<strong>smartctl</strong>
command within
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
. For example, to determine the serial number of disk ada0, type
<strong>smartctl -a /dev/ada0 | grep Serial</strong>
.</p>
</div>
<div class="section" id="viewing-volumes">
<h4>Viewing Volumes<a class="headerlink" href="#viewing-volumes" title="Permalink to this headline">¶</a></h4>
<p>If you click Storage → Volumes → View Volumes, you can view and further configure existing volumes, ZFS datasets, and zvols. The example shown in Figure 6.3l demonstrates one ZFS volume with two datasets and one zvol.</p>
<p>Buttons are provided to provide quick access to
<a class="reference external" href="#1.6.3.4.ZFSVolumeManager|outline">ZFS Volume Manager</a>
,
<a class="reference external" href="#1.6.3.3.UFSVolumeManager|outline">UFS Volume Manager</a>
,
<a class="reference external" href="#1.6.3.2.ImportingVolumes|outline">Import</a>
<a class="reference external" href="#1.6.3.2.ImportingVolumes|outline">Volume</a>
,
<a class="reference external" href="#1.6.3.1.AutoImportingVolumes|outline">Auto Import Volume</a>
, and
<a class="reference external" href="#1.6.3.9.ViewingDisks|outline">View Disks</a>
. If the system has multipath-capable hardware, an extra
button will be added to
<a class="reference external" href="#1.6.3.11.ViewingMultipaths|outline">View Multipaths</a>
.</p>
<p><strong>Figure 6.3l: Viewing Volumes</strong></p>
<p><a class="reference internal" href="_images/10000000000003D6000001C4C62B96CF.png"><img alt="10000000000003D6000001C4C62B96CF_png" src="_images/10000000000003D6000001C4C62B96CF.png" style="width: 6.9252in; height: 3.1866in;" /></a></p>
<p>If you click the entry for a ZFS volume, eight icons will appear at the bottom of the screen. In order from left to right, these icons allow you to:</p>
<ol class="arabic">
<li><p class="first"><strong>Detach Volume:</strong>
allows you to either detach a disk before removing it from the system (also known as a ZFS export) or to delete the contents of the volume, depending upon the choice you make in the screen that pops up when you click this button. The pop-up message, seen in Figure 6.3m, will show the current used space, provide the check box “Mark the disks as new (destroy data)”, prompt you to make sure that you want to do this, warn you if the volume has any associated shares and ask if you wish to delete them, and the browser will turn red to alert you that you are about to do something that will make the data inaccessible.
<a href="#id183"><span class="problematic" id="id184">**</span></a>If you do not check the box to mark the disks as new, the volume will be exported (ZFS volumes only). **
This means that the data is not destroyed and the volume can be re-imported at a later time. If you will be moving a ZFS drive from one system to another, perform this
<a class="reference external" href="http://docs.huihoo.com/opensolaris/solaris-zfs-administration-guide/html/ch04s06.html">export</a>
action first. This operation flushes any unwritten data to disk, writes data to the disk indicating that the export was done, and removes all knowledge of the pool from the system.
<a href="#id185"><span class="problematic" id="id186">**</span></a>If you do check the box to mark the disks as new, the volume and all of its data, datasets, and zvols will be destroyed and the underlying disks will be returned to their raw state. **</p>
</li>
<li><p class="first"><strong>Scrub Volume:</strong></p>
<p>ZFS scrubs and how to schedule them are described in more detail in
<a class="reference external" href="#1.6.4.ZFSScrubs|outline">ZFS</a>
<a class="reference external" href="#1.6.4.ZFSScrubs|outline">Scrubs</a>
. This button allows you to manually initiate a scrub. A scrub is I/O intensive and can negatively impact performance, meaning that you should not initiate one while the system is busy. A cancel button is provided should you need to cancel a scrub.</p>
</li>
</ol>
<p><a href="#id188"><span class="problematic" id="id189">**</span></a>NOTE: **
if you do cancel a scrub, the next scrub will start over from the beginning, not where the cancelled scrub left off.</p>
<p><strong>Figure 6.3m: Detaching or Deleting a Volume</strong></p>
<p><a class="reference internal" href="_images/100000000000032B00000215E25408A6.png"><img alt="100000000000032B00000215E25408A6_png" src="_images/100000000000032B00000215E25408A6.png" style="width: 6.9252in; height: 4.5508in;" /></a></p>
<ol class="arabic simple">
<li><strong>Edit ZFS Options:</strong>
allows you to edit the volume&#8217;s compression level, atime setting, dataset quota, and reserved space for quota. If compression is newly enabled on a volume or dataset that already contains data, existing files will not be compressed until they are modified as compression is only applied when a file is written.</li>
<li><a href="#id190"><span class="problematic" id="id191">**</span></a>Create ZFS Dataset: **
allows you to create a dataset.</li>
<li><a href="#id192"><span class="problematic" id="id193">**</span></a>Create zvol: **
allows you to create a zvol to use as an iSCSI device extent.</li>
<li><strong>Change Permissions:</strong>
allows you to edit the volume&#8217;s user, group, Unix rwx permissions, type of ACL,
and to enable recursive permissions on the volume&#8217;s subdirectories.</li>
<li><strong>Create Snapshot:</strong>
allows you to configure the snapshot&#8217;s name and whether or not it is recursive before manually creating a one-time snapshot. If you wish to schedule the regular creation of snapshots, instead create a
<a class="reference external" href="#1.6.1.PeriodicSnapshotTasks|outline">periodic snapshot task</a>
.</li>
<li><strong>Volume Status:</strong>
a
s seen in the example in Figure 6.3n, this screen shows the device name and status of each disk in the ZFS pool as well as any read, write, or checksum errors.
It also indicates the status of the latest
<a class="reference external" href="#1.6.4.ZFSScrubs|outline">ZFS scrub</a>
. If you click the entry for a device, buttons will appear to edit the device&#8217;s options (shown in Figure 6.3o), offline the device, or replace the device (as described in
<a class="reference external" href="#1.6.3.12.ReplacingaFailedDriveorSSD|outline">Replacing a Failed Drive</a>
).</li>
</ol>
<p>Figure 6.3n: Volume Status</p>
<p><a class="reference internal" href="_images/100000000000028F000001982A79D88A.png"><img alt="100000000000028F000001982A79D88A_png" src="_images/100000000000028F000001982A79D88A.png" style="width: 6.822in; height: 4.2492in;" /></a></p>
<p>If you click a disk in Volume Status and click its “Edit Disk” button, you will see the screen shown in Figure 6.3o. Table 6.3f summarizes the configurable options.</p>
<p>Figure 6.3o: Editing a Disk</p>
<p><a class="reference internal" href="_images/1000000000000181000001977D3920D2.jpg"><img alt="1000000000000181000001977D3920D2_jpg" src="_images/1000000000000181000001977D3920D2.jpg" style="width: 4.639in; height: 3.7689in;" /></a></p>
<p>Table 6.3f: Disk</p>
<p><strong>Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="29%" />
<col width="8%" />
<col width="62%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Name</td>
<td>string</td>
<td>read-only value showing FreeBSD device name for disk</td>
</tr>
<tr class="row-odd"><td>Serial</td>
<td>string</td>
<td>read-only value showing the disk&#8217;s serial number</td>
</tr>
<tr class="row-even"><td>Description</td>
<td>string</td>
<td>optional</td>
</tr>
<tr class="row-odd"><td>HDD Standby</td>
<td>drop-down menu</td>
<td>indicates the time of inactivity (in minutes) before the drive enters standby mode in order to conserve energy; this
<a class="reference external" href="http://forums.freenas.org/showthread.php?2068-How-to-find-out-if-a-drive-is-spinning-down-properly">forum post</a>
demonstrates how to determine if a drive has spun down</td>
</tr>
<tr class="row-even"><td>Advanced Power Management</td>
<td>drop-down menu</td>
<td>default is
<em>Disabled</em>
, can select a power management profile from the menu</td>
</tr>
<tr class="row-odd"><td>Acoustic Level</td>
<td>drop-down menu</td>
<td>default is
<em>Disabled</em>
, can be modified for disks that understand
<a class="reference external" href="http://en.wikipedia.org/wiki/Automatic_acoustic_management">AAM</a></td>
</tr>
<tr class="row-even"><td>Enable
<a class="reference external" href="http://en.wikipedia.org/wiki/S.M.A.R.T.">S.M.A.R.T</a></td>
<td>checkbox</td>
<td>enabled by default if the disk supports S.M.A.R.T.; unchecking this box will disable any configured
<a class="reference external" href="#1.4.6.S.M.A.R.T.Tests|outline">S.M.A.R.T. Tests</a>
for the disk</td>
</tr>
<tr class="row-odd"><td>S.M.A.R.T. extra options</td>
<td>string</td>
<td><a class="reference external" href="http://smartmontools.sourceforge.net/man/smartctl.8.html">smartctl(8)</a>
options</td>
</tr>
</tbody>
</table>
<p><strong>NOTE:</strong>
versions of FreeNAS® prior to 8.3.1 required a reboot in order to apply changes to the HDD Standby, Advanced Power Management, and Acoustic Level settings. As of 8.3.1, changes to these settings are applied immediately.</p>
<p>A ZFS dataset only has five icons as the scrub volume, create ZFS volume, and volume status buttons
only apply to volumes. In a dataset, the Detach Volume button is replaced with the Destroy Dataset button. If you click the Destroy Dataset button, the browser will turn red to indicate that this is a destructive action. The pop-up warning message will warn that destroying the dataset will delete all of the files and snapshots of that dataset.</p>
<div class="section" id="key-management-for-encrypted-volumes">
<h5>Key Management for Encrypted Volumes<a class="headerlink" href="#key-management-for-encrypted-volumes" title="Permalink to this headline">¶</a></h5>
<p>If you check the “Enable full disk encryption” box during the creation of a ZFS volume, five encryption icons will be added to the icons that are typically seen when
<a class="reference external" href="#1.6.3.7.ViewingVolumes|outline">viewing a volume</a>
. An example is seen in Figure 6.3p.</p>
<p><strong>Figure 6.3p: Encryption Icons Associated with an Encrypted ZFS Volume</strong></p>
<p><a class="reference internal" href="_images/1000000000000377000001F18C3BCAE8.png"><img alt="1000000000000377000001F18C3BCAE8_png" src="_images/1000000000000377000001F18C3BCAE8.png" style="width: 6.9252in; height: 3.8799in;" /></a></p>
<p>These icons are used to:</p>
<p><strong>Create/Change Passphrase:</strong>
click this icon to set and confirm the passphrase associated with the GELI encryption key.
<strong>Remember this passphrase as you can not re-import an encrypted volume without it.</strong>
** **
In other words, if you forget the passphrase, it is possible for the data on the volume to become inaccessible. An example would be a failed USB stick that requires a new installation on a new USB stick and a re-import of the existing pool, or the physical removal of disks when moving from an older hardware system to a new system. Protect this passphrase as anyone who knows it could re-import your encrypted volume, thus thwarting the reason for encrypting the disks in the first place.</p>
<p>When you click this icon, a red warning is displayed:
<em>Remember to add a new recovery key as this action invalidates the previous recovery key.</em>
Setting a passphrase invalidates the existing key. Once you set the passphrase, immediately click the
<em>Add recovery key</em>
button to create a new recovery key. Once the passphrase is set, the name of this icon will change to Change Passphrase.</p>
<p><strong>Download Key:</strong>
click this icon to download a backup copy of the GELI encryption key. Since the GELI encryption key is separate from the FreeNAS® configuration database,
<strong>it is highly recommended to make a backup of the key. If the key is every lost or destroyed and there is no **
**backup key, the data on the disks is inaccessible.</strong>
** **</p>
<p><strong>Encryption Re-key:</strong>
generates a new GELI encryption key. Typically this is only performed when the administrator suspects that the current key may be compromised.
This action also removes the current passphrase
.</p>
<p><strong>Add recovery key:</strong>
generates a new recovery key and prompts for a location to download a backup copy of the recovery key. This recovery key can be used if the passphrase is forgotten.
<strong>Always immediately</strong>
** **
add a recovery key whenever the passphrase is changed.</p>
<p><strong>Remove recover key:</strong>
Typically this is only performed when the administrator suspects that the current recovery key may be compromised.
<strong>Immediately</strong>
** **
create a new passphrase and recovery key.</p>
<p>Each of these icons will prompt for the password used to access the FreeNAS® administrative GUI.</p>
</div>
</div>
<div class="section" id="setting-permissions">
<h4>Setting Permissions<a class="headerlink" href="#setting-permissions" title="Permalink to this headline">¶</a></h4>
<p>Setting permissions is an important aspect of configuring volumes. The graphical administrative interface is meant to set the
<strong>initial</strong>
permissions for a volume or dataset in order to make it available as a share. Once a share is available, the client operating system should be used to fine-tune the permissions of the files and directories that are created by the client.</p>
<p><a class="reference external" href="#1.7.SharingConfiguration|outline">Sharing</a>
contains configuration examples for several types of permission scenarios. This section provides an overview of the screen that is used to set permissions.</p>
<p>Once a volume or dataset is created, it will be listed by its mount point name in Storage →
Volumes →
View Volumes. If you click the Change Permissions icon for a specific volume/dataset, you will see the screen shown in Figure 6.3q. Table 6.3g summarizes the options in this screen.</p>
<p>Figure 6.3q: Changing Permissions on a Volume or Dataset</p>
<p><a class="reference internal" href="_images/10000000000001720000018E06DDC591.png"><img alt="10000000000001720000018E06DDC591_png" src="_images/10000000000001720000018E06DDC591.png" style="width: 3.8535in; height: 4.1453in;" /></a></p>
<p><strong>Table 6.3g: Options When Changing Permissions</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="10%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Owner (user)</td>
<td>drop-down menu</td>
<td>user to control the volume/dataset; users which were manually created or imported from Active Directory or LDAP will appear in drop-down menu</td>
</tr>
<tr class="row-odd"><td>Owner (group)</td>
<td>drop-down menu</td>
<td>group to control the volume/dataset; groups which were manually created or imported from Active Directory or LDAP will appear in drop-down</td>
</tr>
<tr class="row-even"><td>Mode</td>
<td>checkboxes</td>
<td>check the desired
<strong>Unix</strong>
permissions for user, group, and other</td>
</tr>
<tr class="row-odd"><td>Type of ACL</td>
<td>bullet selection</td>
<td>Unix and Windows ACLs are mutually exclusive, this means that
<strong>you must select the correct type of ACL to match the share</strong>
; see the paragraphs below this Table for more details</td>
</tr>
<tr class="row-even"><td>Set permission recursively</td>
<td>checkbox</td>
<td>if checked, permissions will also apply to subdirectories of the volume or dataset; if data already exists on the volume/dataset,
<a href="#id198"><span class="problematic" id="id199">**</span></a>it is recommended to instead change the permissions recursively on the client side to **
<a href="#id200"><span class="problematic" id="id201">**</span></a>prevent a performance lag on the FreeNAS® system **</td>
</tr>
</tbody>
</table>
<p>When in doubt, or if you have a mix of operating systems in your network, select Unix ACLs as all clients understand them. Windows ACLs are appropriate when the network contains only Windows clients and are the preferred option within an Active Directory domain. Windows ACLs add a superset of permissions that augment those provided by Unix ACLs. While Windows clients also understand Unix ACLs, they won&#8217;t benefit from the extra permissions provided by Active Directory and Windows ACLs when Unix ACLs are used.</p>
<p>I
f you change your mind about the type of ACL, you do not have to recreate the volume. That is, existing data is not lost if the type of ACL is changed. However, if you change from Windows ACLs to Unix ACLs, the extended permissions provided by Windows ACLs will be removed from the existing files.</p>
<p>When you select Windows ACLs, the
<em>Mode</em>
will become greyed out as it only applies to Unix permissions. The default Windows ACLs are always set to what Windows sets on new files and directories by default. The Windows client should then be used to fine-tune the permissions as required.</p>
</div>
<div class="section" id="viewing-multipaths">
<h4>Viewing Multipaths<a class="headerlink" href="#viewing-multipaths" title="Permalink to this headline">¶</a></h4>
<p>FreeNAS® uses
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=gmultipath">gmultipath(8)</a>
to provide
<a class="reference external" href="http://en.wikipedia.org/wiki/Multipath_I/O">multipath I/O</a>
support on systems containing hardware that is capable of multipath. An example would be a dual SAS expander backplane in the chassis or an external JBOD.</p>
<p>Multipath hardware adds fault tolerance to a NAS as the data is still available even if one disk I/O path has a failure.</p>
<p>FreeNAS® automatically detects active/active and active/passive multipath-capable hardware. Any multipath-capable devices that are detected will be placed in multipath units with the parent devices hidden. The configuration will be displayed in Storage → Volumes → View Multipaths, as seen in the example in Figure 6.3r. Note that this option will not be displayed in the Storage → Volumes tree on systems that do not contain multipath-capable hardware.</p>
<p><strong>Figure 6.3r: Viewing Multipaths</strong></p>
<p><a class="reference internal" href="_images/1000020100000398000000DC97182069.png"><img alt="1000020100000398000000DC97182069_png" src="_images/1000020100000398000000DC97182069.png" style="width: 6.9252in; height: 1.6736in;" /></a></p>
<p>Figure 6.3q provides an example of a system with a SAS ZIL and a SAS hard drive. The ZIL device is capable of active/active writes, whereas the hard drive is capable of active/read.</p>
</div>
<div class="section" id="id202">
<h4>Replacing a Failed Drive<a class="headerlink" href="#id202" title="Permalink to this headline">¶</a></h4>
<p>If you are using any form of redundant RAID, you should replace a failed drive as soon as possible to repair the degraded state of the RAID. Depending upon the capability of your hardware, you may or may not need to reboot in order to replace the failed drive. AHCI capable hardware does not require a reboot.</p>
<p><strong>NOTE:</strong>
a stripe (RAID0) does not provide redundancy. If you lose a disk in a stripe, you will need to recreate the volume and restore the data from backup.</p>
<p>Before physically removing the failed device, go to Storage → Volumes → View Volumes → Volume Status and locate the failed disk. Once you have located the failed device in the GUI, perform the
following steps:</p>
<ol class="arabic simple">
<li>If the disk is formatted with ZFS, click the disk&#8217;s entry then its “Offline” button in order to change that disk&#8217;s status to OFFLINE. This step is needed to properly remove the device from the ZFS pool and to prevent swap issues. If your hardware supports hot-pluggable disks, click the disk&#8217;s “Offline” button, pull the disk, then skip to step 3. If there is no “Offline” button but only a “Replace” button, then the disk is already offlined and you can safely skip this step.</li>
</ol>
<p><strong>NOTE:</strong>
if the process of changing the disk&#8217;s status to OFFLINE fails with a “disk offline failed - no valid replicas” message, you will need to scrub the ZFS volume first using its Scrub Volume button in Storage → Volumes → View Volumes. Once the scrub completes, try to Offline the disk again before proceeding.</p>
<ol class="arabic simple">
<li>If the hardware is not AHCI capable, shutdown the system in order to physically replace the disk. When finished, return to the GUI and locate the OFFLINE disk.</li>
<li>Once the disk is showing as OFFLINE, click the disk again and then click its “Replace” button. Select the replacement disk from the drop-down menu and click the “Replace Disk” button. If the disk is a member of an encrypted ZFS pool, you will be prompted to input the passphrase for the pool. Once you click the “Replace Disk” button, the ZFS pool will start to resilver. You can use the
<strong>zpool status</strong>
command in
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
to monitor the status of the resilvering.</li>
<li>If the replaced disk continues to be listed after resilvering is complete, click its entry and use the “Detach” button to remove the disk from the list.</li>
</ol>
<p>In the example shown in Figure 6.3s, a failed disk is being replaced by disk
<a href="#id204"><span class="problematic" id="id205">*</span></a>ada2 *
in the
volume named
* *
<a href="#id206"><span class="problematic" id="id207">*</span></a>volume1. *</p>
<p><strong>Figure 6.3s: Replacing a Failed Disk</strong></p>
<p><a class="reference internal" href="_images/100000000000026B000001F2DE16903D.png"><img alt="100000000000026B000001F2DE16903D_png" src="_images/100000000000026B000001F2DE16903D.png" style="width: 6.4465in; height: 5.1866in;" /></a></p>
<div class="section" id="replacing-a-failed-drive-in-an-encrypted-pool">
<h5>Replacing a Failed Drive in an Encrypted Pool<a class="headerlink" href="#replacing-a-failed-drive-in-an-encrypted-pool" title="Permalink to this headline">¶</a></h5>
<p>If the ZFS pool is encrypted, additional steps are needed when replacing a failed drive.</p>
<p>First, make sure that a
<a class="reference external" href="#1.6.3.4.2.CreatinganEncryptedVolume|outline">passphrase has been set</a></p>
<p><strong>before</strong>
** **
attempting to replace the failed drive. Then, follow the steps 1 and 2 as described above. During step 3, you will be prompted to input the passphrase for the pool. Wait until the resilvering is complete.</p>
<p>Next, restore the encryption keys to the pool.
<strong>If the following additional steps are not performed before the next reboot, you may lose access to the pool permanently.</strong>
** **</p>
<ol class="arabic simple">
<li>Highlight the pool that contains the disk you just replaced and click the “Encryption Re-key” button in the GUI. You will need to enter the
<em>root</em>
password.</li>
<li>Highlight the pool that contains the disk you just replaced and click the “Create Passphrase” button and enter the new passphrase. You can reuse the old passphrase if desired.</li>
<li>Highlight the pool that contains the disk you just replaced and click the “Download Key” button in order to save the new encryption key. Since the old key will no longer function, any old keys can be safely discarded.</li>
<li>Highlight the pool that contains the disk you just replaced and click the “Add Recovery Key” button in order to save the new recovery key. The old recovery key will no longer function, so it can be safely discarded.</li>
</ol>
</div>
<div class="section" id="removing-a-log-or-cache-device">
<h5>Removing a Log or Cache Device<a class="headerlink" href="#removing-a-log-or-cache-device" title="Permalink to this headline">¶</a></h5>
<p>If you have added any log or cache devices, these devices will also appear in Storage → Volumes → View Volumes → Volume Status. If you click the device, you can either use its &#8220;Replace&#8221; button to replace the device as described above, or click its &#8220;Remove&#8221; button to remove the device.</p>
<p>Before performing either of these operations, verify the version of ZFS running on the system by running
<strong>zpool upgrade -v|more</strong>
from
<a class="reference external" href="#1.12.2.Shell|outline">Shell</a>
.</p>
<p>If the pool is running ZFSv15, and a non-mirrored log device fails, is replaced, or removed, the pool is unrecoverable and the pool must be recreated and the data restored from a backup. For other ZFS versions, removing or replacing the log device will lose any data in the device which had not yet been written. This is typically the last few seconds of writes.</p>
<p>Removing or replacing a cache device will not result in any data loss, but may have an impact on read performance until the device is replaced.</p>
</div>
</div>
<div class="section" id="replacing-drives-to-grow-a-zfs-pool">
<h4>Replacing Drives to Grow a ZFS Pool<a class="headerlink" href="#replacing-drives-to-grow-a-zfs-pool" title="Permalink to this headline">¶</a></h4>
<p>The recommended method for expanding the size of a ZFS pool is to pre-plan the number of disks in a vdev and to stripe additional vdevs using the
<a class="reference external" href="#1.6.3.5.ExtendingaZFSVolume|outline">ZFS Volume Manager</a>
as additional capacity is needed.</p>
<p>However, this is not an option if you do not have open drive ports or the ability to add a SAS/SATA HBA card. In this case, you can replace one disk at a time with a larger disk, wait for the resilvering process to incorporate the new disk into the pool completes, then repeat with another disk until all of the disks have been replaced. This process is slow and places the system in a degraded state. Since a failure at this point could be disastrous,
<strong>do not attempt this method unless the system has a reliable backup.</strong>
** **</p>
<p><strong>NOTE:</strong>
this method requires the ZFS property autoexpand. This property became available starting with FreeNAS® version 8.3.0. If you are running an earlier version of FreeNAS®, upgrade before attempting this method.</p>
<p>Check and verify that the autoexpand property is enabled
<strong>before</strong>
** **
attempting to grow the pool. If it is not, the pool will not recognize that the disk capacity has increased. By default, this property is enabled in FreeNAS® versions 8.3.1 and higher. To verify the property, use
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
. This example checks the ZFS volume named
<em>Vol1</em>
:</p>
<p><strong>zpool get all Vol1</strong></p>
<p>NAME
PROPERTY
VALUE
SOURCE</p>
<p>Vol1
size
4.53T
-</p>
<p>Vol1
capacity
31%
-</p>
<p>Vol1
altroot
/mnt
local</p>
<p>Vol1
health
ONLINE
-</p>
<p>Vol1
guid
8068631824452460057
default</p>
<p>Vol1
version
28
default</p>
<p>Vol1
bootfs
-
default</p>
<p>Vol1
delegation
on
default</p>
<p>Vol1
autoreplace
off
default</p>
<p>Vol1
cachefile
/data/zfs/zpool.cache
local</p>
<p>Vol1
failmode
wait
default</p>
<p>Vol1
listsnapshots
off
default</p>
<p><strong>Vol1 **
**autoexpand **
**on **
**local</strong></p>
<p>Vol1
dedupditto
0
default</p>
<p>Vol1
dedupratio
1.00x
-</p>
<p>Vol1
free
3.12T
-</p>
<p>Vol1
allocated
1.41T
-</p>
<p>Vol1
readonly
off
-</p>
<p>Vol1
comment
-
default</p>
<p>If autoexpansion is not enabled, enable it by specifying the name of the ZFS volume:</p>
<p><strong>zpool set autoexpand=on Vol1</strong></p>
<p>Verify that autoexpand is now enabled by repeating
<strong>zpool get all Vol1</strong>
.</p>
<p>You are now ready to replace one drive with a larger drive using the instructions in
<a class="reference external" href="#1.6.3.12.ReplacingaFailedDriveorSSD|outline">Replacing a Failed Drive</a>
.</p>
<p>Replace one drive at a time and wait for the resilver process to complete on the replaced drive before replacing the next drive. Once all the drives are replaced and the resilver completes, you should see the added space in the pool.</p>
<p>You can view the status of the resilver process by running
<strong>zpool status Vol1</strong>
.</p>
<div class="section" id="enabling-zfs-pool-expansion-after-drive-replacement">
<h5>Enabling ZFS Pool Expansion After Drive Replacement<a class="headerlink" href="#enabling-zfs-pool-expansion-after-drive-replacement" title="Permalink to this headline">¶</a></h5>
<p>It is recommended to enable the autoexpand property before you start replacing drives. If the property is not enabled before replacing some or all of the drives, extra configuration is needed to inform ZFS of the expanded capacity.</p>
<p>Verify that autoexpand is set as described in the previous section. Then, bring each of the drives back online with the following command, replacing the volume name and
GPT ID for each disk in the ZFS pool:</p>
<p><strong>zpool online -e Vol1 gptid/xxx</strong></p>
<p>Online one drive at a time and check the status using the following example. If a drive starts to resilver, you need to wait for the resilver to complete before proceeding to online the next drive.</p>
<p>To find the GPT ID information for the drives, use
<strong>zpool status [Pool_Name]</strong>
which will also show you if any drives are failed or in the process of being resilvered:</p>
<p><strong>zpool status Vol1</strong></p>
<p>pool: Vol1</p>
<p>state: ONLINE</p>
<p>scan: scrub repaired 0 in 16h24m with 0 errors on Sun Mar 10 17:24:20 2013</p>
<p>config:</p>
<p>NAME
STATE
READ WRITE CKSUM</p>
<p>Vol1
ONLINE
0
0
0</p>
<p>raidz1-0
ONLINE
0
0
0</p>
<p>gptid/d5ed48a4-634a-11e2-963c-00e081740bfe
ONLINE
0
0
0</p>
<p>gptid/03121538-62d9-11e2-99bd-00e081740bfe
ONLINE
0
0
0</p>
<p>gptid/252754e1-6266-11e2-8088-00e081740bfe
ONLINE
0
0
0</p>
<p>gptid/9092045a-601d-11e2-892e-00e081740bfe
ONLINE
0
0
0</p>
<p>gptid/670e35bc-5f9a-11e2-92ca-00e081740bfe
ONLINE
0
0
0</p>
<p>errors: No known data errors</p>
<p>After onlining all of the disks, type
<strong>zpool status</strong>
to see if the drives start to resilver. If this happens, wait for the resilvering process to complete.</p>
<p>Next, export and then import the pool:</p>
<p><strong>zpool export Vol1</strong></p>
<p><strong>zpool import -R /mnt Vol1</strong></p>
<p>Once the import completes, all of the drive space should be available. Verify that the increased size is recognized:</p>
<p><strong>zpool list Vol1</strong></p>
<p>NAME
SIZE
ALLOC
FREE
CAP
DEDUP
HEALTH
ALTROOT</p>
<p>Vol1
9.06T
1.41T
7.24T
31%
1.00x
ONLINE
/mnt</p>
<p>If you cannot see the extra space, you may need to run
<strong>zpool online -e &lt;pool&gt; &lt;device&gt;</strong>
for every device listed in
<strong>zpool status</strong>
.</p>
</div>
</div>
<div class="section" id="splitting-a-mirrored-zfs-storage-pool">
<h4>Splitting a Mirrored ZFS Storage Pool<a class="headerlink" href="#splitting-a-mirrored-zfs-storage-pool" title="Permalink to this headline">¶</a></h4>
<p>ZFSv28 provides the ability to to split a
<strong>mirrored</strong>
** **
storage pool, which detaches a disk or disks in the original ZFS volume in order to create another identical ZFS volume on another system.</p>
<p><strong>NOTE:</strong>
zpool split only works on mirrored ZFS volumes.</p>
<p>In this example, a ZFS mirror named
<em>test</em>
contains three drives:</p>
<p><strong>zpool status</strong></p>
<p>pool: test</p>
<p>state: ONLINE</p>
<p>scan: resilvered 568K in 0h0m with 0 errors on Wed Jul
6 16:10:58 2011</p>
<p>config:</p>
<p>NAME
STATE
READ WRITE CKSUM</p>
<p>test
ONLINE
0
0
0</p>
<p>mirror-0
ONLINE
0
0
0</p>
<p>da1
ONLINE
0
0
0</p>
<p>da0
ONLINE
0
0
0</p>
<p>da4
ONLINE
0
0
0</p>
<p>The following command splits from the existing three disk mirror
<em>test</em>
a new ZFS volume named
<em>migrant</em>
containing one disk,
<em>da4</em>
. Disks
<em>da0</em>
and
<em>da1</em>
remain in
<em>test</em>
.</p>
<p><strong>zpool split test migrant da4</strong></p>
<p>At this point,
<em>da4</em>
can be physically removed and installed to a new system as the new pool is exported as it is created. Once physically installed, import the identical pool on the new system:</p>
<p><strong>zpool import migrant</strong></p>
<p>This makes the ZFS volume
<em>migrant</em>
available with a single disk. Be aware that properties come along with the clone, so the new pool will be mounted where the old pool was mounted if the mountpoint property was set on the original pool.</p>
<p>Verify the status of the new pool:</p>
<p><strong>zpool status</strong></p>
<p>pool: migrant</p>
<p>state: ONLINE</p>
<p>scan: resilvered 568K in 0h0m with 0 errors on Wed Jul
6 16:10:58 2011</p>
<p>config:</p>
<p>NAME
STATE
READ WRITE CKSUM</p>
<p>migrant
ONLINE
0
0
0</p>
<p>da4
ONLINE
0
0
0</p>
<p>errors: No known data errors</p>
<p>On the original system, the status now looks like this:</p>
<p><strong>zpool status</strong></p>
<p>pool: test</p>
<p>state: ONLINE</p>
<p>scan: resilvered 568K in 0h0m with 0 errors on Wed Jul
6 16:10:58 2011</p>
<p>config:</p>
<p>NAME
STATE
READ WRITE CKSUM</p>
<p>test
ONLINE
0
0
0</p>
<p>mirror-0
ONLINE
0
0
0</p>
<p>da1
ONLINE
0
0
0</p>
<p>da0
ONLINE
0
0
0</p>
<p>errors: No known data errors</p>
<p>At this point, it is recommended to add disks to create a full mirror set. This example adds two disks named
<em>da2</em>
and
<em>da3</em>
:</p>
<p><strong>zpool attach migrant da4 da2</strong></p>
<p><strong>zpool attach migrant da4 da3</strong></p>
<p>The
<em>migrant</em>
volume now looks like this:</p>
<p><strong>zpool status</strong></p>
<p>pool: migrant</p>
<p>state: ONLINE</p>
<p>scan: resilvered 572K in 0h0m with 0 errors on Wed Jul
6 16:43:27 2011</p>
<p>config:</p>
<p>NAME
STATE
READ WRITE CKSUM</p>
<p>migrant
ONLINE
0
0
0</p>
<p>mirror-0
ONLINE
0
0
0</p>
<p>da4
ONLINE
0
0
0</p>
<p>da2
ONLINE
0
0
0</p>
<p>da3
ONLINE
0
0
0</p>
<p>Now that the new system has been cloned, you can detach
<em>da4</em>
and install it back to the original system. Before physically removing the disk, run this command on the new system:</p>
<p><strong>zpool detach migrant da4</strong></p>
<p>Once the disk is physically re-installed, run this command on the original system:</p>
<p><strong>zpool attach orig da0 da4</strong></p>
<p>Should you ever need to create a new clone, remember to remove the old clone first:</p>
<p><strong>zpool destroy migrant</strong></p>
</div>
</div>
<div class="section" id="id212">
<h3>ZFS Scrubs<a class="headerlink" href="#id212" title="Permalink to this headline">¶</a></h3>
<p>Storage → ZFS Scrubs allows you to schedule and manage scrubs on a ZFS volume. Performing a ZFS scrub on a regular basis helps to identify data integrity problems, detects silent data corruptions caused by transient hardware issues, and provides early alerts to disk failures. If you have consumer-quality drives, consider a weekly scrubbing schedule. If you have datacenter-quality drives, consider a monthly scrubbing schedule.</p>
<p>D
epending upon the amount of data, a scrub can take a long time. Scrubs are I/O intensive and can negatively impact performance. They should be scheduled for evenings or weekends to minimize the impact to users.</p>
<p>A ZFS scrub only checks used disk space. To check unused disk space, schedule a
<a class="reference external" href="#1.4.6.S.M.A.R.T.Tests|outline">S.M.A.R.T. Test</a></p>
<p><em>Type</em>
of
<em>Long Self-Test</em>
to run once or twice a month.</p>
<p>When you create a volume that is formatted with ZFS, a ZFS scrub is automatically scheduled for you. An entry of the same volume name is added to Storage → ZFS Scrubs and a summary of this entry can be viewed in Storage → ZFS Scrubs → View ZFS Scrubs. Figure 6.4a displays the default settings for the volume named
<a href="#id213"><span class="problematic" id="id214">*</span></a>volume1. *
Table 6.4a summarizes the options in this screen.</p>
<p><strong>Figure 6.4a: Viewing a Volume&#8217;s Default Scrub Settings</strong></p>
<p><a class="reference internal" href="_images/10000000000003780000016DE5BE4BC7.png"><img alt="10000000000003780000016DE5BE4BC7_png" src="_images/10000000000003780000016DE5BE4BC7.png" style="width: 6.9252in; height: 2.8457in;" /></a></p>
<p><strong>Table 6.4a: ZFS Scrub Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="10%" />
<col width="84%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Volume</td>
<td>drop-down menu</td>
<td>select ZFS volume to scrub</td>
</tr>
<tr class="row-odd"><td>Threshold days</td>
<td>integer</td>
<td>number of days since the last scrub completed before the next scrub can occur, regardless of the calendar schedule; the default is a multiple of 7 which should ensure that the scrub always occurs on the same day of the week</td>
</tr>
<tr class="row-even"><td>Description</td>
<td>string</td>
<td>optional</td>
</tr>
<tr class="row-odd"><td>Minute</td>
<td>slider or
minute selections</td>
<td>if use the slider, scrub occurs every N minutes; if use minute selections, scrub starts at the highlighted minutes</td>
</tr>
<tr class="row-even"><td>Hour</td>
<td>slider or hour selections</td>
<td>if use the slider, scrub occurs every N hours; if use hour selections, scrub occurs at the highlighted hours</td>
</tr>
<tr class="row-odd"><td>Day of Month</td>
<td>slider or month selections</td>
<td>if use the slider, scrub occurs every N days; if use month selections, scrub occurs on the highlighted days of the selected months</td>
</tr>
<tr class="row-even"><td>Month</td>
<td>checkboxes</td>
<td>scrub occurs on the selected months</td>
</tr>
<tr class="row-odd"><td>Day of week</td>
<td>checkboxes</td>
<td>scrub occurs on the selected days; default is
<em>Sunday</em>
to least impact users</td>
</tr>
<tr class="row-even"><td>Enabled</td>
<td>checkbox</td>
<td>uncheck to disable the scheduled scrub without deleting it</td>
</tr>
</tbody>
</table>
<p>You should review the default selections and, if necessary, modify them to meet the needs of your environment.</p>
<p>While a delete button is provided,
<strong>deleting a scrub is not recommended as a scrub provides an early indication of disk issues that could lead to a disk failure.</strong>
If you find that a scrub is too intensive for your hardware, consider disabling the scrub as a temporary measure until the hardware can be upgraded.</p>
<p>If you do delete a scrub, you can create a new scrub task by clicking Storage → Volumes → ZFS Scrubs → Add ZFS Scrub.</p>
</div>
</div>
<div class="section" id="sharing-configuration">
<h2>Sharing Configuration<a class="headerlink" href="#sharing-configuration" title="Permalink to this headline">¶</a></h2>
<p>Once you have a volume, create at least one share so that the storage is accessible by the other computers in your network. The type of share you create depends upon the operating system(s) running in your network, your security requirements, and expectations for network transfer speeds.</p>
<p><strong>NOTE:</strong>
shares are created to provide and control access to an area of storage. Before creating your shares, it is recommended to make a list of the users that will need access to storage data, which operating systems these users are using, whether or not all users should have the same permissions to the stored data, and whether or not these users should authenticate before accessing the data. This information can help you determine which type of share(s) you need to create, whether or not you need to create multiple datasets in order to divide up the storage into areas with differing access and permission requirements, and how complex it will be to setup your permission requirements. It should be noted that a share is used to provide access to data. If you delete a share, it removes access to data
but does not delete the data itself.</p>
<p>The following types of shares and services are available:</p>
<p><strong>Apple (AFP) Shares</strong>
: the Apple File Protocol (AFP) type of share is a good choice if all of your computers run Mac OS X.</p>
<p><strong>Unix (NFS) Shares</strong>
: the Network File System (NFS) type of share is accessible by Mac OS X, Linux, BSD, and the professional/enterprise versions (not the home editions) of Windows. It is a good choice if there are many different operating systems in your network. Depending upon the operating system, it may require the installation or configuration of client software on the desktop.</p>
<p><strong>Windows (CIFS) Shares</strong>
: the Common Internet File System (CIFS) type of share is accessible by Windows, Mac OS X, Linux, and BSD computers, but it is slower than an NFS share due to the single-threaded design of Samba. It provides more configuration options than NFS and is a good choice on a network containing only Windows systems. However, it is a poor choice if the CPU on the FreeNAS® system is limited; if your CPU is maxed out, you need to upgrade the CPU or consider another type of share.</p>
<p>I
f you are looking for a solution that allows fast access from any operating system, consider configuring the FTP service instead of a share and use a cross-platform FTP and file manager client application such as
<a class="reference external" href="http://filezilla-project.org/">Filezilla</a>
. Secure FTP can be configured if the data needs to be encrypted.</p>
<p>If data security is a concern and your network&#8217;s users are familiar with SSH command line utilities or
<a class="reference external" href="http://winscp.net/">WinSCP</a>
, consider configuring the SSH service instead of a share. It will be slower than unencrypted FTP due to the overhead of encryption, but the data passing through the network will be encrypted.</p>
<p><a href="#id215"><span class="problematic" id="id216">**</span></a>NOTE: **
while the GUI will let you do it, it is a bad idea to share the same volume or dataset using
multiple types of access methods. Different types of shares and services use different file locking methods. For example, if the same volume is configured to use both NFS and FTP, NFS will lock a file for editing by an NFS user, but a FTP user can simultaneously edit or delete that file. This will result in
lost edits and confused users. Another example: if a volume is configured for both AFP and CIFS, Windows users may be confused by the extra filenames used by Mac files and delete the ones they don&#8217;t understand; this will corrupt the files on the AFP share. Pick the one type of share or service that makes the most sense for the types of clients that will access that volume, and configure that volume
for that one type of share or service.
If you need to support multiple types of shares, divide the volume into datasets and use one dataset per share.</p>
<p>This section will demonstrate how to create AFP, NFS, and CIFS shares. FTP and SSH configurations are described in
<a class="reference external" href="#1.8.ServicesConfiguration|outline">Services Configuration</a>
.</p>
<div class="section" id="apple-afp-shares">
<h3>Apple (AFP) Shares<a class="headerlink" href="#apple-afp-shares" title="Permalink to this headline">¶</a></h3>
<p>FreeNAS® uses the
<a class="reference external" href="http://netatalk.sourceforge.net/">Netatalk</a>
AFP server to share data with Apple systems. Configuring AFP shares is a multi-step process that requires you to create or import users and groups, set volume/dataset permissions, create the AFP share(s), configure the
<a class="reference external" href="#1.8.2.AFP|outline">AFP</a>
service, then enable the AFP service in Services → Control Services.</p>
<p>This section describes the configuration screen for creating the AFP share. It then provides configuration examples for creating a guest share, configuring Time Machine to backup to a dataset on the FreeNAS® system, and for connecting to the share from a Mac OS X client.</p>
<div class="section" id="creating-afp-shares">
<h4>Creating AFP Shares<a class="headerlink" href="#creating-afp-shares" title="Permalink to this headline">¶</a></h4>
<p>If you click Sharing → Apple (AFP) Shares → Add Apple (AFP) Share, you will see the screen shown in Figure 7.1a. Some settings are only available in Advanced Mode. To see these settings, either click the Advanced Mode button or configure the system to always display these settings by checking the box “Show advanced fields by default” in System → Settings → Advanced.</p>
<p>Table 7.1a summarizes the available options when creating an AFP share. Refer to
<a class="reference external" href="http://netatalk.sourceforge.net/2.2/htmldocs/configuration.html">Setting up Netatalk</a>
for a more detailed explanation of the available options.</p>
<p>Once you press the OK button when creating the AFP share, a pop-up menu will ask “Would you like to enable this service?” Click Yes and Services
→ Control Services will open and indicate whether or not the AFP service successfully started.</p>
<p>Figure 7.1a: Creating an AFP Share</p>
<p><a class="reference internal" href="_images/10000000000002EF000001DDC96811A8.png"><img alt="10000000000002EF000001DDC96811A8_png" src="_images/10000000000002EF000001DDC96811A8.png" style="width: 6.9252in; height: 4.398in;" /></a></p>
<p>Table 7.1a: AFP Share Configuration Options</p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="7%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Name</td>
<td>string</td>
<td>volume name that will appear in the Mac computer&#8217;s “connect to server” dialogue; limited to 27 characters and can not contain a period</td>
</tr>
<tr class="row-odd"><td>Share Comment</td>
<td>string</td>
<td>optional</td>
</tr>
<tr class="row-even"><td>Path</td>
<td>browse button</td>
<td>browse to the volume/dataset to share</td>
</tr>
<tr class="row-odd"><td>Allow List</td>
<td>string</td>
<td>comma delimited list of allowed users and/or groups where groupname begins with a &#64;</td>
</tr>
<tr class="row-even"><td>Deny List</td>
<td>string</td>
<td>comma delimited list of denied users and/or groups where groupname begins with a &#64;</td>
</tr>
<tr class="row-odd"><td>Read-only Access</td>
<td>string</td>
<td>comma delimited list of users and/or groups who only have read access where groupname begins with a &#64;</td>
</tr>
<tr class="row-even"><td>Read-write Access</td>
<td>string</td>
<td>comma delimited list of users and/or groups who have read and write access where groupname begins with a &#64;</td>
</tr>
<tr class="row-odd"><td>Time Machine</td>
<td>checkbox</td>
<td>due to a limitation in how Mac deals with low-diskspace issues when multiple Mac&#8217;s share the same volume, checking
<em>Time Machine</em>
on multiple shares is discouraged as it may result in intermittent failed backups</td>
</tr>
<tr class="row-even"><td>Database Path</td>
<td>string</td>
<td>specify the path to store the CNID databases used by AFP (default is the root of the volume); the path must be writable</td>
</tr>
<tr class="row-odd"><td>Zero Device Numbers</td>
<td>checkbox</td>
<td>only available in Advanced Mode;
enable when the device number is not constant across a reboot</td>
</tr>
<tr class="row-even"><td>No Stat</td>
<td>checkbox</td>
<td>only available in Advanced Mode;
if checked, AFP won&#8217;t stat the volume path when enumerating the volumes list; useful for automounting or volumes created by a preexec script</td>
</tr>
<tr class="row-odd"><td>AFP3 UNIX Privs</td>
<td>checkbox</td>
<td>enables Unix privileges supported by OSX 10.5 and higher; do not enable if the network contains Mac OS X 10.4 clients or lower as they do not support these</td>
</tr>
<tr class="row-even"><td>Default file permission</td>
<td>checkboxes</td>
<td>only works with Unix ACLs; new files created on the share are set with the selected permissions</td>
</tr>
<tr class="row-odd"><td>Default directory permission</td>
<td>checkboxes</td>
<td>only works with Unix ACLs; new directories created on the share are set with the selected permissions</td>
</tr>
<tr class="row-even"><td>Default umask</td>
<td>integer</td>
<td>umask for newly created files, default is
<em>000</em>
(anyone can read, write, and execute)</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="connecting-to-afp-shares-as-guest">
<h4>Connecting to AFP Shares As Guest<a class="headerlink" href="#connecting-to-afp-shares-as-guest" title="Permalink to this headline">¶</a></h4>
<p>AFP supports guest logins, meaning that all of your Mac OS X users can access the AFP share without requiring their user accounts to first be created on or imported into the the FreeNAS® system.</p>
<p><strong>NOTE:</strong>
if you create a guest share as well a share that requires authentication, AFP will only map users who login as guest to the guest share. This means that if a user logs in to the share that requires authentication, the permissions on the guest share may prevent that user from writing to the guest share. The only way to allow both guest and authenticated users to write to a guest share is to set the permissions on the guest share to 777 or to add the authenticated users to a guest group and set the permissions to 77x.</p>
<p>In this configuration example, the AFP share has been configured for guest access as follows:</p>
<ol class="arabic simple">
<li>A ZFS volume named
<em>/mnt/data</em>
has its permissions set to the built-in
<em>nobody</em>
user account and
<em>nobody</em>
group.</li>
<li>An AFP share has been created with the following attributes:</li>
</ol>
<ul class="simple">
<li>Name:
<em>freenas</em>
(this is the name that will appear to Mac OS X clients)</li>
<li>Path:
<em>/mnt/data</em></li>
<li>Allow List: set to
<em>nobody</em></li>
<li>Read-write Access: set to
<em>nobody</em></li>
</ul>
<ol class="arabic simple">
<li>Services → AFP has been configured as follows:</li>
</ol>
<ul class="simple">
<li>Server Name:
<em>freenas</em></li>
<li>Guest Access: checkbox is checked</li>
<li><em>nobody</em>
is selected in the Guest account drop-down menu</li>
</ul>
<p>Once the AFP service has been started
in Services → Control Services, Mac OS X users can connect to the AFP share by clicking Go → Connect to Server. In the example shown in Figure 7.1b, the user has input
<em>afp://</em>
followed by the IP address of the FreeNAS® system.</p>
<p>Click the Connect button. Once connected, Finder will automatically open. The name of the AFP share will be displayed in the SHARED section in the left frame and the contents of the share will be displayed in the right frame. In the example shown in Figure 7.1c,
<em>/mnt/data</em>
has one folder named images. The user can now copy files to and from the share.</p>
<p><strong>Figure 7.1b: Connect to Server Dialogue</strong></p>
<p><a class="reference internal" href="_images/100000000000024B000001232956E90B.png"><img alt="100000000000024B000001232956E90B_png" src="_images/100000000000024B000001232956E90B.png" style="width: 6.9252in; height: 3.4327in;" /></a></p>
<p><strong>Figure 7.1c: Viewing the Contents of the Share From a Mac System</strong></p>
<p><a class="reference internal" href="_images/10000000000001C60000015C9803C256.png"><img alt="10000000000001C60000015C9803C256_png" src="_images/10000000000001C60000015C9803C256.png" style="width: 6.9272in; height: 3.6102in;" /></a></p>
<p>To disconnect from the volume, click the eject button in the Shared sidebar.</p>
</div>
<div class="section" id="using-time-machine">
<h4>Using Time Machine<a class="headerlink" href="#using-time-machine" title="Permalink to this headline">¶</a></h4>
<p>Mac OS X includes the Time Machine application which can be used to schedule automatic backups. In this configuration example, Time Machine will be configured to backup to an AFP share on a FreeNAS® system. To configure the AFP share on the FreeNAS® system:</p>
<ol class="arabic simple">
<li>A ZFS dataset named
<em>/mnt/data/backup_user1</em>
with a quota of
<em>60G</em>
was created in Storage → Volumes → Create ZFS Dataset.</li>
<li>A user account was created as follows:</li>
</ol>
<ul class="simple">
<li>Username:
<em>user1</em></li>
<li>Home Directory:
<em>/mnt/data/backup_user1</em></li>
<li>the Full Name, E-mail, and Password fields were set where the Username and Password match the values for the user on the Mac OS X system</li>
</ul>
<ol class="arabic simple">
<li>An AFP share with a Name of
<em>backup_user1</em>
has been created with the following attributes:</li>
</ol>
<ul class="simple">
<li>Path:
<em>/mnt/data/backup_user1</em></li>
<li>Allow List: set to
<em>user1</em></li>
<li>Read-write Access: set to
<em>user1</em></li>
<li>Time Machine: checkbox is checked</li>
</ul>
<ol class="arabic simple">
<li>Services → AFP has been configured as follows:</li>
</ol>
<ul class="simple">
<li>Guest Access: checkbox is unchecked</li>
</ul>
<ol class="arabic simple">
<li>The AFP service has been started in Services → Control Services.</li>
</ol>
<p>To configure Time Machine on the Mac OS X client, go to System Preferences → Time Machine which will open the screen shown in Figure 7.1e. Click ON and a pop-up menu should show the FreeNAS® system as a backup option. In our example, it is listed as
<em>backup_user1 on &#8220;freenas&#8221;</em>
. Highlight the entry representing the FreeNAS® system and click the “Use Backup Disk” button. A connection bar will open and will prompt for the user account&#8217;s password&#8211;in this example, the password for the
<em>user1</em>
account.</p>
<p>Time Machine will create a full backup after waiting two minutes. It will then create a one hour incremental backup for the next 24 hours, and then one backup each day, each week and each month.
<strong>Since the oldest backups are deleted when the ZFS dataset becomes full, make sure that the quota size you set is sufficient to hold the backups.</strong>
Note that a default installation of Mac OS X is ~21 GB in size.</p>
<p>If you receive a “Time Machine could not complete the backup. The backup disk image could not be created (error 45)” error when backing up to the FreeNAS® system, you will need to create a sparsebundle image using
<a class="reference external" href="http://forum1.netgear.com/showthread.php?t=49482">these instructions</a>
.</p>
<p>If you receive the message “Time Machine completed a verification of your backups. To improve reliability, Time Machine must create a new backup for you.” and you do not want to perform another complete backup or lose past backups, follow the instructions in this
<a class="reference external" href="http://www.garth.org/archives/2011,08,27,169,fix-time-machine-sparsebundle-nas-based-backup-errors.html">post</a>
. Note that this can occur after performing a scrub as Time Machine may mistakenly believe that the sparsebundle backup is corrupt.</p>
<p><strong>Figure 7.1e: Configuring Time Machine on Mac OS X Lion</strong></p>
<p><a class="reference internal" href="_images/10000000000002A3000001C1F794EDB8.png"><img alt="10000000000002A3000001C1F794EDB8_png" src="_images/10000000000002A3000001C1F794EDB8.png" style="width: 6.9252in; height: 4.6055in;" /></a></p>
</div>
</div>
<div class="section" id="unix-nfs-shares">
<h3>Unix (NFS) Shares<a class="headerlink" href="#unix-nfs-shares" title="Permalink to this headline">¶</a></h3>
<p>FreeNAS® supports the Network File System (NFS) for sharing volumes over a network. Once the NFS share is configured, clients use the
<strong>mount</strong>
command to mount the share. Once mounted, the share appears as just another directory on the client system. Some Linux distros require the installation of additional software in order to mount an NFS share. On Windows systems, enable Services for NFS in the Ultimate or Enterprise editions or install an NFS client application.</p>
<p><strong>NOTE:</strong>
for performance reasons,
<a class="reference external" href="#1.8.7.iSCSI|outline">iSCSI</a>
is preferred to NFS shares when FreeNAS is installed on ESXi. If you are considering creating NFS shares on ESXi, read through the performance analysis at
<a class="reference external" href="http://blog.laspina.ca/ubiquitous/running-zfs-over-nfs-as-a-vmware-store">Running ZFS over NFS as a VMware Store</a>
.</p>
<p>Configuring NFS is a multi-step process that requires you to create NFS share(s), configure NFS in Services → NFS, then start NFS in Services → Services. It does not require you to create users or groups as NFS uses IP addresses to determine which systems are allowed to access the NFS share.</p>
<p>This section demonstrates how to create an NFS share, provides a configuration example, demonstrates how to connect to the share from various operating systems, and provides some troubleshooting tips.</p>
<div class="section" id="creating-nfs-shares">
<h4>Creating NFS Shares<a class="headerlink" href="#creating-nfs-shares" title="Permalink to this headline">¶</a></h4>
<p>To create an NFS share, click Sharing → Unix (NFS) Shares → Add Unix (NFS) Share, shown in Figure 7.2a. Table 7.2a summarizes the options in this screen.</p>
<p><strong>Figure 7.2a: Creating an NFS Share</strong></p>
<p><a class="reference internal" href="_images/10000000000003460000019B3868D5D2.png"><img alt="10000000000003460000019B3868D5D2_png" src="_images/10000000000003460000019B3868D5D2.png" style="width: 6.9252in; height: 3.3957in;" /></a></p>
<p>Once you press the OK button when creating the NFS share, a pop-up menu will ask “Would you like to enable this service?” Click Yes and Services → Control Services will open and indicate whether or not the NFS service successfully started.</p>
<p><strong>Table 7.2a: NFS Share Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="10%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Comment</td>
<td>string</td>
<td>used to set the share name; if left empty, share name will be the list of selected Paths</td>
</tr>
<tr class="row-odd"><td>Authorized networks</td>
<td>string</td>
<td>space
delimited list of allowed network addresses in the form 1.2.3.0/24 where the number after the slash is a CIDR mask</td>
</tr>
<tr class="row-even"><td>Authorized
IP
addresses or
hosts</td>
<td>string</td>
<td>space
delimited list of allowed IP addresses or hostnames</td>
</tr>
<tr class="row-odd"><td>All directories</td>
<td>checkbox</td>
<td>if checked, the client can mount any subdirectory within the
<em>Path</em></td>
</tr>
<tr class="row-even"><td>Read only</td>
<td>checkbox</td>
<td>prohibits writing to the share</td>
</tr>
<tr class="row-odd"><td>Quiet</td>
<td>checkbox</td>
<td>inhibits some syslog diagnostics which can be useful to avoid some annoying error messages; see
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=exports">exports(5)</a>
for examples</td>
</tr>
<tr class="row-even"><td>Maproot User</td>
<td>drop-down menu</td>
<td>if a user is selected, the
<em>root</em>
user is limited to that user&#8217;s permissions</td>
</tr>
<tr class="row-odd"><td>Maproot Group</td>
<td>drop-down menu</td>
<td>if a group is selected, the
<em>root</em>
user will also be limited to that group&#8217;s permissions</td>
</tr>
<tr class="row-even"><td>Mapall User</td>
<td>drop-down menu</td>
<td>the specified user&#8217;s permissions are used by all clients</td>
</tr>
<tr class="row-odd"><td>Mapall Group</td>
<td>drop-down menu</td>
<td>the specified group&#8217;s permission are used by all clients</td>
</tr>
<tr class="row-even"><td>Path</td>
<td>browse button</td>
<td>browse to the volume/dataset/directory to share; click
<em>Add extra *
*path</em>
to select multiple paths</td>
</tr>
</tbody>
</table>
<p>When creating the NFS share, keep the following points in mind:</p>
<ol class="arabic simple">
<li>The Maproot and Mapall options are exclusive, meaning you can only use one or the other&#8211;the GUI will not let you use both. The Mapall options supersede the Maproot options. If you only wish to restrict the
<em>root</em>
user&#8217;s permissions, set the Maproot option. If you wish to restrict the permissions of all users, set the Mapall option.</li>
<li>Each volume or dataset is considered to be its own filesystem and NFS is not able to cross filesystem boundaries.</li>
<li>The network or host must be unique per share and per filesystem or directory.</li>
<li>The “All directories” option can only be used once per share per filesystem.</li>
</ol>
<p>To better understand these restrictions, consider the following scenario where there are:</p>
<ul class="simple">
<li>2 networks named
<em>10.0.0.0/8</em>
and
<em>20.0.0.0/8</em></li>
<li>a ZFS volume named
<em>volume1</em>
with 2 datasets named
<em>dataset1</em>
and
<em>dataset2</em></li>
<li><em>dataset1</em>
has a directory named
<em>directory1</em></li>
</ul>
<p>Because of restriction #3, you will receive an error
if you try to create one NFS share as follows:</p>
<ul>
<li><p class="first"><strong>Authorized networks:</strong></p>
<p><a href="#id218"><span class="problematic" id="id219">*</span></a>10.0.0.0/8 20.0.0.0/8 *</p>
</li>
<li><p class="first"><strong>Path:</strong></p>
<p><em>/mnt/volume1/dataset1</em>
and /
<em>mnt/volume1/dataset1/directory1</em></p>
</li>
</ul>
<p>Instead, you should select the Path of
<em>/mnt/volume1/dataset1</em>
and check the “All directories” box.</p>
<p>However, you could restrict that directory to one of the networks by creating two shares as follows.</p>
<p>First NFS share:</p>
<ul>
<li><p class="first"><strong>Authorized networks:</strong></p>
<p><em>10.0.0.0/8</em></p>
</li>
<li><p class="first"><strong>Path:</strong></p>
<p><a href="#id220"><span class="problematic" id="id221">*</span></a>/mnt/volume1/dataset1 *</p>
</li>
</ul>
<p>Second NFS share:</p>
<ul>
<li><p class="first"><strong>Authorized networks:</strong></p>
<p><a href="#id222"><span class="problematic" id="id223">*</span></a>20.0.0.0/8 *</p>
</li>
<li><p class="first"><strong>Path:</strong></p>
<p><em>/mnt/volume1/dataset1/directory1</em></p>
</li>
</ul>
<p>Note that this requires the creation of two shares as it can not be accomplished in one share.</p>
</div>
<div class="section" id="sample-nfs-share-configuration">
<h4>Sample NFS Share Configuration<a class="headerlink" href="#sample-nfs-share-configuration" title="Permalink to this headline">¶</a></h4>
<p>By default the Mapall options shown in Figure 7.2a show as
<em>N/A</em>
. This means that when a user connects to the NFS share, they connect with the permissions associated with their user account. This is a security risk if a user is able to connect as
<em>root</em>
as they will have
complete
* *
access to the share.</p>
<p>A better scenario is to do the following:</p>
<ol class="arabic simple">
<li>Specify the built-in
<em>nobody</em>
account to be used for NFS access.</li>
<li>In the
<a class="reference external" href="#1.6.3.9.SettingPermissions|outline">permissions</a>
of the volume/dataset that is being shared, change the owner and group to
<em>nobody</em>
and set the permissions according to your specifications.</li>
<li>Select
<em>nobody</em>
in the Mapall User and Mapall Group drop-down menus for the share in Sharing → Unix (NFS) Shares.</li>
</ol>
<p>With this configuration, it does not matter which user account connects to the NFS share, as it will be mapped to the
<em>nobody</em>
user account and will only have the permissions that you specified on the volume/dataset. For example, even if the
<em>root</em>
user is able to connect, it will not gain
<em>root</em>
access to the share.</p>
</div>
<div class="section" id="connecting-to-the-nfs-share">
<h4>Connecting to the NFS Share<a class="headerlink" href="#connecting-to-the-nfs-share" title="Permalink to this headline">¶</a></h4>
<p>In the following examples, an NFS share
on a FreeNAS® system with the IP address of
<em>192.168.2.2</em>
has been configured as follows:</p>
<ol class="arabic simple">
<li>A ZFS volume named
<em>/mnt/data</em>
has its permissions set to the
<em>nobody</em>
user account and the
<em>nobody</em>
group.</li>
<li>A NFS share has been created with the following attributes:</li>
</ol>
<ul class="simple">
<li>Path:
<em>/mnt/data</em></li>
<li>Authorized Network:
<em>192.168.2.0/24</em></li>
<li>MapAll User and MapAll Group are both set to
<em>nobody</em></li>
<li>the All Directories checkbox has been checked</li>
</ul>
<div class="section" id="from-bsd-or-linux-clients">
<h5>From BSD or Linux Clients<a class="headerlink" href="#from-bsd-or-linux-clients" title="Permalink to this headline">¶</a></h5>
<p>To make this share accessible on a BSD or a Linux system, run the following command as the superuser (or with
<strong>sudo</strong>
) from the client system. Repeat on each client that needs access to the NFS share:</p>
<p><strong>mount -t nfs 192.168.2.2:/mnt/data /mnt</strong></p>
<p>The
<strong>mount</strong>
command uses the following options:</p>
<ul class="simple">
<li><strong>-t nfs:</strong>
specifies the type of share.</li>
<li><strong>192.168.2.2:</strong>
replace with the IP address of the FreeNAS® system</li>
<li><strong>/mnt/data:</strong>
replace with the name of the NFS share</li>
<li><strong>/mnt:</strong>
a mount point on the client system. This must be an existing,
<strong>empty</strong>
** **
directory. The data in the NFS share will be made available to the client in this directory.</li>
</ul>
<p>The
<strong>mount</strong>
command should return to the command prompt without any error messages, indicating that the share was successfully mounted.</p>
<p>Once mounted, this configuration allows users on the client system to copy files to and from
<em>/mnt</em>
(the mount point) and all files will be owned by
<em>nobody:nobody</em>
. Any changes to
<em>/mnt</em>
will be saved to the FreeNAS® system&#8217;s
<em>/mnt/data</em>
volume.</p>
<p>Should you wish to make any changes to the NFS share&#8217;s settings or wish to make the share inaccessible, first unmount the share on the client as the superuser:</p>
<p><strong>umount /mnt</strong></p>
</div>
<div class="section" id="from-microsoft-clients">
<h5>From Microsoft Clients<a class="headerlink" href="#from-microsoft-clients" title="Permalink to this headline">¶</a></h5>
<p>Windows systems can connect to NFS shares using Services for NFS (refer to the documentation for your version of Windows for instructions on how to find, activate, and use this service) or a third-party NFS client. Connecting to NFS shares is often faster than connecting to CIFS shares due to the
<a class="reference external" href="http://www.samba.org/samba/docs/man/Samba-Developers-Guide/architecture.html">single-threaded limitation</a>
of Samba.</p>
<p>Instructions for connecting from an Enterprise version of Windows 7 can be found at
<a class="reference external" href="http://www.hackourlife.com/mount-linux-nfs-share-on-windows-7/">Mount Linux NFS Share on Windows 7</a>
.</p>
<p><a class="reference external" href="http://code.google.com/p/nekodrive/downloads/list">Nekodrive</a>
provides an open source graphical NFS client. To use this client, you will need to install the following on the Windows system:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.7-zip.org/">7zip</a>
to extract the Nekodrive download files</li>
<li>NFSClient and NFSLibrary from the Nekodrive download page; once downloaded, extract these files using 7zip</li>
<li><a class="reference external" href="http://www.microsoft.com/download/en/details.aspx?id=17851">.NET Framework 4.0</a></li>
</ul>
<p>Once everything is installed, run the NFSClient executable to start the GUI client. In the example shown in Figure 7.2b, the user has connected to the example
<em>/mnt/data</em>
share of the FreeNAS® system at
<em>192.168.2.2</em>
.</p>
<p><strong>NOTE:</strong>
Nekodrive does not support Explorer drive mapping via NFS. If you need this functionality,
<a class="reference external" href="http://www.citi.umich.edu/projects/nfsv4/windows/readme.html">try this utility</a>
instead.</p>
<p><strong>Figure 7.2b: Using the Nekodrive NFSClient from Windows 7 Home Edition</strong></p>
<p><a class="reference internal" href="_images/1000000000000374000002AEF63058C7.jpg"><img alt="1000000000000374000002AEF63058C7_jpg" src="_images/1000000000000374000002AEF63058C7.jpg" style="width: 6.9252in; height: 5.3736in;" /></a></p>
</div>
<div class="section" id="from-mac-os-x-clients">
<h5>From Mac OS X Clients<a class="headerlink" href="#from-mac-os-x-clients" title="Permalink to this headline">¶</a></h5>
<p>To mount the NFS volume from a Mac OS X client, click on Go → Connect to Server. In the Server Address field, input
<em>nfs://</em>
followed by the IP address of the FreeNAS® system and the name of the volume/dataset being shared by NFS. The example shown in Figure 7.2c continues with our example of
<a href="#id226"><span class="problematic" id="id227">*</span></a>192.168.2.2:/mnt/data. *</p>
<p>Once connected, Finder will automatically open. The IP address of the FreeNAS® system will be displayed in the SHARED section in the left frame and the contents of the share will be displayed in the right frame. In the example shown in Figure 7.2d,
<em>/mnt/data</em>
has one folder named
<em>images</em>
. The user can now copy files to and from the share.</p>
<p><strong>Figure 7.2c: Mounting the NFS Share from Mac OS X</strong></p>
<p><a class="reference internal" href="_images/100000000000024D0000012FE1DE1BD5.png"><img alt="100000000000024D0000012FE1DE1BD5_png" src="_images/100000000000024D0000012FE1DE1BD5.png" style="width: 6.9252in; height: 3.5618in;" /></a></p>
<p><strong>Figure 7.2d: Viewing the NFS Share in Finder</strong></p>
<p><a class="reference internal" href="_images/10000000000001B9000001650B2A66FA.png"><img alt="10000000000001B9000001650B2A66FA_png" src="_images/10000000000001B9000001650B2A66FA.png" style="width: 6.2193in; height: 4.5102in;" /></a></p>
</div>
</div>
<div class="section" id="id228">
<h4>Troubleshooting<a class="headerlink" href="#id228" title="Permalink to this headline">¶</a></h4>
<p>Some NFS clients do not support the NLM (Network Lock Manager) protocol used by NFS. You will know that this is the case if the client receives an error that all or part of the file may be locked when a file transfer is attempted. To resolve this error, add the option
<strong>-o nolock</strong>
when running the
<strong>mount</strong>
command on the client in order to allow write access to the NFS share.</p>
<p>If you receive an error about a “time out giving up” when trying to mount the share from a Linux system, make sure that the portmapper service is running on the Linux client and start it if it is not. If portmapper is running and you still receive timeouts, force it to use TCP by including
<strong>-o tcp</strong>
in your
<strong>mount</strong>
command.</p>
<p>If you receive an error “RPC: Program not registered”, upgrade to the latest version of FreeNAS® and restart the NFS service after the upgrade in order to clear the NFS cache.</p>
<p>If your clients are receiving “reverse DNS” or errors, add an entry for the IP address of the FreeNAS® system in the “Host name database” field of Network →
<a class="reference external" href="#1.5.1.GlobalConfiguration|outline">Global Configuration</a>
.</p>
<p>If the client receives timeout errors when trying to mount the share, add the IP address and hostname of the client to the &#8220;Host name data base&#8221; field of Network →
<a class="reference external" href="#1.5.1.GlobalConfiguration|outline">Global Configuration</a>
.</p>
</div>
</div>
<div class="section" id="windows-cifs-shares">
<h3>Windows (CIFS) Shares<a class="headerlink" href="#windows-cifs-shares" title="Permalink to this headline">¶</a></h3>
<p>FreeNAS® uses
<a class="reference external" href="http://samba.org/">Samba</a>
to share volumes using Microsoft&#8217;s CIFS protocol. CIFS is built into the Windows and Mac OS X operating systems and most Linux and BSD systems pre-install the Samba client which provides support for CIFS. If your distro did not, install the Samba client using your distro&#8217;s software repository.</p>
<p>Configuring CIFS shares is a multi-step process that requires you to set permissions, create CIFS share(s), configure the CIFS service in Services → CIFS, then enable the CIFS service in Services → Control Services. If your Windows network has a Windows server running Active Directory, you will also need to configure the Active Directory service in Services → Directory Services → Active Directory. Depending upon your authentication requirements, you may need to create or import users and groups.</p>
<p>This section will demonstrate some common configuration scenarios:</p>
<ul class="simple">
<li>If you would like an overview of the configurable parameters, see
<a class="reference external" href="#1.7.3.1.CreatingCIFSShares|outline">Creating CIFS Shares</a>
.</li>
<li>If you would like each user to authenticate before accessing the share, see
<a class="reference external" href="#1.7.3.3.ConfiguringLocalUserAccess|outline">Configuring Local User Access</a>
.</li>
<li>If you would like to use Shadow Copies, see
<a class="reference external" href="#1.7.3.4.ConfiguringShadowCopies|outline">Configuring Shadow Copies</a>
.</li>
<li>If you are having problems accessing your CIFS share, see
<a class="reference external" href="#1.8.4.1.TroubleshootingTips|outline">Troubleshooting Tip</a>
<a class="reference external" href="#1.8.4.1.TroubleshootingTips|outline">s</a>
.</li>
</ul>
<div class="section" id="id231">
<h4>Creating CIFS Shares<a class="headerlink" href="#id231" title="Permalink to this headline">¶</a></h4>
<p>Figure 7.3a shows the configuration screen that appears when you click Sharing → Windows (CIFS Shares) → Add Windows (CIFS) Share. Some settings are only available in Advanced Mode. To see these settings, either click the Advanced Mode button or configure the system to always display these settings by checking the box “Show advanced fields by default” in System → Settings → Advanced.</p>
<p>Table 7.3a summarizes the options when creating a CIFS share.</p>
<p><a class="reference external" href="http://www.samba.org/samba/docs/man/manpages-3/smb.conf.5.html">smb.conf(5)</a>
provides more details for each configurable option. Once you press the OK button when creating the CIFS share, a pop-up menu will ask “Would you like to enable this service?” Click Yes and Services → Control Services will open and indicate whether or not the CIFS service successfully started.</p>
<p><strong>Figure 7.3a: Adding a CIFS Share</strong></p>
<p><a class="reference internal" href="_images/10000000000001E6000001C49A1423E2.png"><img alt="10000000000001E6000001C49A1423E2_png" src="_images/10000000000001E6000001C49A1423E2.png" style="width: 5.8547in; height: 4.1846in;" /></a></p>
<p><strong>Table 7.3a: Options for a CIFS Share</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="6%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Name</td>
<td>string</td>
<td>mandatory; name of share</td>
</tr>
<tr class="row-odd"><td>Comment</td>
<td>string</td>
<td>optional description</td>
</tr>
<tr class="row-even"><td>Path</td>
<td>browse button</td>
<td>select volume/dataset/directory to share</td>
</tr>
<tr class="row-odd"><td>Export Read Only</td>
<td>checkbox</td>
<td>prohibits write access to the share</td>
</tr>
<tr class="row-even"><td>Browsable to Network Clients</td>
<td>checkbox</td>
<td>enables Windows clients to browse the shared directory using Windows Explorer</td>
</tr>
<tr class="row-odd"><td>Inherit Owner</td>
<td>checkbox</td>
<td>if checked, ownership for new files and directories is inherited from parent directory rather than from the user</td>
</tr>
<tr class="row-even"><td>Inherit Permissions</td>
<td>checkbox</td>
<td>if checked, the
<strong>UNIX</strong>
permissions on new files and directories are inherited from parent directory; this can be useful on large systems with many users as it allows a single homes share to be used flexibly by each user;
<strong>do not check if Type of ACL is set to Windows in the Volume&#8217;s permissions</strong>
** **</td>
</tr>
<tr class="row-odd"><td>Inherit ACLs</td>
<td>checkbox</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>Export Recycle Bin</td>
<td>checkbox</td>
<td>deleted files are instead moved to a hidden
<em>.recycle</em>
directory in the root folder of the share</td>
</tr>
<tr class="row-odd"><td>Show Hidden Files</td>
<td>checkbox</td>
<td>if enabled, will display filenames that begin with a dot (Unix hidden files)</td>
</tr>
<tr class="row-even"><td>Allow Guest Access</td>
<td>checkbox</td>
<td>if checked, no password is required to connect to the share and all users share the permissions of the guest user defined in Services → CIFS</td>
</tr>
<tr class="row-odd"><td>Only Allow Guest Access</td>
<td>checkbox</td>
<td>requires
<em>Allow guest access</em>
to also be checked; forces guest access for all connections</td>
</tr>
<tr class="row-even"><td>Hosts Allow</td>
<td>string</td>
<td>only available in Advanced Mode;
comma, space, or tab delimited list of allowed hostnames or IP addresses; see NOTE below</td>
</tr>
<tr class="row-odd"><td>Hosts Deny</td>
<td>string</td>
<td>only available in Advanced Mode;
comma, space, or tab delimited list of denied hostnames or IP addresses; allowed hosts take precedence so can use
<em>ALL</em>
in this field and specify allowed hosts in
<em>Hosts Allow</em>
; see NOTE below</td>
</tr>
<tr class="row-even"><td>Auxiliary Parameters</td>
<td>string</td>
<td>only available in Advanced Mode;
add additional [share]
<a class="reference external" href="http://www.samba.org/samba/docs/man/manpages-3/smb.conf.5.html">smb.conf</a>
parameters not covered by other option fields</td>
</tr>
</tbody>
</table>
<p><strong>NOTE:</strong>
hostname lookups add some time to accessing the CIFS share. If you only use IP addresses, uncheck the “Hostnames lookups” box in Services →
<a class="reference external" href="#1.8.4.CIFS|outline">CIFS</a>
.</p>
<p>If you wish some files on a shared volume to be hidden and inaccessible to users, put a
<em>veto files=</em>
line in the Auxiliary Parameters field. The syntax for this line and some examples can be found
<a class="reference external" href="http://www.samba.org/samba/docs/man/manpages-3/smb.conf.5.html#VETOFILES">here</a>
.</p>
</div>
<div class="section" id="configuring-a-share">
<h4>Configuring a Share<a class="headerlink" href="#configuring-a-share" title="Permalink to this headline">¶</a></h4>
<p>The process for configuring a share is as follows:</p>
<ol class="arabic simple">
<li><a href="#id233"><span class="problematic" id="id234">**</span></a>If you are not using Active Directory or LDAP, create a user account for each user **
in Account → Users → Add User with the following attributes:</li>
</ol>
<ul class="simple">
<li>Username and Password: matches the username and password on the client system</li>
<li>Home Directory: browse to the volume to be shared</li>
<li>Repeat this process to create a user account for every user that will need access to the CIFS share</li>
</ul>
<ol class="arabic simple">
<li>If you are not using Active Directory or LDAP, create a group
in Account → Groups →
Add
Group. Once the group is created, click its Members button and add the user accounts that you
created in step 1.</li>
<li><strong>Give the group permission to the volume</strong>
in Storage → View Volumes. When setting the permissions:</li>
</ol>
<ul class="simple">
<li>set Owner(user) to
<em>nobody</em></li>
<li>set the Owner(group) to the one you created in Step 2</li>
<li>Mode: check the write checkbox for the Group as it is unchecked by default</li>
</ul>
<ol class="arabic simple">
<li><strong>Create a CIFS share</strong>
in Sharing → CIFS Shares → Add CIFS Share
with the following attributes:</li>
</ol>
<ul class="simple">
<li>Name: input the name of the share</li>
<li>Path: browse to the volume to be shared</li>
<li>keep the Browsable to Network Clients box checked</li>
</ul>
<p><a href="#id235"><span class="problematic" id="id236">**</span></a>NOTE: **
be careful about unchecking the Browsable to Network Clients box. When this box is checked (the default), other users will see the names of every share that exists using Windows Explorer, but they will receive a permissions denied error message if they try to access someone else&#8217;s share. If this box is unchecked, even the owner of the share won&#8217;t see it or be able to create a drive mapping for the share in Windows Explorer. However, they can still access the share from the command line. Unchecking this option provides limited security and is not a substitute for proper permissions and password control.</p>
<ol class="arabic simple">
<li><a href="#id237"><span class="problematic" id="id238">**</span></a>Configure the CIFS service in Services → CIFS **
as follows:
** **</li>
</ol>
<ul class="simple">
<li>Workgroup: if you are not using Active Directory or LDAP, set to the name being used on the Windows network; unless it has been changed, the default Windows workgroup name is
<em>WORKGROUP</em></li>
</ul>
<ol class="arabic simple">
<li><strong>Start the CIFS service</strong>
in Services → Control Services. Click the click the red OFF button next to CIFS. After a second or so, it will change to a blue ON, indicating that the service has been enabled.</li>
<li><strong>Test the share.</strong></li>
</ol>
<p>To test the share from a Windows system, open Explorer and click on Network. For this configuration example, a system named
<em>FREENAS</em>
should appear with a share named
<em>backups</em>
. An example is seen in Figure 7.3b:</p>
<p><strong>Figure 7.3b: Accessing the CIFS Share from a Windows Computer</strong></p>
<p><a class="reference internal" href="_images/100002010000031D000002804075756D.png"><img alt="100002010000031D000002804075756D_png" src="_images/100002010000031D000002804075756D.png" style="width: 6.9252in; height: 5.5602in;" /></a></p>
<p>If you click on
<em>backups</em>
, a Windows Security pop-up screen should prompt for the user&#8217;s username and password. Once authenticated, the user can copy data to and from the CIFS share.</p>
<p>To prevent Windows Explorer from hanging when accessing the share, map the share as a network drive. To do this, right-click the share and select &#8220;Map network drive...&#8221; as seen in Figure 7.3c:</p>
<p><strong>Figure 7.3c: Mapping the Share as a Network Drive</strong></p>
<p><a class="reference internal" href="_images/100002010000031E0000027D2C5F8621.png"><img alt="100002010000031E0000027D2C5F8621_png" src="_images/100002010000031E0000027D2C5F8621.png" style="width: 6.9252in; height: 5.5272in;" /></a></p>
<p>Choose a drive letter from the drop-down menu and click the Finish button as shown in Figure 7.3d:</p>
<p><strong>Figure 7.3d: Selecting the Network Drive Letter</strong></p>
<p><a class="reference internal" href="_images/1000000000000319000002766C465264.jpg"><img alt="1000000000000319000002766C465264_jpg" src="_images/1000000000000319000002766C465264.jpg" style="width: 6.9252in; height: 5.5016in;" /></a></p>
<p><strong>NOTE:</strong>
since the share is group writable, any authenticated user can change the data in the share. If you wish to setup shares where a group of users have access to some folders but only individuals have access to other folders (where all these folders reside on the same volume), create these directories and set their permissions using
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
. Instructions for doing so can be found at the forum post
<a class="reference external" href="http://forums.freenas.org/showthread.php?1122-Set-Permission-to-allow-users-to-share-a-common-folder-amp-have-private-personal-folder">Set Permission to allow users to share a common folder &amp; have private personal folder</a>
.</p>
</div>
<div class="section" id="id240">
<h4>Configuring Shadow Copies<a class="headerlink" href="#id240" title="Permalink to this headline">¶</a></h4>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Shadow_copy">Shadow Copies</a>
, also known as the Volume Shadow Copy Service (VSS) or Previous Versions, is a Microsoft service for creating volume snapshots. Shadow copies allow you to easily restore previous versions of files from within Windows Explorer. Shadow Copy support is built into Vista and Windows 7. Windows XP or 2000 users need to install the
<a class="reference external" href="http://www.microsoft.com/download/en/details.aspx?displaylang=en&amp;id=16220">Shadow Copy client</a>
.</p>
<p>When you create a periodic snapshot task on a ZFS volume that is configured as a CIFS share in FreeNAS®, it is automatically configured to support shadow copies.</p>
<div class="section" id="prerequisites">
<h5>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h5>
<p>Before using shadow copies with FreeNAS®, be aware of the following caveats:</p>
<ul class="simple">
<li>if the Windows system is not fully patched to the latest service pack, Shadow Copies may not work. If you are unable to see any previous versions of files to restore, use Windows Update to make sure that the system is fully up-to-date.</li>
<li>at this time, shadow copy support only works for ZFS pools or datasets. This means that the CIFS share must be configured on a volume or dataset, not on a directory. Directory support will be added in a future version of FreeNAS®.</li>
<li>since directories can not be shadow copied at this time, if you configure “Enable home directories” on the CIFS service, any data stored in the user&#8217;s home directory will not be shadow copied.</li>
<li>shadow copies will not work with a manual snapshot, you must create a periodic snapshot task for the pool or dataset being shared by CIFS
or a recursive task for a parent dataset
.
At this time, if multiple snapshot tasks are created for the same pool/dataset being shared by CIFS, shadow copies will only work on the last executed task at the time the CIFS service started. A future version of FreeNAS® will address this limitation.</li>
<li>the periodic snapshot task should be created and at least one snapshot should exist
<strong>before</strong>
* *
creating the CIFS share. If you created the CIFS share first, restart the CIFS service in Services → Control Services.</li>
<li>appropriate permissions must be configured on the volume/dataset being shared by CIFS.</li>
<li>users can not delete shadow copies on the Windows system due to the way Samba works. Instead, the administrator can remove snapshots from the FreeNAS® administrative GUI. The only way to disable shadow copies completely is to remove the periodic snapshot task and delete all snapshots
associated with the CIFS share.</li>
</ul>
</div>
<div class="section" id="configuration-example">
<h5>Configuration Example<a class="headerlink" href="#configuration-example" title="Permalink to this headline">¶</a></h5>
<p>In this example, a Windows 7 computer has two users:
<em>user1</em>
and
<em>user2</em>
. To configure FreeNAS® to provide shadow copy support:</p>
<ol class="arabic simple">
<li>For the ZFS volume named
<em>/mnt/data</em>
, create two ZFS datasets in Storage → Volumes → /mnt/data → Create ZFS Dataset. The first dataset is named
<em>/mnt/data/user1</em>
and the second dataset is named
<em>/mnt/data/user2</em>
.</li>
<li>If you are not using Active Directory or LDAP, create two users,
<em>user1</em>
and
<em>user2</em>
in Account → Users → Add User. Each user has the following attributes:</li>
</ol>
<ul class="simple">
<li>Username and Password: matches that user&#8217;s username and password on the Windows system</li>
<li>Home Directory: browse to the dataset created for that user</li>
</ul>
<ol class="arabic simple">
<li>Set the permissions on
<em>/mnt/data/user1</em>
so that the Owner(user) and Owner(group) is
<em>user1</em>
. Set the permissions on
<em>/mnt/data/user2</em>
so that the Owner(user) and Owner(group) is
<em>user2</em>
. For each dataset&#8217;s permissions, tighten the Mode so that Other can not read or execute the information on the dataset.</li>
<li>Create two periodic snapshot tasks in Storage → Periodic Snapshot Tasks → Add Periodic Snapshot, one for each dataset.
Alternatively, you can create one periodic snapshot task for the entire
<em>data</em>
volume.
** **
<strong>Before continuing to the next step,</strong>
** **
confirm that at least one snapshot for each dataset is displayed in the ZFS Snapshots tab. When creating your snapshots, keep in mind how often your users need to access modified files and during which days and time of day they are likely to make changes.</li>
<li>Create two CIFS shares in Sharing → Windows (CIFS) Shares → Add Windows (CIFS) Share. The first CIFS share is named
<em>user1</em>
and has a Path of
<em>/mnt/data/user1</em>
; the second CIFS share is named
<em>user2</em>
and has a Path of
<em>/mnt/data/user2</em>
. When creating the first share, click the No button when the pop-up button asks if the CIFS service should be started. When the last share is created, click the Yes button when the pop-up button prompts to start the CIFS service. Verify that the CIFS service is set to ON in Services → Control Services.</li>
<li>From a Windows system, login as
<em>user1</em>
and open Windows Explorer → Network → FREENAS. Two shares should appear, named
<em>user1</em>
and
<em>user2</em>
. Due to the permissions on the datasets,
<em>user1</em>
should receive an error if they click on the
<em>user2</em>
share. Due to the permissions on the datasets,
<em>user1</em>
should be able to create, add, and delete files and folders from the
<em>user1</em>
share.</li>
</ol>
<p>Figure 7.3e provides an example of using shadow copies while logged in as
<em>user1</em>
. In this example, the user right-clicked
<em>modified file</em>
and selected “Restore previous versions” from the menu. This particular file has three versions: the current version, plus two previous versions stored on the FreeNAS® system. The user can choose to open one of the previous versions, copy a previous version to the current folder, or restore one of the previous versions, which will overwrite the existing file on the Windows system.</p>
<p><strong>Figure 7.3e: Viewing Previous Versions within Explorer</strong></p>
<p><a class="reference internal" href="_images/10000201000002FE0000028C18A1102B.png"><img alt="10000201000002FE0000028C18A1102B_png" src="_images/10000201000002FE0000028C18A1102B.png" style="width: 6.9252in; height: 5.8945in;" /></a></p>
</div>
</div>
</div>
</div>
<div class="section" id="id242">
<h2>Services Configuration<a class="headerlink" href="#id242" title="Permalink to this headline">¶</a></h2>
<p>The Services section of the
GUI
allows you to configure, start, and stop the various services that ship with the FreeNAS® system. FreeNAS® supports the following built-in services:</p>
<ul class="simple">
<li><a class="reference external" href="#1.8.3.AFP|outline">AFP</a></li>
<li><a class="reference external" href="#1.8.4.CIFS|outline">CIFS</a></li>
<li><a class="reference external" href="#1.8.4.DirectoryServices|outline">Directory Services</a></li>
<li><a class="reference external" href="#1.8.5.DynamicDNS|outline">Dynamic DNS</a></li>
<li><a class="reference external" href="#1.8.6.FTP|outline">FTP</a></li>
<li><a class="reference external" href="#1.8.7.iSCSI|outline">iSCSI</a></li>
<li><a class="reference external" href="#1.8.9.NFS|outline">NFS</a></li>
<li><a class="reference external" href="#1.8.11.Rsync|outline">Rsync</a></li>
<li><a class="reference external" href="#1.8.12.S.M.A.R.T.|outline">S.M.A.R.T.</a></li>
<li><a class="reference external" href="#1.8.13.SNMP|outline">SNMP</a></li>
<li><a class="reference external" href="#1.8.14.SSH|outline">SSH</a></li>
<li><a class="reference external" href="#1.8.15.TFTP|outline">TFTP</a></li>
<li><a class="reference external" href="#1.8.16.UPS|outline">UPS</a></li>
</ul>
<p>This section demonstrates how to start a FreeNAS® service then describes the available configuration options for each FreeNAS® service.</p>
<div class="section" id="id248">
<h3>Control Services<a class="headerlink" href="#id248" title="Permalink to this headline">¶</a></h3>
<p>Services → Control Services, shown in Figure 8.1a, allows you to quickly determine which services are currently running, to start and stop services, and to configure services. By default, all services (except for the S.M.A.R.T. service) are off until you start them.</p>
<p>Figure 8.1a: Control Services</p>
<p><a class="reference internal" href="_images/10000000000001E800000200D184B89D.png"><img alt="10000000000001E800000200D184B89D_png" src="_images/10000000000001E800000200D184B89D.png" style="width: 5.8783in; height: 4.7402in;" /></a></p>
<p>A service is stopped if its icon is a red OFF. A service is running if its icon is a blue ON. To start or stop a service, click its ON/OFF icon.</p>
<p>To configure a service, click the wrench icon associated with the service or click the name of the service in the Services section of the tree menu.</p>
<p>If a service does not start, go to System → Settings → Advanced and check the box “Show console messages in the footer”. Console messages will now show at the bottom of your browser. If you click the console messages area, it will pop-up as a window, allowing you to scroll through the output and to copy messages. Watch these messages for errors when you stop and start the problematic service.</p>
<p>If you would like to read the system logs to get more information about a service failure, open
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
and type
<strong>more /var/log/messages</strong>
.</p>
</div>
<div class="section" id="id250">
<h3>AFP<a class="headerlink" href="#id250" title="Permalink to this headline">¶</a></h3>
<p>The Apple Filing Protocol (AFP) is a network protocol that offers file services for Mac computers.
Before configuring this service, you should first create your AFP Shares in Sharing →
<a class="reference external" href="#1.7.1.Apple(AFP)Shares|outline">Apple (AFP) Shares</a>
→ Add Apple (AFP) Share. After configuring this service, go to Services → Control Services to start the service. The AFP shares will not be available on the network if this service is not running.</p>
<p>Starting this service will open the following ports on the FreeNAS® system:</p>
<ul class="simple">
<li>TCP 548 (afpd)</li>
<li>TCP 4799 (cnid_metadata)</li>
<li>UDP 5353 and a random UDP port (avahi)</li>
</ul>
<p>Figure 8.2a shows the configuration options which are described in Table 8.2a.</p>
<p>Figure 8.2a: AFP Configuration</p>
<p><a class="reference internal" href="_images/100000000000028C0000015BBA05D342.png"><img alt="100000000000028C0000015BBA05D342_png" src="_images/100000000000028C0000015BBA05D342.png" style="width: 6.7902in; height: 3.6138in;" /></a></p>
<p><strong>Table 8.2a: AFP Configuration Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="10%" />
<col width="74%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Guest Access</td>
<td>checkbox</td>
<td>if checked, clients will not be prompted to authenticate before accessing the AFP share</td>
</tr>
<tr class="row-odd"><td>Guest Account</td>
<td>drop-down menu</td>
<td>select account to use for guest access; the selected account must have permissions to the volume/dataset being shared</td>
</tr>
<tr class="row-even"><td>Max Connections</td>
<td>integer</td>
<td>maximum number of simultaneous connections</td>
</tr>
<tr class="row-odd"><td>Enable home directories</td>
<td>checkbox</td>
<td>if checked, any user home directories located under
<em>Home directories</em>
will be available over the share</td>
</tr>
<tr class="row-even"><td>Home directories</td>
<td>Browse button</td>
<td>select the volume or dataset which contains user home directories</td>
</tr>
</tbody>
</table>
<p>When configuring home directories, it is recommended to create a dataset to hold the home directories which contains a child dataset for each user. As an example, create a dataset named
<em>volume1/homedirs *
and browse to this dataset when configuring the “Home directories” field of the AFP service. Then, as you create each user, first create a child dataset for that user. For example, create a dataset named
*volume1/homedirs/user1</em>
. When you create the
<em>user1</em>
user, browse to the
<a href="#id252"><span class="problematic" id="id253">*</span></a>volume1/homedirs/user1 *
dataset in the “Home Directory” field of the “Add New User” screen.</p>
<div class="section" id="id254">
<h4>Troubleshooting<a class="headerlink" href="#id254" title="Permalink to this headline">¶</a></h4>
<p>If you receive a “Something wrong with the volume&#8217;s CNID DB” error message, run the following command from
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
, replacing the path to the problematic AFP share:</p>
<p><strong>dbd -rf /path/to/share</strong></p>
<p>This command may take a while, depending upon the size of the volume or dataset being shared. This command will wipe the CNID database and rebuild it from the CNIIDs stored in the AppleDouble files.</p>
</div>
</div>
<div class="section" id="id256">
<h3>CIFS<a class="headerlink" href="#id256" title="Permalink to this headline">¶</a></h3>
<p>The Common Internet File System (CIFS) is a network protocol that offers file services for (typically) Windows computers. Unix-like systems that provide a
<a class="reference external" href="http://www.samba.org/samba/GUI/">CIFS client</a>
can also connect to CIFS shares. Before configuring this service, you should first create your CIFS shares in Sharing →
<a class="reference external" href="#1.7.3.Windows(CIFS)Shares|outline">Windows (CIFS) Shares</a>
→ Add Windows (CIFS) Share. After configuring this service, go to Services → Control Services to start the service. The CIFS shares will not be available on the network if this service is not running.</p>
<p><strong>NOTE:</strong>
after starting the CIFS service, it may take several minutes for the
<a class="reference external" href="http://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/NetworkBrowsing.html#id2581357">master browser election</a>
to occur and for the FreeNAS® system to become available in Windows Explorer.</p>
<p>Starting this service will open the following ports on the FreeNAS® system:</p>
<ul class="simple">
<li>TCP 139 (smbd)</li>
<li>TCP 445 (smbd)</li>
<li>UDP 137 (nmbd)</li>
<li>UDP 138 (nmbd)</li>
</ul>
<p>Figure 8.3a shows the configuration options which are described in Table 8.3a. This configuration screen is really a front-end to
<a class="reference external" href="http://samba.org/samba/docs/man/manpages-3/smb.conf.5.html">smb.conf(5)</a>
.</p>
<p>Figure
8
.
3
a: Configuring CIFS</p>
<p><strong>Table 8.3a: CIFS Configuration Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="7%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>NetBIOS Name</td>
<td>string</td>
<td>must be lowercase and and is automatically populated with the hostname of the FreeNAS® system; it
<strong>must</strong>
** **
be different from the
<em>Workgroup</em>
name</td>
</tr>
<tr class="row-odd"><td>Workgroup</td>
<td>string</td>
<td>must match Windows workgroup name; this setting is ignored if the Active Directory or LDAP service is running</td>
</tr>
<tr class="row-even"><td>Description</td>
<td>string</td>
<td>optional</td>
</tr>
<tr class="row-odd"><td>DOS Charset</td>
<td>drop-down menu</td>
<td>the character set Samba uses when communicating with DOS and Windows 9x/M
E
clients; default is
<em>CP437</em></td>
</tr>
<tr class="row-even"><td>UNIX Charset</td>
<td>drop-down menu</td>
<td>default is
<em>UTF-8</em>
which supports all characters in all languages</td>
</tr>
<tr class="row-odd"><td>Log Level</td>
<td>drop-down menu</td>
<td>choices are
<em>Minimum</em>
,
<em>Normal</em>
,
<em>Full</em>
, or
<em>Debug</em></td>
</tr>
<tr class="row-even"><td>Use syslog</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-odd"><td>Local Master</td>
<td>checkbox</td>
<td><p class="first">determines whether or not the FreeNAS® system participates in a browser election
; should be disabled when network contains an AD or LDAP server and is not necessary if
Vista or
Windows</p>
<p class="last">7 machines are present</p>
</td>
</tr>
<tr class="row-even"><td>Time Server for Domain</td>
<td>checkbox</td>
<td>determines whether or not the FreeNAS® system advertises itself as a time server to Windows clients; should be disabled when network contains an AD or LDAP server</td>
</tr>
<tr class="row-odd"><td>Guest Account</td>
<td>drop-down menu</td>
<td>account to be used for guest access; that account must have permission to access the shared volume/dataset</td>
</tr>
<tr class="row-even"><td>File mask</td>
<td>integer</td>
<td>overrides default file creation mask of 0666 which creates files with read and write access for everybody</td>
</tr>
<tr class="row-odd"><td>Directory mask</td>
<td>integer</td>
<td>overrides default directory creation mask of 0777 which grants directory read, write and execute access for everybody</td>
</tr>
<tr class="row-even"><td>EA Support</td>
<td>checkbox</td>
<td>enables extended attributes</td>
</tr>
<tr class="row-odd"><td>Support DOS File Attributes</td>
<td>checkbox</td>
<td>allows a user who has write access to a file to modify the permissions, even if not the owner of the file</td>
</tr>
<tr class="row-even"><td>Allow Empty Password</td>
<td>checkbox</td>
<td>if checked, users can just press enter when prompted for a password; requires that the username/password be the same for the FreeNAS® user account and the Windows user account</td>
</tr>
<tr class="row-odd"><td>Auxiliary parameters</td>
<td>string</td>
<td><a href="#id259"><span class="problematic" id="id260">*</span></a>smb.conf *
options not covered elsewhere in this screen; see
<a class="reference external" href="http://oreilly.com/openbook/samba/book/appb_02.html">the</a>
<a class="reference external" href="http://oreilly.com/openbook/samba/book/appb_02.html">Samba Guide</a>
for additional settings</td>
</tr>
<tr class="row-even"><td>Enable home directories</td>
<td>checkbox</td>
<td>if checked, a folder with the same name as the user account will be created for each user</td>
</tr>
<tr class="row-odd"><td>Enable home directories browsing</td>
<td>checkbox</td>
<td>users can browse (but not write to) other users&#8217; home directories</td>
</tr>
<tr class="row-even"><td>Home directories</td>
<td>browse button</td>
<td>select volume/dataset where the home directories will be created</td>
</tr>
<tr class="row-odd"><td>Homes auxiliary parameters</td>
<td>string</td>
<td><p class="first">options specific to the [homes] section of
<em>smb.conf</em>
; for example,
<strong>hide dot files = yes</strong></p>
<p class="last">hides files beginning with a dot in home directories</p>
</td>
</tr>
<tr class="row-even"><td>Unix Extensions</td>
<td>checkbox</td>
<td>allows non-Windows CIFS clients to access symbolic links and hard links, has no affect on Windows clients</td>
</tr>
<tr class="row-odd"><td>Zeroconf share discovery</td>
<td>checkbox</td>
<td>e
nable if
Mac clients will be connecting to the CIFS share</td>
</tr>
<tr class="row-even"><td>Hostnames lookups</td>
<td>checkbox</td>
<td>allows you to specify hostnames rather than IP addresses in the Hosts Allow or Hosts Deny fields of a CIFS share; uncheck if you only use IP addresses as it saves the time of a host lookup</td>
</tr>
<tr class="row-odd"><td>Server minimum protocol</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>Server maximum protocol</td>
<td>&nbsp;</td>
<td>&nbsp;</td>
</tr>
</tbody>
</table>
<p>Beginning with FreeNAS® 8.0.3-RELEASE, changes to CIFS settings and CIFS shares take effect immediately. For previous versions, changes will not take effect until you manually stop and start the CIFS service.</p>
<p><strong>NOTE:</strong>
do not set the
<em>directory name cache size</em>
as an auxiliary parameter. Due to differences in how Linux and BSD handle file descriptors, directory name caching is disabled on BSD systems in order to improve performance.</p>
<div class="section" id="troubleshooting-tips">
<h4>Troubleshooting Tips<a class="headerlink" href="#troubleshooting-tips" title="Permalink to this headline">¶</a></h4>
<p>Samba is single threaded, so CPU speed makes a big difference in CIFS performance. Your typical
2.5Ghz Intel quad core or greater should be capable to handle speeds in excess of Gb LAN while low power CPUs such as Intel Atoms and AMD C-30sE-350E-450 will not be able to achieve more than about 30-40MB/sec typically. Remember that other loading such as ZFS loading will also require CPU resources and may cause Samba performance to be less than optimal
.</p>
<p>Samba&#8217;s
“
write cache
”
parameter has been reported to improve write performance in some configurations and can be added to the Auxiliary Parameters field. Use an integer value which is a multiple of _SC_PAGESIZE (typically 4096) to avoid memory fragmentation. This will increase
Samba&#8217;s memory requirements and should not be used on systems with limited RAM.</p>
<p>If you wish to increase network performance, read the Samba section on
<a class="reference external" href="http://samba.org/samba/docs/man/manpages-3/smb.conf.5.html#SOCKETOPTIONS%7C">socket options</a>
. It indicates which options are available and recommends that you experiment to see which are supported by your clients and improve your network&#8217;s performance.</p>
<p>Windows automatically caches file sharing information. If you make changes to a CIFS share or to the permissions of a volume/dataset being shared by CIFS and are no longer able to access the share, try logging out and back into the Windows system.
Alternately, users can type
<strong>net use /delete *</strong>
from the command line to clear their SMB sessions.</p>
<p>Windows also automatically caches login information. If you wish users to be prompted to login every time access is required, reduce the cache settings on the client computers.</p>
<p>Where possible, avoid using a mix of case in filenames as this may cause confusion for Windows users.
<a class="reference external" href="http://oreilly.com/openbook/samba/book/ch05_04.html">Representing and resolving filenames with Samba</a>
explains this in more detail.</p>
<p>If permissions work for Windows users but not for OS X users, try disabling
<em>Unix Extensions</em>
and restarting the CIFS service.</p>
<p>If the CIFS service will not start, run this command from
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
to see if there is an error in the configuration:</p>
<p><strong>testparm /usr/local/etc/smb.conf</strong></p>
<p>The
<a class="reference external" href="http://www.samba.org/samba/docs/man/Samba-HOWTO-Collection/domain-member.html#id2573692">Common Errors</a>
section of the Samba documentation contains additional troubleshooting tips.</p>
</div>
</div>
<div class="section" id="id262">
<h3>Directory Services<a class="headerlink" href="#id262" title="Permalink to this headline">¶</a></h3>
<p>FreeNAS® supports the following directory services:</p>
<ul class="simple">
<li>Active Directory (for Windows 2000 and higher networks)</li>
<li>Domain Controller (for configuring FreeNAS® as a domain controller)</li>
<li>LDAP</li>
<li>NIS</li>
<li>NT4 (for Windows networks older than Windows 2000)</li>
</ul>
<p>This section summarizes each of these services and their available configurations within the FreeNAS® GUI.</p>
<p><strong>NOTE:</strong>
at this time,
<strong>only one directory service can be configured</strong>
. That service must first be selected in the System → Settings → General → Directory Service drop-down menu. Once selected, a Directory Service entry will be added to Services → Control Services so that the service can be started, stopped, and configured.</p>
<div class="section" id="id263">
<h4>Active Directory<a class="headerlink" href="#id263" title="Permalink to this headline">¶</a></h4>
<p>Active Directory (AD) is a service for sharing resources in a Windows network. AD can be configured on a Windows server that is running Windows Server 2000 or higher or on a Unix-like operating
system that is running
<a class="reference external" href="http://wiki.samba.org/index.php/Samba4/HOWTO#Step_4:_Provision_Samba4">Samba version 4</a>
. Since AD provides authentication and authorization services for the users in a network, you do not have to recreate these user accounts on the FreeNAS® system. Instead, configure the Active Directory service so that it can import the account information and imported users can be authorized to access the CIFS shares on the FreeNAS® system.</p>
<p><strong>NOTE:</strong>
if your network contains an NT4 domain controller, or any domain controller containing a version which is earlier than Windows 2000, configure
<a class="reference external" href="#1.8.4.4.NT4|outline">NT4</a>
instead.</p>
<p>Many changes and improvements have been made to Active Directory support within FreeNAS®. If you are not running FreeNAS® 9.2.2-RELEASE, it is strongly recommended that you upgrade before attempting Active Directory integration.</p>
<p><strong>Before configuring the Active Directory service</strong>
, ensure name resolution is properly configured by
<strong>ping</strong>
ing the domain name of the Active Directory domain controller from
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
on the FreeNAS® system. If the
<strong>ping</strong>
fails, check the DNS server and default gateway settings in Network →
<a class="reference external" href="#1.5.1.GlobalConfiguration|outline">Global</a>
<a class="reference external" href="#1.5.1.GlobalConfiguration|outline">Configuration</a>
on the FreeNAS® system.</p>
<p>Next, add a DNS record for the FreeNAS® system on the Windows server and verify that you can
<strong>ping</strong>
the hostname of the FreeNAS® system from the domain controller.</p>
<p>Active Directory relies on Kerberos, which is a time sensitive protocol. This means that the time on both the FreeNAS® system and the Active Directory Domain Controller can not be out of sync by more than a few minutes. The best way to ensure that the same time is running on both systems is to configure both systems to:</p>
<ul class="simple">
<li>use the same NTP server (set in System →
<a class="reference external" href="#1.4.3.NTPServers|outline">NTP Servers</a>
on the FreeNAS® system)</li>
<li>have the same timezone</li>
<li>be set to either localtime or universal time at the BIOS level</li>
</ul>
<p>Figure 8.4a shows the screen that appears when you click Services → Directory Services → Active Directory. Table 8.4a describes the configurable options. Some settings are only available in Advanced Mode. To see these settings, either click the Advanced Mode button or configure the system to always display these settings by checking the box “Show advanced fields by default” in System → Settings → Advanced.</p>
<p>Figure 8.4a: Configuring Active Directory</p>
<p><a class="reference internal" href="_images/10000000000002EB00000195BD451959.png"><img alt="10000000000002EB00000195BD451959_png" src="_images/10000000000002EB00000195BD451959.png" style="width: 6.9252in; height: 3.7543in;" /></a></p>
<p>Table 8.4a: Active Directory Configuration Options</p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="6%" />
<col width="85%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Domain Name</td>
<td>string</td>
<td>name of Active Directory domain (e.g.
<em>example.com</em>
) or child domain (e.g.
<em>sales.example.com</em>
)</td>
</tr>
<tr class="row-odd"><td>NetBIOS Name</td>
<td>string</td>
<td>automatically populated with the hostname of the FreeNAS® system;
<strong>use caution when changing this setting</strong>
** **
as setting an
<a class="reference external" href="http://forums.freenas.org/threads/before-you-setup-ad-authentication-please-read.2447/">incorrect value can corrupt an AD installation</a></td>
</tr>
<tr class="row-even"><td>Workgroup Name</td>
<td>string</td>
<td>name of Windows server&#8217;s workgroup (for older Microsoft clients)</td>
</tr>
<tr class="row-odd"><td>Domain Account
Name</td>
<td>string</td>
<td>name of the
Active Directory administrator
account</td>
</tr>
<tr class="row-even"><td>Domain Account
Password</td>
<td>string</td>
<td>password for the
Active Directory administrator account</td>
</tr>
<tr class="row-odd"><td>Use keytab</td>
<td>checkbox</td>
<td>only available in Advanced Mode;
if selected, browse to the
<em>Kerberos keytab</em></td>
</tr>
<tr class="row-even"><td>Kerberos keytab</td>
<td>browse button</td>
<td>only available in Advanced Mode;
browse to the location of the keytab created using the instructions in
<a class="reference external" href="#1.8.4.1.1.UsingaKeytab|outline">Using a Keytab</a></td>
</tr>
<tr class="row-odd"><td>Verbose logging</td>
<td>checkbox</td>
<td>only available in Advanced Mode; if checked, logs attempts to join the domain to
<em>/var/log/messages</em></td>
</tr>
<tr class="row-even"><td>UNIX extensions</td>
<td>checkbox</td>
<td>only available in Advanced Mode;
** only**
** **
check this box if the AD server has been explicitly configured to map permissions for UNIX users; checking this box provides persistent UIDs and GUIDs, otherwise, users/groups get mapped to the UID/GUID range configured in Samba</td>
</tr>
<tr class="row-odd"><td>Allow Trusted Domains</td>
<td>checkbox</td>
<td>only available in Advanced Mode; should only be enabled if network has active
<a class="reference external" href="http://technet.microsoft.com/en-us/library/cc757352%28WS.10%29.aspx">domain/forest trusts</a>
and you need to manage files on multiple domains; use with caution as it will generate more winbindd traffic, slowing down the ability to filter through user/group information</td>
</tr>
<tr class="row-even"><td>Use default domain</td>
<td>checkbox</td>
<td>only available in Advanced Mode; when unchecked, the domain name is prepended to the username; if
<em>Allow Trusted Domains</em>
is checked and multiple domains use the same usernames, uncheck this box to prevent name collisions</td>
</tr>
<tr class="row-odd"><td>Domain Controller</td>
<td>string</td>
<td>only available in Advanced Mode; can be used to specify hostname of domain controller to use</td>
</tr>
<tr class="row-even"><td>Global Catalog Server</td>
<td>string</td>
<td>only available in Advanced Mode; can be used to specify hostname of global catalog server to use</td>
</tr>
<tr class="row-odd"><td>Kerberos Server</td>
<td>string</td>
<td>only available in Advanced Mode; can be used to specify hostname of kerberos server to use</td>
</tr>
<tr class="row-even"><td>Kerberos Password Server</td>
<td>string</td>
<td>only available in Advanced Mode; can be used to specify hostname of kerberos password server to use</td>
</tr>
<tr class="row-odd"><td>AD timeout</td>
<td>integer</td>
<td>only available in Advanced Mode; in seconds, increase if the AD service does not start after connecting to the domain</td>
</tr>
<tr class="row-even"><td>DNS timeout</td>
<td>integer</td>
<td>only available in Advanced Mode; in seconds, increase if AD DNS queries timeout</td>
</tr>
</tbody>
</table>
<p><strong>NOTE:</strong>
Active Directory places restrictions on which characters are allowed in Domain and NetBIOS names. If you are having problems connecting to the realm,
<a class="reference external" href="http://support.microsoft.com/kb/909264">verify</a>
that your settings do not include any disallowed characters. Also, the Administrator Password cannot contain the
<em>$</em>
character. If a
<em>$</em>
exists in the domain administrator&#8217;s password, kinit will report a “Password Incorrect” error and ldap_bind will report an “Invalid credentials (49)” error.</p>
<p>Once you have configured the Active Directory service, start it in Services → Control Services → Directory Services. It may take a few minutes for the Active Directory information to be populated to the FreeNAS® system. Once populated, the AD users and groups will be available in the drop-down menus of the permissions screen of a volume/dataset. For performance reasons, every available user may not show in the listing. However, it will autocomplete all applicable users if you start typing in a username.</p>
<p>You can verify which Active Directory users and groups have been imported to the FreeNAS® system by using these commands within the FreeNAS®
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
:</p>
<p><strong>wbinfo -u</strong></p>
<p>(to view users)</p>
<p><a href="#id267"><span class="problematic" id="id268">**</span></a>wbinfo -g **
(to view groups)</p>
<p>In addition,
<strong>wbinfo -t</strong>
will test the connection and, if successful, will give a message similar to:</p>
<p>checking the trust secret for domain YOURDOMAIN via RPC calls succeeded</p>
<p>To manually check that a specified user can authenticate:</p>
<p><strong>net ads join -S dcname -U username</strong></p>
<p>If no users or groups are listed in the output of those commands, these commands will provide more troubleshooting information:</p>
<p><strong>getent passwd</strong></p>
<p><strong>getent group</strong></p>
<div class="section" id="id269">
<h5>Using a Keytab<a class="headerlink" href="#id269" title="Permalink to this headline">¶</a></h5>
<p>Kerberos keytabs are used to do Active Directory joins without a password. This means that the password for the Active Directory administrator account does not need to be saved into the FreeNAS® configuration database, which is a security risk in some environments.</p>
<p>When using a keytab, it is recommended to create and use a less privileged account for performing the required LDAP queries as the password for that account will be stored in the FreeNAS® configuration database. Create this account on the domain controller, then input that account name and its associated password into the
<em>Domain Account Name</em>
and
<em>Domain Account Password</em>
fields in the screen shown in Figure 8.4a.</p>
<p>The keytab itself can be created on a Windows system using these commands. The text in red needs to be modified to the actual values used in the domain.</p>
<p><strong>ktpass.exe -out hostname.keytab host/</strong>
<strong>hostname&#64;DOMAINNAME</strong>
** -ptype KRB5_NT_PRINCIPAL -mapuser **
<strong>DOMAINusername</strong>
** -pass **
<strong>userpass</strong></p>
<p><strong>setspn -A host/</strong>
<strong>hostname&#64;DOMAINNAME DOMAINusername</strong></p>
<p>where:</p>
<ul class="simple">
<li><strong>hostname</strong>
is the fully qualified hostname of the domain controller</li>
<li><strong>DOMAINNAME</strong>
is the domain name in all caps</li>
<li><strong>DOMAIN</strong>
is the pre-Windows 2000 short name for the domain</li>
<li><strong>username</strong>
is the privileged account name</li>
<li><strong>userpass</strong>
is the password associated with username</li>
</ul>
<p>This will create a keytab with sufficient privileges to grant tickets for CIFS and LDAP.</p>
<p>Once the keytab is generated, transfer it to the FreeNAS® system, check the
<em>Use keytab</em>
box and browse to the location of the keytab.</p>
</div>
<div class="section" id="id270">
<h5>Troubleshooting Tips<a class="headerlink" href="#id270" title="Permalink to this headline">¶</a></h5>
<p>I
f you are running AD in a 2003/2008 mixed domain, see this
<a class="reference external" href="http://forums.freenas.org/showthread.php?1931-2008R2-2003-mixed-domain">forum post</a>
for instructions on how to prevent the secure channel key from becoming corrupt.</p>
<p>Active Directory uses DNS to determine the location of the domain controllers and global catalog servers in the network. Use the
<strong>host -t srv _ldap._tcp.domainname.com</strong>
command to determine the network&#8217;s SRV records and, if necessary, change the weight and/or priority of the SRV record to reflect the fastest server. More information about SRV records can be found in the Technet article
<a class="reference external" href="http://technet.microsoft.com/en-us/library/cc759550%28WS.10%29.aspx">How DNS</a>
<a class="reference external" href="http://technet.microsoft.com/en-us/library/cc759550%28WS.10%29.aspx">Support for Active Directory Works</a>
.</p>
<p>The realm that is used depends upon the priority in the SRV DNS record, meaning that DNS can override your Active Directory settings. If you are unable to connect to the correct realm, check the SRV records on the DNS server.
<a class="reference external" href="http://www.informit.com/guides/content.aspx?g=security&amp;seqNum=37&amp;rll=1">This article</a>
describes how to configure KDC discovery over DNS and provides some examples of records with differing priorities.</p>
<p>If the cache becomes out of sync due to an AD server being taken off and back online, resync the cache using System → Settings → Advanced → Rebuild LDAP/AD Cache.</p>
<p>An expired password for the administrator account will cause kinit to fail so ensure that the password is still valid.</p>
<p>Try creating a Computer entry on the Windows server&#8217;s OU. When creating this entry, enter the FreeNAS® hostname in the name field. Make sure it is the same name as the one set in the
<em>Hostname</em>
field in Network → Global Configuration and the
<em>NetBIOS Name</em>
in Services → Directory Services → Active Directory settings. Make sure the hostname of the domain controller is set in the
<em>Domain Controller</em>
field of Services → Directory Services → Active Directory.</p>
</div>
</div>
<div class="section" id="domain-controller">
<h4>Domain Controller<a class="headerlink" href="#domain-controller" title="Permalink to this headline">¶</a></h4>
<p>Beginning with FreeNAS® 9.2.1, FreeNAS® uses Samba4, meaning that it can be configured to act as the domain controller for a network.
Refer to the
<a class="reference external" href="https://wiki.samba.org/index.php/FAQ">Samba FAQ</a>
for further information.</p>
<p><strong>NOTE:</strong>
creating a domain controller is a complex process that requires a good understanding of how Active Directory works. While FreeNAS® makes it easy to input the needed settings into the administrative graphical interface, it can&#8217;t tell you what those settings should be. Refer to the
<a class="reference external" href="http://wiki.samba.org/index.php/Samba_AD_DC_HOWTO">Samba AD DC HOWTO</a>
for more information about creating a new domain. The current implementation does not support a configuration that allows FreeNAS® to join an existing domain as a domain controller. This limitation will be addressed in a future version of FreeNAS®.</p>
<p>Figure 8.4b shows the configuration screen for creating a domain controller and Table 8.4b summarizes the available options.</p>
<p><strong>Figure 8.4b: Domain Controller Settings</strong></p>
<p><a class="reference internal" href="_images/10000000000002E5000001C53C1210DD.png"><img alt="10000000000002E5000001C53C1210DD_png" src="_images/10000000000002E5000001C53C1210DD.png" style="width: 6.9252in; height: 4.2327in;" /></a></p>
<p><strong>Table 8.4b: Domain Controller Configuration Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="7%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Realm</td>
<td>string</td>
<td>capitalized DNS realm name</td>
</tr>
<tr class="row-odd"><td>Domain</td>
<td>string</td>
<td>capitalized domain name</td>
</tr>
<tr class="row-even"><td>Server Role</td>
<td>drop-down menu</td>
<td>at this time, the only supported role is as the domain controller for a new domain</td>
</tr>
<tr class="row-odd"><td>DNS Backend</td>
<td>drop-down menu</td>
<td>choices are
<em>SAMBA_INTERNAL</em>
,
<em>BIND9_FLATFILE</em>
,
<em>BIND9_DLZ</em>
, or
<em>NONE</em>
; refer to
<a class="reference external" href="https://wiki.samba.org/index.php/DNS">Which DNS backend should I choose?</a>
for details</td>
</tr>
<tr class="row-even"><td>DNS Forwarder</td>
<td>string</td>
<td>IP address of DNS forwarder; required for recursive queries when
<em>SAMBA_INTERNAL</em>
is selected</td>
</tr>
<tr class="row-odd"><td>Domain Forest Level</td>
<td>drop-down menu</td>
<td>choices are
<em>2000</em>
,
<em>2003</em>
,
<em>2008</em>
, or
<a href="#id273"><span class="problematic" id="id274">*</span></a>2008_R2; *
refer to
<a class="reference external" href="http://technet.microsoft.com/en-us/library/understanding-active-directory-functional-levels%28WS.10%29.aspx">Understanding Active Directory Domain Services (AD DS) Functional Levels</a>
for details</td>
</tr>
<tr class="row-even"><td>Administrator password</td>
<td>string</td>
<td>password to be used for the Active Directory administrator account</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id275">
<h4>LDAP<a class="headerlink" href="#id275" title="Permalink to this headline">¶</a></h4>
<p>FreeNAS® includes an
<a class="reference external" href="http://www.openldap.org/">OpenLDAP</a>
client for accessing information from an
LDAP
server. An
LDAP</p>
<p>server provides directory services for finding network resources such as users and their associated permissions. Examples of
LDAP
servers include Microsoft Server (2000 and newer), Mac
OS
X Server, Novell eDirectory, and OpenLDAP running on a BSD or Linux system. If an
LDAP
server is running on your network, you should configure the FreeNAS®
LDAP
service so that the network&#8217;s users can authenticate to the
LDAP
server and thus be provided authorized access to the data stored on the FreeNAS® system.</p>
<p><strong>NOTE:</strong>
LDAP will not work with CIFS shares until the LDAP directory has been configured for and populated with Samba attributes. The most popular script for performing this task is
<a class="reference external" href="http://download.gna.org/smbldap-tools/">smbldap-tools</a>
and instructions for using it can be found at
<a class="reference external" href="http://download.gna.org/smbldap-tools/docs/samba-ldap-howto/#htoc29">The Linux Samba-OpenLDAP Howto</a>
.</p>
<p>Figure 8.4c shows the
LDAP
Configuration screen that is seen when you click Services → Directory Services → LDAP.</p>
<p><strong>Figure 8.4c: Configuring **
**LDAP</strong></p>
<p><a class="reference internal" href="_images/100000000000022A000001A5020C73E1.png"><img alt="100000000000022A000001A5020C73E1_png" src="_images/100000000000022A000001A5020C73E1.png" style="width: 6.6744in; height: 3.898in;" /></a></p>
<p>Table 8.4c summarizes the available configuration options. If you are new to LDAP terminology, skim through the
<a class="reference external" href="http://www.openldap.org/doc/admin24/">OpenLDAP Software 2.4 Administrator&#8217;s Guide</a>
.</p>
<p><strong>Table 8.4c: **
**LDAP</strong>
** Configuration Options**</p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="12%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Hostname</td>
<td>string</td>
<td>hostname or IP address of
LDAP
server</td>
</tr>
<tr class="row-odd"><td>Base DN</td>
<td>string</td>
<td>top level of the
LDAP
directory tree to be used when searching for resources (e.g.
<em>dc=test,dc=org</em>
)</td>
</tr>
<tr class="row-even"><td>Allow Anonymous
Binding</td>
<td>checkbox</td>
<td>instructs LDAP server to not provide authentication and to allow read/write access to any client</td>
</tr>
<tr class="row-odd"><td>Root bind DN</td>
<td>string</td>
<td>name of administrative account on LDAP server (e.g.
<em>cn=Manager,dc=test,dc=org)</em></td>
</tr>
<tr class="row-even"><td>Root bind password</td>
<td>string</td>
<td>password for
<em>Root bind DN</em></td>
</tr>
<tr class="row-odd"><td>Password Encryption</td>
<td>drop-down menu</td>
<td>select a type supported by the LDAP server, choices are:
<em>clear</em>
(unencrypted),
<em>crypt</em>
,
<em>md5</em>
,
<em>nds</em>
,
<em>racf</em>
,
<em>ad</em>
,
<em>exop</em></td>
</tr>
<tr class="row-even"><td>User Suffix</td>
<td>string</td>
<td>optional, can be added to name when user account added to
LDAP
directory (e.g. dept. or company name)</td>
</tr>
<tr class="row-odd"><td>Group Suffix</td>
<td>string</td>
<td>optional, can be added to name when group added to
LDAP
directory (e.g. dept. or company name)</td>
</tr>
<tr class="row-even"><td>Password Suffix</td>
<td>string</td>
<td>optional, can be added to password when password added to
LDAP
directory</td>
</tr>
<tr class="row-odd"><td>Machine Suffix</td>
<td>string</td>
<td>optional, can be added to name when system added to
LDAP
directory (e.g. server, accounting)</td>
</tr>
<tr class="row-even"><td>Encryption Mode</td>
<td>drop-down menu</td>
<td>choices are
<em>Off</em>
,
<em>SSL</em>
, or
<em>TLS</em></td>
</tr>
<tr class="row-odd"><td>Self signed certificate</td>
<td>browse button</td>
<td>browse to the location of the certificate of the LDAP server if SSL connections are used</td>
</tr>
<tr class="row-even"><td>Auxiliary Parameters</td>
<td>string</td>
<td><a class="reference external" href="http://www.openldap.org/software/man.cgi?query=ldap.conf">ldap.conf(5)</a>
options, one per line, not covered by other options in this screen</td>
</tr>
</tbody>
</table>
<p><strong>NOTE:</strong>
FreeNAS® automatically appends the root DN. This means that you should not include the scope and root DN when configuring the user, group, password, and machine suffixes.</p>
<p>After configuring the LDAP service, start it in Services → Control Services → Directory Services. If the service will not start, refer to the
<a class="reference external" href="http://www.openldap.org/doc/admin24/appendix-common-errors.html">Common errors encountered when using OpenLDAP Software</a>
for common errors and how to fix them. When troubleshooting LDAP, open
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
and look for error messages in
<em>/var/log/auth.log.</em></p>
<p>To verify that the users have been imported, type
<strong>getent passwd</strong>
from
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
. To verify that the groups have been imported, type
<strong>getent group</strong>
.</p>
</div>
<div class="section" id="nis">
<h4>NIS<a class="headerlink" href="#nis" title="Permalink to this headline">¶</a></h4>
<p>Network Information Service (NIS) is a service which maintains and distributes a central directory of Unix user and group information, hostnames, email aliases and other text-based tables of information. If a NIS server is running on your network, the FreeNAS® system can be configured to import the users and groups from the NIS directory.</p>
<p>After configuring this service, start it in Services → Control Services → Directory Services.</p>
<p>Figure 8.4d shows the configuration screen which opens when you click Services → Directory Services → NIS. Table 8.4d summarizes the configuration options.</p>
<p><strong>Figure 8.4d: NIS Configuration</strong></p>
<p><a class="reference internal" href="_images/1000000000000266000001D916254B1A.png"><img alt="1000000000000266000001D916254B1A_png" src="_images/1000000000000266000001D916254B1A.png" style="width: 6.3953in; height: 4.9264in;" /></a></p>
<p><strong>Table 8.4d: NIS Configuration Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="7%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Setting</strong></td>
<td><strong>Value</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td>NIS domain</td>
<td>string</td>
<td>name of NIS domain</td>
</tr>
<tr class="row-odd"><td>NIS servers</td>
<td>string</td>
<td>comma delimited list of hostnames or IP addresses</td>
</tr>
<tr class="row-even"><td>Secure mode</td>
<td>checkbox</td>
<td>if checked,
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=ypbind">ypbind(8)</a>
will refuse to bind to any NIS server that is not running as root on a TCP port number over 1024</td>
</tr>
<tr class="row-odd"><td>Manycast</td>
<td>checkbox</td>
<td>if checked
, ypbind
will bind to the server that responds the fastest; this is useful when no local NIS server is available on the same subnet</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id278">
<h4>NT4<a class="headerlink" href="#id278" title="Permalink to this headline">¶</a></h4>
<p>This service should only be configured if the Windows network&#8217;s domain controller is running NT4. If it is not, you should configure
<a class="reference external" href="#1.8.4.1.ActiveDirectory|outline">Active Directory</a>
instead.</p>
<p>Figure 8.4e shows the configuration screen that appears when you click Services → Directory Services → NT4. These options are summarized in Table 8.4e.</p>
<p>After configuring the NT4 service, start it in Services → Control Services → Directory Services.</p>
<p><strong>Figure 8.4e: NT4 Configuration Options</strong></p>
<p><a class="reference internal" href="_images/10000000000002DE000001EF50F27494.png"><img alt="10000000000002DE000001EF50F27494_png" src="_images/10000000000002DE000001EF50F27494.png" style="width: 6.9252in; height: 4.6701in;" /></a></p>
<p><a href="#id280"><span class="problematic" id="id281">**</span></a>Table 8.4e: NT4 Configuration Options **</p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="11%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Domain Controller</td>
<td>string</td>
<td>hostname of domain controller</td>
</tr>
<tr class="row-odd"><td>NetBIOS Name</td>
<td>string</td>
<td>hostname of FreeNAS® system</td>
</tr>
<tr class="row-even"><td>Workgroup Name</td>
<td>string</td>
<td>name of Windows server&#8217;s workgroup</td>
</tr>
<tr class="row-odd"><td>Administrator Name</td>
<td>string</td>
<td>name of the domain administrator account</td>
</tr>
<tr class="row-even"><td>Administrator Password</td>
<td>string</td>
<td>input and confirm the password for the domain administrator account</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id282">
<h3>Dynamic DNS<a class="headerlink" href="#id282" title="Permalink to this headline">¶</a></h3>
<p>Dynamic
DNS
(DDNS) is useful if your FreeNAS® system is connected to an
ISP
that periodically changes the IP address of the system. With dynamic
DNS
, the system can automatically associate its current IP address with a domain name, allowing you to access the FreeNAS® system even if the IP address changes. DDNS requires you to register with a DDNS service such as
<a class="reference external" href="http://www.dyndns.com/">DynDNS</a>
.</p>
<p>Figure 8.5a shows the DDNS configuration screen and Table 8.5a summarizes the configuration options. The values you need to input will be given to you by the DDNS provider. After configuring DDNS, don&#8217;t forget to start the DDNS service in Services → Control Services.</p>
<p>Figure 8.5a: Configuring DDNS</p>
<p><strong>Table 8.5a: DDNS Configuration Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="6%" />
<col width="85%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Provider</td>
<td>drop-down menu</td>
<td>several providers are supported; if your provider is not listed, leave this field blank and specify the custom provider in the
<em>Auxiliary parameters</em>
field</td>
</tr>
<tr class="row-odd"><td>IP Server</td>
<td>string</td>
<td>&nbsp;</td>
</tr>
<tr class="row-even"><td>Domain name</td>
<td>string</td>
<td>fully qualified domain name
(e.g.
<em>yourname.dyndns.org</em>
)</td>
</tr>
<tr class="row-odd"><td>Username</td>
<td>string</td>
<td>username used to logon to the provider and update the record</td>
</tr>
<tr class="row-even"><td>Password</td>
<td>string</td>
<td>password used to logon to the provider and update the record</td>
</tr>
<tr class="row-odd"><td>Update period</td>
<td>integer</td>
<td>in seconds; be careful with this setting as the provider may block you for abuse if this setting occurs more often than the IP address changes</td>
</tr>
<tr class="row-even"><td>Forced update period</td>
<td>integer</td>
<td>in seconds so be careful with this setting as the provider may block you for abuse; issues a DDNS update request even when the address has not changed so that the service provider knows that the account is still active</td>
</tr>
<tr class="row-odd"><td>Auxiliary parameters</td>
<td>string</td>
<td>additional parameters passed to the provider during record update; an example of specifying a custom provider is
<em>dyndns_system default&#64;provider.com</em></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id283">
<h3>FTP<a class="headerlink" href="#id283" title="Permalink to this headline">¶</a></h3>
<p>FreeNAS® uses the
<a class="reference external" href="http://www.proftpd.org/">proftpd</a>
FTP server to provide FTP services. Once the FTP service is configured and started, clients can browse and download data using a web browser or FTP client software. The advantage of FTP is that easy-to-use cross-platform utilities are available to manage uploads to and downloads from the FreeNAS® system. The disadvantage of FTP is that it is considered to be an insecure protocol, meaning that it should not be used to transfer sensitive files. If you are concerned about sensitive data, see
<a class="reference external" href="#1.8.6.3.EncryptingFTP|outline">Encrypting FTP</a>
.</p>
<p>This section provides an overview of the FTP configuration options. It then provides examples for configuring anonymous FTP, specified user access within a chroot environment, encrypting FTP connections, and troubleshooting tips.</p>
<div class="section" id="ftp-configuration-options">
<h4>FTP Configuration Options<a class="headerlink" href="#ftp-configuration-options" title="Permalink to this headline">¶</a></h4>
<p>Figure 8.6a shows the configuration screen for Services → FTP. Some settings are only available in Advanced Mode. To see these settings, either click the Advanced Mode button or configure the system to always display these settings by checking the box “Show advanced fields by default” in System → Settings → Advanced.</p>
<p>Figure 8.6a: Configuring
FTP</p>
<p><a class="reference internal" href="_images/1000000000000373000001E07E2BF2D0.png"><img alt="1000000000000373000001E07E2BF2D0_png" src="_images/1000000000000373000001E07E2BF2D0.png" style="width: 6.9252in; height: 3.7638in;" /></a></p>
<p>Table 8.6a summarizes the available options when configuring the
FTP
server:</p>
<p><strong>Table 8.6a: **
FTP
** Configuration Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="6%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Port</td>
<td>integer</td>
<td>port the FTP service listens on</td>
</tr>
<tr class="row-odd"><td>Clients</td>
<td>integer</td>
<td>maximum number of simultaneous clients</td>
</tr>
<tr class="row-even"><td>Connections</td>
<td>integer</td>
<td>maximum number of connections per IP address where
<em>0</em>
means unlimited</td>
</tr>
<tr class="row-odd"><td>Login Attempts</td>
<td>integer</td>
<td>maximum number of attempts before client is disconnected; increase this if users are prone to typos</td>
</tr>
<tr class="row-even"><td>Timeout</td>
<td>integer</td>
<td>maximum client idle time in seconds before client is disconnected</td>
</tr>
<tr class="row-odd"><td>Allow Root Login</td>
<td>checkbox</td>
<td>discouraged as increases security risk</td>
</tr>
<tr class="row-even"><td>Allow Anonymous Login</td>
<td>checkbox</td>
<td>enables anonymous FTP logins with access
to the
directory specified in
<em>Path</em></td>
</tr>
<tr class="row-odd"><td>Path</td>
<td>browse button</td>
<td>root directory for anonymous FTP connections</td>
</tr>
<tr class="row-even"><td>Allow Local User Login</td>
<td>checkbox</td>
<td>required if
<em>Anonymous Login</em>
is disabled</td>
</tr>
<tr class="row-odd"><td>Display Login</td>
<td>string</td>
<td>message displayed to local login users after authentication; not displayed to anonymous login users</td>
</tr>
<tr class="row-even"><td>File Permission</td>
<td>checkboxes</td>
<td>only available in Advanced Mode; sets default permissions
for newly created files</td>
</tr>
<tr class="row-odd"><td>Directory Permission</td>
<td>checkboxes</td>
<td>only available in Advanced Mode; s
ets default permissions
for newly created directories</td>
</tr>
<tr class="row-even"><td>Enable
<a class="reference external" href="http://en.wikipedia.org/wiki/File_eXchange_Protocol">FXP</a></td>
<td>checkbox</td>
<td>only available in Advanced Mode; e
nables File eXchange Protocol which is
discouraged as it
makes the server
vulnerable to FTP bounce attacks</td>
</tr>
<tr class="row-odd"><td>Allow Transfer Resumption</td>
<td>checkbox</td>
<td>allows FTP clients to
resume
interrupted transfers</td>
</tr>
<tr class="row-even"><td>Always Chroot</td>
<td>checkbox</td>
<td>a local user is only allowed access to their home directory unless the user is a member of group
<em>wheel</em></td>
</tr>
<tr class="row-odd"><td>Require IDENT Authentication</td>
<td>checkbox</td>
<td>only available in Advanced Mode; will result in timeouts if identd is not running on the client</td>
</tr>
<tr class="row-even"><td>Perform Reverse
DNS
Lookups</td>
<td>checkbox</td>
<td>perform reverse DNS lookups on client IPs; can cause long delays if reverse DNS is not configured</td>
</tr>
<tr class="row-odd"><td>Masquerade address</td>
<td>s
tring</td>
<td>public
IP address or hostname;
set if
FTP
clients can not connect through a NAT device</td>
</tr>
<tr class="row-even"><td>Minimum passive port</td>
<td>integer</td>
<td>only available in Advanced Mode; used by clients in PASV mode, default of
<em>0</em>
means any port above 1023</td>
</tr>
<tr class="row-odd"><td>Maximum passive port</td>
<td>integer</td>
<td>only available in Advanced Mode; used by clients in PASV mode, default of
<em>0</em>
means any port above 1023</td>
</tr>
<tr class="row-even"><td>Local user upload bandwidth</td>
<td>integer</td>
<td>only available in Advanced Mode; in KB/s, default of
<em>0</em>
means unlimited</td>
</tr>
<tr class="row-odd"><td>Local user download bandwidth</td>
<td>integer</td>
<td>only available in Advanced Mode; in KB/s, default of
<em>0</em>
means unlimited</td>
</tr>
<tr class="row-even"><td>Anonymous user upload bandwidth</td>
<td>integer</td>
<td>only available in Advanced Mode; in KB/s, default of
<em>0</em>
means unlimited</td>
</tr>
<tr class="row-odd"><td>Anonymous user download bandwidth</td>
<td>integer</td>
<td>only available in Advanced Mode; in KB/s, default of
<em>0</em>
means unlimited</td>
</tr>
<tr class="row-even"><td>Enable TLS</td>
<td>checkbox</td>
<td>only available in Advanced Mode; enables encrypted connections; if not provided,
a certificate will
automatically
be generated and will appear in the
<em>Certificate *
*and private key</em>
box once you click OK</td>
</tr>
<tr class="row-odd"><td>TLS policy</td>
<td>drop-down menu</td>
<td>only available in Advanced Mode; the selected policy defines whether the control channel, data channel, both channels, or neither channel, of an FTP session must occur over SSL/TLS; the policies are described
<a class="reference external" href="http://www.proftpd.org/docs/directives/linked/config_ref_TLSRequired.html">here</a></td>
</tr>
<tr class="row-even"><td>TLS allow client renegotiations</td>
<td>checkbox</td>
<td>only available in Advanced Mode; checking this box is
<strong>not</strong>
recommended as it breaks several security measures; for this and the rest of the TLS fields, refer to
<a class="reference external" href="http://www.proftpd.org/docs/contrib/mod_tls.html">mod_tls</a>
for more details</td>
</tr>
<tr class="row-odd"><td>TLS allow dot login</td>
<td>checkbox</td>
<td>only available in Advanced Mode; if checked, the user&#8217;s
home directory is checked for a
<em>.tlslogin</em>
file which contains one or more PEM-encoded certificates; if not found, the user will be prompted for password authentication</td>
</tr>
<tr class="row-even"><td>TLS allow per user</td>
<td>checkbox</td>
<td>only available in Advanced Mode; if checked, the user&#8217;s password may be sent unencrypted</td>
</tr>
<tr class="row-odd"><td>TLS common name required</td>
<td>checkbox</td>
<td>only available in Advanced Mode; if checked, the common name in the certificate must match the FQDN of the host</td>
</tr>
<tr class="row-even"><td>TLS enable diagnostics</td>
<td>checkbox</td>
<td>only available in Advanced Mode; if checked when troubleshooting a connection, will log more verbosely</td>
</tr>
<tr class="row-odd"><td>TLS export certificate data</td>
<td>checkbox</td>
<td>only available in Advanced Mode; if checked, exports the certificate environment variables</td>
</tr>
<tr class="row-even"><td>TLS no certificate request</td>
<td>checkbox</td>
<td>only available in Advanced Mode; try checking this box if the client can not connect and you suspect that the client software is not properly handling the server&#8217;s certificate request</td>
</tr>
<tr class="row-odd"><td>TLS no empty fragments</td>
<td>checkbox</td>
<td>only available in Advanced Mode; checking this box is
<strong>not</strong>
recommended as it bypasses a security mechanism</td>
</tr>
<tr class="row-even"><td>TLS no session reuse required</td>
<td>checkbox</td>
<td>only available in Advanced Mode; checking this box reduces the security of the connection so only do so if the client does not understand reused SSL sessions</td>
</tr>
<tr class="row-odd"><td>TLS export standard vars</td>
<td>checkbox</td>
<td>only available in Advanced Mode; if checked, sets several environment variables</td>
</tr>
<tr class="row-even"><td>TLS use implicit SSL</td>
<td>checkbox</td>
<td>only available in Advanced Mode; if checked, will break clients that expect explicit connections</td>
</tr>
<tr class="row-odd"><td>TLS DNS name required</td>
<td>checkbox</td>
<td>only available in Advanced Mode; if checked, the client&#8217;s DNS name must resolve to its IP address and the cert must contain the same DNS name</td>
</tr>
<tr class="row-even"><td>TLS IP address required</td>
<td>checkbox</td>
<td>only available in Advanced Mode; if checked, the client&#8217;s certificate must contain the IP address that matches the IP address of the client</td>
</tr>
<tr class="row-odd"><td>Certificate and private key</td>
<td>string</td>
<td>only available in Advanced Mode; the SSL certificate and private key to be used for TLS FTP connections</td>
</tr>
<tr class="row-even"><td>Auxiliary parameters</td>
<td>string</td>
<td>only available in Advanced Mode; only available in Advanced Mode; include
<a class="reference external" href="http://linux.die.net/man/8/proftpd">proftpd(8)</a>
parameters not covered elsewhere in this screen</td>
</tr>
</tbody>
</table>
<p>The following example demonstrates the auxiliary parameters that will prevent all users from performing the FTP DELETE command:</p>
<p>&lt;Limit DELE&gt;</p>
<p>DenyAll</p>
<p>&lt;/Limit&gt;</p>
</div>
<div class="section" id="anonymous-ftp">
<h4>Anonymous FTP<a class="headerlink" href="#anonymous-ftp" title="Permalink to this headline">¶</a></h4>
<p>Anonymous FTP may be appropriate for a small network where the FreeNAS® system is not accessible from the Internet and everyone in your internal network needs easy access to the stored data. Anonymous FTP does not require you to create a user account for every user. In addition, passwords are not required so you don&#8217;t have to manage changed passwords on the FreeNAS® system.</p>
<p>To configure anonymous FTP:</p>
<ol class="arabic simple">
<li><strong>Give the built-in ftp user account permissions</strong>
to the volume/dataset to be shared in Storage → Volumes as follows:</li>
</ol>
<ul class="simple">
<li>Owner(user): select the built-in
<em>ftp</em>
user from the drop-down menu</li>
<li>Owner(group): select the built-in
<em>ftp</em>
group from the drop-down menu</li>
<li>Mode: review that the permissions are appropriate for the share</li>
</ul>
<p><a href="#id285"><span class="problematic" id="id286">**</span></a>NOTE: **
for FTP, the type of client does not matter when it comes to the type of ACL. This means that you always use Unix ACLs, even if Windows clients will be accessing FreeNAS® via FTP.</p>
<ol class="arabic simple">
<li><strong>Configure anonymous FTP</strong>
in Services → FTP
by setting the following attributes:</li>
</ol>
<ul class="simple">
<li>check the box
<em>Allow Anonymous Login</em></li>
<li>Path: browse to the volume/dataset/directory to be shared</li>
</ul>
<ol class="arabic simple">
<li><strong>Start the FTP service</strong>
in Control Services. Click the red OFF button next to FTP. After a second or so, it will change to a blue ON , indicating that the service has been enabled.</li>
<li><strong>Test the connection</strong>
from a client using a utility such as
<a class="reference external" href="http://filezilla-project.org/">Filezilla</a>
.</li>
</ol>
<p>In the example shown in Figure 8.6b, a user has input the following information into the Filezilla client:</p>
<ul class="simple">
<li>IP address of the FreeNAS® server:
<em>192.168.1.113</em></li>
<li>Username:
<em>anonymous</em></li>
<li>Password: the email address of the user</li>
</ul>
<p><strong>Figure 8.6b: Connecting Using Filezilla</strong></p>
<p><a class="reference internal" href="_images/100000000000038300000122BD3F6150.png"><img alt="100000000000038300000122BD3F6150_png" src="_images/100000000000038300000122BD3F6150.png" style="width: 6.9252in; height: 2.2335in;" /></a></p>
<p>The messages within the client indicate that the FTP connection is successful. The user can now navigate the contents of the root folder on the remote site—this is the volume/dataset that was specified in the FTP service configuration. The user can also transfer files between the local site (their system) and the remote site (the FreeNAS® system).</p>
</div>
<div class="section" id="specified-user-access-in-chroot">
<h4>Specified User Access in chroot<a class="headerlink" href="#specified-user-access-in-chroot" title="Permalink to this headline">¶</a></h4>
<p>If you require your users to authenticate before accessing the data on the FreeNAS® system, you will need to either create a user account for each user or import existing user accounts using
<a class="reference external" href="#1.8.2.ActiveDirectory|outline">Active</a>
<a class="reference external" href="#1.8.4.1.ActiveDirectory|outline">Directory</a>
or
<a class="reference external" href="#1.8.4.2.LDAP|outline">LDAP</a>
. If you then create a ZFS dataset for each user, you can chroot each user so that they are limited to the contents of their own home directory. Datasets provide the added benefit of configuring a quota so that the size of the user&#8217;s home directory is limited to the size of the quota.</p>
<p>To configure this scenario:</p>
<ol class="arabic simple">
<li><strong>Create a ZFS dataset for each user</strong>
in Storage → Volumes. Click an existing ZFS volume → Create ZFS Dataset and set an appropriate quota for each dataset. Repeat this process to create a dataset for every user that will need access to the FTP service.</li>
<li><strong>If you are not using AD or LDAP, create a user account for each user</strong>
in Account → Users → Add User. For each user, browse to the dataset created for that user in the
<em>Home Directory</em>
field. Repeat this process to create a user account for every user that will need access to the FTP service, making sure to assign each user their own dataset.</li>
<li><a href="#id289"><span class="problematic" id="id290">**</span></a>Set the permissions for each dataset **
in Storage → Volumes. Click the Change Permissions
button for a dataset to assign a user account as Owner of that dataset and to set the desired
permissions for that user. Repeat for each dataset.</li>
</ol>
<p><a href="#id291"><span class="problematic" id="id292">**</span></a>NOTE: **
for FTP, the type of client does not matter when it comes to the type of ACL. This means that
you always use Unix ACLs, even if Windows clients will be accessing FreeNAS® via FTP.</p>
<ol class="arabic simple">
<li><strong>Configure FTP</strong>
in Services → FTP
with the following attributes:</li>
</ol>
<ul class="simple">
<li>Path: browse to the parent volume containing the datasets</li>
<li>make sure the boxes for
<em>Allow Anonymous Login</em>
and
<em>Allow Root Login</em>
are
<strong>unchecked</strong>
** **</li>
<li>check the box
<a href="#id293"><span class="problematic" id="id294">*</span></a>Allow Local User Login *</li>
<li>check the box
<em>Always Chroot</em></li>
</ul>
<ol class="arabic simple">
<li><strong>Start the FTP service</strong>
in Control Services. Click the red OFF button next to FTP. After a second or so, it will change to a blue ON , indicating that the service has been enabled.</li>
<li><strong>Test the connection from a client</strong>
using a utility such as Filezilla.</li>
</ol>
<p>To test this configuration in Filezilla, use the IP address of the FreeNAS® system, the Username of a user that has been associated with a dataset, and the Password for that user. The messages should indicate that the authorization and the FTP connection are successful. The user can now navigate the contents of the root folder on the remote site—this time it is not the entire volume but the dataset that was created for that user. The user should be able to transfer files between the local site (their system) and the remote site (their dataset on the FreeNAS® system).</p>
</div>
<div class="section" id="id295">
<h4>Encrypting FTP<a class="headerlink" href="#id295" title="Permalink to this headline">¶</a></h4>
<p>To configure any FTP scenario to use encrypted connections:</p>
<ol class="arabic simple">
<li><strong>Enable TLS</strong>
in Services → FTP. Check the box
<em>Enable TLS</em>
.
Once you press OK, a certificate and key will automatically be generated for you and proftpd will restart and be configured to use that certificate. If you prefer to use your own certificate, delete the automatically generated one that appears in the
<em>Certificate and private key field</em>
and paste in your own certificate and key.</li>
<li><strong>Specify secure FTP when accessing the FreeNAS® system.</strong>
For example, in Filezilla input
<em>ftps://IP_address</em>
(for an implicit connection) or
<em>ftpes://IP_address</em>
(for an explicit connection) as the Host when connecting. The first time a user connects, they should be presented with the certificate of the FreeNAS® system. Click OK to accept the certificate and negotiate an encrypted connection.</li>
</ol>
<p>To force encrypted connections, add the following line to Auxiliary Parameters:</p>
<p>TLS Required on</p>
</div>
<div class="section" id="id296">
<h4>Troubleshooting<a class="headerlink" href="#id296" title="Permalink to this headline">¶</a></h4>
<p>The FTP service will not start if it can not resolve the system&#8217;s hostname to an IP address using DNS. To see if the FTP service is running, open
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
and issue the command:</p>
<p><strong>sockstat -4p 21</strong></p>
<p>If there is nothing listening on port 21, proftpd isn&#8217;t running. To see the error message that occurs when FreeNAS® tries to start the FTP service,
go to System → Settings → Advanced, check the box “Show
console messages in the footer” and click Save
. Next, go to Services → Control Services and switch the FTP service off then back on in the GUI. Watch the console messages at the bottom of the browser for errors.</p>
<p>If the error refers to DNS, either create an entry in your local DNS server with the FreeNAS® system&#8217;s hostname and IP address or
add an entry for the IP address of the FreeNAS® system in the “Host name database” field of Network →
<a class="reference external" href="#1.5.1.GlobalConfiguration|outline">Global Configuration</a>
.</p>
</div>
</div>
<div class="section" id="id299">
<h3>iSCSI<a class="headerlink" href="#id299" title="Permalink to this headline">¶</a></h3>
<p>iSCSI is a protocol standard for the consolidation of storage data. iSCSI allows FreeNAS® to act like a storage area network (SAN) over an existing Ethernet network. Specifically, it exports disk devices over an Ethernet network that iSCSI clients (called initiators) can attach to and mount. Traditional SANs operate over fibre channel networks which require a fibre channel infrastructure such as fibre channel HBAs, fibre channel switches, and discrete cabling. iSCSI can be used over an existing Ethernet network, although dedicated networks can be built for iSCSI traffic in an effort to boost performance. iSCSI also provides an advantage in an environment that uses Windows shell programs; these programs tend to filter “Network Location” but iSCSI mounts are not filtered. FreeNAS® uses
<a class="reference external" href="http://www.peach.ne.jp/archives/istgt/">istgt</a>
to provide iSCSI.</p>
<p>Before configuring the iSCSI service, you should be familiar with the following iSCSI terminology:</p>
<p><strong>CHAP:</strong>
an authentication method which uses a shared secret and three-way authentication to determine if a system is authorized to access the storage device and to periodically confirm that the session has not been hijacked by another system. In iSCSI, the initiator (client) performs the CHAP authentication.</p>
<p><strong>Mutual CHAP:</strong>
a superset of CHAP in that both ends of the communication authenticate to each other.</p>
<p><strong>Initiator:</strong>
a client which has authorized access to the storage data on the FreeNAS® system. The client requires initiator software to connect to the iSCSI share.</p>
<p><strong>Target:</strong>
a storage resource on the FreeNAS® system.</p>
<p><strong>Extent:</strong>
the storage unit to be shared. It can either be a file or a device.</p>
<p><strong>LUN:</strong>
stands for Logical Unit Number and represents a logical SCSI device. An initiator negotiates with a target to establish connectivity to a LUN; the result is an iSCSI connection that emulates a connection to a SCSI hard disk. Initiators treat iSCSI LUNs the same way as they would a raw SCSI or IDE hard drive; rather than mounting remote directories, initiators format and directly manage filesystems on iSCSI LUNs.</p>
<p>FreeNAS® supports multiple iSCSI drives. When configuring multiple iSCSI LUNs, create a new target for each LUN. Portal groups and initiator groups can be reused without any issue. Since istgt multiplexes a target with multiple LUNs over the same TCP connection, you will experience contention from TCP if there is more than one target per LUN.</p>
<p>In order to configure iSCSI:</p>
<ol class="arabic simple">
<li>Decide if you will use authentication, and if so, whether it will be CHAP or mutual CHAP. If using authentication, create an
<a class="reference external" href="#1.8.7.1.AuthorizedAccesses|outline">authorized access</a>
.</li>
<li>Create either a
<a class="reference external" href="#1.8.7.2.1.AddinganExtent|outline">device extent or a file extent</a>
to be used as storage.</li>
<li>Determine which hosts are allowed to connect using iSCSI and create an
<a class="reference external" href="#1.8.7.4.Initiators|outline">initiator</a>
.</li>
<li>Create at least one
<a class="reference external" href="#1.8.7.5.Portals|outline">portal</a>
.</li>
<li>Review the
<a class="reference external" href="#1.8.7.6.TargetGlobalConfiguration|outline">target global configuration</a>
parameters.</li>
<li>Create a
<a class="reference external" href="#1.8.7.7.Targets|outline">target</a>
.</li>
<li>Associate a
<a class="reference external" href="#1.8.7.8.Target/Extents|outline">target with an extent</a>
.</li>
<li>Start the iSCSI service in Services →
<a class="reference external" href="#1.8.1.ControlServices|outline">Control Services</a>
.</li>
</ol>
<p>The rest of this section describes these steps in more detail.</p>
<div class="section" id="authorized-accesses">
<h4>Authorized Accesses<a class="headerlink" href="#authorized-accesses" title="Permalink to this headline">¶</a></h4>
<p>If you will be using CHAP or mutual CHAP to provide authentication, you must create an authorized access in Services → ISCSI → Authorized Accesses → Add Authorized Access. This screen is shown in Figure 8.7a.</p>
<p><strong>NOTE:</strong>
this screen sets login authentication. This is different from discovery authentication which is set in
<a class="reference external" href="#1.8.7.5.TargetGlobalConfiguration|outline">Target Global Configuration</a>
.</p>
<p>Figure 8.7a: Adding an iSCSI Authorized Access</p>
<p><a class="reference internal" href="_images/100000000000017F00000171394D6770.png"><img alt="100000000000017F00000171394D6770_png" src="_images/100000000000017F00000171394D6770.png" style="width: 3.989in; height: 3.8429in;" /></a></p>
<p>Table 8.7a summarizes the settings that can be configured when adding an authorized access:</p>
<p><strong>Table 8.7a: Authorized Access Configuration Settings</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="6%" />
<col width="4%" />
<col width="90%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Group ID</td>
<td>integer</td>
<td>allows different groups to be configured with different authentication profiles; for instance, all users with a Group ID of 1 will inherit the authentication profile associated with Group 1</td>
</tr>
<tr class="row-odd"><td>User</td>
<td>string</td>
<td>name of user account that will be created on the FreeNAS® device for CHAP authentication with the user on the remote system; many initiators default to using the initiator name as the user</td>
</tr>
<tr class="row-even"><td>Secret</td>
<td>string</td>
<td>password to be associated with
<em>User</em>
; the iSCSI standard requires that this be at least 12 characters long</td>
</tr>
<tr class="row-odd"><td>Peer User</td>
<td>string</td>
<td>only input when configuring mutual CHAP; in most cases it will need to be
the same value as
<em>User</em></td>
</tr>
<tr class="row-even"><td>Peer Secret</td>
<td>string</td>
<td>the mutual secret password which
<strong>must be different than the Secret</strong>
; required if the
<em>Peer User</em>
is set</td>
</tr>
</tbody>
</table>
<p><strong>NOTE:</strong>
CHAP does not work with GlobalSAN initiators on Mac OS X.</p>
<p>As authorized accesses are added, they will be listed under View Authorized Accesses. In the example shown in Figure 8.7b, three users (
<em>test1</em>
,
<em>test2</em>
, and
<em>test3</em>
) and two groups (
<em>1</em>
and
<em>2</em>
) have been created, with group 1 consisting of one CHAP user and group 2 consisting of one mutual CHAP user and one CHAP user. Click an
authorized access entry to display its Edit and Delete buttons.</p>
<p>Figure 8.7b: Viewing Authorized Accesses</p>
<p><a class="reference internal" href="_images/1000000000000272000001EAD978110B.png"><img alt="1000000000000272000001EAD978110B_png" src="_images/1000000000000272000001EAD978110B.png" style="width: 6.5193in; height: 5.1035in;" /></a></p>
</div>
<div class="section" id="extents">
<h4>Extents<a class="headerlink" href="#extents" title="Permalink to this headline">¶</a></h4>
<p>In iSCSI, the target virtualizes something and presents it as a device to the iSCSI client. That something can be a device extent or a file extent:</p>
<p><strong>Device extent:</strong>
virtualizes an unformatted physical disk, RAID controller,
<a class="reference external" href="#1.6.3.6.Creatingazvol|outline">zvol</a>
, zvol snapshot, or an existing
<a class="reference external" href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/disks-hast.html">HAST device</a>
.</p>
<p>Virtualizing a single disk is slow as there is no caching but virtualizing a hardware RAID controller has higher performance due to its cache. This type of virtualization does a pass-through to the disk or hardware RAID controller. None of the benefits of ZFS are provided and performance is limited to the capabilities of the disk or controller.</p>
<p>Virtualizing a zvol adds the benefits of ZFS such as its read cache and write cache. Even if the client formats the device extent with a different filesystem, as far as FreeNAS® is concerned, the data benefits from ZFS features such as block checksums and snapshots.</p>
<p><strong>File extent:</strong>
allows you to export a portion of a ZFS volume. The advantage of a file extent is that you can create multiple exports per volume.</p>
<p>In theory, a zvol and a file extent should have identical performance. In practice, a file extent outperforms in reads/writes but this is only noticeable at 10 GB Ethernet speeds or higher. For high performance, file extents are recommended at this time. Future changes to FreeBSD&#8217;s zvol code will increase its performance.</p>
<div class="section" id="adding-an-extent">
<h5>Adding an Extent<a class="headerlink" href="#adding-an-extent" title="Permalink to this headline">¶</a></h5>
<p>To add an extent, go to Services → ISCSI → Extents → Add Extent. In the example shown in Figure 8.7c, the device extent is using the
<em>export</em>
zvol that was previously created from the
<em>/mnt/volume1</em>
volume.</p>
<p><strong>NOTE:</strong>
in FreeNAS® versions prior to 8.3.1, if a physical disk was used instead of a zvol to create a device extent, a bug wiped the partition table on the disk, resulting in data loss. This bug was fixed in 8.3.1.</p>
<p>Table 8.7b summarizes the settings that can be configured when creating an extent.
Note that
<strong>file extent creation will fail if you do not append the name of the file to be created to the volume/dataset name.</strong>
** **</p>
<p>Figure 8.7c: Adding an iSCSI Extent</p>
<p><a class="reference internal" href="_images/10000000000002AB000001EBE6248ABC.png"><img alt="10000000000002AB000001EBE6248ABC_png" src="_images/10000000000002AB000001EBE6248ABC.png" style="width: 6.9252in; height: 4.9783in;" /></a></p>
<p><strong>Table 8.7b: Extent Configuration Settings</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="8%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Extent Name</td>
<td>string</td>
<td>name of extent; if the
<em>Extent size</em>
is not 0, it can not be an existing file within the volume/dataset</td>
</tr>
<tr class="row-odd"><td>Extent Type</td>
<td>drop-down menu</td>
<td>select from
<em>File</em>
or
<em>Device</em></td>
</tr>
<tr class="row-even"><td>Path to the extent</td>
<td>browse button</td>
<td>only appears if
<em>File</em>
is selected; either browse to an existing file and use 0 as the
<em>Extent size</em>
,
<strong>or</strong>
** **
browse to the volume or dataset, click the Close button, append the
<em>Extent Name</em>
to the path, and specify a value in
<em>Extent *
*size</em></td>
</tr>
<tr class="row-odd"><td>Device</td>
<td>drop-down menu</td>
<td>only appears if
<em>Device</em>
is selected; select the unformatted disk, controller, zvol, zvol snapshot, or HAST device</td>
</tr>
<tr class="row-even"><td>Extent size</td>
<td>integer</td>
<td>only appears if
<em>File</em>
is selected; if the size is specified as 0, the file must already exist and the actual file size will be used; otherwise specifies the size of the file to create</td>
</tr>
<tr class="row-odd"><td>Comment</td>
<td>string</td>
<td>optional</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="initiators">
<h4>Initiators<a class="headerlink" href="#initiators" title="Permalink to this headline">¶</a></h4>
<p>The next step is to configure authorized initiators, or the systems which are allowed to connect to the iSCSI targets on the FreeNAS® system. To configure which systems can connect, use Services → ISCSI → Initiators → Add Initiator, shown in Figure 8.7d.</p>
<p>Figure 8.7d: Adding an iSCSI Initiator</p>
<p><a class="reference internal" href="_images/100000000000022A00000107CAD88F71.png"><img alt="100000000000022A00000107CAD88F71_png" src="_images/100000000000022A00000107CAD88F71.png" style="width: 6.6744in; height: 2.4346in;" /></a></p>
<p><strong>NOTE:</strong>
beginning with 8.2.0, FreeNAS® contains
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=iscontrol">iscontrol(8)</a>
. This utility allows the FreeNAS® system to act as an initiator (rather than a target) and must be run from the command line. If you create a custom configuration for
<strong>iscontrol</strong>
, back it up as it will not survive a reboot of the system.</p>
<p>Table 8.7c summarizes the settings that can be configured when adding an initiator.</p>
<p><strong>Table **
**8.7c: Initiator Configuration Settings</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="8%" />
<col width="73%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Initiators</td>
<td>string</td>
<td>use
<em>ALL</em>
keyword or a list of initiator hostnames separated by commas with no space</td>
</tr>
<tr class="row-odd"><td>Authorized network</td>
<td>string</td>
<td>use
<em>ALL</em>
keyword or a network address with CIDR mask such as
<em>192.168.2.0/24</em></td>
</tr>
<tr class="row-even"><td>Comment</td>
<td>string</td>
<td>optional description</td>
</tr>
</tbody>
</table>
<p>In the example shown in Figure 8.7e, two groups have been created. Group 1 allows connections from any initiator on any network; Group 2 allows connections from any initiator on the
<em>10.10.1.0/24</em>
network. Click an initiator&#8217;s entry to display its Edit and Delete buttons.</p>
<p><strong>NOTE:</strong>
if you delete an initiator, a warning will indicate if any targets or target/extent mappings depend upon the initiator. If you confirm the delete, these will be deleted as well.</p>
<p>Figure 8.7e: Sample iSCSI Initiator Configuration</p>
<p><a class="reference internal" href="_images/100000000000026E000001F5B9108435.png"><img alt="100000000000026E000001F5B9108435_png" src="_images/100000000000026E000001F5B9108435.png" style="width: 6.4783in; height: 5.2181in;" /></a></p>
</div>
<div class="section" id="portals">
<h4>Portals<a class="headerlink" href="#portals" title="Permalink to this headline">¶</a></h4>
<p>A portal specifies the IP address and port number to be used for iSCSI connections. Services → ISCSI → Portals → Add Portal will bring up the screen shown in Figure 8.7f.</p>
<p>Table 8.7d summarizes the settings that can be configured when adding a portal. If you need to assign additional IP addresses to the portal, click the link “Add extra Portal IP”.</p>
<p>Figure 8.7f: Adding an iSCSI Portal</p>
<p><a class="reference internal" href="_images/100000000000020D000001AC8D7B7E46.png"><img alt="100000000000020D000001AC8D7B7E46_png" src="_images/100000000000020D000001AC8D7B7E46.png" style="width: 6.3244in; height: 3.9626in;" /></a></p>
<p><strong>Table 8.7d: Portal Configuration Settings</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="15%" />
<col width="73%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Setting</strong></td>
<td><strong>Value</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td>Comment</td>
<td>string</td>
<td>optional description; portals are automatically assigned a numeric group ID</td>
</tr>
<tr class="row-odd"><td>IP address</td>
<td>drop-down menu</td>
<td>select the IP address associated with an interface or the wildcard address
of
<em>0.0.0.0</em>
(any interface)</td>
</tr>
<tr class="row-even"><td>Port</td>
<td>integer</td>
<td>TCP port used to access the iSCSI target; default is
<em>3260</em></td>
</tr>
</tbody>
</table>
<p>FreeNAS® systems with multiple IP addresses or interfaces can use a portal to provide services on different interfaces or subnets. This can be used to configure multi-path I/O (MPIO). MPIO is more efficient than a link aggregation.</p>
<p>If the
FreeNAS® system has multiple configured interfaces, p
ortals can also be used to provide
network access control. For example, consider a system with four interfaces configured with the following addresses:</p>
<p>192.168.1.1/24</p>
<p>192.168.2.1/24</p>
<p>192.168.3.1/24</p>
<p>192.168.4.1/24</p>
<p>You could create a portal containing the first two IP addresses (group ID 1) and
a portal containing the remaining two IP addresses (group ID 2). You could then create a target named A with a Portal Group
ID of 1 and a second target named B with a Portal Group ID of 2. In this scenario, istgt would listen on all four interfaces, but connections to target A would be limited to the first two networks and connections to target B would be limited to the last two networks.</p>
<p>Another scenario would be to create a portal which includes every IP address
<strong>except</strong>
for the one used by a management interface. This would prevent iSCSI connections to the management interface.</p>
</div>
<div class="section" id="id302">
<h4>Target Global Configuration<a class="headerlink" href="#id302" title="Permalink to this headline">¶</a></h4>
<p>Services → iSCSI → Target Global Configuration, shown in Figures 8.7g, contains settings that apply to all iSCSI shares.
Table 8.7e summarizes the settings that can be configured in the Target Global Configuration screen. The integer values in the table are used to tune network performance; most of these values are described in
<a class="reference external" href="http://tools.ietf.org/html/rfc3720">RFC 3720</a>
.</p>
<p>LUC (Logical Unit Controller) is an API provided by istgt to control removable media by providing functions to list targets, load or unload a media to a unit, change media file, or reset a LUN.</p>
<p>In order to dynamically add or remove
<strong>targets</strong>
without restarting the iSCSI service, which can disrupt iSCSI initiators, set the following options:</p>
<ul class="simple">
<li>check the
<em>Enable LUC</em>
box</li>
<li>leave the
<em>Controller IP address</em>
and
<em>Control Authorized Network</em>
at their default values</li>
<li>change the
<em>Controller Auth Method</em>
to
<em>None</em></li>
</ul>
<p><strong>NOTE:</strong>
the following operations do require that the iSCSI service be restarted: editing a target, adding or deleting LUNs, or changing the size of an existing extent.</p>
<p>Figure 8.7g: iSCSI Target Global Configuration Variables</p>
<p><a class="reference internal" href="_images/100000000000029F00000203E6A9CBB4.png"><img alt="100000000000029F00000203E6A9CBB4_png" src="_images/100000000000029F00000203E6A9CBB4.png" style="width: 6.9252in; height: 5.3146in;" /></a></p>
<p><strong>Table 8.7f: Target Global Configuration Settings</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="8%" />
<col width="83%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Base Name</td>
<td>string</td>
<td>see the “Constructing iSCSI names using the iqn. format” section of
<a class="reference external" href="http://www.ietf.org/rfc/rfc3721.txt">RFC 3721</a>
if you are unfamiliar with this format</td>
</tr>
<tr class="row-odd"><td>Discovery Auth Method</td>
<td>drop-down menu</td>
<td>configures the authentication level required by the target for discovery of valid devices, where
<em>None</em>
will allow anonymous discovery,
<em>CHAP</em>
and
<em>Mutual CHAP</em>
require authentication, and
<em>Auto</em>
lets the initiator decide the authentication scheme</td>
</tr>
<tr class="row-even"><td>Discovery Auth Group</td>
<td>drop-down menu</td>
<td>depends on Discovery Auth Method setting: required if set to
<em>CHAP</em>
or
<em>Mutual CHAP</em>
, optional if set to
<em>Auto</em>
, and not needed if set to
<em>None</em></td>
</tr>
<tr class="row-odd"><td>I/O Timeout</td>
<td>integer representing seconds</td>
<td>sets the limit on how long an I/O can be outstanding before an error condition is returned; values range from 0-300 with a default of
<em>30</em></td>
</tr>
<tr class="row-even"><td>NOPIN Interval</td>
<td>integer
representing seconds</td>
<td>how often the target sends a NOP-IN packet to keep a discovered
session alive; values range from 0-300 with a default of
<em>20</em></td>
</tr>
<tr class="row-odd"><td>Max. Sessions</td>
<td>integer</td>
<td>limits the number of sessions the target portal will create/accept from initiator portals; values range from 1-65536 with a default of
<em>16</em></td>
</tr>
<tr class="row-even"><td>Max. Connections</td>
<td>integer</td>
<td>the number of connections a single initiator can make to a single target; values range from 1-65536 with a default of
<em>8</em></td>
</tr>
<tr class="row-odd"><td>Max. pre-send R2T</td>
<td>integer</td>
<td>values range from 1-255 with a default of
<em>32</em></td>
</tr>
<tr class="row-even"><td>MaxOutstandingR2T</td>
<td>integer</td>
<td>the maximum number of ready to receive packets (R2Ts) the target can have outstanding for a single iSCSI command, where larger values should yield performance increases until MaxOutstandingR2T exceeds the size of the largest Write I/O divided by MaxBurstLength; values range from 1-255 with a default of
<em>16</em></td>
</tr>
<tr class="row-odd"><td>First burst length</td>
<td>integer</td>
<td>maximum amount in bytes of unsolicited data an iSCSI initiator may send to the target during the execution of a single SCSI command; values range from 1- 2^32 with a default of
<em>65,536</em></td>
</tr>
<tr class="row-even"><td>Max burst length</td>
<td>integer</td>
<td>maximum write size in bytes the target is willing to receive between R2Ts; values range from 1-2^32 with a default of
<em>262,144</em></td>
</tr>
<tr class="row-odd"><td>Max receive data segment length</td>
<td>integer</td>
<td>in bytes; values range from 1-2^32 with a default of
<em>262,144</em></td>
</tr>
<tr class="row-even"><td>DefaultTime2Wait</td>
<td>integer</td>
<td>minimum time in seconds to wait before attempting a logout or an active task reassignment after an unexpected connection termination or reset; values range from 1-300 with a default of
<em>2</em></td>
</tr>
<tr class="row-odd"><td>DefaultTime2Retain</td>
<td>integer</td>
<td>maximum time in seconds after Time2Wait before which an active task reassignment is still possible after an unexpected connection termination or reset; values range from 1-300 with a default of
<em>60</em></td>
</tr>
<tr class="row-even"><td>Enable LUC</td>
<td>checkbox</td>
<td>check if you need to dynamically add and remove targets; if checked, the next three fields are activated and required</td>
</tr>
<tr class="row-odd"><td>Controller IP address</td>
<td>IP address</td>
<td>keep the default value of
<em>127.0.0.1</em></td>
</tr>
<tr class="row-even"><td>Controller TCP port</td>
<td>integer</td>
<td>possible values range from 1024-65535 with a default value of
<em>3261</em></td>
</tr>
<tr class="row-odd"><td>Controller Authorized netmask</td>
<td>subnet mask</td>
<td>keep the default value of
<em>127.0.0.0/8</em></td>
</tr>
<tr class="row-even"><td>Controller Auth Method</td>
<td>drop-down menu</td>
<td>choices are
<em>None</em>
,
<em>Auto</em>
,
<em>CHAP</em>
, or
<em>Mutual CHAP</em></td>
</tr>
<tr class="row-odd"><td>Controller Auth Group</td>
<td>drop-down menu</td>
<td>required if Controller Auth Method is set to
<em>CHAP</em>
or
<em>Mutual CHAP</em>
, optional if set to
<em>Auto</em>
, and not needed if set to
<em>None</em></td>
</tr>
</tbody>
</table>
<p>If the settings in this screen differ from the settings on the initiator, set them to be the same. When
making changes, always match the larger setting.</p>
<p>If you are changing integer values to optimize the connection, refer to the iSCSI initiator&#8217;s documentation. For example, the following modifications are recommended if the iSCSI initiator is running on Xenserver:</p>
<ul class="simple">
<li>Max. pre-send R2T:
<em>255</em></li>
<li>MaxOutstandingR2T:
<em>64</em></li>
<li>First burst length:
<em>262,144</em></li>
<li>Max burst length:
<em>2,097,152</em></li>
</ul>
</div>
<div class="section" id="targets">
<h4>Targets<a class="headerlink" href="#targets" title="Permalink to this headline">¶</a></h4>
<p>Next, create a Target using Services → ISCSI → Targets → Add Target, as shown in Figure 8.7h. A target combines a portal ID, allowed initiator ID, and an authentication method. Table 8.7f summarizes the settings that can be configured when creating a Target.</p>
<p><strong>NOTE:</strong>
an iSCSI target creates a block device that may be accessible to multiple initiators. A clustered filesystem is required on the block device, such as VMFS used by VMware ESX/ESXi, in order for multiple initiators to mount the block device read/write. If a traditional filesystem such as EXT, XFS, FAT, NTFS, UFS, or ZFS is placed on the block device, care must be taken that only one initiator at a time has read/write access or the result will be filesystem corruption. If you need to support multiple clients to the same data on a non-clustered filesystem, use CIFS or NFS instead of iSCSI or create multiple iSCSI targets (one per client).</p>
<p>Figure 8.7h: Adding an iSCSI Target</p>
<p><a class="reference internal" href="_images/10000000000001BD000001C3DC193DAA.png"><img alt="10000000000001BD000001C3DC193DAA_png" src="_images/10000000000001BD000001C3DC193DAA.png" style="width: 5.3602in; height: 4.1756in;" /></a></p>
<p><strong>Table 8.7f: Target Settings</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="7%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Target Name</td>
<td>string</td>
<td>required value; base name will be appended automatically if it does not start with
<em>iqn</em></td>
</tr>
<tr class="row-odd"><td>Target Alias</td>
<td>string</td>
<td>optional user-friendly name</td>
</tr>
<tr class="row-even"><td>Serial</td>
<td>string</td>
<td>unique ID for target to allow for multiple LUNs; the default is generated from the system&#8217;s MAC address</td>
</tr>
<tr class="row-odd"><td>Target Flags</td>
<td>drop-down menu</td>
<td>choices are
<em>read-write</em>
or
<em>read-only</em></td>
</tr>
<tr class="row-even"><td>Portal Group ID</td>
<td>drop-down menu</td>
<td>leave empty or select number of existing portal to use</td>
</tr>
<tr class="row-odd"><td>Initiator Group ID</td>
<td>drop-down menu</td>
<td>select which existing initiator group has access to the target</td>
</tr>
<tr class="row-even"><td>Auth Method</td>
<td>drop-down menu</td>
<td>choices are
<em>None</em>
,
<em>Auto</em>
,
<em>CHAP</em>
, or
<em>Mutual CHAP</em></td>
</tr>
<tr class="row-odd"><td>Authentication Group number</td>
<td>drop-down menu</td>
<td><em>None</em>
or integer representing number of existing authorized access</td>
</tr>
<tr class="row-even"><td>Queue Depth</td>
<td>integer</td>
<td>see
<a class="reference external" href="http://storagefoo.blogspot.com/2006/04/queue-depths.html">this post</a>
for an explanation of the math involved; values are 0-255 where
<em>0</em>
is disabled and default is
<em>32</em></td>
</tr>
<tr class="row-odd"><td>Logical Block Size</td>
<td>integer</td>
<td>should only be changed to emulate a physical disk&#8217;s size or to increase the block size to allow for larger filesystems on an operating system limited by block count; default is
<em>512</em></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="target-extents">
<h4>Target/Extents<a class="headerlink" href="#target-extents" title="Permalink to this headline">¶</a></h4>
<p>The last step is associating an extent to a target within Services → ISCSI → Target/Extents → Add Target/Extent. This screen is shown in Figure 8.7i. Use the drop-down menus to select the existing target and extent.</p>
<p>Figure 8.7i: Associating iSCSI Targets/Extents</p>
<p><a class="reference internal" href="_images/100000000000012A000000AEE11388A7.png"><img alt="100000000000012A000000AEE11388A7_png" src="_images/100000000000012A000000AEE11388A7.png" style="width: 3.5898in; height: 1.611in;" /></a></p>
<p>Table 8.7g summarizes the settings that can be configured when associating targets and extents.</p>
<p><strong>Table 8.7g: Target/Extents Configuration Settings</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="29%" />
<col width="55%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td>Setting</td>
<td>Value</td>
<td>Description</td>
</tr>
<tr class="row-even"><td>Target</td>
<td>drop-down menu</td>
<td>select the pre-created target</td>
</tr>
<tr class="row-odd"><td>Extent</td>
<td>drop-down menu</td>
<td>select the pre-created extent</td>
</tr>
</tbody>
</table>
<p>It is recommended to always associate extents to targets in a 1:1 manner, even though the GUI will allow multiple extents to be associated with the same target.</p>
<p>Once iSCSI has been configured, don&#8217;t forget to start it in Services → Control Services. Click the red OFF button next to iSCSI. After a second or so, it will change to a blue ON, indicating that the service has started.</p>
</div>
<div class="section" id="connecting-to-iscsi-share">
<h4>Connecting to iSCSI Share<a class="headerlink" href="#connecting-to-iscsi-share" title="Permalink to this headline">¶</a></h4>
<p>In order to access the iSCSI target, clients will need to use iSCSI initiator software.</p>
<p>An iSCSI Initiator client is pre-installed with Windows 7. A detailed how-to for this client can be found
<a class="reference external" href="http://www.windowsnetworking.com/articles_tutorials/Connecting-Windows-7-iSCSI-SAN.html">here</a>
. A client for Windows 2000, XP, and 2003 can be found
<a class="reference external" href="http://www.microsoft.com/downloads/en/details.aspx?FamilyID=12cb3c1a-15d6-4585-b385-befd1319f825">here</a>
. This
<a class="reference external" href="http://www.trainsignal.com/blog/freenas-8-iscsi-target-windows-7">how-to</a>
shows how to create an iSCSI target for a Windows 7 system.</p>
<p>Mac OS X does not include an initiator.
<a class="reference external" href="http://www.studionetworksolutions.com/products/product_detail.php?pi=11">globalSAN</a>
is a commercial, easy-to-use Mac initiator.</p>
<p>BSD systems provide command line initiators:
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=iscontrol">iscontrol(8)</a>
comes with FreeBSD,
<a class="reference external" href="http://netbsd.gw.com/cgi-bin/man-cgi?iscsi-initiator++NetBSD-current">iscsi-initiator(8)</a>
comes with NetBSD, and
<a class="reference external" href="http://www.openbsd.org/cgi-bin/man.cgi?query=iscsid">iscsid(8)</a>
comes with OpenBSD.</p>
<p>Some Linux distros provide the command line utility
<strong>iscsiadm</strong>
from
<a class="reference external" href="http://www.open-iscsi.org/">Open-iSCSI</a>
. Use a web search to see if a package exists for your distribution should the command not exist on your Linux system.</p>
<p>If you add a LUN while
<strong>iscsiadm</strong>
is already connected, it will not see the new LUN until you rescan using
<strong>iscsiadm -m node -R</strong>
. Alternately, use
<strong>iscsiadm -m discovery -t st -p &lt;portal_IP&gt;</strong>
to find the new LUN and
<strong>iscsiadm -m node -T &lt;LUN_Name&gt; -l</strong>
to log into the LUN.</p>
<p>Instructions for connecting from a VMware ESXi Server can be found at
<a class="reference external" href="http://www.vladan.fr/how-to-configure-freenas-8-for-iscsi-and-connect-to-esxi/">How to configure FreeNAS 8 for iSCSI and connect to ESX(i)</a>
. Note that the requirements for booting vSphere 4.x off iSCSI differ between ESX and ESXi. ESX requires a hardware iSCSI adapter while ESXi requires specific iSCSI boot firmware support. The magic is on the booting host side, meaning that there is no difference to the FreeNAS® configuration. See the
<a class="reference external" href="http://www.vmware.com/pdf/vsphere4/r41/vsp_41_iscsi_san_cfg.pdf">iSCSI SAN Configuration Guide</a>
for details.</p>
<p>If you can see the target but not connect to it, check the discovery authentication settings in
<a class="reference external" href="#1.8.7.5.TargetGlobalConfiguration|outline">Target Global Configuration</a>
.</p>
<p>If the LUN is not discovered by ESXi, make sure that promiscuous mode is set to Accept in the vswitch.</p>
<p>To determine which initiators are connected, type
<strong>istgtcontrol info</strong>
within
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
.</p>
</div>
<div class="section" id="growing-luns">
<h4>Growing LUNs<a class="headerlink" href="#growing-luns" title="Permalink to this headline">¶</a></h4>
<p>The method used to grow the size of an existing iSCSI LUN depends on whether the LUN is backed by a file extent or a zvol. Both methods are described in this section.</p>
<p>After the LUN is expanded using one of the methods below, use the tools from the initiator software to grow the partitions and the filesystems it contains.</p>
<div class="section" id="zvol-based-lun">
<h5>Zvol Based LUN<a class="headerlink" href="#zvol-based-lun" title="Permalink to this headline">¶</a></h5>
<p>Before growing a zvol based LUN, make sure that all initiators are disconnected. Stop the iSCSI service in
<a class="reference external" href="#1.8.1.ControlServices|outline">Control Services</a>
.</p>
<p>Open
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
and identify the zvol to be grown:</p>
<p><strong>zfs list -t volume</strong></p>
<p>NAME
USED
AVAIL
REFER
MOUNTPOINT</p>
<p>tank/iscsi_zvol
4G
17.5G
33.9M
-</p>
<p>Then, grow the zvol. This example grows
<em>tank/iscsi_zvol</em>
from 4G to 6G:</p>
<p><strong>zfs set volsize=6G tank/iscsi_zvol</strong></p>
<p><strong>zfs set refreservation=6G tank/iscsi_zvol</strong></p>
<p>Verify that the changes have taken effect:</p>
<p><strong>zfs list -t volume</strong></p>
<p>NAME
USED
AVAIL
REFER
MOUNTPOINT</p>
<p>tank/iscsi_zvol
6G
17.5G
33.9M
-</p>
<p>You can now start the iSCSI service and allow initiators to connect.</p>
</div>
<div class="section" id="file-extent-based-lun">
<h5>File Extent Based LUN<a class="headerlink" href="#file-extent-based-lun" title="Permalink to this headline">¶</a></h5>
<p>Before growing a file extent based LUN, make sure that all initiators are disconnected. Stop the iSCSI service in
<a class="reference external" href="#1.8.1.ControlServices|outline">Control Services</a>
.</p>
<p>Then, go to Services → iSCSI → File Extents → View File Extents to determine the path of the file extent to grow. Open
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
to grow the extent. This example grows
<em>/mnt/volume1/data</em>
by 2G:</p>
<p><strong>truncate -s +2g /mnt/volume1/data</strong></p>
<p>Go back to Services → iSCSI → File Extents → View File Extents and click the Edit button for the file extent. Set the size to 0 as this causes the iSCSI target to use the new size of the file.</p>
<p>You can now start the iSCSI service and allow initiators to connect.</p>
</div>
</div>
</div>
<div class="section" id="id314">
<h3>NFS<a class="headerlink" href="#id314" title="Permalink to this headline">¶</a></h3>
<p>Network File System (NFS) is a protocol for sharing files on a network. Before configuring this service, you should first create your NFS Shares in Sharing → Unix (NFS) Shares → Add Unix (NFS) Share. After configuring this service, go to Services → Control Panel to start the service.</p>
<p>Starting this service will open the following ports on the FreeNAS® system:</p>
<ul class="simple">
<li>TCP and UDP 111 (used by
<strong>rpcbind</strong>
)</li>
<li>TCP 2049 (used by
<strong>nfsd</strong>
)</li>
</ul>
<p>Additionally,
<strong>mountd</strong>
and
<strong>rpcbind</strong>
will each bind to a randomly available UDP port.</p>
<p>Figure 8.8a shows the configuration screen and Table 8.8a summarizes the configuration options for the NFS service.</p>
<p>Figure 8.8a: Configuring NFS</p>
<p><a class="reference internal" href="_images/10000000000002A2000001D87E290272.png"><img alt="10000000000002A2000001D87E290272_png" src="_images/10000000000002A2000001D87E290272.png" style="width: 6.9252in; height: 4.8492in;" /></a></p>
<p><strong>Table 8.8a: NFS Configuration Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="8%" />
<col width="76%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Number of servers</td>
<td>integer</td>
<td>run
<strong>sysctl -n kern.smp.cpus</strong>
from
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
to determine the number; do not exceed the number listed in the output of that command</td>
</tr>
<tr class="row-odd"><td>Serve UDP NFS clients</td>
<td>checkbox</td>
<td>check if NFS client needs to use UDP</td>
</tr>
<tr class="row-even"><td>Bind IP Addresses</td>
<td>checkboxes</td>
<td>select the IP address(es) to listen for NFS requests; if left unchecked, NFS will listen on all available addresses</td>
</tr>
<tr class="row-odd"><td>Allow non-root mount</td>
<td>checkbox</td>
<td>check this box only if the NFS client requires it</td>
</tr>
<tr class="row-even"><td>mountd(8) bind port</td>
<td>integer</td>
<td>optional; specify port for
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=mountd">mountd(8)</a>
to bind to</td>
</tr>
<tr class="row-odd"><td>rpc.statd(8) bind port</td>
<td>integer</td>
<td>optional; specify port for
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=rpc.statd">rpc.statd(8)</a>
to bind to</td>
</tr>
<tr class="row-even"><td>rpc.lockd(8) bind port</td>
<td>integer</td>
<td>optional; specify port for
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=rpc.lockd">rpc.lockd(8)</a>
to bind to</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id316">
<h3>Rsync<a class="headerlink" href="#id316" title="Permalink to this headline">¶</a></h3>
<p>Services → Rsync is used to configure an rsync server when using rsync module mode. See
<a class="reference external" href="#1.4.5.2.ConfiguringRsyncModuleModeBetweenTwoFreeNAS®Systems|outline">Configuring Rsync Module Mode</a>
for a configuration example.</p>
<p>This section describes the configurable options for the
<strong>rsyncd</strong>
service and rsync modules.</p>
<p>Figure 8.9a shows the rsyncd configuration screen which is accessed from Services → Rsync → Configure Rsyncd.</p>
<p><strong>Figure 8.9a: Rsyncd Configuration</strong></p>
<p><a class="reference internal" href="_images/1000000000000234000000C82AD0CB4B.png"><img alt="1000000000000234000000C82AD0CB4B_png" src="_images/1000000000000234000000C82AD0CB4B.png" style="width: 6.7945in; height: 1.8516in;" /></a></p>
<p>Table 8.9a summarizes the options that can be configured for the rsync daemon:</p>
<p><strong>Table 8.9a: Rsync Configuration Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="22%" />
<col width="11%" />
<col width="68%" />
</colgroup>
<tbody valign="top">
<tr class="row-odd"><td><strong>Setting</strong></td>
<td><strong>Value</strong></td>
<td><strong>Description</strong></td>
</tr>
<tr class="row-even"><td>TCP Port</td>
<td>integer</td>
<td>port for
<strong>rsyncd</strong>
to listen on, default is
<em>873</em></td>
</tr>
<tr class="row-odd"><td>Auxiliary parameters</td>
<td>string</td>
<td>additional parameters from
<a class="reference external" href="http://www.samba.org/ftp/rsync/rsyncd.conf.html">rsyncd.conf(5)</a></td>
</tr>
</tbody>
</table>
<div class="section" id="id318">
<h4>Rsync Modules<a class="headerlink" href="#id318" title="Permalink to this headline">¶</a></h4>
<p>Figure 8.9b shows the configuration screen that appears when you click Services → Rsync → Rsync Modules → Add Rsync Module.</p>
<p>Table 8.9b summarizes the options that can be configured when creating a rsync module.</p>
<p><strong>Figure 8.9b: Adding an Rsync Module</strong></p>
<p><a class="reference internal" href="_images/100000000000023D000001C2EB395B61.png"><img alt="100000000000023D000001C2EB395B61_png" src="_images/100000000000023D000001C2EB395B61.png" style="width: 6.9028in; height: 4.1665in;" /></a></p>
<p><strong>Table 8.9b: Rsync Module Configuration Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="14%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Module name</td>
<td>string</td>
<td>mandatory; needs to match the setting on the rsync client</td>
</tr>
<tr class="row-odd"><td>Comment</td>
<td>string</td>
<td>optional description</td>
</tr>
<tr class="row-even"><td>Path</td>
<td>browse button</td>
<td>volume/dataset to hold received data</td>
</tr>
<tr class="row-odd"><td>Access Mode</td>
<td>drop-down menu</td>
<td>choices are
<em>Read and Write</em>
,
<em>Read-only</em>
, or
<em>Write-only</em></td>
</tr>
<tr class="row-even"><td>Maximum connections</td>
<td>integer</td>
<td><em>0</em>
is unlimited</td>
</tr>
<tr class="row-odd"><td>User</td>
<td>drop-down menu</td>
<td>select user that file transfers to and from that module should take place as</td>
</tr>
<tr class="row-even"><td>Group</td>
<td>drop-down menu</td>
<td>select group that file transfers to and from that module should take place as</td>
</tr>
<tr class="row-odd"><td>Hosts allow</td>
<td>string</td>
<td>see
<a class="reference external" href="http://www.samba.org/ftp/rsync/rsyncd.conf.html">rsyncd.conf(5)</a>
for allowed formats</td>
</tr>
<tr class="row-even"><td>Hosts deny</td>
<td>string</td>
<td>see rsyncd.conf(5) for allowed formats</td>
</tr>
<tr class="row-odd"><td>Auxiliary parameters</td>
<td>string</td>
<td>additional parameters from rsyncd.conf(5)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id320">
<h3>S.M.A.R.T.<a class="headerlink" href="#id320" title="Permalink to this headline">¶</a></h3>
<p>FreeNAS® uses the
<a class="reference external" href="http://smartmontools.sourceforge.net/man/smartd.8.html">smartd(8)</a>
service to monitor disk S.M.A.R.T. data for disk health. To fully configure S.M.A.R.T. you need to:</p>
<ol class="arabic simple">
<li>Schedule when to run the S.M.A.R.T. tests in System → S.M.A.R.T. Tests →
<a class="reference external" href="#1.4.5.S.M.A.R.T.Tests|outline">Add S.M.A.R.T. Test</a>
.</li>
<li>Enable or disable S.M.A.R.T. for each disk member of a volume in Volumes →
<a class="reference external" href="#1.6.3.7.ViewingVolumes|outline">View Volumes</a>
. By default, this is already enabled on all disks that support S.M.A.R.T.</li>
<li>Check the configuration of the S.M.A.R.T. service as described in this section.</li>
<li>Start the S.M.A.R.T. service in Services →
Control Services</li>
</ol>
<p>Figure 8.10a shows the configuration screen that appears when you click Services → S.M.A.R.T.</p>
<p><strong>Figure 8.10a: S.M.A.R.T Configuration Options</strong></p>
<p><a class="reference internal" href="_images/1000000000000277000001997C795E8C.png"><img alt="1000000000000277000001997C795E8C_png" src="_images/1000000000000277000001997C795E8C.png" style="width: 6.9252in; height: 3.4492in;" /></a></p>
<p><strong>NOTE:</strong></p>
<p><strong>smartd</strong>
will wake up at every
<em>Check Interval</em>
configured in Figure 8.10a. It will check the times you configured in your tests (described in Figure 4.5a) to see if any tests should be run. Since the smallest time increment for a test is an hour (60 minutes), it does not make sense to set a check interval value higher than 60 minutes. For example, if you set the check interval for 120 minutes and the smart test to every hour, the test will only be run every 2 hours since the daemon only wakes up every 2 hours.</p>
<p>Table 8.10a summarizes the options in the S.M.A.R.T configuration screen.</p>
<p><a href="#id322"><span class="problematic" id="id323">**</span></a>Table 8.10a: S.M.A.R.T Configuration Options **</p>
<table border="1" class="docutils">
<colgroup>
<col width="9%" />
<col width="14%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Check interval</td>
<td>integer</td>
<td>in minutes, how often to wake up
<strong>smartd</strong>
to check to see if any tests have been configured to run</td>
</tr>
<tr class="row-odd"><td>Power mode</td>
<td>drop-down menu</td>
<td>the configured test is not performed if the system enters the specified power mode; choices are:
<em>Never</em>
,
<em>Sleep</em>
,
<em>Standby</em>
, or
<em>Idle</em></td>
</tr>
<tr class="row-even"><td>Difference</td>
<td>integer in degrees Celsius</td>
<td>default of
<em>0</em>
disables this check, otherwise reports if the temperature of a drive has changed by N degrees Celsius since last report</td>
</tr>
<tr class="row-odd"><td>Informational</td>
<td>integer in degrees Celsius</td>
<td>default of
<em>0</em>
disables this check, otherwise will message with a log level of LOG_INFO if the temperature is higher than specified degrees in Celsius</td>
</tr>
<tr class="row-even"><td>Critical</td>
<td>integer in degrees Celsius</td>
<td>default of
<em>0</em>
disables this check, otherwise will message with a log level of LOG_CRIT and send an email if the temperature is higher than specified degrees in Celsius</td>
</tr>
<tr class="row-odd"><td>Email to report</td>
<td>string</td>
<td>email address of person to receive S.M.A.R.T. alert
; separate multiple email recipients with a comma and no space</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id324">
<h3>SNMP<a class="headerlink" href="#id324" title="Permalink to this headline">¶</a></h3>
<p>SNMP (Simple Network Management Protocol) is used to monitor network-attached devices for conditions that warrant administrative attention. FreeNAS® can be configured as a
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=bsnmpd">bsnmpd(8)</a>
server using FreeBSD&#8217;s simple and extensible SNMP daemon. When you start the SNMP service, the following port will be enabled on the FreeNAS® system:</p>
<ul class="simple">
<li>UDP 161 (
<strong>bsnmpd</strong>
listens here for SNMP requests)</li>
</ul>
<p>Available MIBS are located in
<em>/usr/share/SNMP/mibs</em>
and
<em>/usr/local/share/SNMP/mibs</em>
.</p>
<p>Figure 8.11a shows the SNMP configuration screen. Table 8.11a summarizes the configuration options.</p>
<p>Figure 8.11a: Configuring SNMP</p>
<p><a class="reference internal" href="_images/10000000000002AF000001B05B9731AC.png"><img alt="10000000000002AF000001B05B9731AC_png" src="_images/10000000000002AF000001B05B9731AC.png" style="width: 6.9252in; height: 3.3457in;" /></a></p>
<p><strong>Table 8.11a: SNMP Configuration Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="9%" />
<col width="68%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Location</td>
<td>string</td>
<td>optional description of FreeNAS® system&#8217;s location</td>
</tr>
<tr class="row-odd"><td>Contact</td>
<td>string</td>
<td>optional email address of FreeNAS® administrator</td>
</tr>
<tr class="row-even"><td>Community</td>
<td>string</td>
<td>password used on the SNMP network, default is
<em>public</em>
and
<strong>should **
**be changed for security reasons</strong></td>
</tr>
<tr class="row-odd"><td>Auxiliary Parameters</td>
<td>string</td>
<td>additional
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=bsnmpd">bsnmpd(8)</a>
options not covered in this screen, one per line</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id326">
<h3>SSH<a class="headerlink" href="#id326" title="Permalink to this headline">¶</a></h3>
<p>Secure Shell (SSH) allows for files to be transferred securely over an encrypted network. If you configure your FreeNAS® system as an SSH server, the users in your network will need to use
<a class="reference external" href="http://en.wikipedia.org/wiki/Comparison_of_SSH_clients">SSH</a>
<a class="reference external" href="http://en.wikipedia.org/wiki/Comparison_of_SSH_clients">client software</a>
in order to transfer files using SSH.</p>
<p>This section shows the FreeNAS® SSH configuration options, demonstrates an example configuration that restricts users to their home directory, and provides some troubleshooting tips.</p>
<div class="section" id="ssh-configuration-screen">
<h4>SSH Configuration Screen<a class="headerlink" href="#ssh-configuration-screen" title="Permalink to this headline">¶</a></h4>
<p>Figure 8.12a shows the Services →
SSH
configuration screen.
Once you have configured SSH, don&#8217;t forget to start it in Services → Control Services.</p>
<p>Figure 8.12a:
SSH
Configuration</p>
<p><a class="reference internal" href="_images/10000000000001950000012301F7AD89.png"><img alt="10000000000001950000012301F7AD89_png" src="_images/10000000000001950000012301F7AD89.png" style="width: 4.8783in; height: 2.6937in;" /></a></p>
<p>Table 8.12a summarizes the configuration options. Some settings are only available in Advanced Mode. To see these settings, either click the Advanced Mode button or configure the system to always display these settings by checking the box “Show advanced fields by default” in System → Settings → Advanced.</p>
<p><strong>Table 8.12a: **
SSH
** Configuration Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="8%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>TCP Port</td>
<td>integer</td>
<td>port to open for
SSH
connection requests;
<em>22</em>
by default</td>
</tr>
<tr class="row-odd"><td>Login as Root with password</td>
<td>checkbox</td>
<td><strong>for security reasons, root logins are discouraged and disabled by **
**default;</strong>
if enabled, password must be set for
<em>root</em>
user in Account → Users → View Users</td>
</tr>
<tr class="row-even"><td>Allow Password Authentication</td>
<td>checkbox</td>
<td>if unchecked, key based authentication for all users is required; requires
<a class="reference external" href="http://the.earth.li/%7Esgtatham/putty/0.55/htmldoc/Chapter8.html">additional setup</a>
on both the
SSH
client and server</td>
</tr>
<tr class="row-odd"><td>Allow TCP Port Forwarding</td>
<td>checkbox</td>
<td>allows users to bypass firewall restrictions using
SSH
&#8216;s
<a class="reference external" href="http://www.symantec.com/connect/articles/ssh-port-forwarding">port</a>
<a class="reference external" href="http://www.symantec.com/connect/articles/ssh-port-forwarding">forwarding feature</a></td>
</tr>
<tr class="row-even"><td>Compress Connections</td>
<td>checkbox</td>
<td>may reduce latency over slow networks</td>
</tr>
<tr class="row-odd"><td>Host Private Key</td>
<td>string</td>
<td>only available in Advanced Mode; allows you to paste a specific host key as the default key is changed with every installation</td>
</tr>
<tr class="row-even"><td>SFTP Log Level</td>
<td>drop-down menu</td>
<td>only available in Advanced Mode; select the
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=syslog">syslog(3)</a>
level of the SFTP server</td>
</tr>
<tr class="row-odd"><td>SFTP Log Facility</td>
<td>drop-down menu</td>
<td>only available in Advanced Mode; select the
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=syslog">syslog(3)</a>
facility of the SFTP server</td>
</tr>
<tr class="row-even"><td>Extra Options</td>
<td>string</td>
<td>only available in Advanced Mode;
additional
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=sshd_config">sshd_config(5)</a>
options not covered in this screen, one per line; these options are case-sensitive and mis-spellings may prevent the SSH service from starting</td>
</tr>
</tbody>
</table>
<p>A few sshd_config(5) options that are useful to input in the
<em>Extra Options</em>
field include:</p>
<ul class="simple">
<li><strong>ClientAliveInterval</strong>
: increase this number if ssh connections tend to drop</li>
<li><strong>ClientMaxStartup</strong>
: defaults to 10; increase if you have more users</li>
</ul>
</div>
<div class="section" id="chrooting-command-line-sftp-users">
<h4>Chrooting Command Line SFTP Users<a class="headerlink" href="#chrooting-command-line-sftp-users" title="Permalink to this headline">¶</a></h4>
<p>By default when you configure SSH, users can use the
<strong>ssh</strong>
command to login to the FreeNAS® system. A user&#8217;s home directory will be the volume/dataset specified in the
<em>Home Directory</em>
field of their user account on the FreeNAS® system. Users can also use the
<strong>scp</strong>
and
<strong>sftp</strong>
commands to transfer files between their local computer and their home directory on the FreeNAS® system.</p>
<p>While these commands will default to the user&#8217;s home directory, users are able to navigate outside of their home directory which can pose a security risk. SSH supports using a
<a class="reference external" href="http://en.wikipedia.org/wiki/Chroot">chroot</a>
to confine users to only the
<strong>sftp</strong>
command and to be limited to the contents of their own home directory. To configure this scenario on FreeNAS®, perform the following steps.</p>
<p><strong>NOTE:</strong>
some utilities such as WinSCP can
<a class="reference external" href="http://winscp.net/eng/docs/faq_breaks_permissions">bypass the chroot</a>
. This section assumes that users are accessing the chroot using the command line
<strong>sftp</strong>
.</p>
<ol class="arabic simple">
<li><strong>Create a ZFS dataset for each user requiring sftp access</strong>
in Storage → Volumes.</li>
<li><a href="#id329"><span class="problematic" id="id330">**</span></a>If you are not using Active Directory or LDAP, create a user account **
for each user in Account → Users → Add User. In the
<em>Home Directory</em>
field, browse to the location of the
dataset you created for that user. Repeat this process to create a user account for every user that will need access to the SSH service.</li>
<li><strong>Create a group **
named
*sftp*
in Account → Groups → Add Group. Then, click on the
*sftp*
group in View Groups and add the users who are to be restricted to their home directories when using
**sftp</strong>
.</li>
<li><strong>Set permissions for each dataset</strong>
in Storage → Volume → View Volumes. SSH chroot is
<strong>very specific</strong>
** **
with regards to the required permissions (see the ChrootDirectory keyword in
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=sshd_config">sshd_config(5)</a>
for details).
<strong>Your configuration will not work if the permissions on the datasets used by SSH chroot users differ from those shown in Figure 8.12b.</strong>
** **</li>
<li>Create a home directory within each dataset using
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
. Due to the permissions required by SSH chroot, the user will not have permissions to write to the root of their own dataset until you
do this. Since your intention is to limit them to the contents of their home directory, manually create a home directory for each user
<strong>within their own dataset</strong>
and change the ownership of the directory to the user. Example 8.12a demonstrates the commands used to create a home directory called
<em>user1</em>
for the user account
<em>user1</em>
on dataset
<em>/mnt/volume1/user1</em>
:</li>
</ol>
<p><strong>Figure 8.12b: Permissions Required by SSH Chroot</strong></p>
<p><a class="reference internal" href="_images/10000000000001780000016131448D93.png"><img alt="10000000000001780000016131448D93_png" src="_images/10000000000001780000016131448D93.png" style="width: 3.9161in; height: 3.6764in;" /></a></p>
<p><strong>Example 8.12a: Creating a User&#8217;s Home Directory</strong></p>
<p><strong>mkdir /mnt/</strong>
<strong>volume</strong>
<strong>1/user1/user1</strong></p>
<p><strong>chown user1:user1 /mnt/</strong>
<strong>volume</strong>
<strong>1/user1/user1</strong></p>
<ol class="arabic simple">
<li><strong>Configure SSH</strong>
in Services → SSH. Add these lines to the Extra Options section
:</li>
</ol>
<p>Match Group sftp</p>
<p>ChrootDirectory %h</p>
<p>ForceCommand internal-sftp</p>
<p>AllowTcpForwarding no</p>
<ol class="arabic simple">
<li><strong>Start the SSH service</strong>
in Control Services. Click the red OFF button next to SSH. After a second or so, it will change to a blue ON, indicating that the service has been enabled.</li>
<li><strong>Test the connection</strong>
from a client by running
<strong>sftp</strong>
,
<strong>ssh</strong>
, and
<strong>scp</strong>
as the user. The
<strong>sftp</strong>
command should work but be limited to the user&#8217;s home directory and the
<strong>ssh</strong>
and
<strong>scp</strong>
commands should fail.</li>
</ol>
</div>
<div class="section" id="troubleshooting-ssh-connections">
<h4>Troubleshooting SSH Connections<a class="headerlink" href="#troubleshooting-ssh-connections" title="Permalink to this headline">¶</a></h4>
<p>If you add any
<em>Extra Options</em>
in the SSH configuration screen, be aware that the keywords listed in
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=sshd_config">sshd_config(5)</a>
are case sensitive. This means that your configuration will fail to do what you intended if you do not match the upper and lowercase letters of the keyword.</p>
<p>If your clients are receiving “reverse DNS” or timeout errors, add an entry for the IP address of the FreeNAS® system in the
<em>Host name database</em>
field of Network → Global Configuration.</p>
<p>When configuring SSH, always test your configuration as an SSH user account to ensure that the user is limited to what you have configured and that they have permission to transfer files within the
intended directories. If the user account is experiencing problems, the SSH error messages are usually pretty specific to what the problem is. Type the following command within
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
to read these messages as they occur:</p>
<p><strong>tail -f /var/log/messages</strong></p>
<p>Additional messages regarding authentication errors may be found in
<em>/var/log/auth.log</em>
.</p>
</div>
</div>
<div class="section" id="id335">
<h3>TFTP<a class="headerlink" href="#id335" title="Permalink to this headline">¶</a></h3>
<p>Trivial File Transfer Protocol (TFTP) is a light-weight version of FTP usually used to transfer configuration or boot files between machines, such as routers, in a local environment. TFTP provides an extremely limited set of commands and provides no authentication.</p>
<p>If the FreeNAS® system will be used to store images and configuration files for the network&#8217;s devices, configure and start the TFTP service. Starting the TFTP service will open UDP port 69.</p>
<p><strong>NOTE:</strong>
in versions of FreeNAS® prior to 8.3.0, TFTP is limited to a maximum file size of 32MB.</p>
<p>Figure 8.13a shows the TFTP configuration screen and Table 8.13a summarizes the available options:</p>
<p>Figure 8.13a: TFTP Configuration</p>
<p><a class="reference internal" href="_images/10000000000001A10000014C23FFB30C.png"><img alt="10000000000001A10000014C23FFB30C_png" src="_images/10000000000001A10000014C23FFB30C.png" style="width: 5.0236in; height: 3.0744in;" /></a></p>
<p><strong>Table 8.13a: TFTP Configuration Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="10%" />
<col width="8%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Setting</th>
<th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Directory</td>
<td>browse button</td>
<td>browse to the directory to be used for storage; some devices require a specific directory name, refer to the device&#8217;s documentation for details</td>
</tr>
<tr class="row-odd"><td>Allow New Files</td>
<td>checkbox</td>
<td>enable if network devices need to send files to the FreeNAS® system (e.g. backup their config)</td>
</tr>
<tr class="row-even"><td>Port</td>
<td>integer</td>
<td>UDP port to listen for TFTP requests,
<em>69</em>
by default</td>
</tr>
<tr class="row-odd"><td>Username</td>
<td>drop-down
menu</td>
<td>account used for tftp requests; must have permission to the
<em>Directory</em></td>
</tr>
<tr class="row-even"><td>Umask</td>
<td>integer</td>
<td>umask for newly created files, default is
<em>022</em>
(everyone can read, nobody can write); some devices require a less strict umask</td>
</tr>
<tr class="row-odd"><td>Extra options</td>
<td>string</td>
<td>additional
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=tftpd">tftpd(8)</a>
options not shown in this screen, one per line</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="id336">
<h3>UPS<a class="headerlink" href="#id336" title="Permalink to this headline">¶</a></h3>
<p>FreeNAS® uses
<a class="reference external" href="http://www.networkupstools.org/">NUT</a>
(Network UPS Tools) to provide UPS support. If the FreeNAS® system is connected to a UPS device, configure the UPS service then start it in Services → Control Services.</p>
<p>Figure 8.14a shows the UPS configuration screen:</p>
<p><strong>Figure 8.14a: UPS Configuration Screen</strong></p>
<p><a class="reference internal" href="_images/100000000000032D000001F960A4A7FB.png"><img alt="100000000000032D000001F960A4A7FB_png" src="_images/100000000000032D000001F960A4A7FB.png" style="width: 6.9252in; height: 3.3055in;" /></a></p>
<p>Table 8.14a summarizes the options in the UPS Configuration screen.</p>
<p><strong>Table 8.14a: UPS Configuration Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="11%" />
<col width="71%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>UPS Mode</td>
<td>drop-down menu</td>
<td>select from
<em>Master</em>
or
<em>Slave</em></td>
</tr>
<tr class="row-odd"><td>Identifier</td>
<td>string</td>
<td>can contain alphanumeric, period, comma, hyphen, and underscore characters</td>
</tr>
<tr class="row-even"><td>Driver</td>
<td>drop-down menu</td>
<td>supported UPS devices are listed at
<a class="reference external" href="http://www.networkupstools.org/stable-hcl.html">http://www.networkupstools.org/stable-hcl.html</a></td>
</tr>
<tr class="row-odd"><td>Port</td>
<td>drop-down
menu</td>
<td>select the serial or USB port the UPS is plugged into (see
NOTE below)</td>
</tr>
<tr class="row-even"><td>Auxiliary Parameters</td>
<td>string</td>
<td>additional options from
<a class="reference external" href="http://www.networkupstools.org/docs/man/ups.conf.html">ups.conf(5)</a></td>
</tr>
<tr class="row-odd"><td>Description</td>
<td>string</td>
<td>optional</td>
</tr>
<tr class="row-even"><td>Shutdown mode</td>
<td>drop-down menu</td>
<td>choices are
<em>UPS goes on battery</em>
and
<a href="#id337"><span class="problematic" id="id338">*</span></a>UPS reaches low *
<a href="#id339"><span class="problematic" id="id340">*</span></a>battery *</td>
</tr>
<tr class="row-odd"><td>Shutdown timer</td>
<td>integer</td>
<td>in seconds; will initiate shutdown after this many seconds after UPS enters
<em>UPS goes on battery</em>
, unless power is restored</td>
</tr>
<tr class="row-even"><td>Monitor User</td>
<td>string</td>
<td>default is
<em>upsmon</em></td>
</tr>
<tr class="row-odd"><td>Monitor Password</td>
<td>string</td>
<td>default is known value
<em>fixmepass</em>
and should be changed;
can not contain a space or #</td>
</tr>
<tr class="row-even"><td>Extra users</td>
<td>string</td>
<td>defines the accounts that have administrative access; see
<a class="reference external" href="http://www.networkupstools.org/docs/man/upsd.users.html">upsd.users(5)</a>
for examples</td>
</tr>
<tr class="row-odd"><td>Remote monitor</td>
<td>checkbox</td>
<td>if enabled, be aware that the default is to listen on all interfaces and to use the known values user
<em>upsmon</em>
and password
<em>fixmepass</em></td>
</tr>
<tr class="row-even"><td>Send Email Status Updates</td>
<td>checkbox</td>
<td>if checked, activates the
<em>To email</em>
field</td>
</tr>
<tr class="row-odd"><td>To email</td>
<td>email address</td>
<td>if
<em>Send Email</em>
box checked, email address of person to receive status updates</td>
</tr>
<tr class="row-even"><td>Email subject</td>
<td>string</td>
<td>if
<em>Send Email</em>
box checked, subject of email updates</td>
</tr>
</tbody>
</table>
<p><strong>NOTE:</strong></p>
<p>for USB devices, the easiest way to determine the correct device name is to check the box “Show console messages” in System → Settings → Advanced. Plug in the USB device and the console messages will give the name of the
<em>/dev/ugenX.X</em>
device; where the X&#8217;s are the numbers that show on the console.</p>
<p><a class="reference external" href="http://www.networkupstools.org/docs/man/upsc.html">upsc(8)</a>
can be used to get status variables from the UPS daemon such as the current charge and input voltage. It can be run from
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
using the following syntax. The man page gives some other usage examples.</p>
<p><strong>upsc ups&#64;localhost</strong></p>
<p><a class="reference external" href="http://www.networkupstools.org/docs/man/upscmd.html">upscmd(8)</a>
can be used to send commands directly to the UPS, assuming that the hardware supports the command being sent. Only users with administrative rights can use this command. These users are created in the
<em>Extra users</em>
field.</p>
</div>
</div>
<div class="section" id="plugins">
<h2>Plugins<a class="headerlink" href="#plugins" title="Permalink to this headline">¶</a></h2>
<p>FreeNAS® 8.2.0 introduced the ability to extend the built-in NAS services by providing a mechanism for installing additional software. This mechanism was known as the Plugins architecture and is based on
<a class="reference external" href="http://en.wikipedia.org/wiki/Freebsd_jail">FreeBSD jails</a>
and
<a class="reference external" href="http://wiki.pcbsd.org/index.php/AppCafe®/9.2">PC-BSD PBIs</a>
. This allowed users to install and configure additional applications once they had created and configured a plugins jail.</p>
<p>FreeNAS® 9.x simplifies this procedure by providing two methods for software installation. The Plugins method, described in this section, is meant for users who prefer to browse for, install, and configure available software using the GUI. This method is very easy to use, but is limited in the amount of software that is available. Each application will automatically be installed into its own jail, meaning that this method may not be suitable for users who wish to run multiple applications within the same jail.</p>
<p>The
<a class="reference external" href="#1.10.Jails|outline">Jails</a>
method provides much more control over software installation but assumes that the user is comfortable working from the command line can and has a good understanding of networking basics and software installation on FreeBSD-based systems.</p>
<p>It is recommended that users skim through both the Plugins and Jails sections in order to become familiar with the features and limitations of each and to choose the method that best meets their software needs.</p>
<p>D
ue to ABI (application binary interface) changes, FreeNAS® 8.x PBIs can not be installed on a 9.x system.</p>
<div class="section" id="installing-a-freenas-pbi-using-plugins">
<h3>Installing a FreeNAS® PBI Using Plugins<a class="headerlink" href="#installing-a-freenas-pbi-using-plugins" title="Permalink to this headline">¶</a></h3>
<p>A FreeNAS® PBI is a self-contained application installer which has been designed to integrate into the FreeNAS® GUI. A FreeNAS® PBI offers several advantages:</p>
<ul class="simple">
<li>the FreeNAS® GUI provides a browser for viewing the list of available FreeNAS® PBIs. This list is also available at
<a class="reference external" href="#1.9.2.AvailableFreeNAS®PBIs|outline">Available FreeNAS® PBIs</a>
.</li>
<li>the FreeNAS® GUI provides buttons for installing, starting, upgrading, and deleting FreeNAS® PBIs.</li>
<li>if the FreeNAS® PBIs has configuration options, a screen will be added to the FreeNAS® GUI so that these options can be configured from the GUI.</li>
<li>FreeNAS® PBIs can be installed using either the Plugins or the
<a class="reference external" href="#1.10.Jails|outline">Jails</a>
method.</li>
</ul>
<p>To install a FreeNAS® PBI using the plugins method, click Plugins. As seen in Figure 9.1a, the list of available FreeNAS® PBIs will be displayed.</p>
<p><strong>Figure 9.1a: Using Plugins to Install a PBI</strong></p>
<p><a class="reference internal" href="_images/1000000000000556000001EE3E0B22FB.png"><img alt="1000000000000556000001EE3E0B22FB_png" src="_images/1000000000000556000001EE3E0B22FB.png" style="width: 6.9252in; height: 2.5043in;" /></a></p>
<p><strong>NOTE:</strong>
if the list of available PBIs is not displayed, open
<a class="reference external" href="#1.12.2.Shell|outline">Shell</a>
and verify that the FreeNAS® system can
<strong>ping</strong>
an address on the Internet. If it cannot, you may have to add a default gateway address and/or DNS server address in Network →
<a class="reference external" href="#1.5.1.GlobalConfiguration|outline">Global Configuration</a>
.</p>
<p>Highlight the entry of the PBI you would like to install, then click its Install button. In the example shown in Figure 9.1b, the transmission PBI is selected for installation.</p>
<p><strong>Figure 9.1b: Selecting a PBI to Install</strong></p>
<p><a class="reference internal" href="_images/100000000000037E000001EB84FBFF52.png"><img alt="100000000000037E000001EB84FBFF52_png" src="_images/100000000000037E000001EB84FBFF52.png" style="width: 6.9252in; height: 3.8028in;" /></a></p>
<p>Click “OK” to start the installation. It will take a few minutes as the system will first download and configure a jail to contain the installed software. It will then install the PBI and add it to the “Installed” tab as shown in Figure 9.1c. Be patient as it may take a few minutes for the installation to finish.</p>
<p><strong>Figure 9.1c: Viewing Installed PBIs</strong></p>
<p><a class="reference internal" href="_images/1000000000000351000001F25FDB25AB.png"><img alt="1000000000000351000001F25FDB25AB_png" src="_images/1000000000000351000001F25FDB25AB.png" style="width: 6.9252in; height: 4.0618in;" /></a></p>
<div class="section" id="managing-an-installed-freenas-pbi">
<h4>Managing an Installed FreeNAS® PBI<a class="headerlink" href="#managing-an-installed-freenas-pbi" title="Permalink to this headline">¶</a></h4>
<p>As seen in the example shown in Figure 9.1c, entries for the installed PBI will appear in the following locations:</p>
<ul class="simple">
<li>the Installed tab of Plugins</li>
<li>the Plugins section of the tree</li>
<li>the Jails section of the tree</li>
</ul>
<p>The entry in the Installed tab of Plugins will display the plugin name and version, the name of the PBI that was installed, the name of the jail that was created, whether the application status is ON or OFF, and a button to delete the application and its associated jail. If a newer version of the application is available, a button to update the application will also appear.</p>
<p>The &#8220;Service status&#8221; of a PBI must be turned to &#8220;ON&#8221; before the installed application is available. Before starting the service, check to see if it has any configuration options by clicking its entry in the Plugins section of the tree. If the application is configurable, this will open a graphical screen that contains its available configuration options. The options that are available will vary by PBI. PBIs which are not configurable will instead display a message with a hyperlink for accessing the software. That hyperlink will not work until the PBI is started.</p>
<p>You should always review a PBI&#8217;s configuration options before attempting to start it as some PBIs have options that need to be set before their service will successfully start. If you have never configured this application before, check the application&#8217;s website to see what documentation is available. A link to the website for each available PBI can be found in
<a class="reference external" href="#1.9.2.AvailableFreeNAS®PBIs|outline">Available FreeNAS® PBIs</a>
.</p>
<p>If the application requires access to the data stored on the FreeNAS® system, click the entry for the associated jail in the Jails section of the tree and add a storage as described
<a class="reference external" href="#1.10.2.2.2.AddingStorage|outline">here</a>
.</p>
<p>If you need to access the shell of the jail containing the application to complete or test your configuration, click the entry for the associated jail in the Jails section of the tree. You can then click its shell icon as described in
<a class="reference external" href="#1.10.2.1.ManagingJails|outline">Managing Jails</a>
.</p>
<p>Once the configuration is complete, click the red OFF button in the entry for the PBI. If the service successfully starts, it will change to a blue ON. If it fails to start, click the jail&#8217;s shell icon and type
<strong>tail /var/log/messages</strong>
to see if any errors were logged.</p>
</div>
<div class="section" id="updating-an-installed-freenas-pbi">
<h4>Updating an Installed FreeNAS® PBI<a class="headerlink" href="#updating-an-installed-freenas-pbi" title="Permalink to this headline">¶</a></h4>
<p>If a newer version of a FreeNAS® PBI becomes available in the official repository, an &#8220;Update&#8221; button will be added to the entry of the PBI in the &#8220;Installed&#8221; tab. In the example shown in Figure 9.1d, a newer version of Minidlna is available.</p>
<p><strong>Figure 9.1d: Updating an Installed PBI</strong></p>
<p><a class="reference internal" href="_images/10000000000003900000019AB1074006.png"><img alt="10000000000003900000019AB1074006_png" src="_images/10000000000003900000019AB1074006.png" style="width: 6.9252in; height: 3.1126in;" /></a></p>
<p>Click the &#8220;OK&#8221; button and the latest version of the PBI will automatically be downloaded and installed. Once the update is complete, the entry for the PBI will be refreshed to show the new version number and the &#8220;Update&#8221; button will disappear.</p>
</div>
<div class="section" id="installing-additional-pbis">
<h4>Installing Additional PBIs<a class="headerlink" href="#installing-additional-pbis" title="Permalink to this headline">¶</a></h4>
<p>The &#8220;Available&#8221; tab of Plugins contains an &#8220;Upload&#8221; button. This button allows you to install PBIs that are not yet available in the official repository. These PBIs include FreeNAS® PBIs which are still being tested as well as
<a class="reference external" href="http://pbibuild64.pcbsd.org/index.php?ver=9">PC-BSD PBIs</a>
. These PBIs must be manually downloaded first and should end in a
<em>.pbi</em>
extension. When downloading a PBI, make sure
that it matches the architecture (32- or 64-bit) of the FreeNAS® system and
that it was developed for 9.x as 8.x and 10.x PBIs will not work on a 9.x FreeNAS® system.</p>
<p>Once you have downloaded the PBI, click the &#8220;Upload&#8221; button. As seen in the example in Figure 9.1e, this will prompt you to browse to the location of the downloaded PBI. Once the PBI is selected, click the &#8220;Upload&#8221; button to install the PBI. In this example, the user is installing the PC-BSD PBI for webmin.</p>
<p><strong>Figure 9.1e: Installing a Previously Downloaded PBI</strong></p>
<p><a class="reference internal" href="_images/10000000000002DD000001883EEDE3BA.png"><img alt="10000000000002DD000001883EEDE3BA_png" src="_images/10000000000002DD000001883EEDE3BA.png" style="width: 6.9252in; height: 3.7028in;" /></a></p>
<p>When the installation is complete, an entry for the PBI will be added to the &#8220;Installed&#8221; tab and its associated jail will be listed under &#8220;Jails&#8221;. However, if it is not a FreeNAS® PBI, it will not be added to &#8220;Plugins&#8221;. In other words, if the application requires any configuration, you will have to perform it from the command line of the jail&#8217;s shell instead of the GUI.</p>
</div>
<div class="section" id="deleting-a-pbi">
<h4>Deleting a PBI<a class="headerlink" href="#deleting-a-pbi" title="Permalink to this headline">¶</a></h4>
<p>When you install a PBI using the Plugins method, an associated jail is created. If you decide to delete a PBI, the associated jail is also deleted as it is no longer required.
<strong>Before deleting a PBI,</strong>
** **
make sure that you don&#8217;t have any data or configuration in the jail that you do not want to lose. If you do, back it up first, before deleting the PBI.</p>
<p>In the example shown in Figure 9.1f, the CouchPotato PBI has been installed and the user has clicked its &#8220;Delete&#8221; button. As described in the previous sections, this PBI appears in the Plugins portion of the tree, its associated jail,
<em>couchpotato_1</em>
, appears in the Jails portion of the tree, and the PBI shows as installed in the Installed tab of Plugins. A pop-up message asks the user if they are sure that they want to delete.
<strong>This is the one and only warning.</strong>
** **
If the user clicks &#8220;Yes&#8221;, this PBI will be removed from the Plugins portion of the tree, its associated jail,
<em>couchpotato_1</em>
, will be deleted, and the PBI will no longer show as installed in the Installed tab of Plugins.</p>
<p><strong>Figure 9.1f: Deleting an Installed PBI</strong></p>
<p><a class="reference internal" href="_images/1000000000000348000001E9B764361C.png"><img alt="1000000000000348000001E9B764361C_png" src="_images/1000000000000348000001E9B764361C.png" style="width: 6.9252in; height: 4.0311in;" /></a></p>
</div>
</div>
<div class="section" id="id348">
<h3>Available FreeNAS® PBIs<a class="headerlink" href="#id348" title="Permalink to this headline">¶</a></h3>
<p>Currently, the following FreeNAS® PBIs are available:</p>
<ul class="simple">
<li><a class="reference external" href="http://bacula.org/">Bacula (storage daemon)</a></li>
<li><a class="reference external" href="http://www.bittorrent.com/sync">btsync</a></li>
<li><a class="reference external" href="https://couchpota.to/">CouchPotato</a></li>
<li><a class="reference external" href="http://www.code42.com/crashplan/">CrashPlan</a></li>
<li><a class="reference external" href="https://en.wikipedia.org/wiki/Firefly_Media_Server">Firefly</a></li>
<li><a class="reference external" href="https://github.com/mdlesk/Gamez">Gamez</a></li>
<li><a class="reference external" href="http://htpc.io/">HTPC Manager</a></li>
<li><a class="reference external" href="http://www.maraschinoproject.com/">Maraschino</a></li>
<li><a class="reference external" href="https://wiki.archlinux.org/index.php/MiniDLNA">MiniDLNA</a></li>
<li><a class="reference external" href="https://github.com/evilhero/mylar">mylar</a></li>
<li><a class="reference external" href="http://owncloud.org/">ownCloud</a></li>
<li><a class="reference external" href="http://www.plexapp.com/">Plex Media Server</a></li>
<li><a class="reference external" href="http://sabnzbd.org/">SABnzbd</a></li>
<li><a class="reference external" href="http://sickbeard.com/">Sick Beard</a></li>
<li><a class="reference external" href="http://www.transmissionbt.com/">Transmission</a></li>
</ul>
<p><strong>NOTE:</strong>
only a small sub-set of these PBIs are available for 32-bit systems as most applications are 64-bit.</p>
<p>While the FreeNAS® Plugins system makes it easy to install a PBI, it is still up to you to know how to configure and use the installed application. When in doubt, refer to the documentation for that application.</p>
<div class="section" id="pbi-requests">
<h4>PBI Requests<a class="headerlink" href="#pbi-requests" title="Permalink to this headline">¶</a></h4>
<p>If you would like to request a 9.x PC-BSD or FreeNAS® PBI for an application please add an entry to the
<a class="reference external" href="http://doc.freenas.org/index.php/Available_FreeNAS®_PBIs#PBI_Requests">PBI Requests table</a>
. When adding an entry, insert the application name in alphabetical order.</p>
<p>If you are working on a PC-BSD or FreeNAS® PBI module, indicate this in the “9.x PBI for Testing” column for that entry.</p>
<p>Before requesting a PBI, check that a FreeBSD port already exists for the application at
<a class="reference external" href="http://freshports.org/">FreshPorts</a>
. If the software has been ported, FreshPorts will indicate the name and category of the port. For example, the
<a class="reference external" href="http://www.freshports.org/search.php?query=bacula&amp;search=go&amp;num=10&amp;stype=name&amp;method=match&amp;deleted=excludedeleted&amp;start=1&amp;casesensitivity=caseinsensitive">GUI for the Bacula server</a>
is located in sysutils/bacula-bat.</p>
<p>If the software has not been ported to FreeBSD yet, issue a port request at the PC-BSD Port Requests forum using
<a class="reference external" href="http://forums.pcbsd.org/showthread.php?t=13743">these instructions</a>
. Alternately, if you have ported software before, the
<a class="reference external" href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/porters-handbook/">Porters Handbook</a>
contains detailed instructions for porting software to FreeBSD.</p>
</div>
</div>
</div>
<div class="section" id="id350">
<h2>Jails<a class="headerlink" href="#id350" title="Permalink to this headline">¶</a></h2>
<p>The previous section described how to find, install, and configure software using the Plugins method.</p>
<p>This section describes how to use the Jails method, which allows users who are comfortable using the command line to have more control over software installation and management.</p>
<p>While the Plugins method automatically created a FreeBSD jail for each installed PBI, the Jails method allows the user to create as many jails as needed and to specify the type of jail. Unlike the Plugins method, one is not limited to installing only one application per jail.</p>
<p>Essentially, a
<a class="reference external" href="http://en.wikipedia.org/wiki/Freebsd_jail">FreeBSD jail</a>
provides a very light-weight, operating system-level virtualization. Consider it as an independent FreeBSD operating system running on the same hardware, without all of the overhead usually associated with virtualization. This means that any software and configurations within a jail are isolated from both the FreeNAS® operating system and any other jails running on that system. During creation, some jail types provide a
<em>VIMAGE</em>
option which provides that jail with its own, independent networking stack. This allows the jail to do its own IP broadcasting, which is required by some applications.</p>
<p>The following types of jails can be created:</p>
<ol class="arabic simple">
<li><strong>Plugin jail:</strong>
this type of jail provides the most flexibility for software installation. Similar to the Plugins method, this type of jail supports the installation of FreeNAS® PBIs, which integrate into the FreeNAS® GUI. In addition to FreeNAS® PBIs, you can also install the following types of software within a plugin jail: FreeBSD ports and FreeBSD pkgng packages. However, only FreeNAS® PBIs can be managed from the GUI as the other types of software are managed
from the command line of the jail. Further, the other types of jails do not support the ability to install FreeNAS® PBIs. If you plan to install FreeNAS® PBIs, install a plugin jail.</li>
<li><strong>Port jail:</strong>
this type of jail supports the installation of FreeBSD ports and FreeBSD pkgng packages. It does
<strong>not</strong>
** **
support the installation of FreeNAS® PBIs, meaning that any software installed in this type of jail must be managed from the command line of the jail.</li>
<li><strong>Standard jail:</strong>
this type of jail is functionally the same as a port jail. A distinction is made for those users who prefer to separate network servers, such as DHCP or DNS services, from other installed software.</li>
<li><a href="#id351"><span class="problematic" id="id352">**</span></a>Linux jail: **
due to the
<a class="reference external" href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/linuxemu.html">FreeBSD linux binary compatibility layer</a>
, Linux can be installed into a jail and software can be installed using the package management system provided by the installed Linux distro. At this time, the Linux distro must be a 32-bit version and any applications installed into the jail must be available as a 32-bit binary.</li>
</ol>
<p>Table 10a summarizes the type of software which can be installed into each type of jail. Click the name of the type of software for instructions on how to install that type of software.</p>
<p><strong>NOTE:</strong>
the software which can be installed into a Linux jail is limited to the command line package management tool provided by that Linux distribution. If you install software into a Linux jail, install the 32-bit version of the software.</p>
<p><strong>Table 10a: What Type of Software can be Installed Into a Jail?</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="8%" />
<col width="26%" />
<col width="36%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Type of Jail</strong></th>
<th class="head"><a class="reference external" href="#1.10.4.InstallingFreeNAS®PBIs|outline">FreeNAS® PBI</a>
`  &lt;#1.10.4.Installing FreeNAS® PBIs <a href="#id353"><span class="problematic" id="id354">|</span></a>outline&gt;`_</th>
<th class="head"><a class="reference external" href="#1.10.6.1.InstallingFreeBSDPackageswithpkgng|outline">FreeBSD pkgng package</a></th>
<th class="head"><a class="reference external" href="#1.10.6.2.CompilingFreeBSDPortswithmake|outline">FreeBSD port</a></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Plugin</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td>Port</td>
<td>no</td>
<td>no, unless
<em>vanilla</em>
is unchecked during jail creation</td>
<td>yes</td>
</tr>
<tr class="row-even"><td>Standard</td>
<td>no</td>
<td>no, unless
<em>vanilla</em>
is unchecked during jail creation</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td>Linux</td>
<td>no</td>
<td>no</td>
<td>no</td>
</tr>
</tbody>
</table>
<p>The ability to create multiple jails and multiple types of jails offers great flexibility and application separation to the administrator. For example, one could create a separate plugin jail for each FreeNAS® plugin, a separate port jail for each application that is not available as a FreeNAS® plugin, and a separate standard jail for each installed network server. Alternately, one has the ability to create one jail and to mix and match how the software is installed into that jail.</p>
<p>The rest of this section describes the following:</p>
<ul class="simple">
<li><a class="reference external" href="#1.10.2.JailsConfiguration|outline">Jails Configuration</a></li>
<li><a class="reference external" href="#1.10.3.AddingJails|outline">Adding Jails</a></li>
<li><a class="reference external" href="#1.10.4.JailTemplates|outline">Jail Templates</a></li>
<li><a class="reference external" href="#1.10.4.InstallingFreeNAS®PBIs|outline">Installing FreeNAS® PBIs</a></li>
<li><a class="reference external" href="#1.10.6.Installingnon-PBISoftware|outline">Installing non-PBI Software</a></li>
</ul>
<div class="section" id="id355">
<h3>Jails Configuration<a class="headerlink" href="#id355" title="Permalink to this headline">¶</a></h3>
<p>Before you can create any jails, you must first configure which
volume or dataset
will be used to hold the jails. To do so, click Jails → Configuration to access the screen shown in Figure 10.1a.</p>
<p><strong>Figure 10.1a: Global Jail Configuration</strong></p>
<p><a class="reference internal" href="_images/10000000000002A2000001AA8352FB64.png"><img alt="10000000000002A2000001AA8352FB64_png" src="_images/10000000000002A2000001AA8352FB64.png" style="width: 6.9252in; height: 4.3772in;" /></a></p>
<p><strong>NOTE:</strong>
if you have already used the Plugins method, all of the fields in this screen will automatically be filled in. You should still double-check that the pre-configured values are appropriate for your jails.</p>
<p>While a jail can be installed on a UFS volume, it is recommended to use ZFS and to create a dataset to use for the
<em>Jail Root</em>
. As jails are created on a ZFS system, they will automatically be installed into their own dataset under the specified path. For example, if you configure a
<em>Jail Root</em>
of
<em>/mnt/volume1/dataset1</em>
and create a jail named
<em>jail1</em>
, it will be installed into its own dataset named
<em>/mnt/volume1/dataset1/jail1.</em></p>
<p>Table 10.1a summarizes the fields in this configuration screen.</p>
<p><strong>Table 10.1a: Jail Configuration Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="24%" />
<col width="13%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Jail Root</td>
<td>browse button</td>
<td>mandatory as you cannot add a jail until this is set</td>
</tr>
<tr class="row-odd"><td>IPv4 Network</td>
<td>string</td>
<td>see explanation below table; format is IP address of network / CIDR mask</td>
</tr>
<tr class="row-even"><td>IPv4 Network Start Address</td>
<td>string</td>
<td>see explanation below table; format is IP address of host / CIDR mask</td>
</tr>
<tr class="row-odd"><td>IPv4 Network End Address</td>
<td>string</td>
<td>see explanation below table; format is IP address of host / CIDR mask</td>
</tr>
</tbody>
</table>
<p>When selecting the “Jail Root”, ensure that the size of the selected volume or dataset is sufficient to hold the number of jails to be installed as well as any software, log files, and data to be stored within each jail. At a bare minimum, budget at least 2GB per jail and do not select a dataset that is less than 2GB in size.</p>
<p><strong>NOTE:</strong>
if you plan to
<a class="reference external" href="#1.10.3.1.2.AddingStorage|outline">add storage</a>
to a jail, be aware that path size is limited to 88 characters. Make sure that the length of your volume name plus the dataset name plus the jail name does not exceed this limit.</p>
<p>FreeNAS® will automatically detect and display the “IPv4 Network” that the administrative interface is connected to. This setting is important as the IPv4 network must be
<strong>ping</strong>
able from the FreeNAS® system in order for your jails and any installed software to be accessible . If your network topology requires you to change the default value, you will also need to configure a default gateway, and possibly a static route, to the specified network. If you change this value, ensure that the subnet mask value is correct as an incorrect mask can make the IP network unreachable. When in doubt, keep the default setting for “IPv4 Network”. If you are using VMware, make sure that the vswitch is set to promiscuous mode.</p>
<p>Review the default values of the “IPv4 Network Start Address” and “IPv4 Network End Address” to determine if that range is appropriate for the number of jails that you will create. If there is a DHCP server on the network, make sure that this range of addresses is excluded from the scope of the DHCP server. As jails are created, they will automatically be assigned the next free IP address within the range specified by these two values.</p>
<p><strong>NOTE:</strong>
these 4 fields are necessary for the proper operation of Jails. If you are unable to add, start, or access the software installed into jails, double-check the values in these fields. In particular, make sure that the specified IPv4 settings are reachable by clients and that the specified addresses are not in use by any other clients in the network.</p>
</div>
<div class="section" id="id356">
<h3>Adding Jails<a class="headerlink" href="#id356" title="Permalink to this headline">¶</a></h3>
<p>To create a jail, click Jails → Add Jails to access the screen shown in Figure 10.2a.
Table 10.2a
summarizes the available options.</p>
<p><strong>NOTE:</strong>
the “Add Jails” menu item will not appear until after you configure Jails →
<a class="reference external" href="#1.10.2.JailsConfiguration|outline">Configuration</a>
.</p>
<p><strong>Figure 10.2a: Creating a Jail</strong></p>
<p><a class="reference internal" href="_images/10000000000002FD000001EA0AB33970.png"><img alt="10000000000002FD000001EA0AB33970_png" src="_images/10000000000002FD000001EA0AB33970.png" style="width: 6.9252in; height: 4.4346in;" /></a></p>
<p><a href="#id358"><span class="problematic" id="id359">**</span></a>Table 10.2a: Jail Configuration Options **</p>
<table border="1" class="docutils">
<colgroup>
<col width="14%" />
<col width="8%" />
<col width="78%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Jail Name</td>
<td>string</td>
<td>mandatory; can only contain letters and numbers</td>
</tr>
<tr class="row-odd"><td>type</td>
<td>drop-down menu</td>
<td>default choices are
<em>pluginjail</em>
,
<em>portjail</em>
,
<em>standard</em>
,
<em>debian</em>
,
<em>gentoo</em>
,
<em>ubuntu</em>
,
<em>suse</em>
, and
<em>centos</em>
; on a 64-bit system,
options are also available for creating the 32-bit versions of a plugin, port, or standard jail</td>
</tr>
<tr class="row-even"><td>IPv4 address</td>
<td>integer</td>
<td>will be automatically assigned the next free address from the range specified in
<a class="reference external" href="#1.10.1.JailsConfiguration|outline">Jails Configuration</a>
; if you change the default address, make sure it is reachable within the FreeNAS® system&#8217;s network and is not in use by any other host on the network</td>
</tr>
<tr class="row-odd"><td>IPv4 netmask</td>
<td>drop-down menu</td>
<td>select the subnet mask associated with
<em>IPv4 address</em></td>
</tr>
<tr class="row-even"><td>IPv4 bridge address</td>
<td>integer</td>
<td>see NOTE below; will be greyed out for Linux jails or if
<em>VIMAGE</em>
is unchecked</td>
</tr>
<tr class="row-odd"><td>IPv4 bridge netmask</td>
<td>drop-down menu</td>
<td>select the subnet mask associated with
<em>IPv4 bridge address</em>
; will be greyed out for Linux jails or if
<em>VIMAGE</em>
is unchecked</td>
</tr>
<tr class="row-even"><td>IPv4 default gateway</td>
<td>string</td>
<td>used to set the jail&#8217;s default gateway IPv4 address; will be greyed out for Linux jails or if
<em>VIMAGE</em>
is unchecked</td>
</tr>
<tr class="row-odd"><td>IPv6 address</td>
<td>integer</td>
<td>if IPv6 has been configured, will be automatically assigned the next free
address from the range specified in
<a class="reference external" href="#1.10.1.JailsConfiguration|outline">Jails Configuration</a></td>
</tr>
<tr class="row-even"><td>IPv6 prefix length</td>
<td>drop-down menu</td>
<td>select the prefix length associated with
<em>IPv6 address</em></td>
</tr>
<tr class="row-odd"><td>IPv6 bridge address</td>
<td>integer</td>
<td>see NOTE below; will be greyed out for Linux jails or if
<em>VIMAGE</em>
is unchecked</td>
</tr>
<tr class="row-even"><td>IPv6 bridge prefix length</td>
<td>drop-down menu</td>
<td>select the prefix length associated with
<em>IPv6 address</em>
; will be greyed out for Linux jails or if
<em>VIMAGE</em>
is unchecked</td>
</tr>
<tr class="row-odd"><td>IPv6 default gateway</td>
<td>string</td>
<td>used to set the jail&#8217;s default gateway IPv6 address; will be greyed out for Linux jails or if
<em>VIMAGE</em>
is unchecked</td>
</tr>
<tr class="row-even"><td>MAC</td>
<td>string</td>
<td>if a static MAC address is needed, input it here; requires
<em>VIMAGE</em>
to be checked</td>
</tr>
<tr class="row-odd"><td>Sysctls</td>
<td>string</td>
<td>comma-delimited list of sysctls to set inside jail (e.g.
<em>allow.sysvipc=1,allow.raw_sockets=1</em>
)</td>
</tr>
<tr class="row-even"><td>Autostart</td>
<td>checkbox</td>
<td>uncheck if you want to start the jail manually</td>
</tr>
<tr class="row-odd"><td>VIMAGE</td>
<td>checkbox</td>
<td>gives a jail its own virtualized network stack; requires promiscuous mode to be enabled on the interface; does not apply to Linux jails</td>
</tr>
<tr class="row-even"><td>NAT</td>
<td>checkbox</td>
<td>enables Network Address Translation for the jail; will be greyed out for Linux jails or if
<em>VIMAGE</em>
is unchecked</td>
</tr>
<tr class="row-odd"><td>vanilla</td>
<td>checkbox</td>
<td>uncheck this box if you plan to install FreeBSD packages into a
<em>portjail</em>
or
<em>standard</em>
jail</td>
</tr>
</tbody>
</table>
<p><strong>NOTE:</strong>
The IPv4 and IPv6 bridge interface is used to bridge the
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=epair">epair(4)</a>
device, which is automatically created for each started jail, to a physical network device. The default network device is the one that is configured with a default gateway. So, if
<em>em0</em>
is the FreeBSD name of the physical interface and three jails are running, the following virtual interfaces will be automatically created:
<em>bridge0</em>
,
<em>epair0a</em>
,
<em>epair1a</em>
, and
<em>epair2a.</em>
The physical interface
<em>em0</em>
will be added to the bridge, as well as each epair device. The other half of the epair will be placed inside the jail and will be assigned the IP address specified for that jail. The bridge interface will be assigned an alias of the default gateway for that jail, if configured, or the bridge IP, if configured; either is correct.</p>
<p>A “traditional” FreeBSD jail does not use VIMAGE or NAT. If you uncheck both of these boxes, you need to configure the jail with an IP address within the same network as the interface it is bound to, and that address will be assigned as an alias on that interface. To use a VIMAGE jail on the same subnet, disable NAT, and configure an IP address within the same network. In both of these cases, you only configure an IP address and do not configure a bridge or a gateway address.</p>
<p>After making your selections, click the OK button. The jail will be created and will be added to the tree under Jails. By default, a plugin jail will be created and automatically started, unless you specify otherwise.</p>
<p>The first time you add a type of jail, the GUI will automatically download the necessary components from the Internet. If it is unable to connect to the Internet, the jail creation will fail. Otherwise, a
progress bar will indicate the status of the download and provide an estimated time for the process to
complete.
Once the first jail is created, subsequent jails of that type will be added instantaneously as the downloaded base for creating that type of jail is saved to the
<em>Jail Root</em>
.</p>
<div class="section" id="id362">
<h4>Managing Jails<a class="headerlink" href="#id362" title="Permalink to this headline">¶</a></h4>
<p>To view and configure the added jails, click Jails → View all Jails. In the example shown in Figure 10.2b, four jails have been created and the list entry for the jail named
<em>pluginjail</em>
has been clicked.</p>
<p><strong>Figure 10.2b: Created Jails Added to the GUI</strong></p>
<p><a class="reference internal" href="_images/100000000000029B000001F9B804C953.png"><img alt="100000000000029B000001F9B804C953_png" src="_images/100000000000029B000001F9B804C953.png" style="width: 6.9252in; height: 5.2429in;" /></a></p>
<p>Click a jail&#8217;s entry to access its configuration icons. In order, from left to right, these icons are used to:</p>
<p><strong>Edit Jail:</strong>
edit the jail&#8217;s settings as described in the
<a class="reference external" href="#1.10.3.1.1.EditaJail'sSettings|outline">next section</a>
.</p>
<p><strong>Add Storage:</strong>
configure the jail to access an area of storage as described in
<a class="reference external" href="#1.10.3.1.2.AddingStorage|outline">Adding Storage</a>
.</p>
<p><strong>Upload Plugin:</strong>
only available in a plugin jail. Used to install plugins as described in
<a class="reference external" href="#1.10.4.InstallingFreeNAS®PBIs|outline">Installing FreeNAS® PBIs</a>
.</p>
<p><strong>Start/Stop:</strong>
this icon will vary, depending upon the current running status of the jail. If the jail is currently stopped, the icon will be green and can be used to start the jail. If the jail is currently running,
the icon will be red and can be used to stop the jail. A stopped jail and its applications are inaccessible until it is restarted.</p>
<p><strong>Shell:</strong>
used to access a root command prompt in order to configure the selected jail from the command
line.</p>
<p><strong>Delete:</strong>
deleting the specified jail also deletes any software that was installed in that jail. The GUI will display a warning which requires you to click the Yes button, indicating that you are sure that you want to delete the jail, before this operation is performed.</p>
</div>
<div class="section" id="accessing-a-jail-using-ssh-instead-of-its-shell-icon">
<h4>Accessing a Jail Using SSH Instead of its Shell Icon<a class="headerlink" href="#accessing-a-jail-using-ssh-instead-of-its-shell-icon" title="Permalink to this headline">¶</a></h4>
<p>If you prefer to use
<strong>ssh</strong>
to access a jail you will need to first start the
<strong>ssh</strong>
service and create a user account for
<strong>ssh</strong>
access. Since this configuration occurs on a jail-by-jail basis, click the “Shell” icon for the jail you wish to configure
<strong>ssh</strong>
access to.</p>
<p>To start the SSH service on a non-Linux jail, look for the following line in that jail&#8217;s
<em>/etc/rc.conf</em>
:</p>
<p>sshd_enable=&#8221;NO&#8221;</p>
<p>Change the
<em>NO</em>
to
<em>YES</em>
and save the file. Then, start the SSH daemon:</p>
<p><strong>service sshd start</strong></p>
<p>The host RSA key pair should be generated and the key&#8217;s fingerprint and random art image displayed.</p>
<p>For a Linux jail, refer to the documentation for that Linux distribution for instructions on how to start the SSH service. Depending upon the distribution, you may have to first install a SSH server.</p>
<p>Next, add a user account. If you want the user to have superuser privileges to a non-Linux jail, make sure the user is placed in the
<em>wheel</em>
group when it is created. Type
<strong>adduser</strong>
and follow the prompts. When you get to this prompt, do not press enter but instead type
<em>wheel</em>
:</p>
<p>Login group is user1. Invite user1 into other groups? []:
<strong>wheel</strong></p>
<p>Once the user is created, set the
<em>root</em>
password so that the new user will be able to use the
<strong>su</strong>
command to gain superuser privilege. To set the password, type
<strong>passwd</strong>
then input and confirm the desired password.</p>
<p>For a Linux jail, you will need to create a user account using the software that comes with the Linux distribution. Since Linux does not use the
<em>wheel</em>
group, if you wish to give this user superuser privileges, instead install and configure the sudo application.</p>
<p>Finally, test from another system that the user can successfully
<strong>ssh</strong>
in and become the superuser. In this example, a user named
<em>user1</em>
uses
<strong>ssh</strong>
to access the non-Linux jail at 192.168.2.3. The first time the user logs in, they will be asked to verify the fingerprint of the host:</p>
<p><strong>ssh user1&#64;192.168.2.3</strong></p>
<p>The authenticity of host &#8216;192.168.2.3 (192.168.2.3)&#8217; can&#8217;t be established.</p>
<p>RSA key fingerprint is 6f:93:e5:36:4f:54:ed:4b:9c:c8:c2:71:89:c1:58:f0.</p>
<p>Are you sure you want to continue connecting (yes/no)?
<strong>yes</strong></p>
<p>Warning: Permanently added &#8216;192.168.2.3&#8217; (RSA) to the list of known hosts.</p>
<p>Password:
<strong>type_password_here</strong></p>
<p><strong>NOTE:</strong>
each jail has its own user accounts and service configuration. This means that you will need to
repeat these steps for each jail that requires SSH access.</p>
<div class="section" id="edit-a-jail-s-settings">
<h5>Edit a Jail&#8217;s Settings<a class="headerlink" href="#edit-a-jail-s-settings" title="Permalink to this headline">¶</a></h5>
<p>Figure 10.2c shows the configuration screen that appears when you click the “Edit Jail” button for a highlighted jail&#8217;s entry.
This screen can also be accessed by expanding the jail&#8217;s name in the tree view and clicking Edit
.</p>
<p><strong>Figure 10.2c: Jail&#8217;s Edit Settings</strong></p>
<p><a class="reference internal" href="_images/10000000000002C4000001ED511B66EF.png"><img alt="10000000000002C4000001ED511B66EF_png" src="_images/10000000000002C4000001ED511B66EF.png" style="width: 6.9252in; height: 4.8217in;" /></a></p>
<p>Most of these settings were previously described in Table 10.2a and can be changed using this screen after jail creation. The following settings differ between the “Add Jail” and “Edit Jail” screens:</p>
<ul class="simple">
<li><strong>Jail Name:</strong>
this setting is read-only once the jail has been created.</li>
<li><strong>IPv4 aliases:</strong>
once a jail has been created, this field can be used to add additional IPv4 addresses, which are known as aliases. When adding multiple aliases, use a comma delimited list.</li>
<li><strong>IPv6 aliases:</strong>
once a jail has been created, this field can be used to add additional IPv6 addresses. When adding multiple aliases, use a comma delimited list.</li>
</ul>
<p><strong>NOTE:</strong>
if you need to modify the IP address information for a jail, use it&#8217;s &#8220;Edit Jail&#8221; button instead of
the associated networking commands from the command line of the jail.</p>
</div>
<div class="section" id="id364">
<h5>Adding Storage<a class="headerlink" href="#id364" title="Permalink to this headline">¶</a></h5>
<p>It is possible to give a jail access to an area of storage on the FreeNAS® system. This is useful if you install an application that stores a large amount of data or if an installed application needs access to the data stored on the FreeNAS® system. An example would be transmission, which stores torrents. The storage is added using the
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=mount_nullfs">mount_nullfs(8)</a>
mechanism which links data that resides outside of the jail as a storage area within the jail.</p>
<p>To add storage, click the “Add Storage” button for a highlighted jail&#8217;s entry. This screen can also be accessed by expanding the jail&#8217;s name in the tree view and clicking Storage → Add Storage, shown in Figure 10.2d.</p>
<p>Browse to the “Source” and “Destination”, where:</p>
<ul class="simple">
<li><strong>Source:</strong>
is the directory or dataset on the FreeNAS® system you would like to gain access to from the jail. This directory
<strong>must</strong>
** **
reside outside of the volume or dataset being used by the jail. This is why it is recommended to create a separate dataset to store jails, as the dataset holding the jails will always be separate from any datasets used for storage on the FreeNAS® system.</li>
<li><strong>Destination:</strong>
select the directory within the jail which will be linked to the “Source” storage area.</li>
</ul>
<p><strong>Figure 10.2d: Adding Storage to a Jail</strong></p>
<p><a class="reference internal" href="_images/10000000000002C30000020A7F861DA6.png"><img alt="10000000000002C30000020A7F861DA6_png" src="_images/10000000000002C30000020A7F861DA6.png" style="width: 6.9252in; height: 5.1134in;" /></a></p>
<p>When you are adding storage, it is typically because the user and group account associated with an application installed inside of a jail needs to access data stored on the FreeNAS® system. Before selecting the &#8220;Source&#8221;, it is important to first ensure that the permissions of the selected directory or dataset grant permission to the user/group account inside of the jail. This is typically not the default, as the users and groups created inside of a jail are totally separate from the users and groups of the FreeNAS® system.</p>
<p>This means that the workflow for adding storage is usually as follows:</p>
<ol class="arabic simple">
<li>Determine the name of the user and group account used by the application. For example, the installation of the transmission application automatically creates a user account named
<em>transmission</em>
and a group account named
<em>transmission</em>
. When in doubt, check the files
<em>/etc/passwd</em>
(to find the user account) and
<em>/etc/group</em>
(to find the group account) inside of the jail. Typically, the user and group names are similar to the application name. Also, the UID and GID are usually the same as the port number used by the service.</li>
<li>On the FreeNAS® system, create a
<a class="reference external" href="#1.3.2.2.Users|outline">user account</a>
and
<a class="reference external" href="#1.3.2.1.Groups|outline">group account</a>
to match the name of the user and group used by the application in the jail.</li>
<li>On the FreeNAS® system, determine if you want the jail to have access to existing data or if you want to set aside an area of storage for the jail to use.</li>
<li>If the jail should access existing data, edit the
<a class="reference external" href="#1.6.3.10.SettingPermissions|outline">permissions</a>
of the volume or dataset so that the user and group account has the desired read and write access. If multiple applications or jails are to have access to the same data, you will need to create a separate group and add each needed user account to that group.</li>
<li>If you are instead setting aside an area of storage for that jail (or individual application), create a dataset. Then, edit the permissions of that dataset so that the user and group account has the desired read and write access.</li>
<li>Use the &#8220;Add Storage&#8221; button of the jail and select the configured volume/dataset as the &#8220;Source&#8221;.</li>
</ol>
<p>If you wish to prevent writes to the storage, check the box “Read-Only”.</p>
<p>By default, the “Create directory” box is checked. This means that the directory will automatically be created for you under the specified “Destination” path if the directory does not already exist.</p>
<p>Once a storage has been added, it will be added to the tree under the specified jail. In the example shown in Figure 10.2e, a dataset named
<em>volume1/data</em>
has been chosen as the “Source” as it contains the files stored on the FreeNAS® system. When the storage was created, the user browsed to
<em>volume1/jails/pluginjail/usr/local</em>
in the “Destination” field, then typed in
<em>test</em>
as the directory. Since this directory did not already exist, it was created as the “Create directory” box was left as checked. The resulting storage was added to the
<em>pluginjail</em>
entry in the tree as
<em>/usr/local/test</em>
. The user has clicked this
<em>/usr/local/test</em>
entry in order to access its edit screen.</p>
<p>By default, the storage is mounted as it is created. To unmount the storage, uncheck its “Mounted?” box.</p>
<p><strong>NOTE:</strong>
a mounted dataset will not automatically mount any of its child datasets. While the child datasets may appear browsable inside the jail, any changes will not be visible. Since each dataset is considered to be its own filesystem, each child dataset must have its own mount point, meaning that you need to create a separate storage for any child datasets which need to be mounted.</p>
<p>To delete the storage, click its “Delete” button.</p>
<p><strong>DANGER!</strong>
it is important to realize that an added storage is really just a pointer to the selected storage directory on the FreeNAS® system. It does
<strong>not</strong>
** **
create a copy of that data within the jail.
<strong>This means that if you delete any files from the “Destination” directory located in the jail, you are really deleting those files from the “Source” directory located on the FreeNAS® system</strong>
** **
. However, if you delete the storage, you are only deleting the pointer, not the data itself.</p>
<p><strong>Figure 10.2e: Example Storage</strong></p>
<p><a class="reference internal" href="_images/1000000000000263000001F6A0162F91.png"><img alt="1000000000000263000001F6A0162F91_png" src="_images/1000000000000263000001F6A0162F91.png" style="width: 6.3638in; height: 5.2283in;" /></a></p>
</div>
</div>
</div>
<div class="section" id="id366">
<h3>Jail Templates<a class="headerlink" href="#id366" title="Permalink to this headline">¶</a></h3>
<p>Beginning with 9.2.0, FreeNAS® uses the
<a class="reference external" href="http://wiki.pcbsd.org/index.php/Warden®/9.2">warden</a>
templating system to provision jails. When you select the type of jail when creating a jail, as seen in Figure 10.2a, you are really choosing which existing template to use.</p>
<p>To view the default templates, click Jails → View Jail Templates. A listing of the default templates used by a 9.2.2 system are seen in Figure 10.3a.</p>
<p><strong>Figure 10.3a: Listing of Default Jail Templates</strong></p>
<p>The listing contains the following columns:</p>
<ul class="simple">
<li><strong>Name:</strong>
will appear in the &#8220;type&#8221; drop-down menu when adding a new jail.</li>
<li><strong>URL:</strong>
when adding a new jail, the template will be downloaded from this location.</li>
<li><strong>Instances:</strong>
indicates if the template has been used to create a jail. In this example, no templates have been used to create a jail, so all of the instances are set to
<em>0</em>
.</li>
</ul>
<div class="section" id="creating-your-own-templates">
<h4>Creating Your Own Templates<a class="headerlink" href="#creating-your-own-templates" title="Permalink to this headline">¶</a></h4>
<p>Creating your own custom templates allows you to deploy different versions and architectures of FreeBSD or different 32-bit Linux distributions into a FreeNAS® jail. Additionally, the template can be pre-configured to include the applications, configurations, and user accounts that you need in order to quickly deploy your jails.</p>
<p>To create a template, first install the desired FreeBSD or Linux operating system and configure it the way you want. The installation can be either to an existing jail or on another system.</p>
<p><strong>NOTE:</strong>
if you are installing Linux, make sure to install the 32-bit version of the operating system as 64-bit Linux versions are not supported at this time.</p>
<p>Once your configuration is complete, you need to create a tarball of the entire operating system that you wish to use as a template. This tarball needs to be compressed with
<strong>gzip</strong>
and end in a
<em>.tgz</em>
extension. Be careful when creating the tarball as you don&#8217;t want to end up in a recursive loop. In other words, the resulting tarball needs to be saved outside of the operating system being tarballed, such as to
an external USB drive or network share. Alternately, you can create a temporary directory within the operating system and use the
<em>&#8211;exclude</em>
switch to
<strong>tar</strong>
to exclude this directory from the tarball. The exact
<strong>tar</strong>
command to use will vary, depending upon the operating system being used to create the tarball.</p>
<p>Once you have the
<em>.tgz</em>
file for the operating system, save it to either an FTP share or an HTTP server. You will need the associated FTP or HTTP URL in order to add the template to the list of available templates.</p>
<p>To add the template, click Jails → Add Jail Templates which will open the screen seen in Figure 10.3b.</p>
<p><strong>Figure 10.3b: Adding A Custom Jail Template</strong></p>
<p><a class="reference internal" href="_images/100000000000025600000180A291AF63.png"><img alt="100000000000025600000180A291AF63_png" src="_images/100000000000025600000180A291AF63.png" style="width: 6.2283in; height: 3.9992in;" /></a></p>
<p>Table 10.3a summarizes the fields in this screen.</p>
<p><strong>Table 10.3a: Jail Template Options</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="23%" />
<col width="26%" />
<col width="52%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Setting</strong></th>
<th class="head"><strong>Value</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Name</td>
<td>string</td>
<td>value will appear in the
<em>Name</em>
column of View Jail Templates</td>
</tr>
<tr class="row-odd"><td>OS</td>
<td>drop-down menu</td>
<td>choices are
<em>FreeBSD</em>
or
<em>Linux</em></td>
</tr>
<tr class="row-even"><td>Architecture</td>
<td>drop-down menu</td>
<td>choices are
<em>x86</em>
or
<em>x64</em>
;
<em>x86</em>
is required
if
<em>Linux</em>
is selected</td>
</tr>
<tr class="row-odd"><td>URL</td>
<td>string</td>
<td>input the full URL to the
<em>.tgz</em>
file, including the protocol (
<em>ftp://</em>
or
<em>http://</em>
)</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id367">
<h3>Installing FreeNAS® PBIs<a class="headerlink" href="#id367" title="Permalink to this headline">¶</a></h3>
<p>Typically, FreeNAS® PBIs are installed using
<a class="reference external" href="#1.9.Plugins|outline">Plugins</a>
as this section of the GUI provides a method for browsing for available PBIs.</p>
<p>However, if a user has created their own plugins jail, FreeNAS® PBIs can be installed into it. Installing a PBI this way requires the user to first
<a class="reference external" href="http://www.freenas.org/downloads/plugins/9/">download the PBI</a>
for their architecture and version.</p>
<p><strong>NOTE:</strong>
FreeNAS® PBIs can not be installed inside a standard or ports jail.</p>
<p>To install a FreeNAS® PBI, go to Jails → View Jails and click the plugin jail you wish to install into. An example is seen in Figure 10.4a.</p>
<p><strong>Figure 10.4a: Select Plugin Jail to Install Into</strong></p>
<p><a class="reference internal" href="_images/100000000000029F000001F0A36F7687.png"><img alt="100000000000029F000001F0A36F7687_png" src="_images/100000000000029F000001F0A36F7687.png" style="width: 6.9252in; height: 5.1181in;" /></a></p>
<p>Click the “Upload Plugin” button. When prompted, “Browse” to the location of the downloaded PBI then click the “Upload” button to install the PBI. A status bar will indicate the progress of the installation. Once installed, the application will appear under the Plugins entry of the tree. In the example shown in Figure 10.4b, the MiniDLNA plugin has been installed.</p>
<p>You can now configure and manage the installed software as described in
<a class="reference external" href="#1.9.1.InstallingaFreeNAS®PBIUsingPlugins|outline">Plugins</a>
.</p>
<p><strong>Figure 10.4b: FreeNAS PBI Successfully Installed</strong></p>
<p><a class="reference internal" href="_images/10000000000002A1000001AC682CFEED.png"><img alt="10000000000002A1000001AC682CFEED_png" src="_images/10000000000002A1000001AC682CFEED.png" style="width: 6.9252in; height: 4.4035in;" /></a></p>
</div>
<div class="section" id="id370">
<h3>Installing non-PBI Software<a class="headerlink" href="#id370" title="Permalink to this headline">¶</a></h3>
<p>If a PBI is not available for the software that you wish to install, you can still install and configure the application from the command line of a plugin, port, or standard jail using FreeBSD ports or pkgng packages. This section describes these methods of software installation. You should skim through the entire section first to determine which method of software installation best meets your needs.</p>
<p><a href="#id371"><span class="problematic" id="id372">**</span></a>NOTE: **
the commands demonstrated in this section need to be executed from the shell icon of the jail the software is to be installed into.</p>
<div class="section" id="installing-freebsd-packages-with-pkgng">
<h4>Installing FreeBSD Packages with pkgng<a class="headerlink" href="#installing-freebsd-packages-with-pkgng" title="Permalink to this headline">¶</a></h4>
<p>The quickest and easiest way to install software inside the jail is to install a FreeBSD package. A FreeBSD package is pre-compiled, meaning that it contains all the binaries and dependencies required for the software to run on a FreeBSD system.</p>
<p>A lot of software has been ported to FreeBSD (currently over 24,000 applications) and most of that software is available as a package. One way to find FreeBSD software is to use the searchbar at
<a class="reference external" href="http://freshports.org/">FreshPorts.org</a>
.</p>
<p>Once you have located the name of the package you would like to install, use the
<strong>pkg install</strong>
command to install it. For example, to install the audiotag package, use this command:</p>
<p><strong>pkg install audiotag</strong></p>
<p>When prompted, type
<strong>y</strong>
to complete the installation. The installation messages will indicate if the package and its dependencies successfully download and install.</p>
<p><strong>DANGER!</strong></p>
<p><strong>do not</strong>
** **
use the
<strong>pkg_add</strong>
command in a FreeNAS® jail as it will cause inconsistencies in your package management database.</p>
<p>You can confirm that the installation was successful by querying the package database:</p>
<p><strong>pkg info -f audiotag</strong></p>
<p>audiotag-0.19_1</p>
<p>Name
: audiotag</p>
<p>Version
: 0.19_1</p>
<p>Origin
: audio/audiotag</p>
<p>Architecture
: freebsd:9:x86:64</p>
<p>Prefix
: /usr/local</p>
<p>Categories
: multimedia audio</p>
<p>Licenses
: GPLv2</p>
<p>Maintainer
: <a class="reference external" href="mailto:ports&#37;&#52;&#48;FreeBSD&#46;org">ports<span>&#64;</span>FreeBSD<span>&#46;</span>org</a></p>
<p>WWW
: <a class="reference external" href="http://github.com/Daenyth/audiotag">http://github.com/Daenyth/audiotag</a></p>
<p>Comment
: Command-line tool for mass tagging/renaming of audio files</p>
<p>Options
:</p>
<p>DOCS
: on</p>
<p>FLAC
: on</p>
<p>ID3
: on</p>
<p>MP4
: on</p>
<p>VORBIS : on</p>
<p>Flat size
: 62.8KiB</p>
<p>Description
:</p>
<p>Audiotag is a command-line tool for mass tagging/renaming of audio files</p>
<p>it supports the vorbis comment, id3 tags, and MP4 tags.</p>
<p>WWW: <a class="reference external" href="http://github.com/Daenyth/audiotag">http://github.com/Daenyth/audiotag</a></p>
<p>To see what was installed with the package:</p>
<p><strong>pkg info -l audiotag</strong></p>
<p>audiotag-0.19_1:</p>
<p>/usr/local/bin/audiotag</p>
<p>/usr/local/share/doc/audiotag/COPYING</p>
<p>/usr/local/share/doc/audiotag/ChangeLog</p>
<p>/usr/local/share/doc/audiotag/README</p>
<p>/usr/local/share/licenses/audiotag-0.19_1/GPLv2</p>
<p>/usr/local/share/licenses/audiotag-0.19_1/LICENSE</p>
<p>/usr/local/share/licenses/audiotag-0.19_1/catalog.mk</p>
<p>In FreeBSD, third-party software is always stored in
<em>/usr/local</em>
to differentiate it from the software that came with the operating system. Binaries are almost always located in a subdirectory called
<em>bin</em>
or
<em>sbin</em>
and configuration files in a subdirectory called
<em>etc</em>
.</p>
</div>
<div class="section" id="compiling-freebsd-ports-with-make">
<h4>Compiling FreeBSD Ports with make<a class="headerlink" href="#compiling-freebsd-ports-with-make" title="Permalink to this headline">¶</a></h4>
<p>Typically, software is installed using packages. Occasionally you may prefer to compile the port yourself. Compiling the port offers the following advantages:</p>
<ul class="simple">
<li>not every port has an available package. This is usually due to licensing restrictions or known, unaddressed security vulnerabilities.</li>
<li>sometimes the package is out-of-date and you need a feature that became available in the newer version.</li>
<li>some ports provide compile options that are not available in the pre-compiled package. These options are used to add additional features or to strip out the features you do not need.</li>
</ul>
<p>Compiling the port yourself has the following dis-advantages:</p>
<ul class="simple">
<li>it takes time. Depending upon the size of the application, the amount of dependencies, the amount of CPU and RAM on the system, and the current load on the FreeNAS® system, the amount of time can range from a few minutes to a few hours or even to a few days.</li>
</ul>
<p><strong>NOTE:</strong>
if the port doesn&#8217;t provide any compile options, you are better off saving your time and the FreeNAS® system&#8217;s resources by using the
<strong>pkg install</strong>
command instead.</p>
<p>You can determine if the port has any configurable compile options by clicking its FreshPorts listing. Figure 10.5a shows the “Configuration Options” for audiotag.</p>
<p><strong>Figure 10.5a: Configuration Options for Audiotag</strong></p>
<p><a class="reference internal" href="_images/10000000000002E1000002757E7365A6.png"><img alt="10000000000002E1000002757E7365A6_png" src="_images/10000000000002E1000002757E7365A6.png" style="width: 6.9252in; height: 4.5425in;" /></a></p>
<p>In FreeBSD, a
<em>Makefile</em>
is used to provide the compiling instructions to the
<strong>make</strong>
command. The
<em>Makefile</em>
is in ascii text, fairly easy to understand, and documented in
<a class="reference external" href="http://www.freebsd.org/cgi/cvsweb.cgi/ports/Mk/bsd.port.mk?rev=1.708;content-type=text%2Fplain">bsd.port.mk</a>
.</p>
<p>If the port has any configurable compile options, they will be listed at FreshPorts in the port&#8217;s “Configuration Options”. This port contains five configurable options (DOCS, FLAC, ID3, MP4, and VORBIS) and each option is enabled (on) by default.</p>
<p>FreeBSD packages are always built using the default options. When you compile the port yourself, those options will be presented to you in a menu, allowing you to change their default settings.</p>
<p>Before you can compile a port, the ports collection must be installed within the jail. From within the jail, use the
<strong>portsnap</strong>
utility:</p>
<p><strong>portsnap fetch extract</strong></p>
<p>This command will download the ports collection and extract it to the jail&#8217;s
<em>/usr/ports/</em>
directory.</p>
<p><strong>NOTE:</strong>
if you install additional software at a later date, you should make sure that the ports collection is up-to-date using this command:</p>
<p><strong>portsnap fetch update</strong></p>
<p>To compile a port, you will
<strong>cd</strong>
into a subdirectory of
<em>/usr/ports/</em>
. FreshPorts provides the location to
<strong>cd</strong>
into and the
<strong>make</strong>
command to run. This example will compile the audiotag port:</p>
<p><strong>cd /usr/ports/audio/audiotag</strong></p>
<p><strong>make install clean</strong></p>
<p>Since this port has configurable options, the first time this command is run the configure screen shown in Figure 10.5b will be displayed:</p>
<p><strong>Figure 10.5b: Configuration Options for Audiotag Port</strong></p>
<p><a class="reference internal" href="_images/10000000000001DF0000012CAAF5492B.png"><img alt="10000000000001DF0000012CAAF5492B_png" src="_images/10000000000001DF0000012CAAF5492B.png" style="width: 5.7701in; height: 2.778in;" /></a></p>
<p>To change an option&#8217;s setting, use the arrow keys to highlight the option, then press the
<strong>spacebar</strong>
** **
to toggle the selection. Once you are finished, tab over to OK and press enter. The port will begin to compile and install.</p>
<p><strong>NOTE:</strong>
if you change your mind, the configuration screen will not be displayed again should you stop and restart the build. Type
<strong>make config &amp;&amp; make install clean</strong>
if you need to change your selected options.</p>
<p>If the port has any dependencies with options, their configuration screens will be displayed and the compile will pause until it receives your input. It is a good idea to keep an eye on the compile until it finishes and you are returned to the command prompt.</p>
<p>Once the port is installed, it is registered in the same package database that manages packages. This means that you can use
<strong>pkg info</strong>
to determine what was installed, as described in the previous section.</p>
</div>
<div class="section" id="configuring-and-starting-installed-freebsd-software">
<h4>Configuring and Starting Installed FreeBSD Software<a class="headerlink" href="#configuring-and-starting-installed-freebsd-software" title="Permalink to this headline">¶</a></h4>
<p>Once the package or port is installed, you will need to configure and start it. If you are familiar with how to configure the software, look for its configuration file in
<em>/usr/local/etc</em>
or a subdirectory thereof. Many FreeBSD packages contain a sample configuration file to get you started. If you are unfamiliar with the software, you will need to spend some time at the software&#8217;s website to learn which configuration options are available and which configuration file(s) need to be edited.</p>
<p>Most FreeBSD packages that contain a startable service include a startup script which is automatically installed to
<em>/usr/local/etc/rc.d/</em>
. Once your configuration is complete, you can test that the service starts by running the script with the
<strong>onestart</strong>
option. As an example, if openvpn is installed into the jail, these commands will run its startup script and verify that the service started:</p>
<p><strong>/usr/local/etc/rc.d/openvpn onestart</strong></p>
<p>Starting openvpn.</p>
<p><strong>/usr/local/etc/rc.d/openvpn onestatus</strong></p>
<p>openvpn is running as pid 45560.</p>
<p><strong>sockstat -4</strong></p>
<p>USER
COMMAND
PID
FD PROTO
LOCAL ADDRESS
FOREIGN ADDRESS</p>
<p>root
openvpn
48386 4
udp4
<em>:54789
*:</em></p>
<p>If you instead receive an error:</p>
<p><strong>/usr/local/etc/rc.d/openvpn onestart</strong></p>
<p>Starting openvpn.</p>
<p>/usr/local/etc/rc.d/openvpn: WARNING: failed to start openvpn</p>
<p>Run
<strong>tail /var/log/messages</strong>
to see if any error messages hint at the problem. Most startup failures are related to a mis-configuration: either a typo or a missing option in a configuration file.</p>
<p>Once you have verified that the service starts and is working as intended, add a line to
<em>/etc/rc.conf</em>
to ensure that the service automatically starts whenever the jail is started. The line to start a service always ends in
<a href="#id373"><span class="problematic" id="id374">*</span></a>_enable=&#8221;YES&#8221; *
and typically starts with the name of the software. For example, this is the entry for the openvpn service:</p>
<p>openvpn_enable=&#8221;YES&#8221;</p>
<p>When in doubt, the startup script will tell you which line to put in
<em>/etc/rc.conf</em>
. This is the description in
<em>/usr/local/etc/rc.d/openvpn:</em></p>
<p># This script supports running multiple instances of openvpn.</p>
<p># To run additional instances link this script to something like</p>
<p># % ln -s openvpn
openvpn_foo</p>
<p># and define additional openvpn_foo_* variables in one
of</p>
<p># /etc/rc.conf, /etc/rc.conf.local or /etc/rc.conf.d
/openvpn_foo</p>
<p>#</p>
<p># Below NAME should be substituted with the name of this script. By default</p>
<p># it is openvpn, so read as openvpn_enable. If you linked the script to</p>
<p># openvpn_foo, then read as openvpn_foo_enable etc.</p>
<p>#</p>
<p># The following variables are supported (defaults are shown).</p>
<p># You can place them in any of</p>
<p># /etc/rc.conf, /etc/rc.conf.local or /etc/rc.conf.d/NAME</p>
<p>#</p>
<p># NAME_enable=&#8221;NO&#8221;
# set to YES to enable openvpn</p>
<p>The startup script will also indicate if any additional parameters are available:</p>
<p># NAME_if=
# driver(s) to load, set to &#8220;tun&#8221;, &#8220;tap&#8221; or &#8220;tun tap&#8221;</p>
<p>#
# it is OK to specify the <a href="#id451"><span class="problematic" id="id452">if_</span></a> prefix.</p>
<p>#</p>
<p># # optional:</p>
<p># NAME_flags=
# additional command line arguments</p>
<p># NAME_configfile=&#8221;/usr/local/etc/openvpn/NAME.conf&#8221;
# &#8211;config file</p>
<p># NAME_dir=&#8221;/usr/local/etc/openvpn&#8221;
# &#8211;cd directory</p>
</div>
</div>
</div>
<div class="section" id="reporting">
<h2>Reporting<a class="headerlink" href="#reporting" title="Permalink to this headline">¶</a></h2>
<p>Reporting displays several graphs, as seen in the example in Figure 11a. Click the tab for a device type to see its graphs.</p>
<p>Figure 11a: Reporting Graphs</p>
<p><a class="reference internal" href="_images/100000000000033C000001F3B917EE92.png"><img alt="100000000000033C000001F3B917EE92_png" src="_images/100000000000033C000001F3B917EE92.png" style="width: 6.9146in; height: 4.1665in;" /></a></p>
<p>FreeNAS® uses
<a class="reference external" href="https://collectd.org/">collectd</a>
to provide reporting statistics. The following collectd plugins are enabled in
<em>/conf/base/etc/local/collectd.conf</em>
, and thus provide reporting graphs:</p>
<ul class="simple">
<li><a class="reference external" href="https://collectd.org/wiki/index.php/Plugin:CPU">CPU usage</a>
: collects the amount of time spent by the CPU in various states such as executing user code, executing system code, and being idle.</li>
<li><a class="reference external" href="https://collectd.org/wiki/index.php/Plugin:Load">system load</a>
: provides a rough overview of system utilization over a one, five, and fifteen minute average.</li>
<li><a class="reference external" href="https://collectd.org/wiki/index.php/Plugin:Disk">disk</a>
: shows the average time a disk I/O operation took to complete.</li>
<li><a class="reference external" href="https://collectd.org/wiki/index.php/Plugin:Memory">physical memory</a>
: displays physical memory usage.</li>
<li><a class="reference external" href="https://collectd.org/wiki/index.php/Plugin:Swap">swap utilization</a>
: displays the amount of free and used swap space.</li>
<li><a class="reference external" href="https://collectd.org/wiki/index.php/Plugin:Interface">interface</a>
: shows received and transmitted traffic in bits per second for each configured interface.</li>
<li><a class="reference external" href="https://collectd.org/wiki/index.php/Plugin:DF">disk space</a>
: displays free and used space for each volume and dataset. However, the disk space used by an individual
<a class="reference external" href="#1.6.3.6.Creatingazvol|outline">zvol</a>
is not displayed as it is a block device.</li>
<li><a class="reference external" href="https://collectd.org/wiki/index.php/Plugin:Processes">processes</a>
: displays the number of processes, grouped by state.</li>
<li><a class="reference external" href="https://collectd.org/wiki/index.php/Plugin:Uptime">uptime</a>
: keeps track of the system uptime, the average running time, and the maximum reached uptime.</li>
</ul>
<p>Reporting data is saved, allowing you to view and monitor usage trends over time. Reporting data is saved to
<em>/data/rrd_dir.tar.bz2</em>
and should be preserved across system upgrades and at shutdown.</p>
<p>Use the magnifier buttons next to each graph to increase or decrease the displayed time increment from 10 minutes, hourly, daily, weekly, or monthly. You can also use the &lt;&lt; and &gt;&gt; buttons to scroll through the output.</p>
</div>
<div class="section" id="additional-options">
<h2>Additional Options<a class="headerlink" href="#additional-options" title="Permalink to this headline">¶</a></h2>
<p>This section covers the remaining miscellaneous options available from the FreeNAS® graphical administrative interface.</p>
<div class="section" id="display-system-processes">
<h3>Display System Processes<a class="headerlink" href="#display-system-processes" title="Permalink to this headline">¶</a></h3>
<p>If you click Display System Processes, a screen will open showing the output of
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=top">top(1)</a>
. An example is shown in Figure 12.1a.</p>
<p><strong>Figure 12.1a: System Processes Running on FreeNAS®</strong></p>
<p><a class="reference internal" href="_images/10000000000001F70000019B91B24E55.png"><img alt="10000000000001F70000019B91B24E55_png" src="_images/10000000000001F70000019B91B24E55.png" style="width: 6.0598in; height: 3.8055in;" /></a></p>
<p>The display will automatically refresh itself. Simply click the X in the upper right corner to close the display when you are finished. Note that the display is read-only, meaning that you won&#8217;t be able to issue a
<strong>kill</strong>
command within it.</p>
</div>
<div class="section" id="id376">
<h3>Shell<a class="headerlink" href="#id376" title="Permalink to this headline">¶</a></h3>
<p>Beginning with version 8.2.0, the FreeNAS® GUI provides a web shell, making it convenient to run command line tools from the web browser as the
<em>root</em>
user. The link to Shell is the third entry from the bottom of the menu tree. In Figure 12.2a, the link has been clicked and Shell is open.</p>
<p>The prompt indicates that the current user is
<em>root</em>
, the hostname is
<em>freenas</em>
, and the current working directory is
<em>~</em>
(
<em>root</em>
&#8216;s home directory).</p>
<p>To change the size of the shell, click the
<em>80x25</em>
drop-down menu and select a different size.</p>
<p>To copy text from shell, highlight the text, right-click, and select Copy from the right-click menu. To paste into the shell, click the Paste button, paste the text into the box that opens, and click the OK button to complete the paste operation.</p>
<p><strong>Figure 12.2a: Web Shell</strong></p>
<p><a class="reference internal" href="_images/10000000000002A100000215C3C73768.png"><img alt="10000000000002A100000215C3C73768_png" src="_images/10000000000002A100000215C3C73768.png" style="width: 6.9252in; height: 5.4839in;" /></a></p>
<p>While you are in Shell, you will not have access to any of the other GUI menus. If you are using Shell for troubleshooting purposes and need to leave the Shell in order to modify a configuration, click the x in the window&#8217;s upper right corner. The next time you enter Shell, you will return to your last session. When you are finished using Shell, type
<strong>exit</strong>
to leave the session completely.</p>
<p>Shell provides history (use your up arrow to see previously entered commands and press enter to repeat the currently displayed command) and tab completion (type a few letters and press tab to complete a command name or filename in the current directory).</p>
<p><strong>NOTE:</strong>
not all of Shell&#8217;s features render correctly in Chrome. Firefox is the recommended browser for using Shell.</p>
<p>Due to the embedded nature of FreeNAS®, some FreeBSD components are missing and noticeable in Shell. For example, man pages are not included; however, a link to the online FreeBSD man pages is available from
<a class="reference external" href="#1.12.5.Help|outline">Help</a>
. Most FreeBSD command line utilities should be available in Shell. Additional troubleshooting utilities that are provided by FreeNAS® are described in
<a class="reference external" href="#1.11.UsefulCommandLineUtilities|outline">Useful Command Line Utilities</a>
.</p>
</div>
<div class="section" id="reboot">
<h3>Reboot<a class="headerlink" href="#reboot" title="Permalink to this headline">¶</a></h3>
<p>If you click Reboot, you will receive the warning message shown in Figure 12.3a
and your browser color will change to red to indicate that you have selected an option that will negatively impact users of the FreeNAS® system.</p>
<p><strong>NOTE:</strong>
if any volumes are encrypted, make sure that you have
<a class="reference external" href="#1.6.3.4.2.CreatinganEncryptedVolume|outline">set the passphrase and have copies of the encryption key and the latest recovery key</a>
before performing a reboot.
<strong>Without these, you will not be able to **
`unlock the encrypted volume &lt;#1.2.6.4.Unlocking an Encrypted Volume|outline&gt;`_
** after the reboot.</strong>
** **</p>
<p><strong>Figure 12.3a: Reboot Warning Message</strong></p>
<p><a class="reference internal" href="_images/100000000000025A00000181AFAC67DC.png"><img alt="100000000000025A00000181AFAC67DC_png" src="_images/100000000000025A00000181AFAC67DC.png" style="width: 6.2693in; height: 4.0098in;" /></a></p>
<p>If a scrub or resilver is in progress when a reboot is requested, an additional warning will ask you to make sure that you wish to proceed. In this case, it is recommended to &#8220;Cancel&#8221; the reboot request and to periodically run
<strong>zpool status</strong>
from
<a class="reference external" href="#1.12.2.Shell|outline">Shell</a>
until it is verified that the scrub or resilver process is complete. Once complete, the reboot request can be re-issued.</p>
<p>Click the Cancel button if you wish to cancel the reboot request. Otherwise, click the Reboot button to reboot the system. Rebooting the system will disconnect all clients, including the web administration GUI. The URL in your web browser will change to add
<em>/system/reboot/</em>
to the end of the IP address. Wait a few minutes for the system to boot, then use your browser&#8217;s back button to return to the FreeNAS® system&#8217;s IP address. If all went well, you should receive the GUI login screen. If the login screen does not appear, you will need physical access to the FreeNAS® system&#8217;s monitor and keyboard so that you can determine what problem is preventing the system from resuming normal operation.</p>
</div>
<div class="section" id="shutdown">
<h3>Shutdown<a class="headerlink" href="#shutdown" title="Permalink to this headline">¶</a></h3>
<p>If you click Shutdown, you will receive the warning message shown in Figure 12.4a and your browser color will change to red to indicate that you have selected an option that will negatively impact users of the FreeNAS® system.</p>
<p><a href="#id379"><span class="problematic" id="id380">**</span></a>NOTE: if any volumes are encrypted, make sure that you have **
<a class="reference external" href="#1.6.3.4.2.CreatinganEncryptedVolume|outline">set the passphrase and have copies of the encryption key and the latest recovery key</a>
** before performing a shutdown. **
<em>Without these, you will not be able to *
`unlock the encrypted volume &lt;#1.2.6.4.Unlocking an Encrypted Volume|outline&gt;`_
* when the system is restarted.</em>
** **</p>
<p><strong>Figure 12.4a: Shutdown Warning Message</strong></p>
<p><a class="reference internal" href="_images/100000000000026F000001988EEC0562.png"><img alt="100000000000026F000001988EEC0562_png" src="_images/100000000000026F000001988EEC0562.png" style="width: 6.489in; height: 4.2492in;" /></a></p>
<p>If a scrub or resilver is in progress when a shutdown is requested, an additional warning will ask you to make sure that you wish to proceed. In this case, it is recommended to “Cancel” the shutdown request and to periodically run
<strong>zpool status</strong>
from
<a class="reference external" href="#1.12.2.Shell|outline">Shell</a>
until it is verified that the scrub or resilver process is complete. Once complete, the shutdown request can be re-issued.</p>
<p>Click the “Cancel” button if you wish to cancel the shutdown request. Otherwise, click the “Shutdown” button to halt the system. Shutting down the system will disconnect all clients, including the web administration GUI, and will power off the FreeNAS® system. You will need physical access to the FreeNAS® system in order to turn it back on.</p>
</div>
<div class="section" id="id383">
<h3>Help<a class="headerlink" href="#id383" title="Permalink to this headline">¶</a></h3>
<p>The Help button in the upper right corner provides a pop-up menu containing hyperlinks to the various FreeNAS® online resources, including:</p>
<ul class="simple">
<li>the Community Forum</li>
<li>each mailing list</li>
<li>the web interface to the IRC channel</li>
<li>the Bug Tracker page which links to the bug database, video walkthroughs, forums, and the documentation wiki</li>
<li>the online FreeBSD manual pages</li>
<li>a link to professional support</li>
</ul>
<p>These resources are discussed in more detail in the next section.</p>
</div>
<div class="section" id="log-out">
<h3>Log Out<a class="headerlink" href="#log-out" title="Permalink to this headline">¶</a></h3>
<p>To log out of the FreeNAS® GUI, simply click the Log Out button in the upper right corner. You will immediately be logged out. An informational message will indicate that you are logged out and will provide a hyperlink which you can click on to log back in. When logging back in, you will be prompted for the
<em>root</em>
password.</p>
</div>
<div class="section" id="alert">
<h3>Alert<a class="headerlink" href="#alert" title="Permalink to this headline">¶</a></h3>
<p>FreeNAS® provides an alert system to provide a visual warning of any conditions that require administrative attention. The Alert button in the far right corner will flash red when there is an outstanding alert.
In the example alert shown in Figure 12.7a. one of the disks in a ZFS pool is offline which has degraded the state of the pool.</p>
<p><strong>Figure 12.7a: Example Alert Message</strong></p>
<p><a class="reference internal" href="_images/10000000000001860000009EEEECF771.png"><img alt="10000000000001860000009EEEECF771_png" src="_images/10000000000001860000009EEEECF771.png" style="width: 4.0618in; height: 1.6453in;" /></a></p>
<p>Informational messages will have a green OK while messages requiring attention will be listed as a red CRITICAL. CRITICAL messages will also be emailed to the root user account. If you are aware of a critical condition but wish to remove the flashing alert until you deal with it, uncheck the box next to that message.</p>
<p>Behind the scenes, an alert script checks for various alert conditions, such as volume and disk status, and writes the current conditions to
<em>/var/tmp/alert</em>
. A javascript retrieves the current alert status every 5 minutes and will change the solid green alert icon to flashing red if a new alert is detected. Some of the conditions that trigger an alert include:</p>
<ul class="simple">
<li>a ZFS volume&#8217;s capacity goes over 80%</li>
<li>non-optimal multipath states</li>
<li>UPS ONBATT/LOWBATT event</li>
<li>ZFS pool status changes from HEALTHY</li>
<li>the system is unable to bind to the WebGUI Address set in System → Settings → General</li>
<li>the system can not find an IP address configured on an iSCSI portal</li>
<li>the status of a LSI MegaRAID SAS controller has changed;
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=mfiutil">mfiutil(8)</a>
is included for managing these devices</li>
</ul>
</div>
</div>
</div>
<div class="section" id="section-3-getting-help">
<h1>Section 3: Getting Help<a class="headerlink" href="#section-3-getting-help" title="Permalink to this headline">¶</a></h1>
<div class="section" id="id384">
<h2>FreeNAS® Support Resources<a class="headerlink" href="#id384" title="Permalink to this headline">¶</a></h2>
<p>FreeNAS® has a large installation base and an active user community. This means that many usage questions have already been answered and the details are available on the Internet. If you get stuck using FreeNAS®, spend a few moments searching the Internet for the word
<em>FreeNAS</em>
with some key words that describe your error message or the function that you are trying to implement.</p>
<p>The rest of this section discusses the following resources which are available to FreeNAS® users:</p>
<ul class="simple">
<li><a class="reference external" href="#1.10.1.WebsiteandSocialMedia|outline">Website and Social Media</a></li>
<li><a class="reference external" href="#1.10.5.Forums|outline">Forums</a></li>
<li><a class="reference external" href="#1.12.2.SupportDatabase|outline">Support Database</a></li>
<li><a class="reference external" href="#1.10.3.IRC|outline">IRC</a></li>
<li><a class="reference external" href="#1.10.4.MailingLists|outline">Mailing Lists</a></li>
<li><a class="reference external" href="#1.10.7.ProfessionalSupport|outline">Professional Support</a></li>
</ul>
<div class="section" id="id385">
<h3>Website and Social Media<a class="headerlink" href="#id385" title="Permalink to this headline">¶</a></h3>
<p>The
<a class="reference external" href="http://www.freenas.org/">FreeNAS® website</a>
contains links to all of the available documentation, support, and social media resources. Major announcements are also posted to the main page.</p>
<p>Users are welcome to network on the
FreeNAS®
social media sites:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.linkedin.com/groups/FreeNAS8-3903140">LinkedIn</a></li>
<li><a class="reference external" href="https://plus.google.com/110373675402281849911/posts">Google+</a></li>
<li><a class="reference external" href="https://www.facebook.com/freenascommunity">Facebook</a></li>
<li><a class="reference external" href="http://twitter.com/freenasteam">Twitter</a></li>
</ul>
</div>
<div class="section" id="id386">
<h3>Forums<a class="headerlink" href="#id386" title="Permalink to this headline">¶</a></h3>
<p>Another information source for FreeNAS® is the
<a class="reference external" href="http://forums.freenas.org/">Forums</a>
. Forums contain user-contributed tips and
guides which have been categorized, making it an ideal resource if you wish to learn more about a certain aspect of FreeNAS®. A searchbar is included should you wish to search by keyword; alternately, you can click a category to browse through the threads that exist for that topic.</p>
<p>The following categories are available under
<strong>Forum Information:</strong></p>
<ul class="simple">
<li><a class="reference external" href="http://forums.freenas.org/forums/forum-guidelines-read-before-posting.26/">Forum Guidelines</a>
: read this first before creating a forum post.</li>
<li><a class="reference external" href="http://forums.freenas.org/forums/announcements.27/">Announcements</a>
: subscribe to this forum if you wish to receive announcements about new FreeNAS® versions and features.</li>
</ul>
<p>The following categories are available under
<strong>Help and Support:</strong></p>
<ul class="simple">
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?5-FreeNAS-4-N00bs">FreeNAS 4 N00bs</a>
: post here if you are new to FreeNAS® and are unsure which category best matches your question.</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?6-Feature-Requests">Feature Requests</a>
: for the discussion of upcoming features.</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?7-Bug-Reporting">Bug Reporting</a>
: use this forum if you think you have found a bug in FreeNAS® and want to discuss it before creating a support ticket.</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?18-Hardware">Hardware</a>
: for the discussion of hardware and tips for getting the most out of your hardware.</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?19-User-Authentication">User Authentication</a>
: LDAP and Active Directory.</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?20-Sharing">Sharing</a>
: AFP, CIFS, NFS, and iSCSI.</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?21-Storage">Storage</a>
: replication, snapshots, volumes, and ZFS.</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?22-Networking">Networking</a>
: networking hardware, performance, link aggregation, VLANs, DDNS, FTP, SNMP, SSH, and TFTP.</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?32-Installation">Installation</a>
: installing help or advice before performing the installation.</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?34-Plugins">Plugins</a>
: provides a discussion area for creating and troubleshooting PBIs.</li>
</ul>
<p>The following categories are available under
<strong>Development:</strong></p>
<ul class="simple">
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?9-FreeNAS">FreeNAS</a>
: general development discussion.</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?10-nanobsd">nanobsd</a>
: the embedded operating system FreeNAS® is based upon.</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?11-Django">Django</a>
: the web framework used by the FreeNAS® graphical administrative interface.</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?12-Dojo-Toolkit">Dojo Toolkit</a>
: the javascript toolkit used to create widgets and handle client side processing.</li>
</ul>
<p>The following categories are available under
<strong>How-To Guides:</strong></p>
<ul class="simple">
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?14-Hacking">Hacking</a>
: undocumented tricks for getting the most out of your FreeNAS® system.</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?15-Installation">Installation</a>
: specific installation scenarios (hardware and/or software).</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?16-Configuration">Configuration</a>
: specific configuration scenarios (e.g. software or client configuration).</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?17-Hardware">Hardware</a>
: instructions for setting up specific hardware.</li>
</ul>
<p>If you are looking for tips on how to test and increase the performance of your system, check out the
<a class="reference external" href="http://forums.freenas.org/forumdisplay.php?37-Performance">Performance</a>
forum.</p>
<p>The following categories are available under
<strong>Community Forum:</strong></p>
<ul class="simple">
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?23-Off-topic">Off-topic</a>
: want to discuss something of interest to FreeNAS® users but which is not necessarily related to FreeNAS®? This is your place.</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?24-Resources">Resources</a>
: blogs, reviews, and other sources of FreeNAS® information not listed at
<a class="reference external" href="http://freenas.org/">freenas.org</a>
.</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?25-Introductions">Introductions</a>
: FreeNAS® Community meet &#8216;n greet - introduce yourself and let us know who we are chatting with.</li>
</ul>
<p>The following language-specific categories are available under
<strong>International</strong>
, allowing FreeNAS® users to interact with each other in their native language:</p>
<ul class="simple">
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?35-Dutch-Nederlands">Dutch - Nederlands</a></li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?29-French-Francais">French - Francais</a></li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?31-German-Deutsch">German - Deutsch</a></li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?30-Italian-Italiano">Italian - Italiano</a></li>
<li><a class="reference external" href="http://forums.freenas.org/forums/portuguese-português.44/">Portuguese - Português</a></li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?38-Russian-Русский">Russian - Русский</a></li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?33-Spanish-Espanol">Spanish</a>
<a class="reference external" href="http://forums.freenas.org/forumdisplay.php?33-Spanish-Espanol">–</a>
` Espanol &lt;<a class="reference external" href="http://forums.freenas.org/forumdisplay.php?33-Spanish-Espanol">http://forums.freenas.org/forumdisplay.php?33-Spanish-Espanol</a>&gt;`_</li>
<li><a class="reference external" href="http://forums.freenas.org/forumdisplay.php?36-Turkish-T%FCrk%E7e">Turkish - Türkçe</a></li>
</ul>
<p>If you wish to ask a question on the forum, you will need to click the “Sign Up Now!” link to create an account and login using that account.</p>
<p>When asking a question on the forum, it is important that you:</p>
<ul class="simple">
<li>First check to see if the question has already been asked. If you find a similar question, do not create a new thread. Instead use the “Reply” link at the bottom of the post to add your comments to the existing thread.</li>
<li>Review the available categories to see which one is most closely related to your question. Click on that category and use the “Post New Thread” button to open the editor. After typing your post and before you click the “Create Thread” button, make sure the “Watch this thread...” box is checked. If you want to be notified by email, also check the “and receive email notifications” box. That way you will be notified whenever anyone answers your question.</li>
</ul>
</div>
<div class="section" id="id395">
<h3>Support Database<a class="headerlink" href="#id395" title="Permalink to this headline">¶</a></h3>
<p>If you encounter a traceback error when using FreeNAS® or suspect that you have found a software or documentation bug, go to
<a class="reference external" href="https://bugs.freenas.org/projects/freenas">https://bugs.freenas.org/projects/freenas</a>
to see if your issue has already been reported. You do not need to register in order to search for existing issues. However, you will need to register if you wish to comment on an existing issue or create a new support issue.</p>
<p>Before creating a new issue, take the time to research your bug or feature request first. This is to prevent duplicating an existing issue and to ensure that your report contains the information that the developers need in order to implement the fix or the feature.</p>
<p>As part of your research, perform the following steps:</p>
<ul class="simple">
<li>Determine if you are running the latest release of FreeNAS®. FreeNAS® developers tend to fix bugs rapidly and new features are being implemented as FreeNAS® matures. If you are not running the latest version, it is quite likely that the bug has already been fixed or the missing feature has been implemented. If this is the case, your best course of action is to backup your data and configuration and perform an upgrade to the latest version.</li>
<li>If you are running the latest version, use the search feature to see if a similar issue already exists. If one does, do not create a new issue. Instead, add a comment to the existing issue if you have additional information to add.</li>
</ul>
<p>If a similar issue does not already exist, keep the following points in mind as you create a new issue:</p>
<ol class="arabic simple">
<li>You will need to register for an account, confirm you registration email address, and be logged in before you can create a new issue.</li>
<li>In the Tracker drop-down menu, select
<em>Bug</em>
if you are reporting a bug or
<em>Feature</em>
if you are making a feature request.</li>
<li>In the Subject field, include descriptive keywords that describe the issue. This is useful for other users who search for a similar problem.</li>
<li>In the Description section, describe the problem, how to recreate it, and include the text of any error messages. If you are requesting a feature, describe the benefit provided by the feature and, if applicable, provide examples of other products that use that feature or the URL of the homepage for the software.</li>
<li>If you would like to include a screenshot or log of your configuration or error, use the Browse button next to the Files field to upload the file.</li>
<li>Leave all of the other fields at their default values as these are used by developers as they take action on the issue.</li>
<li>Press the Preview link to read through your ticket before submitting it. Make sure it includes all of the information that someone else would need to understand your problem or request. Once you are satisfied with your ticket, click the Create Ticket button to submit it.</li>
</ol>
<p>An email will automatically be sent to the address you used when registering whenever a comment or action occurs on your issue.</p>
</div>
<div class="section" id="id396">
<h3>IRC<a class="headerlink" href="#id396" title="Permalink to this headline">¶</a></h3>
<p>If you wish to ask a question in “real time”, you can try the
<em>#freenas</em>
channel on
IRC</p>
<p><a class="reference external" href="http://freenode.net/index.shtml">Freenode</a>
. Depending upon the time of day and your time zone, a FreeNAS® developer or other FreeNAS® users may be available to assist you. If you do not get an answer right away, remain on the channel as other users tend to read the channel history in order to answer questions as they are able to.</p>
<p>Typically, an IRC
<a class="reference external" href="http://en.wikipedia.org/wiki/Comparison_of_Internet_Relay_Chat_clients">client</a>
is used to access the
<em>#freenas</em>
IRC channel. Alternately, you can access the
<a class="reference external" href="http://webchat.freenode.net/?channels=freenas">webchat</a>
version of the channel from a web browser.</p>
<p>To get the most out of the IRC channel, keep the following points in mind:</p>
<ul class="simple">
<li>Do not ask “can anyone help me?”; instead, just ask your question. If someone knows the
answer, they will try to assist you.</li>
<li>Do not ask a question and then leave. Users who know the answer can not help you if you disappear.</li>
<li>Do not take it personally if no one answers or demand that someone answers your question. Maybe no one who knows the answer is available, maybe your question is really hard, or maybe it is a question that has already been answered many times in the other support resources. Try asking again in a few hours or research the other resources to see if you have missed anything.</li>
<li>Do not post error messages in the channel as the IRC software will probably kick you out. Instead, use a pasting service such as
<a class="reference external" href="http://www.pastebin.com/">pastebin</a>
and paste the resulting URL into the IRC discussion.</li>
</ul>
</div>
<div class="section" id="id397">
<h3>Mailing Lists<a class="headerlink" href="#id397" title="Permalink to this headline">¶</a></h3>
<p>Several FreeNAS® mailing lists are available which allow users and developers to ask and answer questions related to the topic of the mailing list. To post an email to a list, you will need to subscribe to it first. Each mailing list is archived, allowing you to browse for information by date, thread name, or author.</p>
<p>The following mailing lists are available:</p>
<ul class="simple">
<li><a class="reference external" href="http://lists.freenas.org/mailman/listinfo/freenas-announce">Freenas-announce</a>
: this is a low-volume, read-only list where major milestones, such as new releases, are announced.</li>
<li><a class="reference external" href="http://lists.freenas.org/mailman/listinfo/freenas-commit">Freenas-commit</a>
: this is a read-only list. As code changes in the FreeNAS® repository, the commit message is automatically sent to this list.</li>
<li><a class="reference external" href="http://lists.freenas.org/mailman/listinfo/freenas-devel">Freenas-devel</a>
: FreeNAS® developers are subscribed to this list. Technical questions about the current FreeNAS® release can be posted here.</li>
<li><a class="reference external" href="http://lists.freenas.org/mailman/listinfo/freenas-docs">Freenas-docs</a>
: this list is for discussion regarding
<a class="reference external" href="http://doc.freenas.org/">FreeNAS® documentation</a>
.</li>
<li><a class="reference external" href="http://lists.freenas.org/mailman/listinfo/freenas-testing">Freenas-testing</a>
: FreeNAS® developers are subscribed to this list. Technical questions about the upcoming FreeNAS release and feedback on testing snapshots can be posted here.</li>
<li><a class="reference external" href="http://lists.freenas.org/mailman/listinfo/freenas-translations">Freenas-translations</a>
: this list is for discussion regarding
<a class="reference external" href="http://pootle.freenas.org/">FreeNAS® localization</a>
and translating FreeNAS® documentation.</li>
</ul>
<p><strong>NOTE:</strong>
the mailing lists were migrated from SourceForge to Mailman in December, 2013. Archives of the SourceForge mailing lists are available at
<a class="reference external" href="http://dir.gmane.org/index.php?prefix=gmane.os.freenas">Gmane</a>
.</p>
</div>
<div class="section" id="id398">
<h3>Professional Support<a class="headerlink" href="#id398" title="Permalink to this headline">¶</a></h3>
<p>In addition to the freely available community resources, iXsystems offers professional support packages. iXsystems&#8217; development team works hard to improve new and current versions of FreeNAS®, providing them with the insight to provide expert FreeNAS® support and consultation services. Their Professional Services team can also configure your FreeNAS® hardware and software
to deliver the highest levels of performance, stability, and security. See the
<a class="reference external" href="http://www.ixsystems.com/solutions/support/">iXsystems support page</a>
to request a quote.</p>
</div>
</div>
<div class="section" id="id399">
<h2>Useful Command Line Utilities<a class="headerlink" href="#id399" title="Permalink to this headline">¶</a></h2>
<p>Several command line utilities which are provided with FreeNAS® are demonstrated in this section.</p>
<p>The following utilities can be used for benchmarking and performance testing:</p>
<ul class="simple">
<li><a class="reference external" href="#1.11.1.Iperf|outline">Iperf</a>
<strong>:</strong>
used for measuring maximum TCP and UDP bandwidth performance</li>
<li><a class="reference external" href="#1.11.2.Netperf|outline">Netperf</a>
<strong>:</strong>
a tool for measuring network performance</li>
<li><a class="reference external" href="#1.11.2.IOzone|outline">IOzone</a>
<strong>:</strong>
filesystem benchmark utility used to perform a broad filesystem analysis</li>
<li><a class="reference external" href="#1.11.3.arcstat|outline">arcstat.py</a>
<a class="reference external" href="#1.11.3.arcstat|outline">and</a>
<a class="reference external" href="#1.11.3.arcstat|outline">arc_summary.py</a>
<strong>:</strong>
used to gather ZFS ARC statistics</li>
<li><a class="reference external" href="#1.11.4.XDD|outline">XDD</a>
<strong>:</strong>
a tool for measuring and characterizing disk subsystem I/O</li>
</ul>
<p>The following utilities are specific to RAID controllers:</p>
<ul class="simple">
<li><a class="reference external" href="#1.11.5.tw_cli|outline">tw_cli</a>
<strong>:</strong>
used to monitor and maintain 3ware RAID controllers</li>
<li><a class="reference external" href="#1.11.6.MegaCli|outline">MegaCli</a>
<strong>:</strong>
used to configure and manage LSI MegaRAID SAS family of RAID controllers</li>
</ul>
<p>This section also describes the following utilities:</p>
<ul class="simple">
<li><a class="reference external" href="#1.11.8.freenas-debug|outline">freenas-debug</a>
<a href="#id401"><span class="problematic" id="id402">**</span></a>: **
the backend used to dump FreeNAS® debugging information
** **</li>
<li><a class="reference external" href="#1.11.9.tmux|outline">tmux</a>
<a href="#id404"><span class="problematic" id="id405">**</span></a>: **
a terminal multiplexer similar to GNU screen
** **</li>
<li><a class="reference external" href="#1.11.11.Dmidecode|outline">Dmidecode</a>
<a href="#id406"><span class="problematic" id="id407">**</span></a>: **
reports information about system hardware as described in the system&#8217;s BIOS</li>
</ul>
<div class="section" id="id408">
<h3>Iperf<a class="headerlink" href="#id408" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://en.wikipedia.org/wiki/Iperf">Iperf</a>
is a utility for measuring maximum TCP and UDP bandwidth performance. It can be used to chart
network throughput over time. For example, you can use it to test the speed of different types of shares to determine which type best performs on your network.</p>
<p>FreeNAS® includes the Iperf server. To perform network testing, you will need to install an Iperf client on a desktop system that has network access to the FreeNAS® system. This section will demonstrate how to use the
<a class="reference external" href="http://code.google.com/p/xjperf/downloads/detail?name=jperf-2.0.2.zip">xjperf GUI client</a>
as it works on Windows, Mac OS X, Linux, and BSD systems.</p>
<p>Since this client is java based, you will also need to install the appropriate
<a class="reference external" href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">JRE</a>
for the client operating
system.</p>
<p>Linux and BSD users will need to install the iperf package using their operating system&#8217;s package management system.</p>
<p>To start xjperf on Windows: unzip the downloaded file, start Command Prompt in Run as administrator mode,
<strong>cd</strong>
to the unzipped folder, and run
<strong>jperf.bat</strong>
.</p>
<p>To start xjperf on Mac OS X, Linux, or BSD, unzip the downloaded file,
<strong>cd</strong>
to the unzipped directory, type
<strong>chmod u+x jperf.sh</strong>
, and run
<strong>./jperf.sh</strong>
.</p>
<p>Once the client is ready, you need to start the Iperf server on FreeNAS®. To see the available server options, open
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
and type:</p>
<p><strong>iperf &#8211;help | more</strong></p>
<p>Usage: iperf [-s|-c host] [options]</p>
<p>iperf [-h|&#8211;help] [-v|&#8211;version]</p>
<p>Client/Server:</p>
<p>-f, &#8211;format
[kmKM]
format to report: Kbits, Mbits, KBytes, MBytes</p>
<p>-i, &#8211;interval
#
seconds between periodic bandwidth reports</p>
<p>-l, &#8211;len
#[KM]
length of buffer to read or write (default 8 KB)</p>
<p>-m, &#8211;print_mss
print TCP maximum segment size (MTU - TCP/IP header)</p>
<p>-o, &#8211;output
&lt;filename&gt; output the report or error message to this specified file</p>
<p>-p, &#8211;port
#
server port to listen on/connect to</p>
<p>-u, &#8211;udp
use UDP rather than TCP</p>
<p>-w, &#8211;window
#[KM]
TCP window size (socket buffer size)</p>
<p>-B, &#8211;bind
&lt;host&gt;
bind to &lt;host&gt;, an interface or multicast address</p>
<p>-C, &#8211;compatibility
for use with older versions does not sent extra msgs</p>
<p>-M, &#8211;mss
#
set TCP maximum segment size (MTU - 40 bytes)</p>
<p>-N, &#8211;nodelay
set TCP no delay, disabling Nagle&#8217;s Algorithm</p>
<p>-V, &#8211;IPv6Version
Set the domain to IPv6</p>
<p>Server specific:</p>
<p>-s, &#8211;server
run in server mode</p>
<p>-U, &#8211;single_udp
run in single threaded UDP mode</p>
<p>-D, &#8211;daemon
run the server as a daemon</p>
<p>Client specific:</p>
<p>-b, &#8211;bandwidth #[KM]
for UDP, bandwidth to send at in bits/sec</p>
<p>(default 1 Mbit/sec, implies -u)</p>
<p>-c, &#8211;client
&lt;host&gt;
run in client mode, connecting to &lt;host&gt;</p>
<p>-d, &#8211;dualtest
Do a bidirectional test simultaneously</p>
<p>-n, &#8211;num
#[KM]
number of bytes to transmit (instead of -t)</p>
<p>-r, &#8211;tradeoff
Do a bidirectional test individually</p>
<p>-t, &#8211;time
#
time in seconds to transmit for (default 10 secs)</p>
<p>-F, &#8211;fileinput &lt;name&gt;
input the data to be transmitted from a file</p>
<p>-I, &#8211;stdin
input the data to be transmitted from stdin</p>
<p>-L, &#8211;listenport #
port to receive bidirectional tests back on</p>
<p>-P, &#8211;parallel
#
number of parallel client threads to run</p>
<p>-T, &#8211;ttl
#
time-to-live, for multicast (default 1)</p>
<p>-Z, &#8211;linux-congestion &lt;algo&gt;
set TCP congestion control algorithm (Linux only)</p>
<p>Miscellaneous:</p>
<p>-x, &#8211;reportexclude [CDMSV]
exclude C(connection) D(data) M(multicast) S(settings) V(server)
reports</p>
<p>-y, &#8211;reportstyle C
report as a Comma-Separated Values</p>
<p>-h, &#8211;help
print this message and quit</p>
<p>-v, &#8211;version
print version information and quit</p>
<p>[KM] Indicates options that support a K or M suffix for kilo- or mega-</p>
<p>The TCP window size option can be set by the environment variable</p>
<p>TCP_WINDOW_SIZE. Most other options can be set by an environment variable</p>
<p>IPERF_&lt;long option name&gt;, such as IPERF_BANDWIDTH.</p>
<p>For example, to perform a TCP test and start the server in daemon mode (so that you get your prompt back), type:</p>
<p><strong>iperf -sD</strong></p>
<hr class="docutils" />
<p>Server listening on TCP port 5001</p>
<p>TCP window size: 64.0 KByte (default)</p>
<hr class="docutils" />
<p>Running Iperf Server as a daemon</p>
<p>The Iperf daemon process ID: 4842</p>
<p><strong>NOTE:</strong>
if you close Shell, the daemon process will stop. Have your environment setup (e.g. shares configured and started)
<strong>before</strong>
** **
starting the iperf process.</p>
<p>From your desktop, open the client. Input the IP of address of the FreeNAS® system, specify the running time for the test under Application layer options → Transmit (the default test time is 10 seconds), and click the Run Iperf! button. Figure 14.1a shown an example of the client running on a Windows system while an SFTP transfer is occurring on the network.</p>
<p><strong>Figure 14.1a: Viewing Bandwidth Statistics Using xjperf</strong></p>
<p><a class="reference internal" href="_images/10000000000003CA000002BC6A5C3D2E.png"><img alt="10000000000003CA000002BC6A5C3D2E_png" src="_images/10000000000003CA000002BC6A5C3D2E.png" style="width: 6.9252in; height: 4.9965in;" /></a></p>
<p>Depending upon the traffic being tested (e.g. the type of share running on your network), you may need to test UDP instead of TCP. To start the iperf server in UDP mode, use
<strong>iperf -sDu</strong>
as the
<strong>u</strong>
specifies UDP; the startup message should indicate that the server is listening for UDP datagrams. If you are not sure if the traffic that you wish to test is UDP or TCP, run this command to determine which services are running on the FreeNAS® system:</p>
<p><strong>sockstat -4 | more</strong></p>
<p>USER
COMMAND
PID
FD PROTO
LOCAL ADDRESS
FOREIGN ADDRESS</p>
<p>root
iperf
4870
6
udp4
<em>:5001
*:</em></p>
<p>root
iperf
4842
6
tcp4
<em>:5001
*:</em></p>
<p>www
nginx
4827
3
tcp4
127.0.0.1:15956
127.0.0.1:9042</p>
<p>www
nginx
4827
5
tcp4
192.168.2.11:80
192.168.2.26:56964</p>
<p>www
nginx
4827
7
tcp4
<em>:80
*:</em></p>
<p>root
sshd
3852
5
tcp4
<em>:22
*:</em></p>
<p>root
python
2503
5
udp4
<em>:</em>
<em>:</em></p>
<p>root
mountd
2363
7
udp4
<em>:812
*:</em></p>
<p>root
mountd
2363
8
tcp4
<em>:812
*:</em></p>
<p>root
rpcbind
2359
9
udp4
<em>:111
*:</em></p>
<p>root
rpcbind
2359
10 udp4
<em>:886
*:</em></p>
<p>root
rpcbind
2359
11 tcp4
<em>:111
*:</em></p>
<p>root
nginx
2044
7
tcp4
<em>:80
*:</em></p>
<p>root
python
2029
3
udp4
<em>:</em>
<em>:</em></p>
<p>root
python
2029
4
tcp4
127.0.0.1:9042
<em>:</em></p>
<p>root
python
2029
7
tcp4
127.0.0.1:9042
127.0.0.1:15956</p>
<p>root
ntpd
1548
20 udp4
<em>:123
*:</em></p>
<p>root
ntpd
1548
22 udp4
192.168.2.11:123
<em>:</em></p>
<p>root
ntpd
1548
25 udp4
127.0.0.1:123
<em>:</em></p>
<p>root
syslogd
1089
6
udp4
127.0.0.1:514
<em>:</em></p>
<p>When you are finished testing, either type
<strong>killall iperf</strong>
or close Shell to terminate the iperf server process.</p>
</div>
<div class="section" id="id411">
<h3>Netperf<a class="headerlink" href="#id411" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.netperf.org/netperf/">Netperf</a>
is a benchmarking utility that can be used to measure the performance of unidirectional throughput and end-to-end latency.</p>
<p>Before you can use the
<strong>netperf</strong>
command, you must start its server process using this command:</p>
<p><strong>netserver</strong></p>
<p>Starting netserver with host &#8216;IN(6)ADDR_ANY&#8217; port &#8216;12865&#8217; and family AF_UNSPEC</p>
<p>The following command will display the available options for performing tests with the
<strong>netperf</strong>
command. The
<a class="reference external" href="http://www.netperf.org/svn/netperf2/tags/netperf-2.6.0/doc/netperf.html">Netperf Manual</a>
describes each option in more detail and explains how to perform many types of tests. It is the best reference for understanding how each test works and how to interpret your results. When you are finished with your tests, type
<strong>killall netserver</strong>
to stop the server process.</p>
<p><strong>netperf -h |more</strong></p>
<p>Usage: netperf [global options] &#8211; [test options]</p>
<p>Global options:</p>
<p>-a send,recv
Set the local send,recv buffer alignment</p>
<p>-A send,recv
Set the remote send,recv buffer alignment</p>
<p>-B brandstr
Specify a string to be emitted with brief output</p>
<p>-c [cpu_rate]
Report local CPU usage</p>
<p>-C [cpu_rate]
Report remote CPU usage</p>
<p>-d
Increase debugging output</p>
<p>-D [secs,units] * Display interim results at least every secs seconds</p>
<p>using units as the initial guess for units per second</p>
<p>-f G|M|K|g|m|k
Set the output units</p>
<p>-F fill_file
Pre-fill buffers with data from fill_file</p>
<p>-h
Display this text</p>
<p>-H name|ip,fam *
Specify the target machine and/or local ip and family</p>
<p>-i max,min
Specify the max and min number of iterations (15,1)</p>
<p>-I lvl[,intvl]
Specify confidence level (95 or 99) (99)</p>
<p>and confidence interval in percentage (10)</p>
<p>-j
Keep additional timing statistics</p>
<p>-l testlen
Specify test duration (&gt;0 secs) (&lt;0 bytes|trans)</p>
<p>-L name|ip,fam *
Specify the local ip|name and address family</p>
<p>-o send,recv
Set the local send,recv buffer offsets</p>
<p>-O send,recv
Set the remote send,recv buffer offset</p>
<p>-n numcpu
Set the number of processors for CPU util</p>
<p>-N
Establish no control connection, do &#8216;send&#8217; side only</p>
<p>-p port,lport*
Specify netserver port number and/or local port</p>
<p>-P 0|1
Don&#8217;t/Do display test headers</p>
<p>-r
Allow confidence to be hit on result only</p>
<p>-s seconds
Wait seconds between test setup and test start</p>
<p>-S
Set SO_KEEPALIVE on the data connection</p>
<p>-t testname
Specify test to perform</p>
<p>-T lcpu,rcpu
Request netperf/netserver be bound to local/remote cpu</p>
<p>-v verbosity
Specify the verbosity level</p>
<p>-W send,recv
Set the number of send,recv buffers</p>
<p>-v level
Set the verbosity level (default 1, min 0)</p>
<p>-V
Display the netperf version and exit</p>
<p>For those options taking two parms, at least one must be specified; specifying one value without a comma will set both parms to that value, specifying a value with a leading comma will set just the second parm, a value with a trailing comma will set just the first. To set each parm to unique values, specify both and separate them with a comma.</p>
<ul class="simple">
<li>For these options taking two parms, specifying one value with no comma will only set the first parms and will leave the second at the default value. To set the second value it must be preceded with a comma or be a comma-separated pair. This is to retain previous netperf behaviour.</li>
</ul>
</div>
<div class="section" id="id413">
<h3>IOzone<a class="headerlink" href="#id413" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.iozone.org/">IOzone</a>
is a disk and filesystem benchmarking tool. It can be used to test file I/O performance for the following operations: read, write, re-read, re-write, read backwards, read strided, fread, fwrite, random read, pread, mmap, aio_read, and aio_write.</p>
<p>FreeNAS® ships with IOzone, meaning that it can be run from
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
. When using IOzone on FreeNAS®,
<strong>cd</strong>
to a directory in a volume that you have permission to write to, otherwise you will get an error about being unable to write the temporary file.</p>
<p>Before using IOzone, read through the
<a class="reference external" href="http://www.iozone.org/docs/IOzone_msword_98.pdf">IOzone documentation PDF</a>
as it describes the tests, the many command line switches, and how to interpret your results.</p>
<p>If you have never used this tool before, these resources provide good starting points on which tests to run, when to run them, and how to interpret the results:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.cyberciti.biz/tips/linux-filesystem-benchmarking-with-iozone.html">How To Measure Linux Filesystem I/O Performance With iozone</a></li>
<li><a class="reference external" href="http://www.iozone.org/docs/NFSClientPerf_revised.pdf">Analyzing NFS Client Performance with IOzone</a></li>
<li><a class="reference external" href="http://www.thegeekstuff.com/2011/05/iozone-examples/">10 iozone Examples for Disk I/O Performance Measurement on Linux</a></li>
</ul>
<p>You can receive a summary of the available switches by typing the following command.
As you can
see from the number of options, IOzone is comprehensive and it may take some time to learn how to use the tests effectively.</p>
<p>Recent versions of FreeNAS® enable compression by default on newly created ZFS volumes. To properly test performance, use data that is not compressible by including following additional parameters:
<em>-+w 0 -+y 0 -+C 0</em>
.</p>
<p><strong>NOTE:</strong>
if you prefer to visualize the collected data, scripts are available to render IOzone&#8217;s output in
<a class="reference external" href="http://www.gnuplot.info/">Gnuplot</a>
.</p>
<p><strong>iozone -h | more</strong></p>
<p>iozone: help mode</p>
<p>Usage: iozone[-s filesize_Kb] [-r record_size_Kb] [-f [path]filename] [-h]</p>
<p>[-i test] [-E] [-p] [-a] [-A] [-z] [-Z] [-m] [-M] [-t children]</p>
<p>[-l min_number_procs] [-u max_number_procs] [-v] [-R] [-x] [-o]</p>
<p>[-d microseconds] [-F path1 path2...] [-V pattern] [-j stride]</p>
<p>[-T] [-C] [-B] [-D] [-G] [-I] [-H depth] [-k depth] [-U mount_point]</p>
<p>[-S cache_size] [-O] [-L cacheline_size] [-K] [-g maxfilesize_Kb]</p>
<p>[-n minfilesize_Kb] [-N] [-Q] [-P start_cpu] [-e] [-c] [-b Excel.xls]</p>
<p>[-J milliseconds] [-X write_telemetry_filename] [-w] [-W]</p>
<p>[-Y read_telemetry_filename] [-y minrecsize_Kb] [-q
maxrecsize_Kb]</p>
<p>[-+u] [-+m cluster_filename] [-+d] [-+x multiplier] [-+p # ]</p>
<p>[-+r] [-+t] [-+X] [-+Z] [-+w percent dedupable] [-+y percent_interior_dedup]</p>
<p>[-+C percent_dedup_within]</p>
<p>-a
Auto mode</p>
<p>-A
Auto2 mode</p>
<p>-b Filename
Create Excel worksheet file</p>
<p>-B
Use mmap() files</p>
<p>-c
Include close in the timing calculations</p>
<p>-C
Show bytes transferred by each child in throughput testing</p>
<p>-d #
Microsecond delay out of barrier</p>
<p>-D
Use msync(MS_ASYNC) on mmap files</p>
<p>-e
Include flush (fsync,fflush) in the timing calculations</p>
<p>-E
Run extension tests</p>
<p>-f filename
to use</p>
<p>-F filenames
for each process/thread in throughput test</p>
<p>-g #
Set maximum file size (in Kbytes) for auto mode (or #m or #g)</p>
<p>-G
Use msync(MS_SYNC) on mmap files</p>
<p>-h
help</p>
<p>-H #
Use POSIX async I/O with # async operations</p>
<p>-i #
Test to run (0=write/rewrite, 1=read/re-read, 2=random-read/write</p>
<p>3=Read-backwards, 4=Re-write-record, 5=stride-read, 6=fwrite/re-fwrite</p>
<p>7=fread/Re-fread, 8=random_mix, 9=pwrite/Re-pwrite, 10=pread/Re-pread</p>
<p>11=pwritev/Re-pwritev, 12=preadv/Re-preadv)</p>
<p>-I
Use VxFS VX_DIRECT, O_DIRECT,or O_DIRECTIO for all file operations</p>
<p>-j #
Set stride of file accesses to (# * record size)</p>
<p>-J #
milliseconds of compute cycle before each I/O operation</p>
<p>-k #
Use POSIX async I/O (no bcopy) with # async operations</p>
<p>-K
Create jitter in the access pattern for readers</p>
<p>-l #
Lower limit on number of processes to run</p>
<p>-L #
Set processor cache line size to value (in bytes)</p>
<p>-m
Use multiple buffers</p>
<p>-M
Report uname -a output</p>
<p>-n #
Set minimum file size (in Kbytes) for auto mode (or #m or #g)</p>
<p>-N
Report results in microseconds per operation</p>
<p>-o
Writes are synch (O_SYNC)</p>
<p>-O
Give results in ops/sec.</p>
<p>-p
Purge on</p>
<p>-P #
Bind processes/threads to processors, starting with this cpu</p>
<p>-q #
Set maximum record size (in Kbytes) for auto mode (or #m or #g)</p>
<p>-Q
Create offset/latency files</p>
<p>-r #
record size in Kb</p>
<p>or -r #k .. size in Kb</p>
<p>or -r #m .. size in Mb</p>
<p>or -r #g .. size in Gb</p>
<p>-R
Generate Excel report</p>
<p>-s #
file size in Kb</p>
<p>or -s #k .. size in Kb</p>
<p>or -s #m .. size in Mb</p>
<p>or -s #g .. size in Gb</p>
<p>-S #
Set processor cache size to value (in Kbytes)</p>
<p>-t #
Number of threads or processes to use in throughput test</p>
<p>-T
Use POSIX pthreads for throughput tests</p>
<p>-u #
Upper limit on number of processes to run</p>
<p>-U
Mount point to remount between tests</p>
<p>-v
version information</p>
<p>-V #
Verify data pattern write/read</p>
<p>-w
Do not unlink temporary file</p>
<p>-W
Lock file when reading or writing</p>
<p>-x
Turn off stone-walling</p>
<p>-X filename
Write telemetry file. Contains lines with (offset reclen compute_time) in ascii</p>
<p>-y #
Set minimum record size (in Kbytes) for auto mode (or #m or #g)</p>
<p>-Y filename
Read
telemetry file. Contains lines with (offset reclen compute_time) in ascii</p>
<p>-z
Used in conjunction with -a to test all possible record sizes</p>
<p>-Z
Enable mixing of mmap I/O and file I/O</p>
<p>-+E Use existing non-Iozone file for read-only testing</p>
<p>-+K Sony special. Manual control of test 8.</p>
<p>-+m
Cluster_filename
Enable Cluster testing</p>
<p>-+d
File I/O diagnostic mode. (To troubleshoot a broken file I/O subsystem)</p>
<p>-+u
Enable CPU utilization output (Experimental)</p>
<p>-+x # Multiplier to use for incrementing file and record sizes</p>
<p>-+p # Percentage of mix to be reads</p>
<p>-+r Enable O_RSYNC|O_SYNC for all testing.</p>
<p>-+t Enable network performance test. Requires -+m</p>
<p>-+n No retests selected.</p>
<p>-+k Use constant aggregate data set size.</p>
<p>-+q Delay in seconds between tests.</p>
<p>-+l Enable record locking mode.</p>
<p>-+L Enable record locking mode, with shared file.</p>
<p>-+B Sequential mixed workload.</p>
<p>-+A #
Enable madvise. 0 = normal, 1=random, 2=sequential</p>
<p>3=dontneed, 4=willneed</p>
<p>-+N Do not truncate existing files on sequential writes.</p>
<p>-+S # Dedup-able data is limited to sharing within each numerically</p>
<p>identified file set</p>
<p>-+V Enable shared file. No locking.</p>
<p>-+X Enable short circuit mode for filesystem testing ONLY</p>
<p>ALL Results are NOT valid in this mode.</p>
<p>-+Z Enable old data set compatibility mode. WARNING.. Published</p>
<p>hacks may invalidate these results and generate bogus, high</p>
<p>values for results.</p>
<p>-+w ## Percent of dedup-able data in buffers.</p>
<p>-+y ## Percent of dedup-able within &amp; across files in buffers.</p>
<p>-+C ## Percent of dedup-able within &amp; not across files in buffers.</p>
<p>-+H Hostname
Hostname of the PIT server.</p>
<p>-+P Service
Service
of the PIT server.</p>
<p>-+z Enable latency histogram logging.</p>
</div>
<div class="section" id="id416">
<h3>arcstat<a class="headerlink" href="#id416" title="Permalink to this headline">¶</a></h3>
<p>Arcstat is a script that prints out ZFS
<a class="reference external" href="http://en.wikipedia.org/wiki/Adaptive_replacement_cache">ARC</a>
statistics. Originally it was a perl script created by Sun. That perl script was ported to FreeBSD and was then ported as a Python script for use on FreeNAS®.</p>
<p>Watching ARC hits/misses and percentages will provide an indication of how well your ZFS pool is fetching from the ARC rather than using disk I/O. Ideally, you want as many things fetching from
cache as possible. Keep your load in mind as you review the stats. For random reads, expect a miss and</p>
<p>having to go to disk to fetch the data. For cached reads, expect it to pull out of the cache and have a hit.</p>
<p>Like all cache systems, the ARC takes time to fill with data. This means that it will have a lot of misses until the pool has been in use for a while. If there continues to be lots of misses and high disk I/O on cached reads, there is cause to investigate further and tune the system.</p>
<p>The
<a class="reference external" href="http://wiki.freebsd.org/ZFSTuningGuide">FreeBSD ZFS Tuning Guide</a>
provides some suggestions for commonly tuned
<strong>sysctl</strong>
values. It should be noted that performance tuning is more of an art than a science and that any changes you make will probably require several iterations of tune and test. Be aware that what needs to be tuned will</p>
<p>vary depending upon the type of workload and that what works for one person&#8217;s network may not benefit yours.</p>
<p>In particular, the value of pre-fetching depends upon the amount of memory and the type of workload, as seen in these two examples:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.cuddletech.com/blog/pivot/entry.php?id=1040">Understanding ZFS: Prefetch</a></li>
<li><a class="reference external" href="http://southbrain.com/south/2008/04/the-nightmare-comes-slowly-zfs.html">ZFS prefetch algorithm can cause performance drawbacks</a></li>
</ul>
<div class="section" id="using-the-scripts">
<h4>Using the Scripts<a class="headerlink" href="#using-the-scripts" title="Permalink to this headline">¶</a></h4>
<p>FreeNAS® provides two command line scripts which an be manually run from
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
:</p>
<ul>
<li><p class="first"><strong>arc_summary.py:</strong>
provides a summary of the statistics</p>
</li>
<li><p class="first"><strong>arcstat.py:</strong></p>
<p>used to watch
the statistics
in real time</p>
</li>
</ul>
<p>The advantage of these scripts is that they can be used to provide real time (right now) information, whereas the current GUI reporting mechanism is designed to only provide graphs charted over time.</p>
<p>This
<a class="reference external" href="http://forums.freenas.org/threads/benchmarking-zfs.7928/">forum post</a>
demonstrates some examples of using these scripts with hints on how to interpret the results.</p>
<p>To view the help for arcstat.py:
** **</p>
<p><strong>arcstat.py -h</strong></p>
<p>Usage: arcstat [-hvx] [-f fields] [-o file] [-s string] [interval [count]]</p>
<p>-h: Print this help message</p>
<p>-v: List all possible field headers and definitions</p>
<p>-x: Print extended stats</p>
<p>-f: Specify specific fields to print (see -v)</p>
<p>-o: Redirect output to the specified file</p>
<p>-s: Override default field separator with custom character or string</p>
<p>Examples:</p>
<p>arcstat -o /tmp/a.log 2 10</p>
<p>arcstat -s &#8221;,&#8221; -o /tmp/a.log 2 10</p>
<p>arcstat -v</p>
<p>arcstat -f time,hit%,dh%,ph%,mh% 1</p>
<p>To view ARC statistics in real time, specify an interval and a count. This command will display every 1 second for a count of five.</p>
<p><strong>arcstat.py 1 5</strong></p>
<p>time
read
miss
miss%
dmis
dm%
pmis
pm%
mmis
mm%
arcsz
c</p>
<p>06:19:03
0
0
0
0
0
0
0
0
0
425K
6.6G</p>
<p>06:19:04
0
0
0
0
0
0
0
0
0
425K
6.6G</p>
<p>06:19:05
0
0
0
0
0
0
0
0
0
425K
6.6G</p>
<p>06:19:06
0
0
0
0
0
0
0
0
0
425K
6.6G</p>
<p>06:19:07
0
0
0
0
0
0
0
0
0
425K
6.6G</p>
<p>This command provides a brief description of the fields in the output:</p>
<p><strong>arcstat.py -v</strong></p>
<p>System Memory:</p>
<p>2.00%
156.36
MiB Active,
1.49%
116.70
MiB Inact</p>
<p>39.49%
3.02
GiB Wired,
0.03%
2.53
MiB Cache</p>
<p>56.97%
4.35
GiB Free,
0.02%
1.23
MiB Gap</p>
<p>Real Installed:
8.00
GiB</p>
<p>Real Available:
98.65%
7.89
GiB</p>
<p>Real Managed:
96.83%
7.64
GiB</p>
<p>Logical Total:</p>
<p>8.00
GiB</p>
<p>Logical Used:
44.12%
3.53
GiB</p>
<p>Logical Free:
55.88%
4.47
GiB</p>
<p>Kernel Memory:</p>
<p>226.69
MiB</p>
<p>Data:</p>
<p>90.16%
204.39
MiB</p>
<p>Text:</p>
<p>9.84%
22.31
MiB</p>
<p>Kernel Memory Map:</p>
<p>7.64
GiB</p>
<p>Size:</p>
<p>22.56%
1.72
GiB</p>
<p>Free:</p>
<p>77.44%
5.92
GiB</p>
<p>ARC Summary: (HEALTHY)</p>
<p>Storage pool Version:
5000</p>
<p>Filesystem Version:
5</p>
<p>Memory Throttle Count:
0</p>
<p>ARC Misc:</p>
<p>Deleted:</p>
<p>0</p>
<p>Recycle Misses:
0</p>
<p>Mutex Misses:
0</p>
<p>Evict Skips:
0</p>
<p>ARC Size:</p>
<p>28.39%
1.89
GiB</p>
<p>Target Size: (Adaptive)
100.00%
6.64
GiB</p>
<p>Min Size (Hard Limit):
12.50%
850.23MiB</p>
<p>Max Size (High Water):
8:1</p>
<p>6.64
GiB</p>
<p>ARC Size Breakdown:</p>
<p>Recently Used Cache Size:
50.30%
3.34
GiB</p>
<p>Frequently Used Cache Size:
49.70%
3.30GiB</p>
<p>ARC Hash Breakdown:</p>
<p>Elements Max:</p>
<p>258.19k</p>
<p>Elements Current:</p>
<p>100.00%
258.19k</p>
<p>Collisions:</p>
<p>157.63k</p>
<p>Chain Max:</p>
<p>8</p>
<p>Chains:</p>
<p>79.46k</p>
<p>ARC Total accesses:</p>
<p>2.25m</p>
<p>Cache Hit Ratio:</p>
<p>99.94%</p>
<p>2.25m</p>
<p>Cache Miss Ratio:</p>
<p>0.06%</p>
<p>1.38k</p>
<p>Actual Hit Ratio:</p>
<p>99.86%</p>
<p>2.25m</p>
<p>Data Demand Efficiency:
100.00%</p>
<p>1.99m</p>
<p>Data Prefetch Efficiency:
100.00%</p>
<p>6.11k</p>
<p>CACHE HITS BY CACHE LIST:</p>
<p>Anonymously Used:</p>
<p>0.02%</p>
<p>353</p>
<p>Most Recently Used:</p>
<p>2.70%
60.83k</p>
<p>Most Frequently Used:
97.22%</p>
<p>2.19m</p>
<p>Most Recently Used Ghost:</p>
<p>0.06%</p>
<p>1.34k</p>
<p>Most Frequently Used Ghost:</p>
<p>0.00%</p>
<p>13</p>
<p>CACHE HITS BY DATA TYPE:</p>
<p>Demand Data:
88.26%</p>
<p>1.99m</p>
<p>Prefetch Data:</p>
<p>0.27%</p>
<p>6.11k</p>
<p>Demand Metadata:
11.47%
258.29k</p>
<p>Prefetch Metadata:</p>
<p>0.00%</p>
<p>0</p>
<p>CACHE MISSES BY DATA TYPE:</p>
<p>Demand Data:</p>
<p>0.00%</p>
<p>0</p>
<p>Prefetch Data:</p>
<p>0.00%</p>
<p>0</p>
<p>Demand Metadata:</p>
<p>9.76%</p>
<p>135</p>
<p>Prefetch Metadata:
90.24%</p>
<p>1.25k</p>
<p>File-Level Prefetch: (HEALTHY)DMU Efficiency:
10.16m</p>
<p>Hit Ratio:</p>
<p>80.03%</p>
<p>8.13m</p>
<p>Miss Ratio:</p>
<p>19.97%</p>
<p>2.03m</p>
<p>Colinear:</p>
<p>2.03m</p>
<p>Hit Ratio:</p>
<p>0.00%</p>
<p>91</p>
<p>Miss Ratio:
100.00%</p>
<p>2.03m</p>
<p>Stride:</p>
<p>8.06m</p>
<p>Hit Ratio:
100.00%</p>
<p>8.06m</p>
<p>Miss Ratio:</p>
<p>0.00%</p>
<p>0</p>
<p>DMU Misc:</p>
<p>Reclaim:</p>
<p>2.03m</p>
<p>Successes:</p>
<p>0.08%</p>
<p>1.65k</p>
<p>Failures:</p>
<p>99.92%</p>
<p>2.03m</p>
<p>Streams:</p>
<p>72.11k</p>
<p>+Resets:</p>
<p>0.00%</p>
<p>0</p>
<p>-Resets:</p>
<p>100.00%
72.11k</p>
<p>Bogus:</p>
<p>0</p>
<p>ZFS Tunable (sysctl):</p>
<p>kern.maxusers
384</p>
<p>vm.kmem_size
8205963264</p>
<p>vm.kmem_size_scale
1</p>
<p>vm.kmem_size_min
0</p>
<p>vm.kmem_size_max
329853485875</p>
<p>vfs.zfs.l2c_only_size
0</p>
<p>vfs.zfs.mfu_ghost_data_lsize
623119872</p>
<p>vfs.zfs.mfu_ghost_metadata_lsize
348672</p>
<p>vfs.zfs.mfu_ghost_size
623468544</p>
<p>vfs.zfs.mfu_data_lsize
302145536</p>
<p>vfs.zfs.mfu_metadata_lsize
8972288</p>
<p>vfs.zfs.mfu_size
326883328</p>
<p>vfs.zfs.mru_ghost_data_lsize
769186304</p>
<p>vfs.zfs.mru_ghost_metadata_lsize
8935424</p>
<p>vfs.zfs.mru_ghost_size
778121728</p>
<p>vfs.zfs.mru_data_lsize
1127638016</p>
<p>vfs.zfs.mru_metadata_lsize
30442496</p>
<p>vfs.zfs.mru_size
1274765312</p>
<p>vfs.zfs.anon_data_lsize
0</p>
<p>vfs.zfs.anon_metadata_lsize
0</p>
<p>vfs.zfs.anon_size
279040</p>
<p>vfs.zfs.l2arc_norw
1</p>
<p>vfs.zfs.l2arc_feed_again
1</p>
<p>vfs.zfs.l2arc_noprefetch
1</p>
<p>vfs.zfs.l2arc_feed_min_ms
200</p>
<p>vfs.zfs.l2arc_feed_secs
1</p>
<p>vfs.zfs.l2arc_headroom
2</p>
<p>vfs.zfs.l2arc_write_boost
8388608</p>
<p>vfs.zfs.l2arc_write_max
8388608</p>
<p>vfs.zfs.arc_meta_limit
1783055360</p>
<p>vfs.zfs.arc_meta_used
594834472</p>
<p>vfs.zfs.arc_min
891527680</p>
<p>vfs.zfs.arc_max
7132221440</p>
<p>vfs.zfs.dedup.prefetch
1</p>
<p>vfs.zfs.mdcomp_disable
0</p>
<p>vfs.zfs.nopwrite_enabled
1</p>
<p>vfs.zfs.zfetch.array_rd_sz
1048576</p>
<p>vfs.zfs.zfetch.block_cap
256</p>
<p>vfs.zfs.zfetch.min_sec_reap
2</p>
<p>vfs.zfs.zfetch.max_streams
8</p>
<p>vfs.zfs.prefetch_disable
0</p>
<p>vfs.zfs.no_scrub_prefetch
0</p>
<p>vfs.zfs.no_scrub_io
0</p>
<p>vfs.zfs.resilver_min_time_ms
3000</p>
<p>vfs.zfs.free_min_time_ms
1000</p>
<p>vfs.zfs.scan_min_time_ms
1000</p>
<p>vfs.zfs.scan_idle
50</p>
<p>vfs.zfs.scrub_delay
4</p>
<p>vfs.zfs.resilver_delay
2</p>
<p>vfs.zfs.top_maxinflight
32</p>
<p>vfs.zfs.write_to_degraded
0</p>
<p>vfs.zfs.mg_noalloc_threshold
0</p>
<p>vfs.zfs.mg_alloc_failures
8</p>
<p>vfs.zfs.condense_pct
200</p>
<p>vfs.zfs.metaslab.weight_factor_enable
0</p>
<p>vfs.zfs.metaslab.preload_enabled
1</p>
<p>vfs.zfs.metaslab.preload_limit
3</p>
<p>vfs.zfs.metaslab.unload_delay
8</p>
<p>vfs.zfs.metaslab.load_pct
50</p>
<p>vfs.zfs.metaslab.min_alloc_size
10485760</p>
<p>vfs.zfs.metaslab.df_free_pct
4</p>
<p>vfs.zfs.metaslab.df_alloc_threshold
131072</p>
<p>vfs.zfs.metaslab.debug_unload
0</p>
<p>vfs.zfs.metaslab.debug_load
0</p>
<p>vfs.zfs.metaslab.gang_bang
131073</p>
<p>vfs.zfs.ccw_retry_interval
300</p>
<p>vfs.zfs.check_hostid
1</p>
<p>vfs.zfs.deadman_enabled
1</p>
<p>vfs.zfs.deadman_checktime_ms
5000</p>
<p>vfs.zfs.deadman_synctime_ms
1000000</p>
<p>vfs.zfs.recover
0</p>
<p>vfs.zfs.txg.timeout
5</p>
<p>vfs.zfs.max_auto_ashift
13</p>
<p>vfs.zfs.vdev.cache.bshift
16</p>
<p>vfs.zfs.vdev.cache.size
0</p>
<p>vfs.zfs.vdev.cache.max
16384</p>
<p>vfs.zfs.vdev.trim_on_init
1</p>
<p>vfs.zfs.vdev.write_gap_limit
4096</p>
<p>vfs.zfs.vdev.read_gap_limit
32768</p>
<p>vfs.zfs.vdev.aggregation_limit
131072</p>
<p>vfs.zfs.vdev.scrub_max_active
2</p>
<p>vfs.zfs.vdev.scrub_min_active
1</p>
<p>vfs.zfs.vdev.async_write_max_active
10</p>
<p>vfs.zfs.vdev.async_write_min_active
1</p>
<p>vfs.zfs.vdev.async_read_max_active
3</p>
<p>vfs.zfs.vdev.async_read_min_active
1</p>
<p>vfs.zfs.vdev.sync_write_max_active
10</p>
<p>vfs.zfs.vdev.sync_write_min_active
10</p>
<p>vfs.zfs.vdev.sync_read_max_active
10</p>
<p>vfs.zfs.vdev.sync_read_min_active
10</p>
<p>vfs.zfs.vdev.max_active
1000</p>
<p>vfs.zfs.vdev.larger_ashift_minimal
1</p>
<p>vfs.zfs.vdev.bio_delete_disable
0</p>
<p>vfs.zfs.vdev.bio_flush_disable
0</p>
<p>vfs.zfs.vdev.trim_max_pending
64</p>
<p>vfs.zfs.vdev.trim_max_bytes
2147483648</p>
<p>vfs.zfs.cache_flush_disable
0</p>
<p>vfs.zfs.zil_replay_disable
0</p>
<p>vfs.zfs.sync_pass_rewrite
2</p>
<p>vfs.zfs.sync_pass_dont_compress
5</p>
<p>vfs.zfs.sync_pass_deferred_free
2</p>
<p>vfs.zfs.zio.use_uma
1</p>
<p>vfs.zfs.snapshot_list_prefetch
0</p>
<p>vfs.zfs.version.ioctl
3</p>
<p>vfs.zfs.version.zpl
5</p>
<p>vfs.zfs.version.spa
5000</p>
<p>vfs.zfs.version.acl
1</p>
<p>vfs.zfs.debug
0</p>
<p>vfs.zfs.super_owner
0</p>
<p>vfs.zfs.trim.enabled
1</p>
<p>vfs.zfs.trim.max_interval
1</p>
<p>vfs.zfs.trim.timeout
30</p>
<p>vfs.zfs.trim.txg_delay
32</p>
<p>When reading the tunable values, 0 means no, 1 typically means yes, and any other number represents a value. To receive a brief description of a
<strong>sysctl</strong>
value, use
<strong>sysctl -d</strong>
. For example:</p>
<p><strong>sysctl -d vfs.zfs.zio.use_uma</strong></p>
<p>vfs.zfs.zio.use_uma: Use
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=uma">uma(9)</a>
for ZIO allocations</p>
<p>The ZFS tunables require a fair understanding of how ZFS works, meaning that you will be reading man pages and searching for the meaning of acronyms you are unfamiliar with.
<strong>Do not change a tunable&#8217;s value without researching it first.</strong>
** **
If the tunable takes a numeric value (rather than 0 for no or 1 for yes), do not make one up. Instead, research examples of beneficial values that match your workload.</p>
<p>If you decide to change any of the ZFS tunables, continue to monitor the system to determine the effect of the change. It is recommended that you test your changes first at the command line using
<strong>sysctl</strong>
. For example, to disable pre-fetch (i.e. change disable to 1 or yes):</p>
<p><strong>sysctl vfs.zfs.prefetch_disable=1</strong></p>
<p>vfs.zfs.prefetch_disable: 0 -&gt; 1</p>
<p>The output will indicate the old value followed by the new value. If the change is not beneficial, change
it back to the original value. If the change turns out to be beneficial, you can make it permanent by
creating a
<a class="reference external" href="#1.4.9.Tunables|outline">tunable</a>
.</p>
</div>
</div>
<div class="section" id="id421">
<h3>XDD<a class="headerlink" href="#id421" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.ioperformance.com/">XDD</a>
is a utility which provides accurate and detailed measurements of disk I/O performance. This section provides some usage examples.</p>
<p>Type the name of the command without any options to see its usage:</p>
<p><strong>xdd</strong></p>
<p>Usage: xdd command-line-options</p>
<p>-align [target &lt;target#&gt;] &lt;#bytes&gt;</p>
<p>-blocksize [target &lt;target#&gt;] &lt;#bytes/block&gt;</p>
<p>-combinedout &lt;filename&gt;</p>
<p>-createnewfiles [target &lt;target#&gt;]</p>
<p>-csvout &lt;filename&gt;</p>
<p>-datapattern [target &lt;target#&gt;] &lt;c&gt; <a href="#id423"><span class="problematic" id="id424">|</span></a>random|sequenced|ascii &lt;asciistring&gt;|hex &lt;hexdigits&gt;|replicate</p>
<p>-delay #seconds</p>
<p>-deletefile [target &lt;target#&gt;]</p>
<p>-deskew</p>
<p>-devicefile</p>
<p>-dio [target &lt;target#&gt;]</p>
<p>-errout &lt;filename&gt;</p>
<p>-fullhelp</p>
<p>-heartbeat #</p>
<p>-id &#8220;string&#8221; | commandline</p>
<p>-kbytes [target &lt;target#&gt;] &lt;#&gt;</p>
<p>-lockstep &lt;mastertarget#&gt; &lt;slavetarget#&gt; &lt;time|op|percent|mbytes|kbytes&gt; # &lt;time|op|percent|mbytes|kbytes&gt;# &lt;wait|run&gt; &lt;complete|stop&gt;</p>
<p>-lockstepoverlapped</p>
<p>-maxall</p>
<p>-maxerrors #</p>
<p>-maxpri</p>
<p>-mbytes [target &lt;target#&gt;] &lt;#&gt;</p>
<p>-minall</p>
<p>-nobarrier</p>
<p>-nomemlock</p>
<p>-noproclock</p>
<p>-numreqs [target &lt;target#&gt;] &lt;#&gt;</p>
<p>-operation [target &lt;target#&gt;] read|write</p>
<p>-output &lt;filename&gt;</p>
<p>-passes #</p>
<p>-passoffset [target &lt;target#&gt;] &lt;#blocks&gt;</p>
<p>-preallocate [target &lt;target#&gt;] &lt;#blocks&gt;</p>
<p>-processlock</p>
<p>-processor target# processor#</p>
<p>-queuedepth #cmds</p>
<p>-qthreadinfo</p>
<p>-randomize [target &lt;target#&gt;]</p>
<p>-readafterwrite [target #] trigger &lt;stat|mp&gt; <a href="#id425"><span class="problematic" id="id426">|</span></a>lag &lt;#&gt; | reader &lt;hostname&gt;|port &lt;#&gt;</p>
<p>-reallyverbose</p>
<p>-recreatefiles [target &lt;target#&gt;]</p>
<p>-reopen [target &lt;target#&gt;]</p>
<p>-reportthreshold [target #] &lt;#.#&gt;</p>
<p>-reqsize [target &lt;target#&gt;] &lt;#blocks&gt;</p>
<p>-roundrobin # or &#8216;all&#8217;</p>
<p>-runtime #seconds</p>
<p>-rwratio [target &lt;target#&gt;] &lt;ratio&gt;</p>
<p>-seek [target &lt;target#&gt;] save &lt;filename&gt; <a href="#id427"><span class="problematic" id="id428">|</span></a>load &lt;filename&gt; <a href="#id429"><span class="problematic" id="id430">|</span></a>disthist #buckets | seekhist #buckets|sequential|random|range #blocks|stagger|interleave #blocks|seed # | none</p>
<p>-setup filename</p>
<p>-sgio</p>
<p>-sharedmemory [target &lt;target#&gt;]</p>
<p>-singleproc #</p>
<p>-startdelay [target &lt;target#&gt;]#.#seconds</p>
<p>-startoffset [target &lt;target#&gt;] #</p>
<p>-starttime #seconds</p>
<p>-starttrigger &lt;target#&gt; &lt;target#&gt; &lt;&lt;time|op|percent|mbytes|kbytes&gt; #&gt;</p>
<p>-stoptrigger &lt;target#&gt; &lt;target#&gt; &lt;&lt;time|op|percent|mbytes|kbytes&gt; #&gt;</p>
<p>-syncio #</p>
<p>-syncwrite [target &lt;target#&gt;]</p>
<p>-target filename</p>
<p>-targetdir [target &lt;target#&gt;] &lt;directory_name&gt;</p>
<p>-targetoffset # -targets # filename filename filename... -or- -targets -# filename</p>
<p>-targetstartdelay #.#seconds</p>
<p>-throttle [target &lt;target#&gt;] &lt;ops|bw|var&gt; &lt;#.#ops | #.#MB/sec | #.#var&gt;</p>
<p>-timelimit [target &lt;target#&gt;] &lt;#seconds&gt;</p>
<p>-timerinfo</p>
<p>-timeserver &lt;host hostname | port # | bounce #&gt;</p>
<p>-ts [target &lt;target#&gt;] summary|detailed|wrap|oneshot|size #|append|output &lt;filename&gt;|dump
&lt;filename&gt;|triggertime &lt;seconds&gt;|triggerop &lt;op#&gt;</p>
<p>-verbose</p>
<p>-verify [target &lt;target#&gt;] location|contents</p>
<p>-version</p>
<p>Here is an example of a ZFS write test:</p>
<p><strong>xdd –op write –targets 2 /mnt/tank/BIGFILE1 /mnt/tank/BIGFILE2 -blocksize 512 -reqsize 128 -mbytes 2048 –verbose –passes 3</strong></p>
<p>This test will write sequentially from two existing target files,
<em>/mnt/tank/BIGFILE1</em>
and
<em>/mnt/tank/BIGFILE2</em>
. It starts at the beginning of each file using a fixed request size of 128 blocks with 512 bytes per block until it has read 2048 MB, at which time it will end the current pass and proceed to the next pass. It will do this 3 times and display performance information for each pass. The combined performance of both devices is calculated and displayed at the end of the run. Once the test is finished, you can test the read performance by changing the
<strong>-op</strong>
to
<strong>read</strong>
.</p>
<p>You can also test read or write operations on a specified disk. Replace
<em>/dev/ada0</em>
with the device name for the disk you wish to test.</p>
<p><strong>xdd –op read –targets 1 /dev/ada0 –reqsize 128 -mbytes 64 –passes 3 –verbose</strong></p>
<p>If you use the same switches often, create a setup file and refer to it with the
<strong>-setup</strong>
switch. For example, in a writable location (e.g. volume or dataset) create a
<em>xdd.setup</em>
file containing this line:</p>
<p>–reqsize 128 -mbytes 64 –passes 3 –verbose</p>
<p>Now your command would be:</p>
<p><strong>xdd –op read –targets 1 /dev/ada0 -setup xdd.setup</strong></p>
<p>To perform a random I/O test on the specified disk:</p>
<p><strong>xdd –op read –targets 1 /dev/ada0 –reqsize 8 -mbytes 16 –passes 3 –verbose –seek random –seek range 4000000</strong></p>
<p>This random I/O test will read from the target device at some random location using a fixed request size of 8 blocks until it has read 16 MB. It will do this 3 times and display performance information for each pass. Since this is a random I/O pattern, the read requests are distributed over a range of 4,000,000 blocks. This is useful in constraining the area over which the random locations are chosen from. The same seek locations are used for each pass in order to generate reproducible results. In fact, upon each invocation of
<strong>xdd</strong>
using the same parameters, the same random locations are generated each time. This allows the user to change the disk or starting offset and observe the effects. The random locations may be changed from pass to pass within an
<strong>xdd</strong>
run by using the
<strong>-randomize</strong>
option which generates a new set of locations for each pass. The random locations may be changed from run to run using the
<strong>–seek</strong>
* *
<strong>seed</strong>
option to specify a different random number generation seed value for each invocation of
<strong>xdd</strong>
.</p>
</div>
<div class="section" id="id431">
<h3>tw_cli<a class="headerlink" href="#id431" title="Permalink to this headline">¶</a></h3>
<p>FreeNAS® includes the
<strong>tw_cli</strong>
command line utility for providing controller, logical unit, and drive management for AMCC/3ware ATA RAID Controllers. The supported models are listed in the man pages for the
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=twe">twe(4)</a>
and
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=twa">twa(4)</a>
drivers.</p>
<p>Before using this command, read its
<a class="reference external" href="http://www.cyberciti.biz/files/tw_cli.8.html">man page</a>
as it describes the terminology and provides some usage examples.</p>
<p>If you type
<strong>tw_cli</strong>
in
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
, the prompt will change, indicating that you have entered interactive mode where you can run all sorts of maintenance commands on the controller and its arrays.</p>
<p>Alternately, you can specify one command to run. For example, to view the disks in the array:</p>
<p><strong>tw_cli /c0 show</strong></p>
<p>Unit
UnitType
Status
%RCmpl
%V/I/M
Stripe
Size(GB)
Cache AVrfy</p>
<hr class="docutils" />
<p>u0
RAID-6
OK
-
-
256K
5587.88
RiW
ON</p>
<p>u1
SPARE
OK
-
-
-
931.505
-
OFF</p>
<p>u2
RAID-10
OK
-
-
256K
1862.62
RiW
ON</p>
<p>VPort Status
Unit Size
Type
Phy Encl-Slot
Model</p>
<hr class="docutils" />
<p>p8
OK
u0
931.51 GB SAS
-
/c0/e0/slt0
SEAGATE ST31000640SS</p>
<p>p9
OK
u0
931.51 GB SAS
-
/c0/e0/slt1
SEAGATE ST31000640SS</p>
<p>p10
OK
u0
931.51 GB SAS
-
/c0/e0/slt2
SEAGATE ST31000640SS</p>
<p>p11
OK
u0
931.51 GB SAS
-
/c0/e0/slt3
SEAGATE ST31000640SS</p>
<p>p12
OK
u0
931.51 GB SAS
-
/c0/e0/slt4
SEAGATE ST31000640SS</p>
<p>p13
OK
u0
931.51 GB SAS
-
/c0/e0/slt5
SEAGATE ST31000640SS</p>
<p>p14
OK
u0
931.51 GB SAS
-
/c0/e0/slt6
SEAGATE ST31000640SS</p>
<p>p15
OK
u0
931.51 GB SAS
-
/c0/e0/slt7
SEAGATE ST31000640SS</p>
<p>p16
OK
u1
931.51 GB SAS
-
/c0/e0/slt8
SEAGATE ST31000640SS</p>
<p>p17
OK
u2
931.51 GB SATA
-
/c0/e0/slt9
ST31000340NS</p>
<p>p18
OK
u2
931.51 GB SATA
-
/c0/e0/slt10 ST31000340NS</p>
<p>p19
OK
u2
931.51 GB SATA
-
/c0/e0/slt11 ST31000340NS</p>
<p>p20
OK
u2
931.51 GB SATA
-
/c0/e0/slt15 ST31000340NS</p>
<p>Name
OnlineState
BBUReady
Status
Volt
Temp
Hours LastCapTest</p>
<hr class="docutils" />
<p>bbu
On
Yes
OK
OK
OK
212
03-Jan-2012</p>
<p>Or, to review the event log:</p>
<p><strong>tw_cli /c0 show events</strong></p>
<p>Ctl
Date
Severity
AEN Message</p>
<hr class="docutils" />
<p>c0
[Thu Feb 23 2012 14:01:15]
INFO
Battery charging started</p>
<p>c0
[Thu Feb 23 2012 14:03:02]
INFO
Battery charging completed</p>
<p>c0
[Sat Feb 25 2012 00:02:18]
INFO
Verify started: unit=0</p>
<p>c0
[Sat Feb 25 2012 00:02:18]
INFO
Verify started: unit=2,subunit=0</p>
<p>c0
[Sat Feb 25 2012 00:02:18]
INFO
Verify started: unit=2,subunit=1</p>
<p>c0
[Sat Feb 25 2012 03:49:35]
INFO
Verify completed: unit=2,subunit=0</p>
<p>c0
[Sat Feb 25 2012 03:51:39]
INFO
Verify completed: unit=2,subunit=1</p>
<p>c0
[Sat Feb 25 2012 21:55:59]
INFO
Verify completed: unit=0</p>
<p>c0
[Thu Mar 01 2012 13:51:09]
INFO
Battery health check started</p>
<p>c0
[Thu Mar 01 2012 13:51:09]
INFO
Battery health check completed</p>
<p>c0
[Thu Mar 01 2012 13:51:09]
INFO
Battery charging started</p>
<p>c0
[Thu Mar 01 2012 13:53:03]
INFO
Battery charging completed</p>
<p>c0
[Sat Mar 03 2012 00:01:24]
INFO
Verify started: unit=0</p>
<p>c0
[Sat Mar 03 2012 00:01:24]
INFO
Verify started: unit=2,subunit=0</p>
<p>c0
[Sat Mar 03 2012 00:01:24]
INFO
Verify started: unit=2,subunit=1</p>
<p>c0
[Sat Mar 03 2012 04:04:27]
INFO
Verify completed: unit=2,subunit=0</p>
<p>c0
[Sat Mar 03 2012 04:06:25]
INFO
Verify completed: unit=2,subunit=1</p>
<p>c0
[Sat Mar 03 2012 16:22:05]
INFO
Verify completed: unit=0</p>
<p>c0
[Thu Mar 08 2012 13:41:39]
INFO
Battery charging started</p>
<p>c0
[Thu Mar 08 2012 13:43:42]
INFO
Battery charging completed</p>
<p>c0
[Sat Mar 10 2012 00:01:30]
INFO
Verify started: unit=0</p>
<p>c0
[Sat Mar 10 2012 00:01:30]
INFO
Verify started: unit=2,subunit=0</p>
<p>c0
[Sat Mar 10 2012 00:01:30]
INFO
Verify started: unit=2,subunit=1</p>
<p>c0
[Sat Mar 10 2012 05:06:38]
INFO
Verify completed: unit=2,subunit=0</p>
<p>c0
[Sat Mar 10 2012 05:08:57]
INFO
Verify completed: unit=2,subunit=1</p>
<p>c0
[Sat Mar 10 2012 15:58:15]
INFO
Verify completed: unit=0</p>
<p>If you add some disks to the array and they are not showing up in the GUI, try running the following command:</p>
<p><strong>tw_cli /c0 rescan</strong></p>
<p>Use the drives to create units and export them to the operating system. When finished, run
<strong>camcontrol rescan all</strong>
and they should now be available in the
FreeNAS®
GUI.</p>
<p>This
<a class="reference external" href="http://forums.freenas.org/threads/3ware-drive-monitoring.13835/">forum post</a>
contains a handy wrapper script that will notify you of errors.</p>
</div>
<div class="section" id="id434">
<h3>MegaCli<a class="headerlink" href="#id434" title="Permalink to this headline">¶</a></h3>
<p><strong>MegaCli</strong>
is the command line interface for the LSI MegaRAID SAS family of RAID controllers. FreeNAS® also includes the
<a class="reference external" href="http://www.freebsd.org/cgi/man.cgi?query=mfiutil">mfiutil(8)</a>
utility which can be used to configure and manage connected storage devices.</p>
<p>The
<strong>MegaCli</strong>
command is quite complex with several dozen options. While it is fully documented in this 442 page
<a class="reference external" href="http://www.lsi.com/downloads/Public/MegaRAID%20Common%20Files/SASUG_51530-00_RevG.pdf">PDF</a>
, the commands demonstrated in the
<a class="reference external" href="http://tools.rapidsoft.de/perc/perc-cheat-sheet.html">Emergency Cheat Sheet</a>
can get you started.</p>
</div>
<div class="section" id="id436">
<h3>freenas-debug<a class="headerlink" href="#id436" title="Permalink to this headline">¶</a></h3>
<p>The FreeNAS® GUI provides an option to save debugging information to a text file using System → Settings →
<a class="reference external" href="#1.4.6.2.AdvancedTab|outline">Advanced</a>
→ Save Debug. This debugging information is created by the
<strong>freenas-debug</strong>
command line utility and a copy of the information is saved to
<em>/var/tmp/fndebug</em>
.</p>
<p>Using
<a class="reference external" href="#1.9.2.Shell|outline">Shell</a>
, you can run this command manually to gather the specific debugging information that you need. To see the available options, type:</p>
<p><a href="#id439"><span class="problematic" id="id440">**</span></a>freenas-debug **</p>
<p>usage: /usr/local/bin/freenas-debug &lt;options&gt;</p>
<p>Where options is:</p>
<p>-e
A list of comma delimited list of email addresses to email the debug log to.</p>
<p>-a
Dump Active Directory Configuration</p>
<p>-c
Dump (AD|LDAP) Cache</p>
<p>-g
Dump GEOM configuration</p>
<p>-h
Dump Hardware Configuration</p>
<p>-I
Dump IPMI Configuration</p>
<p>-i
Dump iSCSI Configuration</p>
<p>-l
Dump LDAP Configuration</p>
<p>-T
Loader Configuration Information</p>
<p>-n
Dump Network Configuration</p>
<p>-N
Dump NFS Configuration</p>
<p>-s
Dump SSL Configuration</p>
<p>-y
Dump Sysctl Configuration</p>
<p>-t
Dump System Information</p>
<p>-z
Dump ZFS configuration</p>
<p>Output will be saved to /var/tmp/fndebug</p>
<p>For example, if you are troubleshooting your Active Directory configuration, try the following commands to generate and view the debug file:</p>
<p><strong>freenas-debug -a</strong></p>
<p><strong>more /var/tmp/fndebug</strong></p>
</div>
<div class="section" id="id441">
<h3>tmux<a class="headerlink" href="#id441" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://tmux.sourceforge.net/">tmux</a>
is a terminal multiplexer which enables a number of terminals to be created, accessed, and controlled from a single screen. tmux is an alternative to GNU screen. Similar to screen, tmux can be detached from a screen and continue running in the background, then later reattached.</p>
<p>To start a session, simply type
<strong>tmux</strong>
. As seen in Figure 14.9a, a new session with a single window will open with a status line at the bottom of the screen. This line shows information on the current session
and is used to enter interactive commands.</p>
<p><strong>Figure 14.9a: tmux Session</strong></p>
<p><a class="reference internal" href="_images/10000000000002A9000001C464676B50.png"><img alt="10000000000002A9000001C464676B50_png" src="_images/10000000000002A9000001C464676B50.png" style="width: 6.9252in; height: 4.5965in;" /></a></p>
<p>To create a second window, press
<em>ctrl b</em>
then
<em>&#8220;</em>
. To close a window, type
<strong>exit</strong>
within the window.</p>
<p><a class="reference external" href="http://www.openbsd.org/cgi-bin/man.cgi?query=tmux">tmux(1)</a>
lists all of the key bindings and commands for interacting with
<strong>tmux</strong>
windows and sessions.</p>
<p>If you close Shell while
<strong>tmux</strong>
is running, it will detach its session. The next time you open Shell, run
<strong>tmux attach</strong>
to return to the previous session. To leave the
<strong>tmux</strong>
session entirely, type
<strong>exit</strong>
; if you have multiple windows running, you will need to
<strong>exit</strong>
out of each first.</p>
</div>
<div class="section" id="id443">
<h3>Dmidecode<a class="headerlink" href="#id443" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://www.nongnu.org/dmidecode/">Dmidecode</a>
reports hardware information as reported by the system BIOS. Dmidecode does not scan the hardware, it only reports what the BIOS told it to. A sample output can be seen
<a class="reference external" href="http://www.nongnu.org/dmidecode/sample/dmidecode.txt">here</a>
.</p>
<p>To view the BIOS report, type the command with no arguments:</p>
<p><strong>dmidecode | more</strong></p>
<p><a class="reference external" href="http://linux.die.net/man/8/dmidecode">dmidecode(8)</a>
describes the supported strings and types.</p>
</div>
</div>
</div>
<div class="section" id="section-4-contributing-to-freenas">
<h1>Section 4: Contributing to FreeNAS®<a class="headerlink" href="#section-4-contributing-to-freenas" title="Permalink to this headline">¶</a></h1>
<div class="section" id="how-to-get-involved">
<h2>How to Get Involved<a class="headerlink" href="#how-to-get-involved" title="Permalink to this headline">¶</a></h2>
<p>As an open source community, FreeNAS® relies on the input and expertise of its users to help improve FreeNAS®. When you take some time to assist the community, your contributions benefit everyone who uses FreeNAS®.</p>
<p>This section describes some areas of participation to get you started. It is by no means an exhaustive list. If you have an idea that you think would benefit the FreeNAS® community, bring it up on one of the resources mentioned in
<a class="reference external" href="#1.11.FreeNAS®SupportResources|outline">FreeNAS® Support Resources</a>
.</p>
<p>This section demonstrates how you can:</p>
<ul class="simple">
<li><a class="reference external" href="#1.12.1.AssistwithLocalization|outline">Assist with Localization</a></li>
<li><a class="reference external" href="#1.13.3.TestanUpcomingVersion|outline">Test Upcoming Versions</a></li>
</ul>
<div class="section" id="id447">
<h3>Assist with Localization<a class="headerlink" href="#id447" title="Permalink to this headline">¶</a></h3>
<p>FreeNAS® uses
<a class="reference external" href="http://en.wikipedia.org/wiki/Pootle">Pootle</a>
, an open source application, for managing the localization of the menu screens used by the FreeNAS® graphical administrative interface. Pootle makes it easy to find out the localization status of your native language and to translate the text for any menus that have not been localized yet. By providing a web editor and commenting system, Pootle allows translators to spend their time making and reviewing translations rather than learning how to use a translation submission tool.</p>
<p>To see the status of a localization, open
<a class="reference external" href="http://pootle.freenas.org/">pootle.freenas.org</a>
in your browser, as seen in Figure 15.1a:</p>
<p><strong>Figure 15.1a: FreeNAS® Localization System</strong></p>
<p><a class="reference internal" href="_images/10000000000003E0000002624E582DF2.png"><img alt="10000000000003E0000002624E582DF2_png" src="_images/10000000000003E0000002624E582DF2.png" style="width: 6.9252in; height: 3.272in;" /></a></p>
<p>The localizations FreeNAS® users have requested are listed alphabetically on the left. If your language is missing and you would like to help in its translation, send an email to the
<a class="reference external" href="http://lists.freenas.org/mailman/listinfo/freenas-translations">translations mailing list</a>
so it can be added.</p>
<p>The green bar in the Overall Completion column indicates the percentage of FreeNAS® menus that have been localized. If a language is not at 100%, it means that the menus that currently are not translated will appear in English instead of in that language.</p>
<p>If you wish to help localize your language, you should first join the
<a class="reference external" href="http://lists.freenas.org/mailman/listinfo/freenas-translations">translations mailing list</a>
and introduce yourself and which language(s) you can assist with. This will allow you to meet other volunteers as well as keep abreast of any notices or updates that may
effect
the translations. You will also need to click on the Register link in order to create a Pootle login account.</p>
<p>The first time you log into the FreeNAS® Pootle interface, you will be prompted to select your language so that you can access that language&#8217;s translation whenever you login. Alternately, you can click the Home link to see the status of all of the languages. To work on a translation, click the link for the language → click the FreeNAS® link for the project → click the link for LC_MESSAGES → and click the link for django.po. Every text line available in the GUI menu screens has been assigned a string number. If you click the number, an editor will open where you can translate the text. In the example shown in Figure 15.1b, a user has selected string number 46 in the German translation; the other strings in the screenshot have already been translated:</p>
<p><strong>Figure 15.1b: Using the Pootle Interface to Edit a Translation String</strong></p>
<p><a class="reference internal" href="_images/100000000000047B00000232CA1DFA0A.png"><img alt="100000000000047B00000232CA1DFA0A_png" src="_images/100000000000047B00000232CA1DFA0A.png" style="width: 6.9252in; height: 3.3929in;" /></a></p>
<p>Simply type in the translated text and click the Submit button to save your change.</p>
</div>
<div class="section" id="test-an-upcoming-version">
<h3>Test an Upcoming Version<a class="headerlink" href="#test-an-upcoming-version" title="Permalink to this headline">¶</a></h3>
<p>Prior to any release, there is a beta period where testing snapshots will be announced on the FreeNAS® website and
<a class="reference external" href="#1.11.1.WebsiteandSocialMedia|outline">social media sites</a>
. This beta period is meant to provide users an opportunity to test the upcoming release and to provide feedback on bugs and errors so that they can be fixed prior to release. Feedback can be sent to the
<a class="reference external" href="http://lists.freenas.org/mailman/listinfo/freenas-testing">Freenas-testing mailing list</a>
or a
<a class="reference external" href="https://bugs.freenas.org/projects/freenas">bug report can be submitted</a>
.</p>
<div class="section" id="rolling-your-own-testing-snapshot">
<h4>Rolling Your Own Testing Snapshot<a class="headerlink" href="#rolling-your-own-testing-snapshot" title="Permalink to this headline">¶</a></h4>
<p>Users who wish to create their own custom ISO for testing purposes can download and compile the latest FreeNAS® source from the github repository.</p>
<p>In order to build your own testing snapshot, you will need to install
<a class="reference external" href="http://www.freebsd.org/releases/9.2R/announce.html">FreeBSD 9.2</a>
in a virtual environment or on a test system. If you are using a virtual environment, a 64-bit system with at least 4 GB of RAM is recommended. Download and
<a class="reference external" href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/bsdinstall.html">install</a>
the FreeBSD version (i386 or amd64) that matches the architecture that you wish to build.</p>
<p>After booting into the newly installed FreeBSD system, become the superuser (type
<strong>su</strong>
and enter the
<em>root</em>
user&#8217;s password) and run the following commands. First, install the software you&#8217;ll need and refresh your path so it is aware of the new binaries:</p>
<p><strong>pkg_add -r git-subversion</strong></p>
<p><strong>pkg_add -r cdrtools</strong></p>
<p><strong>pkg_add -r python27</strong></p>
<p><strong>pkg_add -r pbi-manager</strong></p>
<p><strong>rehash</strong></p>
<p>Change to the directory where you would like to store the FreeNAS® source, download the source, then change to the directory containing the downloaded source:</p>
<p><strong>cd /</strong>
<strong>path/to/your-build-filesystem</strong></p>
<p><strong>git clone git://github.com/freenas/freenas.git</strong></p>
<p><strong>cd freenas</strong></p>
<p>You are now ready to build the image using the instructions in this
<a class="reference external" href="https://github.com/freenas/freenas">README</a>
.</p>
</div>
</div>
</div>
<div class="section" id="using-the-freenas-api">
<h2>Using the FreeNAS® API<a class="headerlink" href="#using-the-freenas-api" title="Permalink to this headline">¶</a></h2>
<p>FreeNAS® provides a
<a class="reference external" href="http://docutils.sourceforge.net/docs/ref/rst/restructuredtext.html">reST</a>
API which can be used as an alternate mechanism for remotely controlling a FreeNAS® system.</p>
<p>reStructuredText is an easy-to-read, lightweight markup language that provides an HTTP implementation of functions, known as resources, which are available beneath a specified base URL. Each resource is manipulated using
<a class="reference external" href="http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">HTTP methods</a>
such as GET, PUT, POST, or DELETE.</p>
<p>This section demonstrates how to install the necessary software to build a local copy of the reference documentation for the FreeNAS® APIs. It then walks through some code examples to get you started using the APIs.</p>
<div class="section" id="building-a-local-copy-of-the-apis">
<h3>Building a Local Copy of the APIs<a class="headerlink" href="#building-a-local-copy-of-the-apis" title="Permalink to this headline">¶</a></h3>
<p>If you plan to use the APIs, it is recommended that you build a local HTML copy of the API documentation so that you can easily determine which resources are available and learn more about how each resource works. This section demonstrates how to install the software and source needed to build the documentation using a
<a class="reference external" href="https://www.freebsd.org/releases/9.2R/announce.html">FreeBSD 9.2</a>
system. Users of other operating systems will need to find and install the equivalent packages for their operating system.</p>
<p>On a FreeBSD system, login as root and install the necessary software:</p>
<p><strong>pkg_add -r git</strong></p>
<p><strong>pkg_add -r py-oauth2</strong></p>
<p><strong>pkg_add -r py-sphinxcontrib-httpdomain</strong></p>
<p><strong>rehash</strong></p>
<p>Those commands install the binary packages and add the new binaries to the user&#8217;s path. If a package is not available,
<a class="reference external" href="http://www.freebsd.org/doc/en_US.ISO8859-1/books/handbook/ports-using.html">compile the port</a>
instead.</p>
<p>Next, download a local copy of the FreeNAS® source code from github. Run this command in the directory which will store the local copy:</p>
<p><strong>cd /usr/local</strong></p>
<p><strong>git clone &#8211;depth 1 git://github.com/freenas/freenas.git</strong></p>
<p>This will create a subdirectory called
<em>freenas</em>
which contains the cloned source. Once the system has a local copy, it can be updated as needed by running this command within
<em>freenas</em>
:</p>
<p><strong>git pull</strong></p>
<p>To build a local copy of the API reference documentation:</p>
<p><strong>cd freenas/docs/api</strong></p>
<p>make htm
<strong>l</strong></p>
<p>Point a web browser to
<em>/usr/local/freenas/docs/api/_build/html/index.html</em>
to view the documentation. As seen in the example in Figure 16.1a, the resources are laid out in an order that is similar to the tree menu of the FreeNAS® GUI.</p>
<p><strong>Figure 16.1a: FreeNAS® API Documentation</strong></p>
<p><a class="reference internal" href="_images/10000000000003AC000002E942993BA8.png"><img alt="10000000000003AC000002E942993BA8_png" src="_images/10000000000003AC000002E942993BA8.png" style="width: 6.9252in; height: 5.4425in;" /></a></p>
</div>
<div class="section" id="a-simple-api-example">
<h3>A Simple API Example<a class="headerlink" href="#a-simple-api-example" title="Permalink to this headline">¶</a></h3>
<p>The
<em>freenas/examples/api/</em>
directory contains some API usage examples. This section provides a walk-through of the
<em>freenas/examples/api/newuser.py</em>
script, shown below, as it provides a simple example that creates a user.</p>
<p>In order to create a customized script based on this example, you will need a running FreeNAS® 9.2.0 system. If you would like to test the scripts directly on the FreeNAS® system, create a user account. When creating this user account, select an existing volume or dataset for the user&#8217;s &#8220;Home Directory&#8221;. Once the user is created, start the SSH service using Services → Control Services. That user will now be able to
<strong>ssh</strong>
to the IP address of the FreeNAS® system in order to create and run scripts. Alternately, you can test your scripts on any system that has the software mentioned in the previous section installed.</p>
<p>To customize this script, copy the contents of this example into a filename that ends in
<em>.py</em>
. The text that is highlighted in red below should be modified in your copy in order to match the needs of the user
being created. The text in black should remain as-is. After saving your changes, run the script by typing
<strong>python scriptname.py</strong>
. If all goes well, the new user account will appear in Account → Users → View Users in the FreeNAS® GUI.</p>
<p>Here is the example script with line numbers. Do
<strong>not</strong>
include the line numbers in your script. Instead, refer to the line numbers in the explanation below.</p>
<p><strong>1:</strong>
import json</p>
<p><strong>2:</strong>
import requests</p>
<p><strong>3:</strong>
r = requests.post(</p>
<p><strong>4:</strong></p>
<p>&#8216;<a class="reference external" href="https://">https://</a>
freenas.mydomain
/api/v1.0/account/users/&#8217;,</p>
<p><strong>5:</strong></p>
<p>auth=(&#8216;root&#8217;, &#8216;
freenas
&#8216;),</p>
<p><strong>6:</strong></p>
<p>headers={&#8216;Content-Type&#8217;: &#8216;application/json&#8217;},</p>
<p><strong>7:</strong></p>
<p>verify=False,</p>
<p><strong>8:</strong></p>
<p>data=json.dumps({</p>
<p><strong>9:</strong></p>
<p>&#8216;bsdusr_uid&#8217;: &#8216;
1100
&#8216;,</p>
<p><strong>10:</strong></p>
<p>&#8216;bsdusr_username&#8217;: &#8216;
myuser
&#8216;,</p>
<p><strong>11:</strong></p>
<p>&#8216;bsdusr_mode&#8217;: &#8216;
755
&#8216;,</p>
<p><strong>12:</strong></p>
<p>&#8216;bsdusr_creategroup&#8217;: &#8216;
True
&#8216;,</p>
<p><strong>13:</strong></p>
<p>&#8216;bsdusr_password&#8217;: &#8216;
12345
&#8216;,</p>
<p><strong>14:</strong></p>
<p>&#8216;bsdusr_shell&#8217;: &#8216;
/usr/local/bin/bash
&#8216;,</p>
<p><strong>15:</strong></p>
<p>&#8216;bsdusr_full_name&#8217;: &#8216;
Full Name
&#8216;,</p>
<p><strong>16:</strong></p>
<p>&#8216;bsdusr_email&#8217;: &#8216;
<a class="reference external" href="mailto:name&#37;&#52;&#48;provider&#46;com">name<span>&#64;</span>provider<span>&#46;</span>com</a>
&#8216;,</p>
<p><strong>17:</strong></p>
<p>})</p>
<p><strong>18:</strong>
)</p>
<p><strong>19:</strong>
print r.text</p>
<p>Where:</p>
<p><strong>Lines 1-2:</strong>
import the Python modules used to make HTTP requests and handle data in JSON format.</p>
<p><strong>Line 4:</strong>
replace
<em>freenas.mydomain</em>
with the &#8220;Hostname&#8221; value in System → System Information. Note that your script will fail if the machine running the script is not able to resolve that hostname. If you are not using HTTPS to access the FreeNAS® system, change
<em>https</em>
to
<em>http</em>
.</p>
<p><strong>Line 5:</strong>
replace
<em>freenas</em>
with the password that you use to access the FreeNAS® system.</p>
<p><strong>Line 7:</strong>
if you are using HTTPS and want to force validation of the SSL certificate, change
<em>False</em>
to
<em>True</em>
.</p>
<p><strong>Lines 8-16:</strong>
sets the values for the user being created. The &#8220;Users&#8221; resource, found in
<em>freenas/docs/api/_build/html/resources/account.html#users</em>
, describes this resource in more detail. The allowed parameters are listed in the &#8220;Json Parameters&#8221; section of that resource. Since this resource creates a FreeBSD user, the values that you input must be valid for a FreeBSD user account. Table 16.2a summarizes the valid values. Since this resource is using JSON, the possible boolean values are
<em>True</em>
or
<em>False</em>
.</p>
<p><strong>Table 16.2a: Valid JSON Parameters for Users Create Resource</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="15%" />
<col width="6%" />
<col width="79%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>JSON Parameter</strong></th>
<th class="head"><strong>Type</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>bsdusr_username</td>
<td>string</td>
<td>maximum 32 characters, though a maximum of 8 is recommended for interoperability; can include numerals but can not include a space</td>
</tr>
<tr class="row-odd"><td>bsdusr_full_name</td>
<td>string</td>
<td>may contain spaces and uppercase characters</td>
</tr>
<tr class="row-even"><td>bsdusr_password</td>
<td>string</td>
<td>can include a mix of upper and lowercase letters, characters, and
numbers</td>
</tr>
<tr class="row-odd"><td>bsdusr_uid</td>
<td>integer</td>
<td>by convention, user accounts have an ID greater than 1000 with a maximum allowable value of 65,535</td>
</tr>
<tr class="row-even"><td>bsdusr_group</td>
<td>integer</td>
<td>if
<em>bsdusr_creategroup</em>
is set to
<em>False</em>
, specify the numeric ID of the group to create</td>
</tr>
<tr class="row-odd"><td>bsdusr_creategroup</td>
<td>boolean</td>
<td>if set to
<em>True</em>
, a primary group with the same numeric ID as
<em>bsdusr_uid</em>
will be automatically created</td>
</tr>
<tr class="row-even"><td>bsdusr_mode</td>
<td>string</td>
<td>sets default numeric UNIX permissions of user&#8217;s home directory</td>
</tr>
<tr class="row-odd"><td>bsdusr_shell</td>
<td>string</td>
<td>specify full path to a UNIX shell that is installed on the system</td>
</tr>
<tr class="row-even"><td>bsdusr_password_disabled</td>
<td>boolean</td>
<td>if set to
<em>True</em>
, user is not allowed to login</td>
</tr>
<tr class="row-odd"><td>bsdusr_locked</td>
<td>boolean</td>
<td>if set to
<em>True</em>
, user is not allowed to login</td>
</tr>
<tr class="row-even"><td>bsdusr_sudo</td>
<td>boolean</td>
<td>if set to
<em>True</em>
, sudo is enabled for the user</td>
</tr>
</tbody>
</table>
<p><strong>NOTE:</strong>
when using boolean values, JSON returns raw lowercase values whereas Python uses uppercase values. This means that you should use
<em>True</em>
or
<em>False</em>
in your Python scripts even though the example JSON responses in the API documentation are displayed as
<em>true</em>
or
<em>false</em>
.</p>
</div>
<div class="section" id="a-more-complex-example">
<h3>A More Complex Example<a class="headerlink" href="#a-more-complex-example" title="Permalink to this headline">¶</a></h3>
<p>This section provides a walk-through of a more complex example found in the
<em>freenas/examples/api/startup.py</em>
script. Use the searchbar within the API documentation to quickly locate the JSON parameters used in this example.
This example defines a class and several methods which are used to create a ZFS volume, create a ZFS dataset, share this dataset over CIFS, and enable the CIFS service. The responses from some methods are used as parameters in other methods. In addition to the import lines seen in the previous example, this example imports two additional Python modules to provide parsing functions for command line arguments:</p>
<p>import argparse</p>
<p>import sys</p>
<p>It then creates a
<em>Startup</em>
class which is started with the hostname, username, and password provided by the user via the command line:</p>
<p>class Startup(object):</p>
<p>def __init__(self, hostname, user, secret):</p>
<p>self._hostname = hostname</p>
<p>self._user = user</p>
<p>self._secret = secret</p>
<p>self._ep = &#8216;<a class="reference external" href="http://%s/api/v1.0">http://%s/api/v1.0</a>&#8216; % hostname</p>
<p>def request(self, resource, method=&#8217;GET&#8217;, data=None):</p>
<p>if data is None:</p>
<p>data =</p>
<p>r = requests.request(</p>
<p>method,</p>
<p>&#8216;%s/%s/&#8217; % (self._ep, resource),</p>
<p>data=json.dumps(data),</p>
<p>headers={&#8216;Content-Type&#8217;: &#8220;application/json&#8221;},</p>
<p>auth=(self._user, self._secret),</p>
<p>)</p>
<p>if r.ok:</p>
<p>try:</p>
<p>return r.json()</p>
<p>except:</p>
<p>return r.text</p>
<p>raise ValueError(r)</p>
<p>A
<em>_get_disks</em>
method is defined to get all the disks in the system as a
<em>disk_name</em>
response. The
<em>create_pool</em>
method will then use this information to create a ZFS pool named
<em>tank</em>
which will be created as a stripe. The
<em>volume_name</em>
and
<em>layout</em>
JSON parameters are described in the Storage Volume resource of the API documentation.</p>
<p>def _get_disks(self):</p>
<p>disks = self.request(&#8216;storage/disk&#8217;)</p>
<p>return [disk[&#8216;disk_name&#8217;] for disk in disks]</p>
<p>def create_pool(self):</p>
<p>disks = self._get_disks()</p>
<p>self.request(&#8216;storage/volume&#8217;, method=&#8217;POST&#8217;, data={</p>
<p>&#8216;volume_name&#8217;: &#8216;tank&#8217;,</p>
<p>&#8216;layout&#8217;: [</p>
<p>{&#8216;vdevtype&#8217;: &#8216;stripe&#8217;, &#8216;disks&#8217;: disks},</p>
<p>],</p>
<p>})</p>
<p>The
<em>create_dataset</em>
method is defined which creates a dataset named
<em>MyShare</em>
:</p>
<p>def create_dataset(self):</p>
<p>self.request(&#8216;storage/volume/tank/datasets&#8217;, method=&#8217;POST&#8217;, data={</p>
<p>&#8216;name&#8217;: &#8216;MyShare&#8217;,</p>
<p>})</p>
<p>The
<em>create_cifs_share</em>
method is used to share
<em>/mnt/tank/MyShare</em>
with guest-only access enabled. The
<em>cifs_name</em>
,
<em>cifs_path</em>
,
<em>cifs_guestonly</em>
JSON parameters, as well as the other allowable parameters, are described in the Sharing CIFS resource of the API documentation.</p>
<p>def create_cifs_share(self):</p>
<p>self.request(&#8216;sharing/cifs&#8217;, method=&#8217;POST&#8217;, data={</p>
<p>&#8216;cifs_name&#8217;: &#8216;My Test Share&#8217;,</p>
<p>&#8216;cifs_path&#8217;: &#8216;/mnt/tank/MyShare&#8217;,</p>
<p>&#8216;cifs_guestonly&#8217;: True</p>
<p>})</p>
<p>Finally, the
<em>service_start</em>
method issues a command to enable the CIFS service. The
<em>srv_enable</em>
JSON parameter is described in the Services Services resource.</p>
<p>def service_start(self, name):</p>
<p>self.request(&#8216;services/services/%s&#8217; % name, method=&#8217;PUT&#8217;, data={</p>
<p>&#8216;srv_enable&#8217;: True,</p>
<p>})</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="test.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Section 1: Introduction and Installation</a></li>
<li><a class="reference internal" href="#preface">Preface</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a><ul>
<li><a class="reference internal" href="#what-s-new-in-9-2-2">What&#8217;s New in 9.2.2</a></li>
<li><a class="reference internal" href="#known-issues">Known Issues</a></li>
<li><a class="reference internal" href="#hardware-recommendations">Hardware Recommendations</a><ul>
<li><a class="reference internal" href="#architecture">Architecture</a></li>
<li><a class="reference internal" href="#ram">RAM</a></li>
<li><a class="reference internal" href="#compact-or-usb-flash">Compact or USB Flash</a></li>
<li><a class="reference internal" href="#storage-disks-and-controllers">Storage Disks and Controllers</a></li>
<li><a class="reference internal" href="#network-interfaces">Network Interfaces</a></li>
<li><a class="reference internal" href="#raid-overview">RAID Overview</a></li>
<li><a class="reference internal" href="#zfs-overview">ZFS Overview</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#installing-and-upgrading-freenas">Installing and Upgrading FreeNAS®</a><ul>
<li><a class="reference internal" href="#id14">Getting FreeNAS®</a></li>
<li><a class="reference internal" href="#id21">FreeNAS® in a Virtual Environment</a><ul>
<li><a class="reference internal" href="#virtualbox">VirtualBox</a><ul>
<li><a class="reference internal" href="#creating-the-virtual-machine">Creating the Virtual Machine</a></li>
<li><a class="reference internal" href="#creating-devices-for-storage-and-installation-media">Creating Devices for Storage and Installation Media</a></li>
<li><a class="reference internal" href="#configuring-the-bridged-adapter">Configuring the Bridged Adapter</a></li>
<li><a class="reference internal" href="#id24">Running FreeNAS® from a USB Image</a></li>
</ul>
</li>
<li><a class="reference internal" href="#vmware-esxi">VMware ESXi</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id25">Installing from CDROM</a></li>
<li><a class="reference internal" href="#id27">Burning an IMG File</a><ul>
<li><a class="reference internal" href="#using-xzcat-and-dd-on-a-freebsd-or-linux-system">Using xzcat and dd on a FreeBSD or Linux System</a></li>
<li><a class="reference internal" href="#using-keka-and-dd-on-an-os-x-system">Using Keka and dd on an OS X System</a></li>
<li><a class="reference internal" href="#using-7-zip-and-win32diskimager-on-windows">Using 7-Zip and Win32DiskImager on Windows</a></li>
<li><a class="reference internal" href="#id36">Troubleshooting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id37">Initial Setup</a></li>
<li><a class="reference internal" href="#id40">Upgrading FreeNAS®</a><ul>
<li><a class="reference internal" href="#preparing-for-the-upgrade">Preparing for the Upgrade</a></li>
<li><a class="reference internal" href="#using-the-iso-to-upgrade">Using the ISO to Upgrade</a></li>
<li><a class="reference internal" href="#using-the-gui-to-upgrade">Using the GUI to Upgrade</a></li>
<li><a class="reference internal" href="#unlocking-an-encrypted-volume">Unlocking an Encrypted Volume</a></li>
<li><a class="reference internal" href="#if-something-goes-wrong">If Something Goes Wrong</a></li>
<li><a class="reference internal" href="#upgrading-a-zfs-pool">Upgrading a ZFS Pool</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#section-2-using-the-graphical-interface">Section 2: Using the Graphical Interface</a><ul>
<li><a class="reference internal" href="#quick-start-guide-and-account-configuration">Quick Start Guide and Account Configuration</a><ul>
<li><a class="reference internal" href="#quick-start-guide">Quick Start Guide</a><ul>
<li><a class="reference internal" href="#set-the-root-password">Set the Root Password</a></li>
<li><a class="reference internal" href="#set-the-administrative-email-address">Set the Administrative Email Address</a></li>
<li><a class="reference internal" href="#enable-console-logging">Enable Console Logging</a></li>
<li><a class="reference internal" href="#configure-storage">Configure Storage</a></li>
<li><a class="reference internal" href="#create-users-groups-or-integrate-with-ad-ldap">Create Users/Groups or Integrate with AD/LDAP</a></li>
<li><a class="reference internal" href="#configure-permissions">Configure Permissions</a></li>
<li><a class="reference internal" href="#configure-sharing">Configure Sharing</a></li>
<li><a class="reference internal" href="#start-applicable-service-s">Start Applicable Service(s)</a></li>
<li><a class="reference internal" href="#test-configuration-from-client">Test Configuration from Client</a></li>
<li><a class="reference internal" href="#backup-the-configuration">Backup the Configuration</a></li>
</ul>
</li>
<li><a class="reference internal" href="#account-configuration">Account Configuration</a><ul>
<li><a class="reference internal" href="#id55">Groups</a></li>
<li><a class="reference internal" href="#id58">Users</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#system-configuration">System Configuration</a><ul>
<li><a class="reference internal" href="#id74">Cron Jobs</a></li>
<li><a class="reference internal" href="#id76">Init/Shutdown Scripts</a></li>
<li><a class="reference internal" href="#id77">NTP Servers</a></li>
<li><a class="reference internal" href="#id78">Rsync Tasks</a><ul>
<li><a class="reference internal" href="#creating-an-rsync-task">Creating an Rsync Task</a></li>
<li><a class="reference internal" href="#configuring-rsync-module-mode-between-two-freenas-systems">Configuring Rsync Module Mode Between Two FreeNAS® Systems</a></li>
<li><a class="reference internal" href="#configuring-rsync-over-ssh-mode-between-two-freenas-systems">Configuring Rsync over SSH Mode Between Two FreeNAS® Systems</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id87">S.M.A.R.T. Tests</a></li>
<li><a class="reference internal" href="#id91">Settings</a><ul>
<li><a class="reference internal" href="#general-tab">General Tab</a></li>
<li><a class="reference internal" href="#advanced-tab">Advanced Tab</a><ul>
<li><a class="reference internal" href="#id98">Autotune</a></li>
</ul>
</li>
<li><a class="reference internal" href="#email-tab">Email Tab</a></li>
<li><a class="reference internal" href="#ssl-tab">SSL Tab</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id101">Sysctls</a></li>
<li><a class="reference internal" href="#id103">System Information</a></li>
<li><a class="reference internal" href="#id104">Tunables</a><ul>
<li><a class="reference internal" href="#recovering-from-incorrect-tunables">Recovering From Incorrect Tunables</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#network-configuration">Network Configuration</a><ul>
<li><a class="reference internal" href="#id106">Global Configuration</a></li>
<li><a class="reference internal" href="#id109">Interfaces</a></li>
<li><a class="reference internal" href="#id111">IPMI</a></li>
<li><a class="reference internal" href="#id114">Link Aggregations</a><ul>
<li><a class="reference internal" href="#considerations-when-using-lacp-mpio-nfs-or-esxi">Considerations When Using LACP, MPIO, NFS, or ESXi</a></li>
<li><a class="reference internal" href="#creating-a-link-aggregation">Creating a Link Aggregation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id119">Network Summary</a></li>
<li><a class="reference internal" href="#id120">Static Routes</a></li>
<li><a class="reference internal" href="#id121">VLANs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#storage-configuration">Storage Configuration</a><ul>
<li><a class="reference internal" href="#id129">Periodic Snapshot Tasks</a><ul>
<li><a class="reference internal" href="#creating-a-periodic-snapshot-task">Creating a Periodic Snapshot Task</a></li>
<li><a class="reference internal" href="#managing-periodic-snapshot-tasks">Managing Periodic Snapshot Tasks</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id133">Replication Tasks</a><ul>
<li><a class="reference internal" href="#configure-pull">Configure PULL</a></li>
<li><a class="reference internal" href="#configure-push">Configure PUSH</a></li>
<li><a class="reference internal" href="#troubleshooting-replication">Troubleshooting Replication</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id137">Volumes</a><ul>
<li><a class="reference internal" href="#auto-importing-volumes">Auto Importing Volumes</a><ul>
<li><a class="reference internal" href="#auto-importing-a-geli-encrypted-zfs-pool">Auto Importing a GELI-Encrypted ZFS Pool</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id142">Importing Volumes</a></li>
<li><a class="reference internal" href="#id143">UFS Volume Manager</a></li>
<li><a class="reference internal" href="#id146">ZFS Volume Manager</a><ul>
<li><a class="reference internal" href="#id152">Encryption</a><ul>
<li><a class="reference internal" href="#creating-an-encrypted-volume">Creating an Encrypted Volume</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id155">Manual Volume Creation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id159">Extending a ZFS Volume</a></li>
<li><a class="reference internal" href="#id162">Creating ZFS Datasets</a><ul>
<li><a class="reference internal" href="#id165">Deduplication</a></li>
<li><a class="reference internal" href="#id168">Compression</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id177">Creating a zvol</a></li>
<li><a class="reference internal" href="#viewing-disks">Viewing Disks</a></li>
<li><a class="reference internal" href="#viewing-volumes">Viewing Volumes</a><ul>
<li><a class="reference internal" href="#key-management-for-encrypted-volumes">Key Management for Encrypted Volumes</a></li>
</ul>
</li>
<li><a class="reference internal" href="#setting-permissions">Setting Permissions</a></li>
<li><a class="reference internal" href="#viewing-multipaths">Viewing Multipaths</a></li>
<li><a class="reference internal" href="#id202">Replacing a Failed Drive</a><ul>
<li><a class="reference internal" href="#replacing-a-failed-drive-in-an-encrypted-pool">Replacing a Failed Drive in an Encrypted Pool</a></li>
<li><a class="reference internal" href="#removing-a-log-or-cache-device">Removing a Log or Cache Device</a></li>
</ul>
</li>
<li><a class="reference internal" href="#replacing-drives-to-grow-a-zfs-pool">Replacing Drives to Grow a ZFS Pool</a><ul>
<li><a class="reference internal" href="#enabling-zfs-pool-expansion-after-drive-replacement">Enabling ZFS Pool Expansion After Drive Replacement</a></li>
</ul>
</li>
<li><a class="reference internal" href="#splitting-a-mirrored-zfs-storage-pool">Splitting a Mirrored ZFS Storage Pool</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id212">ZFS Scrubs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sharing-configuration">Sharing Configuration</a><ul>
<li><a class="reference internal" href="#apple-afp-shares">Apple (AFP) Shares</a><ul>
<li><a class="reference internal" href="#creating-afp-shares">Creating AFP Shares</a></li>
<li><a class="reference internal" href="#connecting-to-afp-shares-as-guest">Connecting to AFP Shares As Guest</a></li>
<li><a class="reference internal" href="#using-time-machine">Using Time Machine</a></li>
</ul>
</li>
<li><a class="reference internal" href="#unix-nfs-shares">Unix (NFS) Shares</a><ul>
<li><a class="reference internal" href="#creating-nfs-shares">Creating NFS Shares</a></li>
<li><a class="reference internal" href="#sample-nfs-share-configuration">Sample NFS Share Configuration</a></li>
<li><a class="reference internal" href="#connecting-to-the-nfs-share">Connecting to the NFS Share</a><ul>
<li><a class="reference internal" href="#from-bsd-or-linux-clients">From BSD or Linux Clients</a></li>
<li><a class="reference internal" href="#from-microsoft-clients">From Microsoft Clients</a></li>
<li><a class="reference internal" href="#from-mac-os-x-clients">From Mac OS X Clients</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id228">Troubleshooting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#windows-cifs-shares">Windows (CIFS) Shares</a><ul>
<li><a class="reference internal" href="#id231">Creating CIFS Shares</a></li>
<li><a class="reference internal" href="#configuring-a-share">Configuring a Share</a></li>
<li><a class="reference internal" href="#id240">Configuring Shadow Copies</a><ul>
<li><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li><a class="reference internal" href="#configuration-example">Configuration Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id242">Services Configuration</a><ul>
<li><a class="reference internal" href="#id248">Control Services</a></li>
<li><a class="reference internal" href="#id250">AFP</a><ul>
<li><a class="reference internal" href="#id254">Troubleshooting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id256">CIFS</a><ul>
<li><a class="reference internal" href="#troubleshooting-tips">Troubleshooting Tips</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id262">Directory Services</a><ul>
<li><a class="reference internal" href="#id263">Active Directory</a><ul>
<li><a class="reference internal" href="#id269">Using a Keytab</a></li>
<li><a class="reference internal" href="#id270">Troubleshooting Tips</a></li>
</ul>
</li>
<li><a class="reference internal" href="#domain-controller">Domain Controller</a></li>
<li><a class="reference internal" href="#id275">LDAP</a></li>
<li><a class="reference internal" href="#nis">NIS</a></li>
<li><a class="reference internal" href="#id278">NT4</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id282">Dynamic DNS</a></li>
<li><a class="reference internal" href="#id283">FTP</a><ul>
<li><a class="reference internal" href="#ftp-configuration-options">FTP Configuration Options</a></li>
<li><a class="reference internal" href="#anonymous-ftp">Anonymous FTP</a></li>
<li><a class="reference internal" href="#specified-user-access-in-chroot">Specified User Access in chroot</a></li>
<li><a class="reference internal" href="#id295">Encrypting FTP</a></li>
<li><a class="reference internal" href="#id296">Troubleshooting</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id299">iSCSI</a><ul>
<li><a class="reference internal" href="#authorized-accesses">Authorized Accesses</a></li>
<li><a class="reference internal" href="#extents">Extents</a><ul>
<li><a class="reference internal" href="#adding-an-extent">Adding an Extent</a></li>
</ul>
</li>
<li><a class="reference internal" href="#initiators">Initiators</a></li>
<li><a class="reference internal" href="#portals">Portals</a></li>
<li><a class="reference internal" href="#id302">Target Global Configuration</a></li>
<li><a class="reference internal" href="#targets">Targets</a></li>
<li><a class="reference internal" href="#target-extents">Target/Extents</a></li>
<li><a class="reference internal" href="#connecting-to-iscsi-share">Connecting to iSCSI Share</a></li>
<li><a class="reference internal" href="#growing-luns">Growing LUNs</a><ul>
<li><a class="reference internal" href="#zvol-based-lun">Zvol Based LUN</a></li>
<li><a class="reference internal" href="#file-extent-based-lun">File Extent Based LUN</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id314">NFS</a></li>
<li><a class="reference internal" href="#id316">Rsync</a><ul>
<li><a class="reference internal" href="#id318">Rsync Modules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id320">S.M.A.R.T.</a></li>
<li><a class="reference internal" href="#id324">SNMP</a></li>
<li><a class="reference internal" href="#id326">SSH</a><ul>
<li><a class="reference internal" href="#ssh-configuration-screen">SSH Configuration Screen</a></li>
<li><a class="reference internal" href="#chrooting-command-line-sftp-users">Chrooting Command Line SFTP Users</a></li>
<li><a class="reference internal" href="#troubleshooting-ssh-connections">Troubleshooting SSH Connections</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id335">TFTP</a></li>
<li><a class="reference internal" href="#id336">UPS</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plugins">Plugins</a><ul>
<li><a class="reference internal" href="#installing-a-freenas-pbi-using-plugins">Installing a FreeNAS® PBI Using Plugins</a><ul>
<li><a class="reference internal" href="#managing-an-installed-freenas-pbi">Managing an Installed FreeNAS® PBI</a></li>
<li><a class="reference internal" href="#updating-an-installed-freenas-pbi">Updating an Installed FreeNAS® PBI</a></li>
<li><a class="reference internal" href="#installing-additional-pbis">Installing Additional PBIs</a></li>
<li><a class="reference internal" href="#deleting-a-pbi">Deleting a PBI</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id348">Available FreeNAS® PBIs</a><ul>
<li><a class="reference internal" href="#pbi-requests">PBI Requests</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id350">Jails</a><ul>
<li><a class="reference internal" href="#id355">Jails Configuration</a></li>
<li><a class="reference internal" href="#id356">Adding Jails</a><ul>
<li><a class="reference internal" href="#id362">Managing Jails</a></li>
<li><a class="reference internal" href="#accessing-a-jail-using-ssh-instead-of-its-shell-icon">Accessing a Jail Using SSH Instead of its Shell Icon</a><ul>
<li><a class="reference internal" href="#edit-a-jail-s-settings">Edit a Jail&#8217;s Settings</a></li>
<li><a class="reference internal" href="#id364">Adding Storage</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id366">Jail Templates</a><ul>
<li><a class="reference internal" href="#creating-your-own-templates">Creating Your Own Templates</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id367">Installing FreeNAS® PBIs</a></li>
<li><a class="reference internal" href="#id370">Installing non-PBI Software</a><ul>
<li><a class="reference internal" href="#installing-freebsd-packages-with-pkgng">Installing FreeBSD Packages with pkgng</a></li>
<li><a class="reference internal" href="#compiling-freebsd-ports-with-make">Compiling FreeBSD Ports with make</a></li>
<li><a class="reference internal" href="#configuring-and-starting-installed-freebsd-software">Configuring and Starting Installed FreeBSD Software</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#reporting">Reporting</a></li>
<li><a class="reference internal" href="#additional-options">Additional Options</a><ul>
<li><a class="reference internal" href="#display-system-processes">Display System Processes</a></li>
<li><a class="reference internal" href="#id376">Shell</a></li>
<li><a class="reference internal" href="#reboot">Reboot</a></li>
<li><a class="reference internal" href="#shutdown">Shutdown</a></li>
<li><a class="reference internal" href="#id383">Help</a></li>
<li><a class="reference internal" href="#log-out">Log Out</a></li>
<li><a class="reference internal" href="#alert">Alert</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#section-3-getting-help">Section 3: Getting Help</a><ul>
<li><a class="reference internal" href="#id384">FreeNAS® Support Resources</a><ul>
<li><a class="reference internal" href="#id385">Website and Social Media</a></li>
<li><a class="reference internal" href="#id386">Forums</a></li>
<li><a class="reference internal" href="#id395">Support Database</a></li>
<li><a class="reference internal" href="#id396">IRC</a></li>
<li><a class="reference internal" href="#id397">Mailing Lists</a></li>
<li><a class="reference internal" href="#id398">Professional Support</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id399">Useful Command Line Utilities</a><ul>
<li><a class="reference internal" href="#id408">Iperf</a></li>
<li><a class="reference internal" href="#id411">Netperf</a></li>
<li><a class="reference internal" href="#id413">IOzone</a></li>
<li><a class="reference internal" href="#id416">arcstat</a><ul>
<li><a class="reference internal" href="#using-the-scripts">Using the Scripts</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id421">XDD</a></li>
<li><a class="reference internal" href="#id431">tw_cli</a></li>
<li><a class="reference internal" href="#id434">MegaCli</a></li>
<li><a class="reference internal" href="#id436">freenas-debug</a></li>
<li><a class="reference internal" href="#id441">tmux</a></li>
<li><a class="reference internal" href="#id443">Dmidecode</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#section-4-contributing-to-freenas">Section 4: Contributing to FreeNAS®</a><ul>
<li><a class="reference internal" href="#how-to-get-involved">How to Get Involved</a><ul>
<li><a class="reference internal" href="#id447">Assist with Localization</a></li>
<li><a class="reference internal" href="#test-an-upcoming-version">Test an Upcoming Version</a><ul>
<li><a class="reference internal" href="#rolling-your-own-testing-snapshot">Rolling Your Own Testing Snapshot</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#using-the-freenas-api">Using the FreeNAS® API</a><ul>
<li><a class="reference internal" href="#building-a-local-copy-of-the-apis">Building a Local Copy of the APIs</a></li>
<li><a class="reference internal" href="#a-simple-api-example">A Simple API Example</a></li>
<li><a class="reference internal" href="#a-more-complex-example">A More Complex Example</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/index.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li><a href="test.html">freenas 9.2.2 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, freenas.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>