Here's a snapshot of the FreeBSD 8.1-based FreeNAS.  It features a move to
the /etc/rc.d startup scripting, a move to a Django-based GUI and should
set the stage for a more modular system in the future.

This snapshot is for developers and very experienced users only.  It
is not functionally complete yet, and there are likely many rough
edges.  The code is of alpha quality.  It has no safeguards against
accidentally initializing a previously configured volume, zpool or
raid mirror.  No support for software raid exists in this release
(only single disks and zfs).  There's no upgrade path for this
snapshot (no conversion from old releases, no in-place firmware
upgrades like FreeNAS 0.7 and earlier had, etc).  There is no way to
import old volumes.  This snapshot should be viewed as a technology
preview only.

The GUI is currently incomplete.  You can configure your network
address, some misc system configuration, ssh, ftp, tftp, cifs/samba
and nfs.  All the GUI screens should work at least to the point of
saving the data to the database.  You may encounter a GUI hang if you
turn a service on and then off due to a signal mask problem that we've
not yet corrected.  If you encounter this, reboot the system and the
GUI will return, and the configured functionality, including the
last-saved transaction, should work.

The GUI should behave basically the same as 0.7's GUI, but there are
some differences.  The biggest differences are in configuring disks.
You need to add one of the disks (there's no safeguards against adding
the same disk multiple times, adding the system disk, etc).  Once you
add the disk to the system via the GUI, you need to create a disk
group (even for groups of 1).  Then you can create a volume that is
the basis for all further things in the system.

The GUI does not yet replicate the file chooser functionality for
pathnames that the old system had.  You'll have to type the path.

To build the system (experts only):

You will need your own FreeBSD src tree, your own ports tree.  FreeBSD
8.1 Release ports should work.  The ports tree as of
2010.06.24.12.00.00 is also known to work.

The build tree I have under a common root:

freebsd/src		FreeBSD 8.1 Release sources [*]
freebsd/ports		FreeBSD /usr/ports tree
freenas			The experimental/ix part of the FreeNAS svn tree

[*] currently, you must apply the patches in experimental/ix/patches to the
FreeBSD 8.1-RELEASE tree (once) before you start the build process.  Otherwise,
the initial database won't be in /data and there will be a boatload of
complaints from the boot scripts (there's one complaint that's expected, but
without the patch you'll have like 20).

cd freebsd/src
sh tools/tools/nanobsd/nanobsd.sh -c ../../freenas/nanobsd/freenas64.conf

# or for the i386 builds:
cd freebsd/src
sh tools/tools/nanobsd/nanobsd.sh -c ../../freenas/nanobsd/freenas32.conf

If the build fails, and you want to try again, you can add -b to the end of
the line and it will skip the FreeBSD build.

You'll wind up with a tree in /tmp/$LOGNAME/obj.freenas64.   The final binary
image will be in /tmp/$LOGNAME/obj.freenas64/_.disk.full and can be dd'd from
there, or converted to a VM container.  The build takes between 2-4 hours
depending on the speed of your machine.

Native builds on amd64 and i386 work.  Cross building i386 on amd64 currently
fails.
